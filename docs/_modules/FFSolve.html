
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>FFSolve &#8212; LQCD Analysis Codebase TF Fits documentation</title>
    <link rel="stylesheet" href="../_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>
    <div class="header-wrapper" role="banner">
      <div class="header">
        <div class="headertitle"><a
          href="../index.html">LQCD Analysis Codebase TF Fits documentation</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for FFSolve</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># import matplotlib</span>
<span class="c1"># matplotlib.use(&#39;Agg&#39;) # Must be before importing matplotlib.pyplot or pylab!</span>
<span class="c1"># import matplotlib.pyplot as pl</span>
<span class="c1"># import PlotData as jpl</span>

<span class="c1"># from BootStrapping import BootStrap</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span><span class="p">,</span><span class="n">copy</span>
<span class="kn">from</span> <span class="nn">MiscFuns</span> <span class="k">import</span> <span class="n">ODNested</span><span class="p">,</span><span class="n">mkdir_p</span><span class="p">,</span><span class="n">CreateNameAndLL</span><span class="p">,</span><span class="n">op_dict</span>
<span class="kn">from</span> <span class="nn">MiscFuns</span> <span class="k">import</span> <span class="n">flip_fun_2arg</span><span class="p">,</span><span class="n">GetInfoList</span><span class="p">,</span><span class="n">GenSinkFun</span><span class="p">,</span><span class="n">ReduceCfgs</span>
<span class="kn">import</span> <span class="nn">MomParams</span> <span class="k">as</span> <span class="nn">mp</span>
<span class="kn">from</span> <span class="nn">Params</span> <span class="k">import</span> <span class="n">defFitDict</span><span class="p">,</span><span class="n">defmom2list</span><span class="p">,</span><span class="n">outputdir</span><span class="p">,</span><span class="n">scratchdir</span><span class="p">,</span><span class="n">Debug_Mode</span><span class="p">,</span><span class="n">Wipe_All_Fits</span>
<span class="kn">from</span> <span class="nn">Params</span> <span class="k">import</span> <span class="n">defFitAlpha</span><span class="p">,</span><span class="n">defMcore</span><span class="p">,</span><span class="n">nchi_threshold</span><span class="p">,</span><span class="n">nchi_fit_threshold</span><span class="p">,</span><span class="n">myeps</span>
<span class="kn">from</span> <span class="nn">MultiWrap</span> <span class="k">import</span> <span class="n">DoMulticore</span>
<span class="c1"># from Params import plot_the_ff</span>
<span class="c1"># import multiprocessing</span>
<span class="c1"># import glob,sys</span>
<span class="kn">import</span> <span class="nn">operator</span> <span class="k">as</span> <span class="nn">op</span>
<span class="c1"># from FFFuns import *</span>
<span class="kn">from</span> <span class="nn">SetsOfRatios</span> <span class="k">import</span> <span class="n">SetOfRat</span>
<span class="kn">from</span> <span class="nn">SetsOfTwoPtCorrs</span> <span class="k">import</span> <span class="n">SetOfNNQ</span><span class="p">,</span><span class="n">SetOfNNQFull</span>
<span class="kn">from</span> <span class="nn">TwoPtCorrelators</span> <span class="k">import</span> <span class="n">TwoPointCorr</span><span class="p">,</span><span class="n">NNQCorr</span><span class="p">,</span><span class="n">NNQFullCorr</span>
<span class="kn">from</span> <span class="nn">FormFactors</span> <span class="k">import</span> <span class="n">FormFact</span><span class="p">,</span><span class="n">FFRenorm</span><span class="p">,</span><span class="n">FFQ2FitFun</span><span class="p">,</span><span class="n">FF_Imp</span>
<span class="kn">from</span> <span class="nn">QuantityLists</span> <span class="k">import</span> <span class="n">ObsListAbr</span>
<span class="kn">from</span> <span class="nn">BootStrapping</span> <span class="k">import</span> <span class="n">BootStrap</span>

<span class="c1"># from PredefFitFuns import FormFactorO1,FormFactorO2,FormFactorO3,LinearFitFun,DPfitfun</span>
<span class="c1"># from PredefFitFuns import FormFactorO1,LinearFitFun,DPfitfun</span>
<span class="kn">from</span> <span class="nn">PredefFitFuns</span> <span class="k">import</span> <span class="n">FormFactorO1</span>
<span class="kn">import</span> <span class="nn">FitFunctions</span> <span class="k">as</span> <span class="nn">ff</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">XmlFormatting</span> <span class="k">import</span> <span class="n">QsqrdToFormat</span><span class="p">,</span><span class="n">unxmlfitr</span><span class="p">,</span><span class="n">tflowTOLeg</span><span class="p">,</span><span class="n">AvgStdToFormat</span><span class="p">,</span><span class="n">KeyForamtting</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">dill</span> <span class="k">as</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pa</span>
<span class="c1"># from FileIO import WriteXml,WritePickle,ReadPickleWrap,BackupFile,WriteFuns,ReadFuns</span>
<span class="kn">from</span> <span class="nn">FileIO</span> <span class="k">import</span> <span class="n">WriteXml</span><span class="p">,</span><span class="n">WritePickle</span><span class="p">,</span><span class="n">ReadPickleWrap</span><span class="p">,</span><span class="n">BackupFile</span>
<span class="kn">from</span> <span class="nn">GammaMatricies</span> <span class="k">import</span> <span class="n">CorrSpinTrace</span>
<span class="kn">from</span> <span class="nn">DSDefines</span> <span class="k">import</span> <span class="n">DSfundict</span>
<span class="kn">from</span> <span class="nn">TimeStuff</span> <span class="k">import</span> <span class="n">Timer</span>
<span class="kn">import</span> <span class="nn">itertools</span>

<span class="c1">## title for ratio comparison</span>
<span class="c1">## $G_{3}$ Fit Range Comparison $m_{\pi}=411MeV$ Neutron $F_{3}/2m_{N}$</span>
<span class="c1">## ylabel for CP odd form factor F3</span>
<span class="c1">## $\frac{F_{3}}{2m_{N}}$</span>

<div class="viewcode-block" id="FFEquation"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation">[docs]</a><span class="k">class</span> <span class="nc">FFEquation</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    This class uses FormFact from FormFactors.py and RatioCorr from RatioCorrelators.py</span>

<span class="sd">    sets up system of equations to solve:</span>

<span class="sd">    Af = R , with indicies:</span>
<span class="sd">    A_1a * f_a + a_1b * f_b + ... = R_1</span>
<span class="sd">    A_2a * f_a + a_2b * f_b + ... = R_2</span>
<span class="sd">    ...</span>


<span class="sd">    A = coefficients of form factors [ A_1a , A_1b , ... ]</span>
<span class="sd">                                     [ A_2a , A_2b , ... ]</span>
<span class="sd">                                     [ ...               ]</span>

<span class="sd">    R = extracted ratio function results (from fits to correlators or ratio functions)</span>
<span class="sd">    R = [ R_2, R_1, ... ]</span>

<span class="sd">    f = form factors to solve for [f_a, f_b,...]</span>

<span class="sd">    default q2list is usually [0,1,2,3,4] , (depends on what you calculate, set in MomParams.py if you like )</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">parentlist</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="FFEquation.reInit"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.reInit">[docs]</a>    <span class="k">def</span> <span class="nf">reInit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">FFEquation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">,</span><span class="n">q2list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q2list</span><span class="p">,</span><span class="n">pp2list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pp2list</span><span class="p">,</span><span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglistin</span><span class="p">,</span> <span class="n">Info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">,</span>
                          <span class="n">fit2pt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fit2ptin</span><span class="p">,</span><span class="n">fitAlpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fitAlphain</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">namein</span><span class="p">,</span>
                          <span class="n">thissym</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thissym</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">currtype</span><span class="p">,</span><span class="n">q2list</span><span class="o">=</span><span class="n">defmom2list</span><span class="p">,</span><span class="n">pp2list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cfglist</span><span class="o">=</span><span class="p">{},</span>
                        <span class="n">cfglist2pt</span><span class="o">=</span><span class="p">{},</span><span class="n">Info</span><span class="o">=</span><span class="p">{},</span><span class="n">fit2pt</span><span class="o">=</span><span class="s1">&#39;From Def&#39;</span><span class="p">,</span><span class="n">fitAlpha</span><span class="o">=</span><span class="s1">&#39;From Def&#39;</span><span class="p">,</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">thissym</span><span class="o">=</span><span class="s1">&#39;Not Set&#39;</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="s1">&#39;Not Set&#39;</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span> <span class="o">=</span> <span class="n">thisshift</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span> <span class="o">=</span> <span class="n">thiscol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thissym</span> <span class="o">=</span> <span class="n">thissym</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfglistin</span> <span class="o">=</span> <span class="n">cfglist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span> <span class="o">=</span> <span class="n">cfglist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q2list</span> <span class="o">=</span> <span class="n">q2list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pp2list</span> <span class="o">=</span> <span class="n">pp2list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Info</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">Info</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit2ptin</span> <span class="o">=</span> <span class="n">fit2pt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitAlphain</span> <span class="o">=</span> <span class="n">fitAlpha</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nchi_threshold</span> <span class="o">=</span> <span class="n">nchi_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nchi_fit_threshold</span> <span class="o">=</span> <span class="n">nchi_fit_threshold</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fitAlpha</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fitAlphain</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitAlphain</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currtype</span> <span class="o">=</span> <span class="n">currtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">namein</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thisshiftscale</span> <span class="o">=</span> <span class="s1">&#39;Not Set&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Renormed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Inefm</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="s1">&#39;Rat_alpha&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_alpha</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;Rat_alpha&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_alpha</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">## default to no symmetrizing, (usually full matrix isn&#39;t computed nowerdays.</span>


        <span class="k">if</span> <span class="s1">&#39;Alpha_Full&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">doAlphafull</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;Alpha_Full&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">doAlphafull</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="s1">&#39;Chi_Cutoff&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">Do_Chi_cutoff</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;Chi_Cutoff&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="bp">self</span><span class="o">.</span><span class="n">Do_Chi_cutoff</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Do_Chi_cutoff</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;Chi2pdf_Min&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">Chi2pdf_Min</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;Chi2pdf_Min&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>  <span class="bp">self</span><span class="o">.</span><span class="n">Chi2pdf_Min</span> <span class="o">=</span> <span class="mf">0.3</span>
            <span class="k">if</span> <span class="s1">&#39;Chi2pdf_Max&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">Chi2pdf_Max</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;Chi2pdf_Max&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>  <span class="bp">self</span><span class="o">.</span><span class="n">Chi2pdf_Max</span> <span class="o">=</span> <span class="mf">0.7</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Chi2pdf_Min</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Chi2pdf_Max</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="s1">&#39;RF_fit_range_minimum&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">RF_fit_range_minimum</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;RF_fit_range_minimum&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="bp">self</span><span class="o">.</span><span class="n">RF_fit_range_minimum</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="k">if</span> <span class="s1">&#39;RF_fit_max&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">RF_fit_max</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;RF_fit_max&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="bp">self</span><span class="o">.</span><span class="n">RF_fit_max</span> <span class="o">=</span> <span class="mi">11</span>

        <span class="k">if</span> <span class="s1">&#39;RF_fit_min&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">RF_fit_min</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;RF_fit_min&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="bp">self</span><span class="o">.</span><span class="n">RF_fit_min</span> <span class="o">=</span> <span class="mi">2</span>


        <span class="k">if</span> <span class="s1">&#39;Rat_tsum_range&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_tsum_range</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;Rat_tsum_range&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="bp">self</span><span class="o">.</span><span class="n">Rat_tsum_range</span> <span class="o">=</span> <span class="s1">&#39;tsumfitr2-20&#39;</span>


        <span class="k">if</span> <span class="s1">&#39;Important_FF&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">Important_FF</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;Important_FF&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="bp">self</span><span class="o">.</span><span class="n">Important_FF</span> <span class="o">=</span> <span class="kc">True</span>


        <span class="k">if</span> <span class="s1">&#39;Reduce_System&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reduce_System</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;Reduce_System&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="bp">self</span><span class="o">.</span><span class="n">Reduce_System</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="s1">&#39;Rat_comb_alpha_fun&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">ralpha_mult_fun</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;Rat_comb_alpha_fun&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ralpha_mult_fun</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">truediv</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ralpha_mult_fun</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ralpha_mult_fun</span> <span class="o">=</span> <span class="n">op_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ralpha_mult_fun</span><span class="p">]</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Top&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;Wein&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">)</span>



        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;Top&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flowtype</span> <span class="o">=</span> <span class="s1">&#39;TopCharge&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flowlab</span> <span class="o">=</span> <span class="s1">&#39;Top&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;Wein&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flowtype</span> <span class="o">=</span> <span class="s1">&#39;Weinberg&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flowlab</span> <span class="o">=</span> <span class="s1">&#39;Wein&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;Full_Rat&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflowfull</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;Full_Rat&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflowfull</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flowtype</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flowlab</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doflowfull</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cfg_fromfile</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfglist</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfg_fromfile</span> <span class="o">=</span> <span class="n">cfglist</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">cfglist</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;found previous cfglist, skipping search&#39;</span><span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cfglist</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;previous config file not found at&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">cfglist</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span> <span class="o">=</span> <span class="n">cfglist</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">cfg_fromfile_2pt</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfglist2pt</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfg_fromfile_2pt</span> <span class="o">=</span> <span class="n">cfglist2pt</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">cfglist2pt</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;found previous cfglist2pt, skipping search&#39;</span><span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cfglist2pt</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cfglist2pt</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;previous config2pt file not found at &#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">cfglist2pt</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cfglist2pt</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfglist2pt</span> <span class="o">=</span> <span class="n">cfglist2pt</span>





        <span class="c1">## Info can contain fit ranges to be calculated</span>
        <span class="c1">## must bein form Info[&#39;FlowFitFun&#39;] = (Function Object , number of parameters )</span>
        <span class="k">if</span> <span class="s1">&#39;FFiGuess&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;FFiGuess&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span>

        <span class="c1">## Info can contain fit ranges to be calculated</span>
        <span class="c1">## must bein form Info[&#39;FFFits&#39;] = [ &#39;fit#-#&#39; , ...]</span>
        <span class="k">if</span> <span class="s1">&#39;FFFits&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">PredefFits</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;FFFits&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">PredefFits</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="s1">&#39;tflowfit&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">tflows</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;tflowfit&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tflows</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">]</span>

        <span class="c1">## makes alpha have the same config list as everything else</span>
        <span class="k">if</span> <span class="s1">&#39;AlphaFree&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">alphafree</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;AlphaFree&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">alphafree</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># ## makes mass have same config list as everything else</span>
        <span class="c1"># if &#39;MassFree&#39; in Info.keys(): self.MassFree = Info[&#39;MassFree&#39;]</span>
        <span class="c1"># else: self.MassFree = False</span>



        <span class="c1">## DoubSing tells whether to read doublet (doub) or singlet (sing) contribution</span>
        <span class="k">if</span> <span class="s1">&#39;DoubSing&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;DoubSing&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">DSfundict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DSList (from DSDefines.py):&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">DSfundict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Doublet,Singlet type (Info[&#39;DoubSing&#39;]) not recognised&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DS</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;DoubSing&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Please set DoubSing in Info for ThreePtCorrelators &#39;</span><span class="p">)</span>

        <span class="c1">## Info can contain fit ranges to be calculated</span>
        <span class="c1">## must bein form Info[&#39;FlowFitFun&#39;] = (Function Object , number of parameters )</span>
        <span class="c1">## Fit Functions are now hard coded into FormFactors.py</span>
        <span class="c1">## modify FFFitFuns in FormFactors.py to change</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ppparams</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">LatticeParameters</span><span class="p">(</span><span class="n">mom2list</span><span class="o">=</span><span class="n">pp2list</span><span class="p">,</span><span class="n">Info</span><span class="o">=</span><span class="n">Info</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ppparams</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qparams</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">LatticeParameters</span><span class="p">(</span><span class="n">mom2list</span><span class="o">=</span><span class="n">q2list</span><span class="p">,</span><span class="n">Info</span><span class="o">=</span><span class="n">Info</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">nt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nxyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">nxyz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span> <span class="o">=</span> <span class="s1">&#39;RC&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nxyz</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;x&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim_ll</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nxyz</span><span class="p">)</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;^</span><span class="si">{3}</span><span class="s1">\times &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SetCustomName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1">## if flowed run</span>
        <span class="c1">##      self.FitDict [itflow , iFF , ifit] fitting class instance</span>
        <span class="c1">## else</span>
        <span class="c1">##      self.FitDict [iff , ifitr ] fitting instance</span>
        <span class="c1"># self.FitDict = ODNested()</span>
        <span class="c1"># self.FitDictAvg = ODNested()</span>
        <span class="c1"># self.FitDictStd = ODNested()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FF_Col_Names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;flow_time&#39;</span><span class="p">,</span><span class="s1">&#39;Chi2pdf_number&#39;</span><span class="p">,</span><span class="s1">&#39;Q_momentum&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FF_Col_Names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Chi2pdf_number&#39;</span><span class="p">,</span><span class="s1">&#39;Q_momentum&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        self.FF_Stats DataFrame:</span>

<span class="sd">        columns =   boot,   Avg,        Std</span>

<span class="sd">        rows =     &#39;flow_time&#39; (if flowed), Chi2pdf_number, &#39;Q_momentum&#39;</span>

<span class="sd">        data is Fitting class instance (which includes form factor numbers as parameters)</span>
<span class="sd">        &#39;&#39;&#39;</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Col_Names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;flow_time&#39;</span><span class="p">,</span><span class="s1">&#39;Chi2pdf_number&#39;</span><span class="p">,</span><span class="s1">&#39;form_factor_number&#39;</span><span class="p">,</span><span class="s1">&#39;Q_fit_range&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Col_Names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Chi2pdf_number&#39;</span><span class="p">,</span><span class="s1">&#39;form_factor_number&#39;</span><span class="p">,</span><span class="s1">&#39;Q_fit_range&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        self.FF_Fit_Stats DataFrame:</span>

<span class="sd">        columns =   boot,   Avg,        Std</span>

<span class="sd">        rows =      flow_time(if flowed), Chi2pdf_number, form_factor_number,   fit_range</span>

<span class="sd">        data is Fitting class instance, fit parameters are for fitting form factor</span>
<span class="sd">        &#39;&#39;&#39;</span>



<div class="viewcode-block" id="FFEquation.LoadPreFF"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.LoadPreFF">[docs]</a>    <span class="k">def</span> <span class="nf">LoadPreFF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1">## set mass later</span>
        <span class="n">thisfile</span> <span class="o">=</span> <span class="s1">&#39;Pre&#39;</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span> <span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">,</span><span class="s1">&#39;q&#39;</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">mom2list</span><span class="p">)),</span>
                                    <span class="s1">&#39;pp&#39;</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ppparams</span><span class="o">.</span><span class="n">mom2list</span><span class="p">)),</span><span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thispreFF</span> <span class="o">=</span> <span class="n">FormFact</span><span class="p">(</span>  <span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">mom2list</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ppparams</span><span class="o">.</span><span class="n">mom2list</span><span class="p">,</span>
                                    <span class="n">Info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">thisfile</span><span class="p">,</span><span class="n">tflowlist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">)</span>


        <span class="c1">## gamma maricies for all operators in current type need to be found</span>
        <span class="n">Info2pt</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">)</span>
        <span class="c1"># Info2pt[&#39;pmom&#39;] = [&#39;0 0 0&#39;]</span>
        <span class="n">Info2pt</span><span class="p">[</span><span class="s1">&#39;Interp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;CPEven&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PreC2forMass</span> <span class="o">=</span> <span class="n">TwoPointCorr</span><span class="p">(</span><span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist2pt</span><span class="p">,</span> <span class="n">Info</span><span class="o">=</span><span class="n">Info2pt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PreC2forMass</span><span class="o">.</span><span class="n">SetCustomName</span><span class="p">(</span><span class="s1">&#39;MassForFF&#39;</span><span class="p">,</span><span class="s1">&#39;Mass&#39;</span><span class="p">)</span>
        <span class="c1">## we don&#39;t care what mass we use here, so if there is a file, just use it (checkcfgs=false)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PreC2forMass</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">PreGet2ptFit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit2ptin</span><span class="p">)</span>

        <span class="c1">## using above mass (with incorrect configuration list, see below!), the system of equations is set up in self.thispreFF:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Finding acceptable operator+momentum combinations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thispreFF</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PreC2forMass</span><span class="p">,</span><span class="n">thistflowlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span></div>

<div class="viewcode-block" id="FFEquation.LoadRatios"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.LoadRatios">[docs]</a>    <span class="k">def</span> <span class="nf">LoadRatios</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">Mcore</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1">## set up dictionary of RatioCorr instances.</span>
        <span class="c1">## self.thispreFF.keysOpMoms = [ ( icurrOp , ipkey , iqkey ) ]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">InfoList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">namelist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">iOp</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">iq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">thispreFF</span><span class="o">.</span><span class="n">keysOpMoms</span><span class="p">():</span>
            <span class="n">thisInfo</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">)</span>
            <span class="n">thisInfo</span><span class="p">[</span><span class="s1">&#39;ppmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ppparams</span><span class="o">.</span><span class="n">stripmom</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
            <span class="n">thisInfo</span><span class="p">[</span><span class="s1">&#39;qmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">stripmom</span><span class="p">(</span><span class="n">iq</span><span class="p">)]</span>
            <span class="n">thisProj</span><span class="p">,</span><span class="n">thisGamma</span><span class="p">,</span><span class="n">FO</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FormatProjGamma</span><span class="p">(</span><span class="n">iOp</span><span class="p">)</span>
            <span class="n">thisInfo</span><span class="p">[</span><span class="s1">&#39;Observable&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FO</span>
            <span class="n">thisInfo</span><span class="p">[</span><span class="s1">&#39;gammas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">thisGamma</span><span class="p">]</span>
            <span class="n">thisInfo</span><span class="p">[</span><span class="s1">&#39;Projector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisProj</span>
            <span class="n">thisInfo</span><span class="p">[</span><span class="s1">&#39;AllC2p&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1">## namelist is required to make RatioFuns output be unique for every result.</span>
            <span class="c1">## thisProj not needed, because output has projector in different folders</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">namelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;FFRats&#39;</span><span class="p">,</span><span class="n">thisProj</span><span class="p">,</span><span class="n">thisGamma</span><span class="p">,</span><span class="n">iq</span><span class="p">,</span><span class="n">FO</span><span class="p">]))</span>
            <span class="c1"># if self.doflow and (&#39;Top&#39; in thisGamma or &#39;Wein&#39; in thisGamma):</span>
            <span class="c1">#     self.namelist[-1] = self.namelist[-1]+&#39;_&#39;+self.tflow[0]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflowfull</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;Top&#39;</span> <span class="ow">in</span> <span class="n">thisGamma</span> <span class="ow">or</span> <span class="s1">&#39;Wein&#39;</span> <span class="ow">in</span> <span class="n">thisGamma</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">namelist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">namelist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_RatFull&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">InfoList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisInfo</span><span class="p">)</span>

        <span class="c1"># #save memory?</span>
        <span class="c1"># del self.thispreFF</span>

        <span class="c1">## set up SetsOfRat with all momenta and operators</span>
        <span class="c1">## Heads up: self.Ratios eventually gets overridden, look at last instance in __init__ to see form of dictionary</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Please set Info[&#39;tflowfit&#39;] in information dictionary if working with CP odd form factor extraction&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Setting up Ratio Functions&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ratios</span> <span class="o">=</span> <span class="n">SetOfRat</span><span class="p">(</span><span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span><span class="p">,</span><span class="n">InfoDict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">InfoList</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">setnames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">namelist</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Obtaining ratio functions and setting up system of equations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ratios</span><span class="o">.</span><span class="n">LoadPickleCommonC2</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">Mcore</span><span class="o">=</span><span class="n">Mcore</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ratios</span><span class="o">.</span><span class="n">cfglist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ratios</span><span class="o">.</span><span class="n">SetRat</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stream_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetLegLab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg_fromfile</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg_fromfile</span><span class="p">,</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span> <span class="p">,</span> <span class="n">f</span> <span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Error pickling &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg_fromfile</span><span class="p">)</span></div>




<div class="viewcode-block" id="FFEquation.LoadProperFF"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.LoadProperFF">[docs]</a>    <span class="k">def</span> <span class="nf">LoadProperFF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1">## overwrite C2forMass with version with proper configuration list</span>
        <span class="c1">## all 2point correlators in .Ratios will be identical, so just pick first one</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C2forMass</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ratios</span><span class="o">.</span><span class="n">SetRat</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">C2class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Get2ptFit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit2ptin</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span>
            <span class="n">Info2pt</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doAlphafull</span><span class="p">:</span>
                <span class="n">Info2pt</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0 0 0&#39;</span><span class="p">]</span>
            <span class="n">Info2pt</span><span class="p">[</span><span class="s1">&#39;Interp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;CPOdd&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;sm2ptRat&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info2pt</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">sinklab</span><span class="p">,</span><span class="n">jsmcoeffs</span><span class="p">,</span><span class="n">sm2ptList</span><span class="p">,</span><span class="n">InfoList</span> <span class="o">=</span> <span class="n">GetInfoList</span><span class="p">(</span><span class="n">Info2pt</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alphafree</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doAlphafull</span><span class="p">:</span>
                        <span class="n">FOSet</span> <span class="o">=</span> <span class="n">SetOfNNQFull</span><span class="p">(</span><span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist2pt</span><span class="p">,</span><span class="n">InfoDict</span><span class="o">=</span><span class="n">InfoList</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">FOSet</span> <span class="o">=</span> <span class="n">SetOfNNQ</span><span class="p">(</span><span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist2pt</span><span class="p">,</span><span class="n">InfoDict</span><span class="o">=</span><span class="n">InfoList</span><span class="p">)</span>
                    <span class="c1">## this step removes all gauge fields configurations that do not apear in 3-point correlator</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span><span class="p">,</span><span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cfglist2pt</span> <span class="o">=</span> <span class="n">ReduceCfgs</span><span class="p">(</span><span class="n">FOSet</span><span class="o">.</span><span class="n">cfglist</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span><span class="p">)</span>
                        <span class="n">FOSet</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist2pt</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cfglist2pt</span> <span class="o">=</span> <span class="n">FOSet</span><span class="o">.</span><span class="n">cfglist</span>
                    <span class="c1"># FOSet = SetOfNNQ(cfglist=self.cfglist2pt,InfoDict=InfoList)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doAlphafull</span><span class="p">:</span>
                        <span class="n">FOSet</span> <span class="o">=</span> <span class="n">SetOfNNQFull</span><span class="p">(</span><span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span><span class="p">,</span><span class="n">InfoDict</span><span class="o">=</span><span class="n">InfoList</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">FOSet</span> <span class="o">=</span> <span class="n">SetOfNNQ</span><span class="p">(</span><span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span><span class="p">,</span><span class="n">InfoDict</span><span class="o">=</span><span class="n">InfoList</span><span class="p">)</span>

                <span class="n">FOSet</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


                <span class="n">thisname</span><span class="p">,</span><span class="n">thisleglab</span><span class="p">,</span><span class="n">jsmlab</span> <span class="o">=</span> <span class="n">CreateNameAndLL</span><span class="p">(</span><span class="n">FOSet</span><span class="o">.</span><span class="n">SetC2</span><span class="p">,</span><span class="n">sinklab</span><span class="p">)</span>
                <span class="n">thisfun</span> <span class="o">=</span> <span class="n">GenSinkFun</span><span class="p">(</span><span class="n">jsmcoeffs</span><span class="p">)</span>
                <span class="c1"># print thisname,thisleglab</span>
                <span class="c1"># print jsmcoeffs</span>
                <span class="c1"># print sinklab</span>
                <span class="c1"># print thisfun.__name__</span>
                <span class="c1"># print FOSet.SetC2.keys()</span>
                <span class="c1"># print FOSet.SetC2[FOSet.SetC2.keys()[0]].NNQ_Stats[&#39;boot&#39;]</span>
                <span class="c1"># for ikey,ival in FOSet.SetC2.iteritems():</span>
                <span class="c1">#     print ikey</span>
                <span class="c1">#     print ival.NNQ_Stats</span>
                <span class="c1">#     print</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C2FOforAlpha</span> <span class="o">=</span> <span class="n">FOSet</span><span class="o">.</span><span class="n">CombineCorrs</span><span class="p">(</span><span class="n">thisfun</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">thisname</span><span class="p">,</span>
                                                <span class="n">LegLab</span><span class="o">=</span><span class="n">thisleglab</span><span class="p">,</span><span class="n">jsmlab</span> <span class="o">=</span><span class="n">jsmlab</span><span class="p">)</span>
                <span class="c1">## for memeory conservation?</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alphafree</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doAlphafull</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cfglist2pt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2FOforAlpha</span><span class="o">.</span><span class="n">NNQFull_cfgs</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cfglist2pt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2FOforAlpha</span><span class="o">.</span><span class="n">NNQ_cfgs</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg_fromfile_2pt</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg_fromfile_2pt</span><span class="p">,</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfglist2pt</span> <span class="p">,</span> <span class="n">f</span> <span class="p">)</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Error pickling &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg_fromfile_2pt</span><span class="p">)</span>

                <span class="c1"># print self.C2FOforAlpha.NNQAvg</span>
                <span class="c1"># print self.C2FOforAlpha.AlphaAvg</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alphafree</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doAlphafull</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">C2FOforAlpha</span> <span class="o">=</span> <span class="n">NNQFullCorr</span><span class="p">(</span><span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span><span class="p">,</span> <span class="n">Info</span><span class="o">=</span><span class="n">Info2pt</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">C2FOforAlpha</span> <span class="o">=</span> <span class="n">NNQCorr</span><span class="p">(</span><span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span><span class="p">,</span> <span class="n">Info</span><span class="o">=</span><span class="n">Info2pt</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doAlphafull</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">C2FOforAlpha</span> <span class="o">=</span> <span class="n">NNQFullCorr</span><span class="p">(</span><span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist2pt</span><span class="p">,</span> <span class="n">Info</span><span class="o">=</span><span class="n">Info2pt</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">C2FOforAlpha</span> <span class="o">=</span> <span class="n">NNQCorr</span><span class="p">(</span><span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist2pt</span><span class="p">,</span> <span class="n">Info</span><span class="o">=</span><span class="n">Info2pt</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C2FOforAlpha</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">WipeData</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alphafree</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doAlphafull</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cfglist2pt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2FOforAlpha</span><span class="o">.</span><span class="n">NNQFull_cfgs</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cfglist2pt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2FOforAlpha</span><span class="o">.</span><span class="n">NNQ_cfgs</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg_fromfile_2pt</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg_fromfile_2pt</span><span class="p">,</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfglist2pt</span> <span class="p">,</span> <span class="n">f</span> <span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Error pickling &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg_fromfile_2pt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GetAlphaFit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitAlphain</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">## just to make sure alpha is not used, but these parameters are passed in with default values anyway.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tflows</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2FOforAlpha</span> <span class="o">=</span> <span class="s1">&#39;PreDef&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading proper system of equations.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thisFF</span> <span class="o">=</span> <span class="n">FormFact</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">mom2list</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ppparams</span><span class="o">.</span><span class="n">mom2list</span><span class="p">,</span>
                                <span class="n">Info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">,</span><span class="n">tflowlist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thisFF</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2forMass</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">thistflowlist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">,</span><span class="n">thisalpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C2FOforAlpha</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading proper system of equations complete.&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="FFEquation.LineupReducedRF"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.LineupReducedRF">[docs]</a>    <span class="k">def</span> <span class="nf">LineupReducedRF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Mcore</span><span class="o">=</span><span class="n">defMcore</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;thisFF&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s1">&#39;Please initialse form factors with .LoadProperFF before lining up reduced ffs&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Ratios&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s1">&#39;Please initialse ratio functions with .LoadRatios before lining up reduced ffs&#39;</span><span class="p">)</span>
        <span class="c1"># self.thisFF.GetRedFFParms()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reducing the system of equations.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ratios</span><span class="o">.</span><span class="n">ReduceRatios</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thisFF</span><span class="o">.</span><span class="n">combine_keys_forRF</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">thisFF</span><span class="o">.</span><span class="n">coeffs_forRF</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">Mcore</span><span class="o">=</span><span class="n">Mcore</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reducing the system of equations complete.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FFEquation.PullFits"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.PullFits">[docs]</a>    <span class="k">def</span> <span class="nf">PullFits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">## Rewrite ratios with the fitted results</span>
        <span class="c1">## self.Ratios = { set , States_Fitted_To , Fit_range , ip  } Fitting class instance</span>
        <span class="c1"># if self.fitratio == &#39;From Def&#39;:</span>
        <span class="c1">#     self.fitratio = defFitAllGamma</span>
            <span class="c1">## don&#39;t forget fitratio = fit#-#</span>
        <span class="c1">## output { set , igamma , ip  } Fitting class instance</span>
        <span class="n">this_col</span><span class="p">,</span><span class="n">this_fun</span> <span class="o">=</span> <span class="s1">&#39;boot&#39;</span><span class="p">,</span><span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;_mal&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;ralpha_mult_fun&#39;</span><span class="p">):</span>
                <span class="n">this_col</span> <span class="o">=</span> <span class="s1">&#39;alpha_rat_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ralpha_mult_fun</span><span class="o">.</span><span class="vm">__name__</span>
                <span class="n">this_fun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ralpha_mult_fun</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">this_col</span> <span class="o">=</span> <span class="s1">&#39;alpha_rat_div&#39;</span>
                <span class="n">this_fun</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">truediv</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies</span><span class="p">,</span><span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">this_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s1">&#39;boot&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;will do later&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RatioFits</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">RatioFitsFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ratios</span><span class="o">.</span><span class="n">GetFitsFromIndex</span><span class="p">(</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies_flow</span><span class="p">,</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">RF_fit_min</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">RF_fit_max</span><span class="p">,</span>
                                                    <span class="n">thisflowlist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">,</span>
                                                    <span class="n">tsum_fit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_tsum_range</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Do_Chi_cutoff</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Important_FF</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">FF_Imp</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currtype</span> <span class="o">+</span> <span class="s1">&#39;not set up for Important_FF, see FormFactors.py&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">RatioFits</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">RatioFitsFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ratios</span><span class="o">.</span><span class="n">GetChi2PdfFits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RF_fit_min</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">RF_fit_max</span><span class="p">,</span>
                                                                <span class="n">chi_min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Chi2pdf_Min</span><span class="p">,</span><span class="n">chi_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Chi2pdf_Max</span><span class="p">,</span>
                                                                <span class="n">min_fitr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">RF_fit_range_minimum</span><span class="p">,</span>
                                                                <span class="n">thisflowlist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">,</span>
                                                                <span class="n">tsum_fit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_tsum_range</span><span class="p">,</span>
                                                                <span class="n">nchi_threshold</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nchi_threshold</span><span class="p">,</span>
                                                                <span class="n">ralpha_info</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2FOforAlpha</span><span class="p">,</span><span class="n">this_fun</span><span class="p">,</span><span class="n">this_col</span><span class="p">),</span>
                                                                <span class="n">imp_list</span><span class="o">=</span><span class="n">FF_Imp</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">RatioFits</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">RatioFitsFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ratios</span><span class="o">.</span><span class="n">GetChi2PdfFits</span><span class="p">(</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">RF_fit_min</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">RF_fit_max</span><span class="p">,</span>
                                                <span class="n">chi_min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Chi2pdf_Min</span><span class="p">,</span><span class="n">chi_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Chi2pdf_Max</span><span class="p">,</span>
                                                <span class="n">min_fitr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">RF_fit_range_minimum</span><span class="p">,</span>
                                                <span class="n">thisflowlist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">,</span>
                                                <span class="n">tsum_fit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_tsum_range</span><span class="p">,</span>
                                                <span class="n">ralpha_info</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2FOforAlpha</span><span class="p">,</span><span class="n">this_fun</span><span class="p">,</span><span class="n">this_col</span><span class="p">),</span>
                                                <span class="n">nchi_threshold</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nchi_threshold</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">this_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s1">&#39;boot&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;will do later&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RatioFits</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">RatioFitsFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ratios</span><span class="o">.</span><span class="n">GetBestFits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RF_fit_min</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">RF_fit_max</span><span class="p">,</span>
                                                            <span class="n">min_fitr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">RF_fit_range_minimum</span><span class="p">,</span>
                                                            <span class="n">thisflowlist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">,</span><span class="n">tsum_fit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_tsum_range</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies_flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RatioFits</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">RatioFitsFlow</span><span class="o">.</span><span class="n">index</span>
        <span class="c1">## get usefull things from self.Ratio before we overwrite it!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RatioFileList</span> <span class="o">=</span> <span class="p">[</span><span class="n">irat</span><span class="o">.</span><span class="n">HumanFile</span> <span class="k">for</span> <span class="n">irat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ratios</span><span class="o">.</span><span class="n">SetRat</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
        <span class="c1"># self.SetLegLab(&#39; &#39;.join([&#39;$&#39;+self.currtype+&#39;$&#39;,self.Ratios.SetRat[self.Ratios.SetRat.keys()[0]].LegLab]))</span>

        <span class="c1"># print &#39;DEBUG&#39;</span>
        <span class="c1"># if &#39;boot&#39; in self.RatioFits:</span>
        <span class="c1">#     print self.RatioFits[&#39;boot&#39;]</span>
        <span class="c1"># if &#39;boot&#39; in self.RatioFitsFlow:</span>
        <span class="c1">#     print self.RatioFitsFlow[&#39;boot&#39;]</span>
        <span class="c1">## abit of cleaning up, make the keys line up and get rid of redundant dictionaries</span>
        <span class="n">lboot</span><span class="p">,</span><span class="n">lchi</span><span class="p">,</span><span class="n">lAvg</span><span class="p">,</span><span class="n">lStd</span><span class="p">,</span><span class="n">ilist</span> <span class="o">=</span> <span class="p">[],[],[],[],[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reduce_System</span><span class="p">:</span> <span class="n">this_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thisFF</span><span class="o">.</span><span class="n">keysOpMomsRed</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span><span class="n">this_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thisFF</span><span class="o">.</span><span class="n">keysOpMoms</span><span class="p">())</span>
        <span class="n">shown_error</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">iOp</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">iq</span> <span class="ow">in</span> <span class="n">this_iter</span><span class="p">:</span>
            <span class="n">this_Op</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">iOp</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">itflow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flowlab</span> <span class="ow">in</span> <span class="n">this_Op</span><span class="p">:</span>
                        <span class="c1"># print self.RatioFitsFlow.loc[(slice(None),this_Op,iq,itflow),:]</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">thisdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RatioFitsFlow</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">this_Op</span><span class="p">,</span><span class="n">iq</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)),</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                            <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RatioFitsFlow</span><span class="p">:</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="n">shown_error</span><span class="p">:</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RatioFitsFlow</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RatioFits</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
                                    <span class="n">shown_error</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no FO solutions found for &#39;</span><span class="p">,</span><span class="n">this_Op</span><span class="p">,</span><span class="n">iq</span><span class="p">,</span><span class="n">itflow</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">((</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">this_Op</span><span class="p">,</span><span class="n">iq</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)))</span>
                                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RatioFitsFlow</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
                                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RatioFits</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
                                <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">No Fits found for RatioFitsFlow&#39;</span><span class="p">)</span>
                            <span class="k">continue</span>
                        <span class="c1"># if (slice(None),this_Op,iq,itflow,slice(None)) not in self.RatioFitsFlow:</span>
                        <span class="c1"># chidata =</span>
                        <span class="k">for</span> <span class="n">ifitr</span><span class="p">,</span><span class="n">fit_data</span> <span class="ow">in</span> <span class="n">thisdata</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time_fit_range&#39;</span><span class="p">):</span>
                            <span class="n">fit_chi_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RatioFitsFlow</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">this_Op</span><span class="p">,</span><span class="n">iq</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">ifitr</span><span class="p">),</span><span class="s1">&#39;chi2pdf&#39;</span><span class="p">]</span>
                            <span class="c1"># chidata[(slice(None),ifitr)]</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fit_data</span><span class="p">,</span><span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
                                <span class="k">for</span> <span class="n">ikey</span><span class="p">,</span><span class="n">ival</span> <span class="ow">in</span> <span class="n">fit_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                    <span class="k">if</span> <span class="n">iOp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span> <span class="ow">in</span> <span class="n">ikey</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                                        <span class="n">fit_data</span> <span class="o">=</span> <span class="n">ival</span>
                                        <span class="n">fit_chi_data</span> <span class="o">=</span> <span class="n">fit_chi_data</span><span class="p">[</span><span class="n">ikey</span><span class="p">]</span>
                                        <span class="k">break</span>
                            <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">iOp</span><span class="p">),</span><span class="n">ip</span><span class="p">,</span><span class="n">iq</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">ifitr</span><span class="p">))</span>
                            <span class="n">lboot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fit_data</span><span class="p">)</span>
                            <span class="n">lchi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fit_chi_data</span><span class="p">)</span>
                            <span class="n">lAvg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fit_data</span><span class="o">.</span><span class="n">Avg</span><span class="p">)</span>
                            <span class="n">lStd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fit_data</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># if (slice(None),this_Op,iq,slice(None)) not in self.RatioFits:</span>
                        <span class="c1">#     print &#39;no solutions found for &#39;,this_Op,iq</span>
                        <span class="c1">#     continue</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">thisdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RatioFits</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">this_Op</span><span class="p">,</span><span class="n">iq</span><span class="p">,</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)),</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                            <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RatioFitsFlow</span><span class="p">:</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="n">shown_error</span><span class="p">:</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RatioFitsFlow</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
                                    <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RatioFits</span><span class="p">:</span>
                                        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RatioFits</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
                                    <span class="n">shown_error</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no solutions found for &#39;</span><span class="p">,</span><span class="n">this_Op</span><span class="p">,</span><span class="n">iq</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">No Fits found for RatioFits&#39;</span><span class="p">)</span>
                            <span class="k">continue</span>
                        <span class="c1"># chidata = self.RatioFits.loc[(slice(None),this_Op,iq,slice(None)),&#39;chi2pdf&#39;]</span>
                        <span class="k">for</span> <span class="n">ifitr</span><span class="p">,</span><span class="n">fit_data</span> <span class="ow">in</span> <span class="n">thisdata</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time_fit_range&#39;</span><span class="p">):</span>
                            <span class="c1"># fit_chi_data = chidata[(slice(None),ifitr)]</span>
                            <span class="n">fit_chi_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RatioFits</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">this_Op</span><span class="p">,</span><span class="n">iq</span><span class="p">,</span><span class="n">ifitr</span><span class="p">),</span><span class="s1">&#39;chi2pdf&#39;</span><span class="p">]</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fit_data</span><span class="p">,</span><span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
                                <span class="k">for</span> <span class="n">ikey</span><span class="p">,</span><span class="n">ival</span> <span class="ow">in</span> <span class="n">fit_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                    <span class="k">if</span> <span class="n">iOp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span> <span class="ow">in</span> <span class="n">ikey</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                                        <span class="n">fit_data</span> <span class="o">=</span> <span class="n">ival</span>
                                        <span class="n">fit_chi_data</span> <span class="o">=</span> <span class="n">fit_chi_data</span><span class="p">[</span><span class="n">ikey</span><span class="p">]</span>
                                        <span class="k">break</span>
                            <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">iOp</span><span class="p">),</span><span class="n">ip</span><span class="p">,</span><span class="n">iq</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">ifitr</span><span class="p">))</span>
                            <span class="n">lboot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fit_data</span><span class="p">)</span>
                            <span class="n">lchi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fit_chi_data</span><span class="p">)</span>
                            <span class="n">lAvg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fit_data</span><span class="o">.</span><span class="n">Avg</span><span class="p">)</span>
                            <span class="n">lStd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fit_data</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if (slice(None),this_Op,iq,slice(None)) not in self.RatioFits:</span>
                <span class="c1">#     print &#39;no solutions found for &#39;,this_Op,iq</span>
                <span class="c1">#     continue</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">thisdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RatioFits</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">this_Op</span><span class="p">,</span><span class="n">iq</span><span class="p">,</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)),</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RatioFits</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">shown_error</span><span class="p">:</span>
                            <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RatioFitsFlow</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RatioFitsFlow</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
                            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RatioFits</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
                            <span class="n">shown_error</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no solutions found for &#39;</span><span class="p">,</span><span class="n">this_Op</span><span class="p">,</span><span class="n">iq</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">No Fits found for RatioFits&#39;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">for</span> <span class="n">ifitr</span><span class="p">,</span><span class="n">fit_data</span> <span class="ow">in</span> <span class="n">thisdata</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time_fit_range&#39;</span><span class="p">):</span>
                    <span class="n">fit_chi_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RatioFits</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">this_Op</span><span class="p">,</span><span class="n">iq</span><span class="p">,</span><span class="n">ifitr</span><span class="p">),</span><span class="s1">&#39;chi2pdf&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fit_data</span><span class="p">,</span><span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">ikey</span><span class="p">,</span><span class="n">ival</span> <span class="ow">in</span> <span class="n">fit_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">iOp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span> <span class="ow">in</span> <span class="n">ikey</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                                <span class="n">fit_chi_data</span> <span class="o">=</span> <span class="n">fit_chi_data</span><span class="p">[</span><span class="n">ikey</span><span class="p">]</span>
                                <span class="n">fit_data</span> <span class="o">=</span> <span class="n">ival</span>
                                <span class="k">break</span>
                    <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">iOp</span><span class="p">),</span><span class="n">ip</span><span class="p">,</span><span class="n">iq</span><span class="p">,</span><span class="n">ifitr</span><span class="p">))</span>
                    <span class="n">lboot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fit_data</span><span class="p">)</span>
                    <span class="n">lchi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fit_chi_data</span><span class="p">)</span>
                    <span class="n">lAvg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fit_data</span><span class="o">.</span><span class="n">Avg</span><span class="p">)</span>
                    <span class="n">lStd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fit_data</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
            <span class="c1"># # firstgamma = setdata.keys()[0]</span>
            <span class="c1"># # firstiq = setdata[firstgamma].keys()[0]</span>
            <span class="c1"># # ## its probably &#39;Par1&#39; since constant fit function, but just to be safe.</span>
            <span class="c1"># # thisdata = setdata[firstgamma][firstiq]</span>
            <span class="c1"># if isinstance(thisdata,ff.Fitting):</span>
            <span class="c1">#     if self.doflow:</span>
            <span class="c1">#         for itflow in self.tflows:</span>
            <span class="c1">#             data = thisdata[itflow]</span>
            <span class="c1">#             rathold[iOp][ip][iq][itflow] = thisdata.Params.values()[0]</span>
            <span class="c1">#     else:</span>
            <span class="c1">#         rathold[iOp][ip][iq] = thisdata.Params.values()[0]</span>
            <span class="c1"># else:</span>
            <span class="c1">#     ## we assume all the flow times are the same for every operator</span>
            <span class="c1">#     ## (they should be because the info dict only specifies 1 flow time).</span>
            <span class="c1">#     for itflow,flowdata in thisdata.iteritems():</span>
            <span class="c1">#         rathold[iOp][ip][iq][itflow] = flowdata.Params.values()[0]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ratios</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span>
                <span class="n">these_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;current_operator&#39;</span><span class="p">,</span><span class="s1">&#39;sink_momentum&#39;</span><span class="p">,</span><span class="s1">&#39;current_momentum&#39;</span><span class="p">,</span><span class="s1">&#39;flow_time&#39;</span><span class="p">,</span><span class="s1">&#39;fit_range&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">these_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;current_operator&#39;</span><span class="p">,</span><span class="s1">&#39;sink_momentum&#39;</span><span class="p">,</span><span class="s1">&#39;current_momentum&#39;</span><span class="p">,</span><span class="s1">&#39;fit_range&#39;</span><span class="p">]</span>
            <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="n">these_names</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ratios</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lboot</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ratios</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;chi2pdf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lboot</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ratios</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lAvg</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ratios</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lStd</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
        <span class="c1"># Final form of self.Ratios = { iOp , ip , iq (, itf if has flow time) } Bootstrap</span>
        <span class="c1"># Final form of self.Ratios = { iOp , ip , iq } Bootstrap</span>

        <span class="c1">## solves the system of equations to get the form factors out</span>
        <span class="c1">## results stored in self.ffres, self.ffresAvg, self.ffresStd (see SolveRatios())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">thisMassboot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2forMass</span><span class="o">.</span><span class="n">C2_Fit_Stats</span><span class="o">.</span><span class="n">at</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit2pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;p000&#39;</span><span class="p">),</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thisMassboot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisMassboot</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fit2pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;Params&#39;</span><span class="p">][</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thisMass</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">thisMassboot</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit2pt</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thisMassAvg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisMassboot</span><span class="o">.</span><span class="n">Avg</span></div>
        <span class="c1"># mlist,ilist = [],[]</span>
        <span class="c1"># for (istate,ifitr),setdata in self.C2forMass.C2_Fit_Stats[&#39;boot&#39;][self,&#39;p000&#39;,self.fit2pt[1]].iteritems():</span>
        <span class="c1">#     # print setdata.keys(),&#39;p000&#39;</span>
        <span class="c1">#     # print setdata[&#39;p000&#39;].keys(),self.fit2pt[1]</span>
        <span class="c1">#     # print setdata[&#39;p000&#39;][self.fit2pt[1]].Params.keys(),&#39;Energy&#39;</span>
        <span class="c1">#     mlist.append(setdata.)</span>
        <span class="c1">#     self.thisMass[&#39;_&#39;.join([iset,&#39;_&#39;.join(self.fit2pt)])] = setdata[&#39;p000&#39;][self.fit2pt[1]].Params[&#39;Energy&#39;]</span>
        <span class="c1">#     self.thisMassboot = self.thisMass.values()[0]</span>
        <span class="c1">#     self.thisMassAvg = self.thisMassboot.Avg</span>




    <span class="c1">## deletes all other data, and just leaves form factor results.</span>
    <span class="c1">## recomended to do this before running analysis of form factor results</span>
    <span class="c1">## to reduce memory usage</span>
<div class="viewcode-block" id="FFEquation.DelResidual"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.DelResidual">[docs]</a>    <span class="k">def</span> <span class="nf">DelResidual</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Ratios&#39;</span><span class="p">):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ratios</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ratios</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;RatioFits&#39;</span><span class="p">):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">RatioFits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RatioFits</span> <span class="o">=</span> <span class="p">{}</span></div>
        <span class="c1">## mass might be usefull!</span>
        <span class="c1"># del self.C2forMass</span>


<div class="viewcode-block" id="FFEquation.GetQsqrd"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.GetQsqrd">[docs]</a>    <span class="k">def</span> <span class="nf">GetQsqrd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">iq</span><span class="p">,</span><span class="n">ipp</span><span class="p">,</span><span class="n">Phys</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1">## Q^2 = -q^2 = -q^mu q_mu</span>
        <span class="k">if</span> <span class="n">Phys</span><span class="p">:</span>
            <span class="c1">## TODO? use thisMassboot instead? but then the yaxis will have error too!</span>
            <span class="n">pmu</span><span class="p">,</span><span class="n">qmu</span><span class="p">,</span><span class="n">ppmu</span> <span class="o">=</span> <span class="n">CorrSpinTrace</span><span class="p">()</span><span class="o">.</span><span class="n">Create4Mom</span><span class="p">(</span><span class="n">iq</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">qunit</span><span class="p">,</span><span class="n">ipp</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">qunit</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">thisMassAvg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pmu</span><span class="p">,</span><span class="n">qmu</span><span class="p">,</span><span class="n">ppmu</span> <span class="o">=</span> <span class="n">CorrSpinTrace</span><span class="p">()</span><span class="o">.</span><span class="n">Create4Mom</span><span class="p">(</span><span class="n">iq</span><span class="p">,</span><span class="n">ipp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">thisMassAvg</span><span class="p">)</span>
        <span class="c1">## meh, dont like negative Qsqrds</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">qmu</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span></div>
        <span class="c1"># return -np.sum(np.array(qmu)**2)</span>

<div class="viewcode-block" id="FFEquation.MakeQsqrdList"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.MakeQsqrdList">[docs]</a>    <span class="k">def</span> <span class="nf">MakeQsqrdList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">thisqvec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">momlist</span>
        <span class="n">thisppvec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ppparams</span><span class="o">.</span><span class="n">momlist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Qsqrdlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">ipp</span> <span class="ow">in</span> <span class="n">thisppvec</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">iq</span> <span class="ow">in</span> <span class="n">thisqvec</span><span class="p">:</span>
                <span class="n">thisQsqrd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetQsqrd</span><span class="p">(</span><span class="n">iq</span><span class="p">,</span><span class="n">ipp</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Qsqrdlist</span> <span class="o">-</span><span class="n">thisQsqrd</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0001</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Qsqrdlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Qsqrdlist</span><span class="p">,</span><span class="n">thisQsqrd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Qsqrdlist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Qsqrdlist</span><span class="p">)</span>
        <span class="c1"># self.Qsqrdlist = sorted(list(set(Qsqrdlist)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">QsqrdKeyList</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Q^</span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">QsqrdToFormat</span><span class="p">(</span><span class="n">iQ</span><span class="p">)</span> <span class="k">for</span> <span class="n">iQ</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Qsqrdlist</span><span class="p">]</span></div>

<div class="viewcode-block" id="FFEquation.SetupRatiosFO"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.SetupRatiosFO">[docs]</a>    <span class="k">def</span> <span class="nf">SetupRatiosFO</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chi_Qsqrd</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">iQkey</span><span class="p">,</span><span class="n">iQsqrd</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">QsqrdKeyList</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Qsqrdlist</span><span class="p">):</span>
            <span class="n">xdata</span><span class="p">,</span><span class="n">ydata</span> <span class="o">=</span> <span class="p">[],[]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reduce_System</span><span class="p">:</span>
                <span class="n">this_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thisFF</span><span class="o">.</span><span class="n">itemsParListRed</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">this_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thisFF</span><span class="o">.</span><span class="n">itemsParList</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">iOp</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">iq</span><span class="p">,</span><span class="n">imass</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">parlabs</span><span class="p">,</span><span class="n">parvals</span> <span class="ow">in</span> <span class="n">this_iter</span><span class="p">:</span>
                <span class="c1"># print itflowcyc, itflow</span>
                <span class="k">if</span> <span class="n">itflow</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">:</span> <span class="k">continue</span>
                <span class="c1">## imass dissapears from here on, so we assume only 1 fit range is being used in the calculation</span>
                <span class="n">qvec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">TOpvec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">stripmom</span><span class="p">(</span><span class="n">iq</span><span class="p">))</span>
                <span class="n">ppvec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ppparams</span><span class="o">.</span><span class="n">TOpvec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">stripmom</span><span class="p">(</span><span class="n">ip</span><span class="p">))</span>
                <span class="n">thisQsqrd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetQsqrd</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">qvec</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ppvec</span><span class="p">))</span>
                <span class="c1"># print thisQsqrd,iQsqrd</span>
                <span class="c1"># print thisQsqrd, iQsqrd</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">thisQsqrd</span> <span class="o">-</span> <span class="n">iQsqrd</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">myeps</span><span class="p">:</span>
                    <span class="n">ydata</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                    <span class="n">xdata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parvals</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">ifitr</span><span class="p">,</span><span class="n">fitdata</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ratios</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">iOp</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">iq</span><span class="p">,</span><span class="n">itflow</span><span class="p">),</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="c1"># print iOp,ip,iq,parlabs</span>
                        <span class="c1"># print [ipar.Avg for ipar in parvals]</span>
                        <span class="c1"># print self.Ratios[iOp][ip][iq][itflow].Avg</span>
                        <span class="c1"># print thisQsqrd, iQsqrd</span>
                        <span class="c1"># print self.Ratios.keys(),iOp</span>
                        <span class="c1"># print self.Ratios[iOp].keys(),ip</span>
                        <span class="c1"># print self.Ratios[iOp][ip].keys(),iq</span>
                        <span class="c1"># print self.Ratios[iOp][ip][itflow].keys(),itflow</span>
                        <span class="n">ydata</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fitdata</span><span class="p">)</span>
            <span class="c1"># print iQkey</span>
            <span class="c1"># for ix,iy in zip(xdata,ydata):</span>
            <span class="c1">#     print &#39;ix&#39;,[iix.Avg for iix in ix],&#39;iy&#39;,  iy.Avg</span>

            <span class="n">thisparlab</span> <span class="o">=</span> <span class="n">parlabs</span>
            <span class="n">thisfun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisFF</span><span class="o">.</span><span class="n">fffun</span>
            <span class="n">thisnpar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisFF</span><span class="o">.</span><span class="n">npar</span>
            <span class="c1">### TODO, look through ydata, and find which coeficients are zero. If none, raise exception.</span>
            <span class="c1">## this deals with the case at Q^2=0 where only F1 can be solved in the vector case.</span>
            <span class="c1">## maybe there are other Q^2&#39;s and current types where this occurs?</span>
            <span class="n">OnlyGe</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No ratio functions found for &#39;</span> <span class="p">,</span> <span class="n">itflow</span><span class="p">,</span> <span class="n">iQkey</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">thisfun</span> <span class="o">=</span> <span class="n">FormFactorO1</span>
                <span class="n">thisnpar</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">thisparlab</span> <span class="o">=</span> <span class="p">[</span><span class="n">thisparlab</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="c1"># print xdata</span>
                <span class="c1"># print ydata</span>
                <span class="n">xdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">rollaxis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xdata</span><span class="p">),</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">OnlyGe</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># elif &#39;Tensor&#39; in self.currtype and len(ydata) == 2:</span>
            <span class="c1">#     # TODO:</span>
            <span class="c1">#     print &#39;DEBUG: 2 equations for 3 params&#39;</span>
            <span class="c1">#     print xdata[0][0].Avg, xdata[0][1].Avg, xdata[0][2].Avg, ydata[0].Avg, ydata[0].Std</span>
            <span class="c1">#     print xdata[1][0].Avg, xdata[1][1].Avg, xdata[1][2].Avg, ydata[1].Avg, ydata[1].Std</span>
            <span class="c1">#     raise ArithmeticError(&#39;Found system of equations less than number of parameters, this needs to be implemented for tensor form factor solutions&#39;)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rollaxis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xdata</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># if len(ydata[0]) ==0 :</span>
            <span class="c1">#     print &#39;No ratio functions found for &#39;,iQkey</span>
            <span class="c1">#     if show_timer: thistimer.Lap()</span>
            <span class="c1">#     continue</span>

            <span class="nb">print</span><span class="p">(</span><span class="n">iQkey</span><span class="p">,</span> <span class="s1">&#39; has &#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ydata</span><span class="p">)),</span><span class="s1">&#39; different momenta&#39;</span><span class="p">)</span>
            <span class="n">avg_fits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">iy</span><span class="p">)</span> <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="n">ydata</span><span class="p">])</span>
            <span class="n">total_fits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">iy</span><span class="p">)</span> <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="n">ydata</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average number of fits per momenta is &#39;</span><span class="p">,</span> <span class="n">avg_fits</span><span class="p">)</span>
            <span class="n">this_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">ydata</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total number of fits is &#39;</span><span class="p">,</span> <span class="n">total_fits</span><span class="p">,</span><span class="s1">&#39; giving total number of system of equations = &#39;</span><span class="p">,</span>  <span class="nb">len</span><span class="p">(</span><span class="n">this_list</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">this_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">iinc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">this_list</span><span class="p">)</span><span class="o">//</span><span class="mi">1000</span><span class="o">+</span><span class="mi">2</span><span class="p">):</span>
                    <span class="n">this_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="s1">&#39;/Chi_block_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iinc</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
                    <span class="n">mkdir_p</span><span class="p">(</span><span class="n">this_dir</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">this_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="s1">&#39;/Chi_block_0/&#39;</span>
                <span class="n">mkdir_p</span><span class="p">(</span><span class="n">this_dir</span><span class="p">)</span>
            <span class="c1"># print len(list(itertools.product(*ydata))),&#39; different fit range combinations found for &#39;,iQkey</span>
            <span class="c1"># if show_timer: thistimer = Timer(   linklist=range(len(list(itertools.product(*ydata)))),</span>
            <span class="c1">#                                     name=&#39;Solving Form Factors for &#39;+iQkey)</span>
            <span class="n">this_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="n">iQkey</span><span class="o">+</span><span class="s1">&#39;_info.dat&#39;</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">this_file</span><span class="p">,</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">([</span><span class="n">OnlyGe</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">this_list</span><span class="p">)],</span><span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">itflow</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chi_Qsqrd</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chi_Qsqrd</span><span class="p">[</span><span class="n">itflow</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chi_Qsqrd</span><span class="p">[</span><span class="n">itflow</span><span class="p">][</span><span class="n">iQkey</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">this_list</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span>   <span class="n">linklist</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">this_list</span><span class="p">))),</span>
                                                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Setting Form Factors for &#39;</span><span class="o">+</span><span class="n">iQkey</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">icy</span><span class="p">,</span><span class="n">iylist</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">ydata</span><span class="p">)):</span>
                <span class="n">thisfit</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">Fitting</span><span class="p">(</span><span class="n">Funs</span><span class="o">=</span><span class="p">[</span><span class="n">thisfun</span><span class="p">,</span><span class="n">thisnpar</span><span class="p">],</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">xdata</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">iylist</span><span class="p">)],</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_Chi&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icy</span><span class="p">),</span><span class="n">paramlist</span><span class="o">=</span><span class="n">thisparlab</span><span class="p">)</span>
                <span class="n">mul_of_1000</span> <span class="o">=</span> <span class="n">icy</span><span class="o">//</span><span class="mi">1000</span>
                <span class="n">this_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="s1">&#39;/Chi_block_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">mul_of_1000</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
                <span class="n">this_file</span> <span class="o">=</span> <span class="n">this_dir</span><span class="o">+</span><span class="n">iQkey</span><span class="o">+</span><span class="s1">&#39;_Chi&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icy</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.dat&#39;</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">this_file</span><span class="p">,</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">thisfit</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span><span class="o">.</span><span class="n">Lap</span><span class="p">()</span>

        <span class="n">this_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="s1">&#39;_Instance.dat&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">this_file</span><span class="p">,</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span><span class="n">f</span><span class="p">)</span></div>


<div class="viewcode-block" id="FFEquation.LoadSystemResultsFO"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.LoadSystemResultsFO">[docs]</a>    <span class="k">def</span> <span class="nf">LoadSystemResultsFO</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">this_qfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="s1">&#39;_info.dat&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">this_qfile</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">QsqrdKeyList</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Qsqrdlist</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">ffboot</span><span class="p">,</span><span class="n">ffAvg</span><span class="p">,</span><span class="n">ffStd</span><span class="p">,</span><span class="n">ilist</span> <span class="o">=</span> <span class="p">[],[],[],[]</span>
        <span class="k">for</span> <span class="n">iQkey</span><span class="p">,</span><span class="n">iQsqrd</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">QsqrdKeyList</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Qsqrdlist</span><span class="p">):</span>
            <span class="n">this_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="n">iQkey</span><span class="o">+</span><span class="s1">&#39;_info.dat&#39;</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">this_file</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">OnlyGe</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">ydata_len</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span>   <span class="n">linklist</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ydata_len</span><span class="p">)),</span>
                                                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Loading Form Factors for &#39;</span><span class="o">+</span><span class="n">iQkey</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">icy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ydata_len</span><span class="p">):</span>
                <span class="n">mul_of_1000</span> <span class="o">=</span> <span class="n">icy</span><span class="o">//</span><span class="mi">1000</span>
                <span class="n">this_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="s1">&#39;/Chi_block_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">mul_of_1000</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
                <span class="n">this_file</span> <span class="o">=</span> <span class="n">this_dir</span><span class="o">+</span><span class="n">iQkey</span><span class="o">+</span><span class="s1">&#39;_Chi&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icy</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.res&#39;</span>

                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">this_file</span><span class="p">):</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">this_file</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">thisfit</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: FNF: &#39;</span><span class="p">,</span><span class="n">this_file</span><span class="p">)</span>
                <span class="c1"># else:</span>
                <span class="c1">#     print &#39;FNF:&#39;,this_file</span>

                <span class="k">if</span> <span class="n">OnlyGe</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;Vector&#39;</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">currtype</span> <span class="ow">or</span> <span class="s1">&#39;VectorTop&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currtype</span> <span class="ow">or</span> <span class="s1">&#39;VectorWein&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">):</span>
                    <span class="n">thisfit</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;G_</span><span class="si">{E}</span><span class="s1">&#39;</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">thisfit</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;F_</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="p">,:]</span>
                <span class="n">ffboot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisfit</span><span class="p">)</span>
                <span class="n">ffAvg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisfit</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;ParamsAvg&#39;</span><span class="p">])</span>
                <span class="n">ffStd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisfit</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;ParamsStd&#39;</span><span class="p">])</span>
                <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">itflow</span><span class="p">,</span><span class="s1">&#39;Chi&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icy</span><span class="p">),</span><span class="n">iQkey</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span><span class="o">.</span><span class="n">Lap</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Col_Names</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">ffboot</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">ffAvg</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">ffStd</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;BNL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ConvertToBNL</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;Top&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currtype</span> <span class="ow">or</span> <span class="s1">&#39;Wein&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">F3div2M</span><span class="p">()</span></div>


<div class="viewcode-block" id="FFEquation.TOefm"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.TOefm">[docs]</a>    <span class="k">def</span> <span class="nf">TOefm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">F3div2M</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span> <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Inefm</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">F3</span> <span class="o">=</span> <span class="s1">&#39;F_</span><span class="si">{3}</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;BNL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">:</span> <span class="n">F3</span> <span class="o">=</span> <span class="s1">&#39;tilde</span><span class="si">{F}</span><span class="s1">_</span><span class="si">{3}</span><span class="s1">&#39;</span>
        <span class="n">F3divm</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;frac{&#39;</span><span class="o">+</span><span class="n">F3</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;}{2m_</span><span class="si">{N}</span><span class="s1">}&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="p">,</span><span class="s1">&#39;hbarcdivlat&#39;</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">Params</span> <span class="k">import</span> <span class="n">latspace</span><span class="p">,</span><span class="n">hbarc</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">hbarcdivlat</span> <span class="o">=</span> <span class="n">hbarc</span><span class="o">/</span><span class="n">latspace</span>
        <span class="k">for</span> <span class="n">ikey</span><span class="p">,</span><span class="n">Qsqrdres</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># if F3 in self.ffres[iflow][iQsqrd].Params.keys():</span>
            <span class="c1">#     self.ffres[iflow][iQsqrd].Params[F3] = (Qsqrdres.Params[F3]/self.qparams.hbarcdivlat)</span>
            <span class="c1">## this is to correct legacy resuts in which Qsqrdres.Parmams[F3divm] = (Qsqrdres.Params[F3]*self.qparams.hbarc)/(2*thismass)</span>
            <span class="c1">## to                                        Qsqrdres.Parmams[F3divm] = (Qsqrdres.Params[F3]*self.qparams.latspace)/(2*thismass)</span>
            <span class="k">if</span> <span class="n">F3divm</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Qsqrdres</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">F3divm</span><span class="p">,</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Qsqrdres</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">F3divm</span><span class="p">,</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">hbarcdivlat</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">F3divm</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">F3divm</span><span class="p">,</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Avg</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">F3divm</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">F3divm</span><span class="p">,</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Std</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Inefm</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="FFEquation.F3div2M"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.F3div2M">[docs]</a>    <span class="k">def</span> <span class="nf">F3div2M</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">F3</span> <span class="o">=</span> <span class="s1">&#39;F_</span><span class="si">{3}</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;BNL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">:</span> <span class="n">F3</span> <span class="o">=</span> <span class="s1">&#39;tilde</span><span class="si">{F}</span><span class="s1">_</span><span class="si">{3}</span><span class="s1">&#39;</span>
        <span class="n">F3divm</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;frac{&#39;</span><span class="o">+</span><span class="n">F3</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;}{2m_</span><span class="si">{N}</span><span class="s1">}&#39;</span>
        <span class="c1"># thismass = self.C2forMass.C2_Fit_Stats.at[(self.fit2pt[0],&#39;p000&#39;,self.fit2pt[1]),&#39;boot&#39;]</span>
        <span class="c1"># ## ends up being a bootstrapped quantitiy</span>
        <span class="c1"># thismass = thismass.fit_data.at[&#39;Energy&#39;,&#39;Params&#39;]</span>
        <span class="c1"># if not hasattr(self.qparams,&#39;hbarc&#39;):</span>
        <span class="c1">#     from Params import hbarc</span>
        <span class="c1">#     self.qparams.hbarc = hbarc</span>
        <span class="c1"># if not hasattr(self.qparams,&#39;latspace&#39;):</span>
        <span class="c1">#     from Params import latspace</span>
        <span class="c1">#     self.qparams.latspace = latspace</span>
        <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span>   <span class="n">linklist</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]),</span>
                                            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Creating F3div2M form factors&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ikey</span><span class="p">,</span><span class="n">Qsqrdres</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">F3</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Qsqrdres</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span><span class="o">.</span><span class="n">Lap</span><span class="p">(</span><span class="n">ikey</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">F3divm</span> <span class="ow">in</span> <span class="n">Qsqrdres</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span><span class="o">.</span><span class="n">Lap</span><span class="p">(</span><span class="n">ikey</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="c1"># F3hold = deepcopy(Qsqrdres.Params[F3])</span>
            <span class="n">this_df</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">Qsqrdres</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">icol</span><span class="p">,</span><span class="n">colval</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">jkey</span><span class="p">,</span><span class="n">keyval</span> <span class="ow">in</span> <span class="n">colval</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">this_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">jkey</span><span class="p">,</span><span class="n">icol</span><span class="p">]</span> <span class="o">=</span> <span class="n">keyval</span>
            <span class="n">this_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">F3divm</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">Qsqrdres</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">F3</span><span class="p">,:]</span>
            <span class="n">this_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">F3divm</span><span class="p">,</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Qsqrdres</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">F3</span><span class="p">,</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">latspace</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">thisMassboot</span><span class="p">)</span>
            <span class="n">this_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">F3divm</span><span class="p">,</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span> <span class="o">=</span> <span class="n">this_df</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">F3divm</span><span class="p">,</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">F3divm</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">F3divm</span><span class="p">,</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Avg</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">F3divm</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">F3divm</span><span class="p">,</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Std</span>
            <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span><span class="o">.</span><span class="n">Lap</span><span class="p">(</span><span class="n">ikey</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Inefm</span> <span class="o">=</span> <span class="kc">True</span></div>



<div class="viewcode-block" id="FFEquation.SetupRatios"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.SetupRatios">[docs]</a>    <span class="k">def</span> <span class="nf">SetupRatios</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Setting up system of equations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MakeQsqrdList</span><span class="p">()</span>
        <span class="n">this_qfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="s1">&#39;_info.dat&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">this_qfile</span><span class="p">,</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">QsqrdKeyList</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Qsqrdlist</span><span class="p">],</span><span class="n">f</span><span class="p">)</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SetupRatiosFO</span><span class="p">(</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chi_Qsqrd</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">iQkey</span><span class="p">,</span><span class="n">iQsqrd</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">QsqrdKeyList</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Qsqrdlist</span><span class="p">):</span>
            <span class="n">xdata</span><span class="p">,</span><span class="n">ydata</span> <span class="o">=</span> <span class="p">[],[]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reduce_System</span><span class="p">:</span>
                <span class="n">this_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thisFF</span><span class="o">.</span><span class="n">itemsParListRed</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">this_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thisFF</span><span class="o">.</span><span class="n">itemsParList</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">iOp</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">iq</span><span class="p">,</span><span class="n">imass</span><span class="p">,</span><span class="n">parlabs</span><span class="p">,</span><span class="n">parvals</span> <span class="ow">in</span> <span class="n">this_iter</span><span class="p">:</span>
                <span class="c1">## imass dissapears from here on, so we assume only 1 fit range is being used in the calculation</span>
                <span class="c1"># print &#39;DEBUG&#39;</span>
                <span class="c1"># print iOp,ip,iq,parlabs, parvals</span>
                <span class="c1"># print self.Ratios.keys(), iOp</span>
                <span class="c1"># print self.Ratios[iOp].keys() , ip</span>
                <span class="c1"># print self.Ratios[iOp][ip].keys() , iq</span>
                <span class="c1"># print [ipar.Avg for ipar in parvals],self.Ratios[iOp][ip][iq].Avg</span>
                <span class="c1"># print thisQsqrd, iQsqrd</span>
                <span class="n">qvec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">TOpvec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">stripmom</span><span class="p">(</span><span class="n">iq</span><span class="p">))</span>
                <span class="n">ppvec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ppparams</span><span class="o">.</span><span class="n">TOpvec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">stripmom</span><span class="p">(</span><span class="n">ip</span><span class="p">))</span>
                <span class="n">thisQsqrd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetQsqrd</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">qvec</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ppvec</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">thisQsqrd</span> <span class="o">-</span> <span class="n">iQsqrd</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">myeps</span><span class="p">:</span>
                    <span class="n">xdata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parvals</span><span class="p">)</span>
                    <span class="c1"># print &#39;DEBUG&#39;</span>
                    <span class="c1"># print self.Ratios.keys(),iOp</span>
                    <span class="c1"># print self.Ratios[iOp].keys(),ip</span>
                    <span class="c1"># print self.Ratios[iOp][ip].keys(),iq</span>
                    <span class="c1"># print self.Ratios[iOp][ip][iq].keys()</span>
                    <span class="n">ydata</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">iOp</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">iq</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ratios</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]:</span> <span class="k">continue</span>
                    <span class="k">for</span> <span class="n">ifitr</span><span class="p">,</span><span class="n">fitdata</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ratios</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">iOp</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">iq</span><span class="p">),</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">ydata</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fitdata</span><span class="p">)</span>
            <span class="c1"># print &#39;DEBUG&#39;</span>
            <span class="c1"># print iQkey</span>
            <span class="c1"># for ix,iy in zip(xdata,ydata):</span>
            <span class="c1">#     print &#39;ix&#39;,ix[0].Avg,ix[1].Avg,&#39;iy&#39;,  iy.Avg,iy.Std</span>

            <span class="n">thisparlab</span> <span class="o">=</span> <span class="n">parlabs</span>
            <span class="n">thisfun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisFF</span><span class="o">.</span><span class="n">fffun</span>
            <span class="n">thisnpar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisFF</span><span class="o">.</span><span class="n">npar</span>
            <span class="c1">### TODO, look through ydata, and find which coeficients are zero. If none, raise exception.</span>
            <span class="c1">## this deals with the case at Q^2=0 where only F1 can be solved in the vector case.</span>
            <span class="c1">## maybe there are other Q^2&#39;s and current types where this occurs?</span>
            <span class="n">OnlyGe</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No ratio functions found for &#39;</span> <span class="p">,</span> <span class="n">iQkey</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">thisfun</span> <span class="o">=</span> <span class="n">FormFactorO1</span>
                <span class="n">thisnpar</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">thisparlab</span> <span class="o">=</span> <span class="p">[</span><span class="n">thisparlab</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="c1"># print xdata</span>
                <span class="c1"># print ydata</span>
                <span class="n">xdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">rollaxis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xdata</span><span class="p">),</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">OnlyGe</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="s1">&#39;Tensor&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currtype</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># TODO:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DEBUG: 2 equations for 3 params&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">xdata</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span> <span class="n">xdata</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span> <span class="n">xdata</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span> <span class="n">ydata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span> <span class="n">ydata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">xdata</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span> <span class="n">xdata</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span> <span class="n">xdata</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span> <span class="n">ydata</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span> <span class="n">ydata</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ArithmeticError</span><span class="p">(</span><span class="s1">&#39;Found system of equations less than number of parameters, this needs to be implemented for tensor form factor solutions&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rollaxis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xdata</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span> <span class="o">==</span><span class="mi">0</span> <span class="p">:</span>
                <span class="nb">print</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No ratio functions found for &#39;</span><span class="p">,</span><span class="n">iQkey</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="c1"># print &#39;debug:&#39;</span>
            <span class="c1"># print xdata.shape, np.array(ydata).shape</span>
            <span class="c1"># for ix, iy in zip(xdata,ydata):</span>
            <span class="c1">#     print ix[0].Avg,iy.Avg,iy.Std</span>
            <span class="c1">#     print &#39;TypeTest&#39;,type(iy)</span>
            <span class="c1"># print</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">iQkey</span><span class="p">,</span> <span class="s1">&#39; has &#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ydata</span><span class="p">)),</span><span class="s1">&#39; different momenta&#39;</span><span class="p">)</span>
            <span class="n">avg_fits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">iy</span><span class="p">)</span> <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="n">ydata</span><span class="p">])</span>
            <span class="n">total_fits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">iy</span><span class="p">)</span> <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="n">ydata</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average number of fits per momenta is &#39;</span><span class="p">,</span> <span class="n">avg_fits</span><span class="p">)</span>
            <span class="n">this_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">ydata</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total number of fits is &#39;</span><span class="p">,</span> <span class="n">total_fits</span><span class="p">,</span><span class="s1">&#39; giving total number of system of equations = &#39;</span><span class="p">,</span>  <span class="nb">len</span><span class="p">(</span><span class="n">this_list</span><span class="p">))</span>

            <span class="c1"># print len(list(itertools.product(*ydata))),&#39; different fit range combinations found for &#39;,iQkey</span>
            <span class="n">this_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="n">iQkey</span><span class="o">+</span><span class="s1">&#39;_info.dat&#39;</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">this_file</span><span class="p">,</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">([</span><span class="n">OnlyGe</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">this_list</span><span class="p">)],</span><span class="n">f</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chi_Qsqrd</span><span class="p">[</span><span class="n">iQkey</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">this_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">this_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">iinc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">this_list</span><span class="p">)</span><span class="o">//</span><span class="mi">1000</span><span class="o">+</span><span class="mi">2</span><span class="p">):</span>
                    <span class="n">this_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="s1">&#39;/Chi_block_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iinc</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
                    <span class="n">mkdir_p</span><span class="p">(</span><span class="n">this_dir</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">this_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="s1">&#39;/Chi_block_0/&#39;</span>
                <span class="n">mkdir_p</span><span class="p">(</span><span class="n">this_dir</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span>   <span class="n">linklist</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">this_list</span><span class="p">))),</span>
                                                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Setting up Form Factors for &#39;</span><span class="o">+</span><span class="n">iQkey</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">icy</span><span class="p">,</span><span class="n">iylist</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">ydata</span><span class="p">)):</span>
                <span class="n">mul_of_1000</span> <span class="o">=</span> <span class="n">icy</span><span class="o">//</span><span class="mi">1000</span>
                <span class="n">this_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="s1">&#39;/Chi_block_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">mul_of_1000</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
                <span class="n">this_file</span> <span class="o">=</span> <span class="n">this_dir</span><span class="o">+</span><span class="n">iQkey</span><span class="o">+</span><span class="s1">&#39;_Chi&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icy</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.dat&#39;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">this_file</span><span class="p">):</span>
                    <span class="n">thisfit</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">Fitting</span><span class="p">(</span><span class="n">Funs</span><span class="o">=</span><span class="p">[</span><span class="n">thisfun</span><span class="p">,</span><span class="n">thisnpar</span><span class="p">],</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xdata</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">iylist</span><span class="p">)],</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_Chi&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icy</span><span class="p">),</span><span class="n">paramlist</span><span class="o">=</span><span class="n">thisparlab</span><span class="p">)</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">this_file</span><span class="p">,</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">thisfit</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span><span class="o">.</span><span class="n">Lap</span><span class="p">()</span>
        <span class="n">this_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="s1">&#39;_Instance.dat&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">this_file</span><span class="p">,</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span><span class="n">f</span><span class="p">)</span></div>


<div class="viewcode-block" id="FFEquation.SolveSystem"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.SolveSystem">[docs]</a>    <span class="k">def</span> <span class="nf">SolveSystem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Mcore</span> <span class="o">=</span> <span class="n">defMcore</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># self.MakeQsqrdList()</span>
        <span class="k">def</span> <span class="nf">this_fun</span><span class="p">(</span><span class="n">this_in</span><span class="p">):</span>
            <span class="c1">## this part requires pathos version of multiprocessing,</span>
            <span class="c1">## but this downgrades python to 3.6</span>
            <span class="c1"># this_job_number = multiprocessing.Process()._identity[0]</span>
            <span class="c1"># this_file,ichi = this_in</span>
            <span class="c1"># if int(this_job_number)%10 == 0:</span>
            <span class="c1">#     dat_len = len(list(glob.glob(this_file.replace(ichi,&#39;*&#39;))))</span>
            <span class="c1">#     res_len = len(list(glob.glob(this_file.replace(ichi,&#39;*&#39;).replace(&#39;.dat&#39;,&#39;.res&#39;))))</span>
            <span class="c1">#     sys.stdout.write(str(res_len*100/dat_len)+ &#39;% done \r&#39;)</span>
            <span class="c1">#     sys.stdout.flush()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">this_file</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">thisfit</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">thisfit</span><span class="o">.</span><span class="n">FitBoots</span><span class="p">()</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">this_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.dat&#39;</span><span class="p">,</span><span class="s1">&#39;.res&#39;</span><span class="p">),</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">thisfit</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">thisfit</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;EOFError&#39;</span><span class="p">,</span><span class="n">this_file</span><span class="p">)</span>

        <span class="n">this_qfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="s1">&#39;_info.dat&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">this_qfile</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s1">&#39;FNF: &#39;</span><span class="o">+</span><span class="n">this_qfile</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> Has FFSetup been completed?&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">this_qfile</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">this_QsqrdKeyList</span><span class="p">,</span><span class="n">this_Qsqrdlist</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">iQkey</span><span class="p">,</span><span class="n">iQsqrd</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">this_QsqrdKeyList</span><span class="p">,</span><span class="n">this_Qsqrdlist</span><span class="p">):</span>
            <span class="n">this_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="n">iQkey</span><span class="o">+</span><span class="s1">&#39;_info.dat&#39;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">this_file</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;FNF:&#39;</span><span class="p">,</span><span class="n">this_file</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">this_file</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">file_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">icy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">mul_of_1000</span> <span class="o">=</span> <span class="n">icy</span><span class="o">//</span><span class="mi">1000</span>
                <span class="n">this_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="s1">&#39;/Chi_block_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">mul_of_1000</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
                <span class="n">this_file</span> <span class="o">=</span> <span class="n">this_dir</span><span class="o">+</span><span class="n">iQkey</span><span class="o">+</span><span class="s1">&#39;_Chi&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icy</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.dat&#39;</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">this_file</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">this_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.dat&#39;</span><span class="p">,</span><span class="s1">&#39;.res&#39;</span><span class="p">)):</span>
                    <span class="n">file_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">this_file</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">icy</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solving&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_list</span><span class="p">),</span> <span class="s1">&#39;equations for &#39;</span> <span class="p">,</span> <span class="n">iQkey</span><span class="p">)</span>
            <span class="n">DoMulticore</span><span class="p">(</span><span class="n">this_fun</span><span class="p">,</span><span class="n">file_list</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span></div>

<div class="viewcode-block" id="FFEquation.DelSystemResults"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.DelSystemResults">[docs]</a>    <span class="k">def</span> <span class="nf">DelSystemResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">this_I_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="s1">&#39;_Instance.dat&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">this_I_file</span><span class="p">):</span> <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">this_I_file</span><span class="p">)</span>

        <span class="n">this_qfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="s1">&#39;_info.dat&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">this_qfile</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">this_qfile</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">this_QsqrdKeyList</span><span class="p">,</span><span class="n">this_Qsqrdlist</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">iQkey</span><span class="p">,</span><span class="n">iQsqrd</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">this_QsqrdKeyList</span><span class="p">,</span><span class="n">this_Qsqrdlist</span><span class="p">):</span>
                <span class="n">this_dat_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="n">iQkey</span><span class="o">+</span><span class="s1">&#39;_info.dat&#39;</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">this_dat_file</span><span class="p">):</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">this_dat_file</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">temp</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span>   <span class="n">linklist</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])),</span>
                                                        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Deleting Form Factors for &#39;</span><span class="o">+</span><span class="n">iQkey</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">icy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                        <span class="n">mul_of_1000</span> <span class="o">=</span> <span class="n">icy</span><span class="o">//</span><span class="mi">1000</span>
                        <span class="n">this_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="s1">&#39;/Chi_block_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">mul_of_1000</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
                        <span class="n">this_file</span> <span class="o">=</span> <span class="n">this_dir</span><span class="o">+</span><span class="n">iQkey</span><span class="o">+</span><span class="s1">&#39;_Chi&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icy</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.dat&#39;</span>
                        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">this_file</span><span class="p">):</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">this_file</span><span class="p">)</span>
                        <span class="n">this_file</span> <span class="o">=</span> <span class="n">this_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.dat&#39;</span><span class="p">,</span><span class="s1">&#39;.res&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">this_file</span><span class="p">):</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">this_file</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span><span class="o">.</span><span class="n">Lap</span><span class="p">()</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">this_dat_file</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">this_qfile</span><span class="p">)</span></div>

<div class="viewcode-block" id="FFEquation.LoadSystemResults"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.LoadSystemResults">[docs]</a>    <span class="k">def</span> <span class="nf">LoadSystemResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading system of equations&#39;</span><span class="p">)</span>

        <span class="n">this_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="s1">&#39;_Instance.dat&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">this_file</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s1">&#39;FNF: &#39;</span><span class="o">+</span><span class="n">this_file</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> as FFSetup and FFSolve been completed?&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">this_file</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LoadSystemResultsFO</span><span class="p">(</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">ffboot</span><span class="p">,</span><span class="n">ffAvg</span><span class="p">,</span><span class="n">ffStd</span><span class="p">,</span><span class="n">ilist</span> <span class="o">=</span> <span class="p">[],[],[],[]</span>
        <span class="c1"># self.MakeQsqrdList()</span>

        <span class="k">for</span> <span class="n">iQkey</span><span class="p">,</span><span class="n">iQsqrd</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">QsqrdKeyList</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Qsqrdlist</span><span class="p">):</span>

            <span class="n">this_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="n">iQkey</span><span class="o">+</span><span class="s1">&#39;_info.dat&#39;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">this_file</span><span class="p">):</span> <span class="k">continue</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">this_file</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">OnlyGe</span><span class="p">,</span><span class="n">ydata_len</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span>   <span class="n">linklist</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ydata_len</span><span class="p">)),</span>
                                                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Loading Form Factors for &#39;</span><span class="o">+</span><span class="n">iQkey</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">icy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ydata_len</span><span class="p">):</span>
                <span class="n">mul_of_1000</span> <span class="o">=</span> <span class="n">icy</span><span class="o">//</span><span class="mi">1000</span>
                <span class="n">this_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="s1">&#39;/Chi_block_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">mul_of_1000</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
                <span class="n">this_file</span> <span class="o">=</span> <span class="n">this_dir</span><span class="o">+</span><span class="n">iQkey</span><span class="o">+</span><span class="s1">&#39;_Chi&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icy</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.res&#39;</span>

                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">this_file</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">this_file</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="n">thisfit</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">()</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;File:&#39;</span><span class="p">,</span><span class="n">this_file</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: FNF: &#39;</span><span class="p">,</span><span class="n">this_file</span><span class="p">)</span>

                <span class="c1">## at Q^2 = 0, only G_{E} can be deturmined</span>
                <span class="k">if</span> <span class="n">OnlyGe</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;Vector&#39;</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">):</span>
                    <span class="n">thisfit</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;G_</span><span class="si">{E}</span><span class="s1">&#39;</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">thisfit</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;F_</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="p">,:]</span>

                <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Chi&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icy</span><span class="p">),</span><span class="n">iQkey</span><span class="p">))</span>
                <span class="n">ffboot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisfit</span><span class="p">)</span>
                <span class="n">ffAvg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisfit</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;ParamsAvg&#39;</span><span class="p">])</span>
                <span class="n">ffStd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisfit</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;ParamsStd&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span><span class="o">.</span><span class="n">Lap</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Col_Names</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">ffboot</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">ffAvg</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">ffStd</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span></div>


<div class="viewcode-block" id="FFEquation.Undo_Over_Renorm"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.Undo_Over_Renorm">[docs]</a>    <span class="k">def</span> <span class="nf">Undo_Over_Renorm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">## self.Renromed is just a bool to keep track if you have renormalised the quantity or not</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">:</span>
            <span class="c1"># self.FF_Stats.loc[:,&#39;boot&#39;] = (self.FF_Stats.loc[:,&#39;boot&#39;]*FFRenorm[self.currtype]).apply(DoStats)</span>
            <span class="c1"># self.FF_Stats.loc[:,&#39;Avg&#39;] = self.FF_Stats.loc[:,&#39;boot&#39;].apply(DoAvg)</span>
            <span class="c1"># self.FF_Stats.loc[:,&#39;Std&#39;] = self.FF_Stats.loc[:,&#39;boot&#39;].apply(DoStd)</span>
            <span class="k">for</span> <span class="n">ikey</span><span class="p">,</span><span class="n">iff</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">hold_df</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="n">columns</span><span class="o">=</span><span class="n">iff</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                                        <span class="n">index</span><span class="o">=</span><span class="n">iff</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">iparam</span><span class="p">,</span><span class="n">ival</span> <span class="ow">in</span> <span class="n">iff</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">hold_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">iparam</span><span class="p">,</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ival</span><span class="o">/</span><span class="n">FFRenorm</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">hold_df</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">iff</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;ParamsAvg&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">iff</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;ParamsStd&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="p">:</span>
            <span class="c1"># self.FF_Fit_Stats.loc[:,&#39;boot&#39;] = (self.FF_Fit_Stats.loc[:,&#39;boot&#39;]*FFRenorm[self.currtype]).apply(DoStats)</span>
            <span class="c1"># self.FF_Fit_Stats.loc[:,&#39;Avg&#39;] = self.FF_Fit_Stats.loc[:,&#39;boot&#39;].apply(DoAvg)</span>
            <span class="c1"># self.FF_Fit_Stats.loc[:,&#39;Std&#39;] = self.FF_Fit_Stats.loc[:,&#39;boot&#39;].apply(DoStd)</span>
            <span class="k">for</span> <span class="n">ikey</span><span class="p">,</span><span class="n">iff_fit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">hold_df_fit</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="n">columns</span><span class="o">=</span><span class="n">iff_fit</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                                            <span class="n">index</span><span class="o">=</span><span class="n">iff_fit</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">iparam</span><span class="p">,</span><span class="n">ival</span> <span class="ow">in</span> <span class="n">iff_fit</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">hold_df_fit</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">iparam</span><span class="p">,</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ival</span><span class="o">/</span><span class="n">FFRenorm</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">hold_df_fit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">iff_fit</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;ParamsAvg&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">iff_fit</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;ParamsStd&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="FFEquation.Renorm"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.Renorm">[docs]</a>    <span class="k">def</span> <span class="nf">Renorm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">## self.Renromed is just a bool to keep track if you have renormalised the quantity or not</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">Renormed</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">:</span>
                <span class="c1"># self.FF_Stats.loc[:,&#39;boot&#39;] = (self.FF_Stats.loc[:,&#39;boot&#39;]*FFRenorm[self.currtype]).apply(DoStats)</span>
                <span class="c1"># self.FF_Stats.loc[:,&#39;Avg&#39;] = self.FF_Stats.loc[:,&#39;boot&#39;].apply(DoAvg)</span>
                <span class="c1"># self.FF_Stats.loc[:,&#39;Std&#39;] = self.FF_Stats.loc[:,&#39;boot&#39;].apply(DoStd)</span>
                <span class="k">for</span> <span class="n">ikey</span><span class="p">,</span><span class="n">iff</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">hold_df</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="n">columns</span><span class="o">=</span><span class="n">iff</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                                            <span class="n">index</span><span class="o">=</span><span class="n">iff</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">iparam</span><span class="p">,</span><span class="n">ival</span> <span class="ow">in</span> <span class="n">iff</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">Debug_Mode</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">FFRenorm</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                            <span class="nb">print</span><span class="p">()</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">iparam</span><span class="p">,</span><span class="s1">&#39;Params&#39;</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">iff</span><span class="o">.</span><span class="n">fit_data</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">()</span>
                        <span class="n">hold_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">iparam</span><span class="p">,</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ival</span><span class="o">*</span><span class="n">FFRenorm</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">hold_df</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">iff</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;ParamsAvg&#39;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">iff</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;ParamsStd&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="p">:</span>
                <span class="c1"># self.FF_Fit_Stats.loc[:,&#39;boot&#39;] = (self.FF_Fit_Stats.loc[:,&#39;boot&#39;]*FFRenorm[self.currtype]).apply(DoStats)</span>
                <span class="c1"># self.FF_Fit_Stats.loc[:,&#39;Avg&#39;] = self.FF_Fit_Stats.loc[:,&#39;boot&#39;].apply(DoAvg)</span>
                <span class="c1"># self.FF_Fit_Stats.loc[:,&#39;Std&#39;] = self.FF_Fit_Stats.loc[:,&#39;boot&#39;].apply(DoStd)</span>
                <span class="k">for</span> <span class="n">ikey</span><span class="p">,</span><span class="n">iff_fit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">hold_df_fit</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="n">columns</span><span class="o">=</span><span class="n">iff_fit</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                                                <span class="n">index</span><span class="o">=</span><span class="n">iff_fit</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">iparam</span><span class="p">,</span><span class="n">ival</span> <span class="ow">in</span> <span class="n">iff_fit</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">hold_df_fit</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">iparam</span><span class="p">,</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ival</span><span class="o">*</span><span class="n">FFRenorm</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">hold_df_fit</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">iff_fit</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;ParamsAvg&#39;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ikey</span><span class="p">,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">iff_fit</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;ParamsStd&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Renormed</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="FFEquation.FormatProjGamma"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.FormatProjGamma">[docs]</a>    <span class="k">def</span> <span class="nf">FormatProjGamma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thisoplist</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;P&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">thisoplist</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Please try to have the Projector in the first element of the oplist &#39;</span><span class="p">)</span>
        <span class="n">thisProj</span> <span class="o">=</span> <span class="n">thisoplist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">thisGamma</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">thisoplist</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">if</span> <span class="s1">&#39;Top&#39;</span> <span class="ow">in</span> <span class="n">thisGamma</span> <span class="p">:</span>
            <span class="n">thisGamma</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Top&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">FO</span> <span class="o">=</span> <span class="s1">&#39;TopCharge&#39;</span>
        <span class="k">elif</span> <span class="s1">&#39;Wein&#39;</span> <span class="ow">in</span> <span class="n">thisGamma</span><span class="p">:</span>
            <span class="n">thisGamma</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Wein&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">FO</span> <span class="o">=</span> <span class="s1">&#39;Weinberg&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">FO</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">return</span> <span class="n">thisProj</span><span class="p">,</span><span class="n">thisGamma</span><span class="p">,</span><span class="n">FO</span></div>

<div class="viewcode-block" id="FFEquation.Get2ptFit"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.Get2ptFit">[docs]</a>    <span class="k">def</span> <span class="nf">Get2ptFit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fit2pt</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fit2pt</span> <span class="o">==</span> <span class="s1">&#39;From Def&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2forMass</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">defFitDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fit2pt</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">defFitDict</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fit2pt</span> <span class="o">=</span> <span class="n">defFitDict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">C2forMass</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">## don&#39;t forget fit2pt = (state# , fitr#-#)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit2pt</span> <span class="o">=</span> <span class="n">fit2pt</span>

        <span class="c1"># if &#39;boot&#39; not in self.C2forMass.C2_Fit_Stats or (self.fit2pt[0],&#39;p000&#39;,self.fit2pt[1]) not in self.C2forMass.C2_Fit_Stats[&#39;boot&#39;].keys():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Fitting two-point correlator for mass&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit2pt</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C2forMass</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit2pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],[</span><span class="bp">self</span><span class="o">.</span><span class="n">fit2pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Fitting complete.&#39;</span><span class="p">)</span></div>
        <span class="c1"># elif self.fit2pt[1] not in self.C2forMass.C2_Fit_Stats[&#39;boot&#39;][self.fit2pt[0],&#39;p000&#39;].keys():</span>
        <span class="c1">#     print &#39;Fitting two-point correlator for mass&#39;, self.fit2pt</span>
        <span class="c1">#     self.C2forMass.Fit(self.fit2pt[0],[self.fit2pt[1]])</span>

<div class="viewcode-block" id="FFEquation.PreGet2ptFit"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.PreGet2ptFit">[docs]</a>    <span class="k">def</span> <span class="nf">PreGet2ptFit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fit2pt</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fit2pt</span> <span class="o">==</span> <span class="s1">&#39;From Def&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PreC2forMass</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">defFitDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fit2pt</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">defFitDict</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fit2pt</span> <span class="o">=</span> <span class="n">defFitDict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">PreC2forMass</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">## don&#39;t forget fit2pt = (state# , fitr#-#)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit2pt</span> <span class="o">=</span> <span class="n">fit2pt</span>

        <span class="c1"># if &#39;boot&#39; not in self.C2forMass.C2_Fit_Stats or (self.fit2pt[0],&#39;p000&#39;,self.fit2pt[1]) not in self.C2forMass.C2_Fit_Stats[&#39;boot&#39;].keys():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Fitting Pre two-point correlator for mass&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit2pt</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PreC2forMass</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit2pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],[</span><span class="bp">self</span><span class="o">.</span><span class="n">fit2pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span></div>
        <span class="c1"># elif self.fit2pt[1] not in self.C2forMass.C2_Fit_Stats[&#39;boot&#39;][self.fit2pt[0],&#39;p000&#39;].keys():</span>
        <span class="c1">#     print &#39;Fitting two-point correlator for mass&#39;, self.fit2pt</span>
        <span class="c1">#     self.C2forMass.Fit(self.fit2pt[0],[self.fit2pt[1]])</span>


<div class="viewcode-block" id="FFEquation.GetAlphaFit"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.GetAlphaFit">[docs]</a>    <span class="k">def</span> <span class="nf">GetAlphaFit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fitAlpha</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Extracting alpha fit from&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2FOforAlpha</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fitAlpha</span> <span class="o">==</span> <span class="s1">&#39;From Def&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fitAlpha</span> <span class="o">=</span> <span class="n">defFitAlpha</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">C2FOforAlpha</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">## don&#39;t forget fitAlpha = fitr#-#</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fitAlpha</span> <span class="o">=</span> <span class="n">fitAlpha</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doAlphafull</span><span class="p">:</span>
            <span class="c1"># if  &#39;boot&#39; not in self.C2FOforAlpha.NNQ_Fit_Stats or \</span>
            <span class="c1">#     (&#39;p000&#39;,self.fitAlpha) not in self.C2FOforAlpha.NNQFull_Fit_Stats[&#39;boot&#39;].swaplevel(1,2):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Fitting NNQFull for Alpha&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitAlpha</span><span class="p">)</span>
            <span class="n">fitr_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitAlpha</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2FOforAlpha</span><span class="o">.</span><span class="n">FitAlpha</span><span class="p">(</span><span class="n">fit_range</span><span class="o">=</span><span class="n">fitr_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">thistflowlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">,</span><span class="n">tsum_ranges</span><span class="o">=</span><span class="n">fitr_list</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if  &#39;boot&#39; not in self.C2FOforAlpha.NNQ_Fit_Stats or \</span>
            <span class="c1">#     (&#39;p000&#39;,self.fitAlpha) not in self.C2FOforAlpha.NNQ_Fit_Stats[&#39;boot&#39;].swaplevel(1,2):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Fitting NNQ for Alpha&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitAlpha</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2FOforAlpha</span><span class="o">.</span><span class="n">FitAlpha</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitAlpha</span><span class="p">,</span><span class="n">thistflowlist</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">)</span></div>

<div class="viewcode-block" id="FFEquation.SetCustomName"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.SetCustomName">[docs]</a>    <span class="k">def</span> <span class="nf">SetCustomName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">LegLab</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflowfull</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span>  <span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;R&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_tsum_range</span><span class="p">,</span>
                                                <span class="s1">&#39;A&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">fitAlphain</span><span class="p">,</span><span class="s1">&#39;RFmin&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RF_fit_range_minimum</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span>  <span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">,</span><span class="s1">&#39;qmax&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ppparams</span><span class="o">.</span><span class="n">mom2max</span><span class="p">),</span>
                                            <span class="s1">&#39;ppmax&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">mom2max</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                            <span class="s1">&#39;A&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">fitAlphain</span><span class="p">,</span><span class="s1">&#39;RFmin&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RF_fit_range_minimum</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span>  <span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;A&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">fitAlphain</span><span class="p">,</span>
                                                <span class="s1">&#39;RFmin&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RF_fit_range_minimum</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span>  <span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">,</span><span class="s1">&#39;qmax&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ppparams</span><span class="o">.</span><span class="n">mom2max</span><span class="p">),</span>
                                            <span class="s1">&#39;ppmax&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">mom2max</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                            <span class="s1">&#39;A&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">fitAlphain</span><span class="p">,</span><span class="s1">&#39;RFmin&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RF_fit_range_minimum</span><span class="p">)))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">,</span><span class="s1">&#39;RFmin&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RF_fit_range_minimum</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>   <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">,</span><span class="s1">&#39;qmax&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ppparams</span><span class="o">.</span><span class="n">mom2max</span><span class="p">),</span>
                                        <span class="s1">&#39;ppmax&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">mom2max</span><span class="p">),</span><span class="s1">&#39;RFmin&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RF_fit_range_minimum</span><span class="p">)))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Do_Chi_cutoff</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Important_FF</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reduce_System</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+=</span> <span class="s1">&#39;_RIChi</span><span class="si">{:}</span><span class="s1">-</span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Chi2pdf_Min</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Chi2pdf_Max</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39;_RIChi</span><span class="si">{:}</span><span class="s1">-</span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Chi2pdf_Min</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Chi2pdf_Max</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+=</span> <span class="s1">&#39;_IChi</span><span class="si">{:}</span><span class="s1">-</span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Chi2pdf_Min</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Chi2pdf_Max</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39;_IChi</span><span class="si">{:}</span><span class="s1">-</span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Chi2pdf_Min</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Chi2pdf_Max</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reduce_System</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+=</span> <span class="s1">&#39;_RChi</span><span class="si">{:}</span><span class="s1">-</span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Chi2pdf_Min</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Chi2pdf_Max</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39;_RChi</span><span class="si">{:}</span><span class="s1">-</span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Chi2pdf_Min</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Chi2pdf_Max</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+=</span> <span class="s1">&#39;_Chi</span><span class="si">{:}</span><span class="s1">-</span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Chi2pdf_Min</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Chi2pdf_Max</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39;_Chi</span><span class="si">{:}</span><span class="s1">-</span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Chi2pdf_Min</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Chi2pdf_Max</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reduce_System</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+=</span> <span class="s1">&#39;_BestRChi&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39;_BestRChi&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+=</span> <span class="s1">&#39;_BestChi&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39;_BestChi&#39;</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;isCustomRFitR&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">isCustomRFitR</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+=</span> <span class="s1">&#39;_RfitRCust&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39;_RfitRCust&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_alpha</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39;_Rata&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+=</span> <span class="s1">&#39;_Rata&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetLegLab</span><span class="p">(</span><span class="n">LegLab</span><span class="o">=</span><span class="n">LegLab</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subdir</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span><span class="s1">&#39;qmax&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ppparams</span><span class="o">.</span><span class="n">mom2max</span><span class="p">),</span><span class="s1">&#39;ppmax&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">mom2max</span><span class="p">)))</span>
        <span class="c1"># self.SubDir = &#39;_&#39;.join([self.C3class.Proj,self.C3class.DS,self.C3class.ppform])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">FFdir</span> <span class="o">=</span> <span class="n">outputdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ppparams</span><span class="o">.</span><span class="n">kappafolder</span><span class="o">+</span><span class="s1">&#39;/FormFactors/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">subdir</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FFdir_scratch</span> <span class="o">=</span> <span class="n">scratchdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ppparams</span><span class="o">.</span><span class="n">kappafolder</span><span class="o">+</span><span class="s1">&#39;/FormFactors/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">subdir</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
        <span class="n">mkdir_p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FFdir</span><span class="o">+</span><span class="s1">&#39;/Pickle/&#39;</span><span class="p">)</span>
        <span class="n">mkdir_p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FFdir</span><span class="o">+</span><span class="s1">&#39;/Excel/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FFdir</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.xml&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FFdir</span><span class="o">+</span><span class="s1">&#39;/Excel/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.xlsx&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FFdir</span><span class="o">+</span><span class="s1">&#39;/Pickle/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.py3p&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FFdir_scratch</span><span class="o">+</span><span class="s1">&#39;/System/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
        <span class="n">mkdir_p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="p">)</span></div>


<div class="viewcode-block" id="FFEquation.SetLegLab"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.SetLegLab">[docs]</a>    <span class="k">def</span> <span class="nf">SetLegLab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">LegLab</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">stream_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">LegLab</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span> <span class="o">=</span> <span class="s1">&#39;$&#39;</span><span class="o">+</span><span class="s1">&#39;\ &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_ll</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">GetPionMassLab</span><span class="p">(),</span><span class="n">stream_name</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;$&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stream_name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span> <span class="o">=</span> <span class="n">LegLab</span><span class="o">+</span><span class="s1">&#39;$\ &#39;</span><span class="o">+</span><span class="n">stream_name</span><span class="o">+</span><span class="s1">&#39;$&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span> <span class="o">=</span> <span class="n">LegLab</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_alpha</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39;\ R_{\alpha}&#39;</span></div>

<div class="viewcode-block" id="FFEquation.ConvertToBNL"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.ConvertToBNL">[docs]</a>    <span class="k">def</span> <span class="nf">ConvertToBNL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span> <span class="k">return</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2FOforAlpha</span><span class="p">,</span><span class="s1">&#39;NNQFull_Fit_Stats&#39;</span><span class="p">):</span>
            <span class="c1"># thisalpha = self.C2FOforAlpha.NNQFull_Fit_Stats.loc[(&#39;p000&#39;,self.tflows[0],self.fitAlpha),&#39;boot&#39;]</span>
            <span class="n">fit_split</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitAlpha</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="n">fit_split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit_split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;tsumfitr&#39;</span><span class="p">,</span><span class="s1">&#39;fittwor&#39;</span><span class="p">)</span>
            <span class="n">thisalpha</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thisFF</span><span class="o">.</span><span class="n">alpha</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># thisalpha = self.C2FOforAlpha.NNQFull_Fit_Stats.loc[(&#39;p000&#39;,self.tflows[0]),&#39;boot&#39;]\</span>
            <span class="c1">#                                                 [fit_split[0],fit_split[1]].iloc[0]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thisalpha</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thisFF</span><span class="o">.</span><span class="n">alpha</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># thisalpha = self.C2FOforAlpha.NNQ_Fit_Stats.loc[(&#39;p000&#39;,self.tflows[0]),&#39;boot&#39;][self.fitAlpha].iloc[0]</span>
        <span class="c1">## ends up being a bootstrapped quantitiy</span>

        <span class="c1"># thisalpha = thisalpha.fit_data[&#39;Params&#39;].values[0]</span>
        <span class="n">twocos_alpha</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">thisalpha</span><span class="p">)</span><span class="o">.</span><span class="n">cos</span><span class="p">()</span>
        <span class="n">twosin_alpha</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">thisalpha</span><span class="p">)</span><span class="o">.</span><span class="n">sin</span><span class="p">()</span>
        <span class="n">mintwosin_alpha</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">thisalpha</span><span class="p">)</span><span class="o">.</span><span class="n">sin</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span>   <span class="n">linklist</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]),</span>
                                            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Creating BNL form factors&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ikey</span><span class="p">,</span><span class="n">Qsqrdres</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;tilde</span><span class="si">{F}</span><span class="s1">_</span><span class="si">{2}</span><span class="s1">&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Qsqrdres</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;tilde</span><span class="si">{F}</span><span class="s1">_</span><span class="si">{3}</span><span class="s1">&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Qsqrdres</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span> <span class="k">continue</span>
            <span class="c1"># F2hold = deepcopy(Qsqrdres.fit_data.loc[&#39;tilde{F}_{2}&#39;,&#39;Params&#39;])</span>
            <span class="c1"># F3hold = deepcopy(Qsqrdres.fit_data.loc[&#39;tilde{F}_{3}&#39;,&#39;Params&#39;])</span>
            <span class="n">F2hold</span> <span class="o">=</span> <span class="n">Qsqrdres</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;tilde</span><span class="si">{F}</span><span class="s1">_</span><span class="si">{2}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span>
            <span class="n">F3hold</span> <span class="o">=</span> <span class="n">Qsqrdres</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;tilde</span><span class="si">{F}</span><span class="s1">_</span><span class="si">{3}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span>
            <span class="n">hold_df</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">Qsqrdres</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">icol</span><span class="p">,</span><span class="n">colval</span> <span class="ow">in</span> <span class="n">Qsqrdres</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">jkey</span><span class="p">,</span><span class="n">ival</span> <span class="ow">in</span> <span class="n">colval</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">hold_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">jkey</span><span class="p">,</span><span class="n">icol</span><span class="p">]</span> <span class="o">=</span> <span class="n">ival</span>
            <span class="c1"># hold_df.loc[&#39;tilde{F}_{2}&#39;,:] = self.FF_Stats.loc[ikey,&#39;boot&#39;].fit_data.loc[&#39;tilde{F}_{2}&#39;,:]</span>
            <span class="c1"># hold_df.loc[&#39;tilde{F}_{3}&#39;,:] = self.FF_Stats.loc[ikey,&#39;boot&#39;].fit_data.loc[&#39;tilde{F}_{3}&#39;,:]</span>
            <span class="n">hold_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;tilde</span><span class="si">{F}</span><span class="s1">_</span><span class="si">{2}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">twocos_alpha</span> <span class="o">*</span> <span class="n">F2hold</span> <span class="o">+</span> <span class="n">mintwosin_alpha</span><span class="o">*</span><span class="n">F3hold</span>
            <span class="n">hold_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;tilde</span><span class="si">{F}</span><span class="s1">_</span><span class="si">{3}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">twosin_alpha</span> <span class="o">*</span> <span class="n">F2hold</span> <span class="o">+</span> <span class="n">twocos_alpha</span><span class="o">*</span><span class="n">F3hold</span>
            <span class="n">Qsqrdres</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span> <span class="o">=</span> <span class="n">hold_df</span>
            <span class="c1"># self.FF_Stats.at[ikey,&#39;boot&#39;].fit_data.update(hold_df)</span>
            <span class="n">Qsqrdres</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
            <span class="n">Qsqrdres</span><span class="p">[</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;tilde</span><span class="si">{F}</span><span class="s1">_</span><span class="si">{2}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Qsqrdres</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;tilde</span><span class="si">{F}</span><span class="s1">_</span><span class="si">{2}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Avg</span>
            <span class="n">Qsqrdres</span><span class="p">[</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;tilde</span><span class="si">{F}</span><span class="s1">_</span><span class="si">{3}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Qsqrdres</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;tilde</span><span class="si">{F}</span><span class="s1">_</span><span class="si">{3}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Avg</span>
            <span class="n">Qsqrdres</span><span class="p">[</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;tilde</span><span class="si">{F}</span><span class="s1">_</span><span class="si">{2}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Qsqrdres</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;tilde</span><span class="si">{F}</span><span class="s1">_</span><span class="si">{2}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Std</span>
            <span class="n">Qsqrdres</span><span class="p">[</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;tilde</span><span class="si">{F}</span><span class="s1">_</span><span class="si">{3}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Qsqrdres</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;tilde</span><span class="si">{F}</span><span class="s1">_</span><span class="si">{3}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Std</span>
            <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span><span class="o">.</span><span class="n">Lap</span><span class="p">(</span><span class="n">ikey</span><span class="p">)</span></div>

<div class="viewcode-block" id="FFEquation.FixRead"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.FixRead">[docs]</a>    <span class="k">def</span> <span class="nf">FixRead</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">readdict</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;Renormed&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">readdict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;Renormed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;Inefm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">readdict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;Inefm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># if &#39;RenormedFix&#39; not in readdict.keys():</span>
        <span class="c1">#     readdict[&#39;RenormedFix&#39;] = False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;tflows&#39;</span><span class="p">],(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;tflows&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tflows</span>
        <span class="c1"># if not os.path.isfile(str(readdict[&#39;PickleFile&#39;])):</span>
        <span class="c1">#     readdict[&#39;PickleFile&#39;] = self.PickleFile</span>
        <span class="c1">#     readdict[&#39;HumanFile&#39;] = self.HumanFile</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;THIS LINE IS HERE TO MAKE THE FILE POINT TO ITSELF!&#39;</span><span class="p">)</span>
        <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;PickleFile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span>
        <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;HumanFile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;ppparams&#39;</span><span class="p">],</span><span class="s1">&#39;PickleFile&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;ppparams&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">):</span>
            <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;ppparams&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">PickleFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ppparams</span><span class="o">.</span><span class="n">PickleFile</span>
            <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;ppparams&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">HumanFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ppparams</span><span class="o">.</span><span class="n">HumanFile</span>
            <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;qparams&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">PickleFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">PickleFile</span>
            <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;qparams&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">HumanFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">HumanFile</span>
            <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;Info&#39;</span><span class="p">][</span><span class="s1">&#39;outdir&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;outdir&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;QsqrdKeylist&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">readdict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;QsqrdKeyList&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;QsqrdKeylist&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;isCustomRFitR&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">readdict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;isCustomRFitR&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">Debug_Mode</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Debug mode fixes broken file for currtype, fixing now&#39;</span><span class="p">)</span>
            <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;currtype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currtype</span>

        <span class="k">return</span> <span class="n">readdict</span></div>


<div class="viewcode-block" id="FFEquation.SetupPickle"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.SetupPickle">[docs]</a>    <span class="k">def</span> <span class="nf">SetupPickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">HardWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">Mcore</span><span class="o">=</span><span class="n">defMcore</span><span class="p">,</span>
                    <span class="n">RatioFitLists</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">,</span><span class="kc">False</span><span class="p">]):</span>
        <span class="c1"># print &#39;Loading Pickle for &#39; , self.PickleFile</span>
        <span class="c1"># print &#39;Loading Pickle for &#39; , self.PickleFile</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;isCustomRFitR&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">isCustomRFitR</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies_flow</span> <span class="o">=</span> <span class="n">RatioFitLists</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies_flow</span> <span class="o">=</span> <span class="n">RatioFitLists</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isCustomRFitR</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies</span><span class="p">,</span><span class="nb">bool</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetCustomName</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">DefWipe</span><span class="p">:</span>
            <span class="n">thispickle</span> <span class="o">=</span> <span class="n">ReadPickleWrap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span>
            <span class="n">thispickle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FixRead</span><span class="p">(</span><span class="n">thispickle</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">thispickle</span><span class="p">[</span><span class="s1">&#39;tflows&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">,</span><span class="s1">&#39;.bak.xlsx&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetupPickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">HardWipe</span><span class="o">=</span><span class="n">HardWipe</span><span class="p">,</span><span class="n">Mcore</span><span class="o">=</span><span class="n">Mcore</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;flow times incorrect in file:&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;file is &#39;</span> <span class="p">,</span> <span class="n">thispickle</span><span class="p">[</span><span class="s1">&#39;tflows&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;class is &#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="s1">&#39;_Instance.dat&#39;</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Instance file for computing system of equations found:&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="s1">&#39;_Instance.dat&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Jumping to solving system of equations&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">LoadPreFF</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">HardWipe</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">LoadRatios</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">HardWipe</span><span class="p">,</span><span class="n">Mcore</span><span class="o">=</span><span class="n">Mcore</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">LoadProperFF</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">HardWipe</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reduce_System</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">LineupReducedRF</span><span class="p">(</span><span class="n">Mcore</span><span class="o">=</span><span class="n">Mcore</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">PullFits</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">SetupRatios</span><span class="p">()</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies_flow</span>
            <span class="k">if</span> <span class="s1">&#39;RfitIndicies&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">thispickle</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span> <span class="ow">or</span> <span class="s1">&#39;RfitIndicies_flow&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">thispickle</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
                <span class="k">return</span> <span class="n">thispickle</span><span class="p">[</span><span class="s1">&#39;RfitIndicies&#39;</span><span class="p">],</span><span class="n">thispickle</span><span class="p">[</span><span class="s1">&#39;RfitIndicies_flow&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span><span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cannot find file&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="s1">&#39;_Instance.dat&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">DefWipe</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Instance file for computing system of equations found:&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SystemDir</span><span class="o">+</span><span class="s1">&#39;_Instance.dat&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Jumping to solving system of equations&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LoadPreFF</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">HardWipe</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LoadRatios</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">HardWipe</span><span class="p">,</span><span class="n">Mcore</span><span class="o">=</span><span class="n">Mcore</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LoadProperFF</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">HardWipe</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reduce_System</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">LineupReducedRF</span><span class="p">(</span><span class="n">Mcore</span><span class="o">=</span><span class="n">Mcore</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PullFits</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SetupRatios</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies_flow</span></div>

<div class="viewcode-block" id="FFEquation.SolvePickle"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.SolvePickle">[docs]</a>    <span class="k">def</span> <span class="nf">SolvePickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">HardWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">Mcore</span><span class="o">=</span><span class="n">defMcore</span><span class="p">,</span>
                    <span class="n">RatioFitLists</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">,</span><span class="kc">False</span><span class="p">]):</span>
        <span class="c1"># print &#39;Loading Pickle for &#39; , self.PickleFile</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;isCustomRFitR&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">isCustomRFitR</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies_flow</span> <span class="o">=</span> <span class="n">RatioFitLists</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies_flow</span> <span class="o">=</span> <span class="n">RatioFitLists</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isCustomRFitR</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies</span><span class="p">,</span><span class="nb">bool</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetCustomName</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">DefWipe</span><span class="p">:</span>
            <span class="n">thispickle</span> <span class="o">=</span> <span class="n">ReadPickleWrap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span>
            <span class="n">thispickle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FixRead</span><span class="p">(</span><span class="n">thispickle</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">thispickle</span><span class="p">[</span><span class="s1">&#39;tflows&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;using backupfile for &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">,</span><span class="s1">&#39;.bak.xlsx&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SolvePickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">HardWipe</span><span class="o">=</span><span class="n">HardWipe</span><span class="p">,</span><span class="n">Mcore</span><span class="o">=</span><span class="n">Mcore</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;flow times incorrect in file:&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;file is &#39;</span> <span class="p">,</span> <span class="n">thispickle</span><span class="p">[</span><span class="s1">&#39;tflows&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;class is &#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SolveSystem</span><span class="p">(</span><span class="n">Mcore</span><span class="o">=</span><span class="n">Mcore</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies_flow</span>
            <span class="k">if</span> <span class="s1">&#39;RfitIndicies&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">thispickle</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span> <span class="ow">or</span> <span class="s1">&#39;RfitIndicies_flow&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">thispickle</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
                <span class="k">return</span> <span class="n">thispickle</span><span class="p">[</span><span class="s1">&#39;RfitIndicies&#39;</span><span class="p">],</span><span class="n">thispickle</span><span class="p">[</span><span class="s1">&#39;RfitIndicies_flow&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span><span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cannot find file&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolveSystem</span><span class="p">(</span><span class="n">Mcore</span><span class="o">=</span><span class="n">Mcore</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies_flow</span></div>

<div class="viewcode-block" id="FFEquation.LoadPickle"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.LoadPickle">[docs]</a>    <span class="k">def</span> <span class="nf">LoadPickle</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">HardWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">Mcore</span><span class="o">=</span><span class="n">defMcore</span><span class="p">,</span><span class="n">OnlyFits</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">DoFits</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">RatioFitLists</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">,</span><span class="kc">False</span><span class="p">]):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading Pickle for &#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;isCustomRFitR&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">isCustomRFitR</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies_flow</span> <span class="o">=</span> <span class="n">RatioFitLists</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies_flow</span> <span class="o">=</span> <span class="n">RatioFitLists</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isCustomRFitR</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RfitIndicies</span><span class="p">,</span><span class="nb">bool</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetCustomName</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">DefWipe</span><span class="p">:</span>
            <span class="n">thispickle</span> <span class="o">=</span> <span class="n">ReadPickleWrap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span>
            <span class="n">thispickle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FixRead</span><span class="p">(</span><span class="n">thispickle</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">thispickle</span><span class="p">[</span><span class="s1">&#39;tflows&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">thispickle</span><span class="p">)</span>
                <span class="c1">## if the file name is broken, just use default location.</span>
                <span class="k">if</span> <span class="s1">&#39;FF_Stats_name&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">thispickle</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">thispickle</span><span class="p">[</span><span class="s1">&#39;FF_Stats_name&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="o">+</span><span class="s1">&#39;.FFstats&#39;</span>
                <span class="k">if</span> <span class="s1">&#39;FF_Fit_Stats_name&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">thispickle</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">thispickle</span><span class="p">[</span><span class="s1">&#39;FF_Fit_Stats_name&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="o">+</span><span class="s1">&#39;.FFFitstats&#39;</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats_name</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">OnlyFits</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats_name</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading stats &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats_name</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">Wipe_All_Fits</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading fit stats &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats_name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats_name</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loaded results from: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">OnlyFits</span><span class="p">:</span>
                    <span class="c1"># if &#39;BNL&#39; in self.currtype:</span>
                    <span class="c1">#     self.ConvertToBNL()</span>
                    <span class="c1"># if &#39;Top&#39; in self.currtype or &#39;Wein&#39; in self.currtype:</span>
                    <span class="c1">#     self.F3div2M()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">TOefm</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Renorm</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">DoFits</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">FitFFs</span><span class="p">(</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;using backupfile for &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">,</span><span class="s1">&#39;.bak.xlsx&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">HardWipe</span><span class="o">=</span><span class="n">HardWipe</span><span class="p">,</span><span class="n">Mcore</span><span class="o">=</span><span class="n">Mcore</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;flow times incorrect in file:&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;file is &#39;</span> <span class="p">,</span> <span class="n">thispickle</span><span class="p">[</span><span class="s1">&#39;tflows&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;class is &#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LoadSystemResults</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Renorm</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">DoFits</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">FitFFs</span><span class="p">(</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cannot find file&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LoadSystemResults</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Renorm</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">DoFits</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">FitFFs</span><span class="p">(</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span></div>

<div class="viewcode-block" id="FFEquation.GetProj"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.GetProj">[docs]</a>    <span class="k">def</span> <span class="nf">GetProj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thislist</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ilist</span> <span class="ow">in</span> <span class="n">thislist</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;P&#39;</span> <span class="o">==</span> <span class="n">ilist</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">ilist</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span></div>

    <span class="c1">## FFout = [ imass , ipp , ( , itflow) thisqsqrd,&#39;_&#39;.join([gammakey,iq]) ] = ( Coeff_1 FF_1 + ... + Coeff_n + FF_n )</span>
    <span class="c1">## Ratout { set , igamma , iq  } Fitting class instance</span>
    <span class="c1">## output is same format as FFout</span>
    <span class="c1">## calculated in a way where set actually contains both gamma and ip, and set has igamma and ip within it</span>
    <span class="c1">## so we just pull the first key for igamma and ip</span>
<div class="viewcode-block" id="FFEquation.GetEquationsOut"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.GetEquationsOut">[docs]</a>    <span class="k">def</span> <span class="nf">GetEquationsOut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">FFout</span><span class="p">,</span><span class="n">Ratout</span><span class="p">,</span><span class="n">Ratout_flow</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ODNested</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">imass</span><span class="p">,</span><span class="n">massdata</span> <span class="ow">in</span> <span class="n">FFout</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">ipp</span><span class="p">,</span><span class="n">ppdata</span> <span class="ow">in</span> <span class="n">massdata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">itflow</span><span class="p">,</span><span class="n">flowdata</span> <span class="ow">in</span> <span class="n">ppdata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">for</span> <span class="n">iqsqrd</span><span class="p">,</span><span class="n">psqrdata</span> <span class="ow">in</span> <span class="n">flowdata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="k">for</span> <span class="n">ipop</span><span class="p">,</span><span class="n">popdata</span> <span class="ow">in</span> <span class="n">psqrdata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                <span class="n">thisProj</span><span class="p">,</span><span class="n">thisGamma</span><span class="p">,</span><span class="n">FO</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FormatProjGamma</span><span class="p">(</span><span class="n">ipop</span><span class="p">)</span>
                                <span class="n">FFkey</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">GetProj</span><span class="p">(</span><span class="n">ipop</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)),</span><span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span><span class="n">ipp</span><span class="p">,</span><span class="s1">&#39;FFRats&#39;</span><span class="p">,</span><span class="n">ipop</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
                                <span class="k">if</span> <span class="s1">&#39;tilde&#39;</span> <span class="ow">in</span> <span class="n">FFkey</span><span class="p">:</span> <span class="n">FFkey</span> <span class="o">=</span> <span class="n">FFkey</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;tilde&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;\tilde&#39;</span><span class="p">)</span>
                                <span class="k">if</span> <span class="s1">&#39;frac&#39;</span> <span class="ow">in</span> <span class="n">FFkey</span><span class="p">:</span> <span class="n">FFkey</span> <span class="o">=</span> <span class="n">FFkey</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;frac&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;\frac&#39;</span><span class="p">)</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flowlab</span> <span class="ow">in</span> <span class="n">ipop</span><span class="p">:</span> <span class="n">FFkey</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flowtype</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflowfull</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;Top&#39;</span> <span class="ow">in</span> <span class="n">FFkey</span> <span class="ow">or</span> <span class="s1">&#39;Wein&#39;</span> <span class="ow">in</span> <span class="n">FFkey</span><span class="p">):</span> <span class="n">FFkey</span> <span class="o">+=</span> <span class="s1">&#39;_RatFull&#39;</span>
                                <span class="c1"># thisRat = Ratout[FFkey]</span>
                                <span class="c1"># while not isinstance(thisRat,ff.Fitting):</span>
                                <span class="c1">#     try:</span>
                                <span class="c1">#         thisRat = thisRat[thisRat.keys()[0]]</span>
                                <span class="c1">#     except:</span>
                                <span class="c1">#         print thisRat</span>
                                <span class="c1">#         raise EnvironmentError(&#39;Error occured when trying to get ratio function for equations out&#39;)</span>
                                <span class="c1"># print Ratout.keys(),FFkey</span>
                                <span class="c1"># raise EnvironmentError(&#39;This part needs to be implemented.&#39;)</span>
                                <span class="c1"># if FFkey not in Ratout.keys(): continue</span>
                                <span class="c1"># thisRat = thisRat[thisRat.keys()[0]]</span>
                                <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">flowed_op</span> <span class="ow">in</span> <span class="n">FFkey</span> <span class="k">for</span> <span class="n">flowed_op</span> <span class="ow">in</span> <span class="n">ObsListAbr</span><span class="p">]):</span>
                                    <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Ratout_flow</span><span class="p">:</span>
                                        <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s1">&#39;Ratout_flow not initialised&#39;</span><span class="p">)</span>
                                    <span class="k">elif</span> <span class="n">FFkey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Ratout_flow</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                                        <span class="n">err_hold</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ival</span><span class="p">)</span> <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Ratout_flow</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
                                        <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="n">FFkey</span> <span class="o">+</span> <span class="s2">&quot; not in Ratout.keys(): </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">err_hold</span><span class="p">))</span>
                                    <span class="n">thisRat</span> <span class="o">=</span> <span class="n">Ratout_flow</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">][</span><span class="n">FFkey</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Ratout</span><span class="p">:</span>
                                        <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s1">&#39;Ratout not initialised&#39;</span><span class="p">)</span>
                                    <span class="k">elif</span> <span class="n">FFkey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Ratout</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                                        <span class="n">err_hold</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ival</span><span class="p">)</span> <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Ratout_flow</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
                                        <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="n">FFkey</span> <span class="o">+</span> <span class="s2">&quot; not in Ratout.keys() </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">err_hold</span><span class="p">))</span>
                                    <span class="n">thisRat</span> <span class="o">=</span> <span class="n">Ratout</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">][</span><span class="n">FFkey</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                <span class="n">output</span><span class="p">[</span><span class="n">imass</span><span class="p">][</span><span class="n">ipp</span><span class="p">][</span><span class="n">itflow</span><span class="p">][</span><span class="n">iqsqrd</span><span class="p">][</span><span class="n">ipop</span><span class="p">]</span> <span class="o">=</span> <span class="n">popdata</span> <span class="o">+</span> <span class="s1">&#39; =  (&#39;</span><span class="o">+</span><span class="n">AvgStdToFormat</span><span class="p">(</span><span class="n">thisRat</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span><span class="n">thisRat</span><span class="o">.</span><span class="n">Std</span><span class="p">,</span><span class="n">dec</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">numlen</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span><span class="o">+</span> <span class="s1">&#39;) &#39;</span>
                                <span class="c1"># print Ratout[Ratout.keys()[0]], ipop</span>
                                <span class="c1"># print imass,ipp,ipop</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">imass</span><span class="p">,</span><span class="n">massdata</span> <span class="ow">in</span> <span class="n">FFout</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">ipp</span><span class="p">,</span><span class="n">ppdata</span> <span class="ow">in</span> <span class="n">massdata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">iqsqrd</span><span class="p">,</span><span class="n">psqrdata</span> <span class="ow">in</span> <span class="n">ppdata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">for</span> <span class="n">ipop</span><span class="p">,</span><span class="n">popdata</span> <span class="ow">in</span> <span class="n">psqrdata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">FFkey</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">GetProj</span><span class="p">(</span><span class="n">ipop</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)),</span><span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span><span class="n">ipp</span><span class="p">,</span><span class="s1">&#39;FFRats&#39;</span><span class="p">,</span><span class="n">ipop</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
                            <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Ratout</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s1">&#39;Ratout not initialised&#39;</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="n">FFkey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Ratout</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                                <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="n">FFkey</span> <span class="o">+</span> <span class="s2">&quot; not in Ratout.keys() &quot;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">Ratout</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
                            <span class="n">thisRat</span> <span class="o">=</span> <span class="n">Ratout</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">][</span><span class="n">FFkey</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">output</span><span class="p">[</span><span class="n">imass</span><span class="p">][</span><span class="n">ipp</span><span class="p">][</span><span class="n">iqsqrd</span><span class="p">][</span><span class="n">ipop</span><span class="p">]</span> <span class="o">=</span> <span class="n">popdata</span> <span class="o">+</span> <span class="s1">&#39; =  (&#39;</span><span class="o">+</span><span class="n">AvgStdToFormat</span><span class="p">(</span><span class="n">thisRat</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span><span class="n">thisRat</span><span class="o">.</span><span class="n">Std</span><span class="p">,</span><span class="n">dec</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">numlen</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span><span class="o">+</span> <span class="s1">&#39;) &#39;</span>
                            <span class="c1"># print Ratout[Ratout.keys()[0]], ipop</span>
                            <span class="c1"># print imass,ipp,ipop</span>
        <span class="k">return</span> <span class="n">output</span></div>

<div class="viewcode-block" id="FFEquation.GetFuns"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.GetFuns">[docs]</a>    <span class="k">def</span> <span class="nf">GetFuns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thisFF</span><span class="o">.</span><span class="n">GetFuns</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;thispreFF&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thispreFF</span><span class="o">.</span><span class="n">GetFuns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C2FOforAlpha</span><span class="o">.</span><span class="n">GetFuns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PreC2forMass</span><span class="o">.</span><span class="n">GetFuns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C2forMass</span><span class="o">.</span><span class="n">GetFuns</span><span class="p">()</span></div>
        <span class="c1"># if not hasattr(self,&#39;Fun&#39;):</span>
        <span class="c1">#     self.Fun = ReadFuns(self.Fun_name)[0]</span>

<div class="viewcode-block" id="FFEquation.RemoveFuns"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.RemoveFuns">[docs]</a>    <span class="k">def</span> <span class="nf">RemoveFuns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thisFF</span><span class="o">.</span><span class="n">RemoveFuns</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;thispreFF&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thispreFF</span><span class="o">.</span><span class="n">RemoveFuns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C2FOforAlpha</span><span class="o">.</span><span class="n">RemoveFuns</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;PreC2forMass&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PreC2forMass</span><span class="o">.</span><span class="n">RemoveFuns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C2forMass</span><span class="o">.</span><span class="n">RemoveFuns</span><span class="p">()</span></div>
        <span class="c1"># if hasattr(self,&#39;Fun&#39;):</span>
        <span class="c1">#     self.Fun_name = self.Fun.__name__</span>
        <span class="c1">#     WriteFuns(self.Fun)</span>
        <span class="c1">#     del self.Fun</span>

<div class="viewcode-block" id="FFEquation.Write"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.Write">[docs]</a>    <span class="k">def</span> <span class="nf">Write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">WipeData</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">WipeAllFits</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">FixDictArray</span><span class="p">(</span><span class="n">thislist</span><span class="p">,</span><span class="n">ikey</span><span class="p">):</span>
            <span class="n">outDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">ic</span><span class="p">,</span><span class="n">ilist</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">thislist</span><span class="p">):</span>
                <span class="n">outDict</span><span class="p">[</span><span class="n">ikey</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ic</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ilist</span>
            <span class="k">return</span> <span class="n">outDict</span>
        <span class="k">try</span><span class="p">:</span>
        <span class="c1"># print &#39;DEBUG, please uncomment this&#39;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;preEq&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reduce_System</span><span class="p">:</span>
                    <span class="n">preEq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetEquationsOut</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thisFF</span><span class="o">.</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;Equations_Reduced&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">RatioFits</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">RatioFitsFlow</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">preEq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetEquationsOut</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thisFF</span><span class="o">.</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;Equations&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">RatioFits</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">RatioFitsFlow</span><span class="p">)</span>
        <span class="c1"># except Exception as err:</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># print err</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;outDict&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outDict</span><span class="p">,(</span><span class="nb">dict</span><span class="p">,</span><span class="n">OrderedDict</span><span class="p">)):</span>
                <span class="k">if</span> <span class="s1">&#39;Equations&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">preEq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;Equations&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">preEq</span> <span class="o">=</span> <span class="s1">&#39;No Equations&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">preEq</span> <span class="o">=</span> <span class="s1">&#39;No outDict&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">outDict</span> <span class="o">=</span> <span class="n">ODNested</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;nt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;nxyz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nxyz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;Mass_File&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2forMass</span><span class="o">.</span><span class="n">HumanFile</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;Alpha_File&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2FOforAlpha</span><span class="o">.</span><span class="n">HumanFile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;Coeff_File&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisFF</span><span class="o">.</span><span class="n">HumanFile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;Ratio_Files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FixDictArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RatioFileList</span><span class="p">,</span><span class="s1">&#39;Rat&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Renormed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;Renorm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FFRenorm</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;Renorm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;F_</span><span class="si">{3}</span><span class="s1">/2m_in_efm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Inefm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;nchi_fit_threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nchi_fit_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;nchi_threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nchi_threshold</span>
        <span class="k">if</span> <span class="s1">&#39;_mal&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ralpha_mult_fun&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ralpha_mult_fun</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">itflow</span><span class="p">,</span><span class="n">ichi</span><span class="p">,</span><span class="n">iQ</span><span class="p">),</span><span class="n">Qdata</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outDict</span><span class="p">[</span><span class="n">itflow</span><span class="p">][</span><span class="n">ichi</span><span class="p">][</span><span class="n">iQ</span><span class="p">]</span> <span class="o">=</span> <span class="n">Qdata</span><span class="o">.</span><span class="n">GetOutputDict</span><span class="p">()</span>
            <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="p">:</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">itflow</span><span class="p">,</span><span class="n">ichi</span><span class="p">,</span><span class="n">iFF</span><span class="p">,</span><span class="n">ifitr</span><span class="p">),</span><span class="n">fitdata</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outDict</span><span class="p">[</span><span class="n">itflow</span><span class="p">][</span><span class="n">ichi</span><span class="p">][</span><span class="s1">&#39;FF_Fits&#39;</span><span class="o">+</span><span class="n">ifitr</span><span class="p">][</span><span class="n">iFF</span><span class="p">]</span> <span class="o">=</span> <span class="n">fitdata</span><span class="o">.</span><span class="n">GetOutputDict</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">ichi</span><span class="p">,</span><span class="n">iQ</span><span class="p">),</span><span class="n">Qdata</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outDict</span><span class="p">[</span><span class="n">ichi</span><span class="p">][</span><span class="n">iQ</span><span class="p">]</span> <span class="o">=</span> <span class="n">Qdata</span><span class="o">.</span><span class="n">GetOutputDict</span><span class="p">()</span>
            <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="p">:</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">ichi</span><span class="p">,</span><span class="n">iFF</span><span class="p">,</span><span class="n">ifitr</span><span class="p">),</span><span class="n">fitdata</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outDict</span><span class="p">[</span><span class="n">ichi</span><span class="p">][</span><span class="s1">&#39;FF_Fits&#39;</span><span class="o">+</span><span class="n">ifitr</span><span class="p">][</span><span class="n">iFF</span><span class="p">]</span> <span class="o">=</span> <span class="n">fitdata</span><span class="o">.</span><span class="n">GetOutputDict</span><span class="p">()</span>

        <span class="n">bakThis</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">preEq</span> <span class="o">==</span> <span class="s1">&#39;No outDict&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cannot pull equations from previous result, omitting from output (this occurs when using older results)&#39;</span><span class="p">)</span>
            <span class="n">bakThis</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">preEq</span> <span class="o">==</span> <span class="s1">&#39;No Equations&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No Equations found in previous file. (this occurs when using older results)&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;Equations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preEq</span>

        <span class="k">if</span> <span class="n">WipeData</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">DelResidual</span><span class="p">()</span>
        <span class="c1">## Write human readable file with data</span>
        <span class="k">if</span> <span class="n">bakThis</span><span class="p">:</span> <span class="n">BackupFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span><span class="p">)</span>
        <span class="c1">## pickles rest of data for reading</span>
        <span class="k">if</span> <span class="n">WipeAllFits</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">WipeAllFits</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RemoveFuns</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;FF_Stats&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="o">+</span><span class="s1">&#39;.FFstats&#39;</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats_name</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats_name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats_name</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;FF_Fit_Stats&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="o">+</span><span class="s1">&#39;.FFFitstats&#39;</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats_name</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats_name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats_name</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats_name</span><span class="p">)</span>
        <span class="n">out_dict</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;FF_Stats&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">out_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">del</span> <span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;FF_Stats&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;FF_Fit_Stats&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">out_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">del</span> <span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;FF_Fit_Stats&#39;</span><span class="p">]</span>
        <span class="n">WritePickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">,</span><span class="n">out_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GetFuns</span><span class="p">()</span>

        <span class="n">WriteXml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span><span class="p">,{</span><span class="s1">&#39;Results&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">outDict</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DelSystemResults</span><span class="p">()</span></div>


<div class="viewcode-block" id="FFEquation.ImportPlotParams"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.ImportPlotParams">[docs]</a>    <span class="k">def</span> <span class="nf">ImportPlotParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thiscol</span><span class="p">,</span><span class="n">thissym</span><span class="p">,</span><span class="n">thisshift</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckCol</span><span class="p">(</span><span class="n">thiscol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckSym</span><span class="p">(</span><span class="n">thissym</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span> <span class="o">=</span> <span class="n">thisshift</span></div>

<div class="viewcode-block" id="FFEquation.CheckCol"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.CheckCol">[docs]</a>    <span class="k">def</span> <span class="nf">CheckCol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thiscol</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;PreDefine&#39;</span> <span class="o">==</span> <span class="n">thiscol</span> <span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;Not Set&#39;</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Pass in color to initialize it&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span> <span class="o">=</span> <span class="n">thiscol</span></div>

<div class="viewcode-block" id="FFEquation.CheckSym"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.CheckSym">[docs]</a>    <span class="k">def</span> <span class="nf">CheckSym</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thissym</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;PreDefine&#39;</span> <span class="o">==</span> <span class="n">thissym</span> <span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;Not Set&#39;</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">thissym</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Pass in symbol to initialize it&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thissym</span> <span class="o">=</span> <span class="n">thissym</span></div>


<div class="viewcode-block" id="FFEquation.GetShift"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.GetShift">[docs]</a>    <span class="k">def</span> <span class="nf">GetShift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">xlims</span><span class="p">,</span><span class="n">thisshift</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">thisshift</span> <span class="o">!=</span> <span class="s1">&#39;PreDefine&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span> <span class="o">=</span> <span class="n">thisshift</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisshiftscale</span> <span class="o">==</span> <span class="s1">&#39;Not Set&#39;</span><span class="p">:</span>
            <span class="n">xlen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xlims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xlims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thisshiftscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span><span class="o">*</span><span class="n">xlen</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisshiftscale</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisshiftscale</span></div>

<div class="viewcode-block" id="FFEquation.CheckFF"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.CheckFF">[docs]</a>    <span class="k">def</span> <span class="nf">CheckFF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thisFF</span><span class="p">,</span><span class="n">resub</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">thiskey</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span>
            <span class="n">calcfflist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">][</span><span class="n">thiskey</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">thisFF</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">calcfflist</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;tilde</span><span class="si">{F}</span><span class="s1">_</span><span class="si">{3}</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">thisFF</span> <span class="ow">and</span> <span class="s1">&#39;tilde</span><span class="si">{F}</span><span class="s1">_</span><span class="si">{3}</span><span class="s1">&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">calcfflist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">mom2max</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">resub</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ConvertToBNL</span><span class="p">()</span>
                    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;frac&#39;</span> <span class="ow">in</span> <span class="n">thisFF</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">mom2max</span> <span class="o">!=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">F3div2M</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CheckFF</span><span class="p">(</span><span class="n">thisFF</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;frac&#39;</span> <span class="ow">in</span> <span class="n">thisFF</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">qparams</span><span class="o">.</span><span class="n">mom2max</span> <span class="o">!=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="ow">and</span> <span class="n">resub</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">F3div2M</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CheckFF</span><span class="p">(</span><span class="n">thisFF</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING, &#39;</span> <span class="p">,</span> <span class="n">thisFF</span> <span class="p">,</span> <span class="s1">&#39; not found in self.FF_Stats last key&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">][</span><span class="n">thiskey</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                    <span class="nb">print</span><span class="p">()</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">thisFF</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">][</span><span class="n">thiskey</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING, &#39;</span> <span class="p">,</span> <span class="n">thisFF</span> <span class="p">,</span> <span class="s1">&#39; not found in self.FF_Stats last key&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">][</span><span class="n">thiskey</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                <span class="nb">print</span><span class="p">()</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="FFEquation.CheckChi"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.CheckChi">[docs]</a>    <span class="k">def</span> <span class="nf">CheckChi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">this_chi</span><span class="p">,</span><span class="n">chi_list</span><span class="p">):</span>
        <span class="n">chi_min</span><span class="p">,</span><span class="n">chi_max</span> <span class="o">=</span> <span class="n">chi_list</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">RemoveChi</span><span class="p">(</span><span class="n">ichi</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">ichi</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Chi&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">RemoveChi</span><span class="p">(</span><span class="n">chi_min</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">RemoveChi</span><span class="p">(</span><span class="n">this_chi</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">RemoveChi</span><span class="p">(</span><span class="n">chi_max</span><span class="p">)</span></div>

<div class="viewcode-block" id="FFEquation.Plot"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.Plot">[docs]</a>    <span class="k">def</span> <span class="nf">Plot</span><span class="p">(</span>   <span class="bp">self</span><span class="p">,</span><span class="n">plot_class</span><span class="p">,</span><span class="n">thisFF</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">,</span>
                <span class="n">thissym</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">,</span><span class="n">plottflow</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">,</span><span class="n">this_chi_list</span><span class="o">=</span><span class="s1">&#39;Chi0-Chi20&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckCol</span><span class="p">(</span><span class="n">thiscol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckSym</span><span class="p">(</span><span class="n">thissym</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thisshiftscale</span> <span class="o">=</span> <span class="s1">&#39;Not Set&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetShift</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Qsqrdlist</span><span class="p">)],</span><span class="n">thisshift</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">CheckFF</span><span class="p">(</span><span class="n">thisFF</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">thisFF</span><span class="p">,</span> <span class="s1">&#39;Not found in &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">plot_class</span>
        <span class="n">thisFFleg</span> <span class="o">=</span> <span class="n">thisFF</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;tilde&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;\tilde&#39;</span><span class="p">)</span>
        <span class="n">thisFFleg</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$&#39;</span><span class="o">+</span><span class="n">thisFFleg</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;frac&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;\frac&#39;</span><span class="p">)</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;$&#39;</span>
        <span class="k">if</span> <span class="n">plottflow</span> <span class="o">==</span> <span class="s1">&#39;PreDefine&#39;</span><span class="p">:</span> <span class="n">plottflow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tflows</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plottflow</span><span class="p">,(</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">plottflow</span> <span class="o">=</span> <span class="n">plottflow</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">this_chi_list</span><span class="p">,(</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">this_chi_list</span> <span class="o">=</span> <span class="n">this_chi_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thisFF</span><span class="p">,(</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">thisFF</span> <span class="o">=</span> <span class="n">thisFF</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># for iQ,Avg,Std in zip(np.array(self.Qsqrdlist)+thisshift,self.ffresAvg.values(),self.ffresStd.values()):</span>
        <span class="c1">#     print abs(iQ),Avg[thisFF],Std[thisFF]</span>
        <span class="n">vall</span><span class="p">,</span><span class="n">errl</span><span class="p">,</span><span class="n">ilist</span> <span class="o">=</span> <span class="p">[],[],[]</span>
        <span class="n">medl</span><span class="p">,</span><span class="n">medupl</span><span class="p">,</span><span class="n">meddownl</span> <span class="o">=</span> <span class="p">[],[],[]</span>
        <span class="n">plotQsqrd</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">chi_min</span><span class="p">,</span><span class="n">chi_max</span> <span class="o">=</span> <span class="n">this_chi_list</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span>
            <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">plottflow</span><span class="p">,</span><span class="n">chi_min</span><span class="p">,</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">thisFF</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">chi_min</span><span class="p">,</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">thisFF</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ikey</span><span class="p">,</span><span class="n">fit_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">CheckChi</span><span class="p">(</span><span class="n">ikey</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span><span class="n">this_chi_list</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">iQ2key</span> <span class="o">=</span> <span class="n">ikey</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">ipar</span><span class="p">,</span><span class="n">par_data</span> <span class="ow">in</span> <span class="n">fit_data</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># if ipar not in thisFF and plot_the_ff: continue</span>
                <span class="k">if</span> <span class="n">iQ2key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">QsqrdKeyList</span><span class="p">:</span>
                    <span class="n">iQ2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Qsqrdlist</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">QsqrdKeyList</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">iQ2key</span><span class="p">)]</span>
                    <span class="n">plotQsqrd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iQ2</span><span class="p">)</span>
                <span class="n">par_data</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
                <span class="n">vall</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par_data</span><span class="o">.</span><span class="n">Avg</span><span class="p">)</span>
                <span class="n">errl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par_data</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
                <span class="n">medl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par_data</span><span class="o">.</span><span class="n">Median</span><span class="p">)</span>
                <span class="n">medupl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par_data</span><span class="o">.</span><span class="n">MedStd_Up</span><span class="p">)</span>
                <span class="n">meddownl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par_data</span><span class="o">.</span><span class="n">MedStd_Down</span><span class="p">)</span>
                <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ikey</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;Qsqrd&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iQ2</span><span class="p">),</span><span class="n">ipar</span><span class="p">])</span> <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;Form_Factors&#39;</span><span class="p">])</span>
            <span class="n">ploty</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">vall</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="n">plotyerr</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">errl</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="n">ploty_median</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">medl</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="n">plotyerr_up</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">medupl</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="n">plotyerr_down</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">meddownl</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="c1"># if this_key not in ploty.index:</span>
            <span class="c1">#     print &#39;Warning, key&#39;, &#39;, &#39;.join(this_key) ,&#39;not in FF_Stats&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No form factor to plot for &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">plot_class</span>

        <span class="n">hold_series</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;boot_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;x_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;from_keys&#39;</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;y_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ploty</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;yerr_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotyerr</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;y_data_median&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ploty_median</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;yerr_data_up&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotyerr_up</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;yerr_data_down&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotyerr_down</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;xerr_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;xerr_data_up&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;xerr_data_down&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;error_bar_vary&#39;</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;key_select&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_key</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;fit_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span> <span class="c1">#&#39; &#39;.join([thisFFleg,,tflowleg,ichi])</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;doflowfull&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflowfull</span><span class="p">:</span>
            <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39;$\alpha_</span><span class="si">{fit}</span><span class="s1">$&#39;</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thissym</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;shift&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;xdatarange&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;Phys&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;ShowPar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;Median&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;fmt_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">KeyForamtting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ppparams</span><span class="p">)</span>
        <span class="n">plot_class</span><span class="o">.</span><span class="n">AppendData</span><span class="p">(</span><span class="n">hold_series</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plot_class</span></div>

<div class="viewcode-block" id="FFEquation.ImportFitRanges"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.ImportFitRanges">[docs]</a>    <span class="k">def</span> <span class="nf">ImportFitRanges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fit_ranges</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;PreDef&#39;</span> <span class="o">==</span> <span class="n">fit_ranges</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_ranges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PredefFits</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_ranges</span> <span class="o">=</span> <span class="n">fit_ranges</span>
        <span class="n">this_bool</span> <span class="o">=</span>  <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_ranges</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_ranges</span> <span class="o">==</span> <span class="s1">&#39;All&#39;</span>
        <span class="n">this_bool_2</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_ranges</span><span class="p">,(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="s1">&#39;All&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_ranges</span><span class="p">)</span>
        <span class="c1"># if (this_bool or this_bool_2) and not self.Do_Chi_cutoff:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">this_bool</span> <span class="ow">or</span> <span class="n">this_bool_2</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_ranges</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">iQmin</span><span class="p">,</span><span class="n">iQmax</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Qsqrdlist</span><span class="p">))),</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Qsqrdlist</span><span class="p">)))):</span>
                <span class="k">if</span> <span class="n">iQmax</span> <span class="o">&gt;</span> <span class="n">iQmin</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fit_ranges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;fitr&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iQmin</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iQmax</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_ranges</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_ranges</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_ranges</span><span class="p">]</span></div>

<div class="viewcode-block" id="FFEquation.SetFunction"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.SetFunction">[docs]</a>    <span class="k">def</span> <span class="nf">SetFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thiscurrtype</span><span class="p">,</span><span class="n">thisDS</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">thisDS</span><span class="p">,</span><span class="n">thiscurrtype</span><span class="p">])</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">FFQ2FitFun</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fun</span> <span class="o">=</span> <span class="n">FFQ2FitFun</span><span class="p">[</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">thisDS</span><span class="p">,</span><span class="n">thiscurrtype</span><span class="p">])]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fun</span> <span class="o">=</span> <span class="n">FFQ2FitFun</span><span class="p">[</span><span class="n">thiscurrtype</span><span class="p">]</span></div>


    <span class="c1">## wrapper for Fit to fit all form factors</span>
<div class="viewcode-block" id="FFEquation.FitFFs"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.FitFFs">[docs]</a>    <span class="k">def</span> <span class="nf">FitFFs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thisFF</span><span class="o">=</span><span class="s1">&#39;All&#39;</span><span class="p">,</span><span class="n">fit_ranges</span><span class="o">=</span><span class="s1">&#39;All&#39;</span><span class="p">,</span><span class="n">iGuess</span><span class="o">=</span><span class="s1">&#39;PreDef&#39;</span><span class="p">,</span>
                    <span class="n">EstDir</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">WipeFit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">thisFF</span> <span class="o">==</span> <span class="s1">&#39;All&#39;</span><span class="p">:</span>
            <span class="n">imax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ival</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">imax</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span>   <span class="n">ipar</span><span class="p">,</span><span class="n">fit_ranges</span><span class="o">=</span><span class="n">fit_ranges</span><span class="p">,</span><span class="n">iGuess</span><span class="o">=</span><span class="n">iGuess</span><span class="p">,</span>
                            <span class="n">EstDir</span><span class="o">=</span><span class="n">EstDir</span><span class="p">,</span><span class="n">WipeFit</span><span class="o">=</span><span class="n">WipeFit</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">thisFF</span><span class="p">,</span><span class="n">fit_ranges</span><span class="o">=</span><span class="n">fit_ranges</span><span class="p">,</span><span class="n">iGuess</span><span class="o">=</span><span class="n">iGuess</span><span class="p">,</span><span class="n">EstDir</span><span class="o">=</span><span class="n">EstDir</span><span class="p">,</span><span class="n">WipeFit</span><span class="o">=</span><span class="n">WipeFit</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span></div>

<div class="viewcode-block" id="FFEquation.WipeAllFits"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.WipeAllFits">[docs]</a>    <span class="k">def</span> <span class="nf">WipeAllFits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DEBUG, wiping all fits&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span></div>

<div class="viewcode-block" id="FFEquation.Stats"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.Stats">[docs]</a>    <span class="k">def</span> <span class="nf">Stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">stat_fun</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
            <span class="n">val</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">val</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">stat_fun</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">stat_fun</span><span class="p">)</span></div>
    <span class="c1">## fit_ranges are just related to the indexing of the momenta, (since we have already converted to 2pi/L etc..</span>
    <span class="c1">## thisFFfun is a dictionary of touples { iform_factor ; (the_function, n_parameters) }</span>
<div class="viewcode-block" id="FFEquation.Fit"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.Fit">[docs]</a>    <span class="k">def</span> <span class="nf">Fit</span><span class="p">(</span>    <span class="bp">self</span><span class="p">,</span><span class="n">thisFF</span><span class="p">,</span><span class="n">thisFFfun</span><span class="o">=</span><span class="s1">&#39;PreDef&#39;</span><span class="p">,</span><span class="n">fit_ranges</span><span class="o">=</span><span class="s1">&#39;All&#39;</span><span class="p">,</span><span class="n">iGuess</span><span class="o">=</span><span class="s1">&#39;PreDef&#39;</span><span class="p">,</span>
                <span class="n">EstDir</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">WipeFit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">thisFFfun</span> <span class="o">!=</span> <span class="s1">&#39;PreDef&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fun</span><span class="p">[</span><span class="n">thisFF</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisFFfun</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fun</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span> <span class="ow">or</span> <span class="n">thisFF</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Fun</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">return</span> <span class="kc">False</span>
            <span class="c1"># print thisFF</span>
            <span class="c1"># print self.Fun</span>
            <span class="c1"># raise IOError(&#39;Please define funciton using .SetFunction(Fun) for fitting before calling .Fit()&#39;)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">CheckFF</span><span class="p">(</span><span class="n">thisFF</span><span class="p">):</span> <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImportFitRanges</span><span class="p">(</span><span class="n">fit_ranges</span><span class="p">)</span>
        <span class="c1"># out_str = &#39;Debugging \n fit_ranges\n&#39;</span>
        <span class="c1"># out_str += &#39;\n&#39;.join(fit_ranges)</span>
        <span class="c1"># out_str += &#39;self fit_ranges\n&#39;</span>
        <span class="c1"># out_str += &#39;\n&#39;.join(self.fit_ranges)</span>
        <span class="c1"># out_str += &#39;\n&#39;.join(self.fit_ranges)</span>
        <span class="c1"># raise Exception(out_str)</span>
        <span class="k">if</span> <span class="n">iGuess</span> <span class="o">!=</span> <span class="s1">&#39;PreDef&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span> <span class="o">=</span> <span class="n">iGuess</span>
        <span class="n">fboot</span><span class="p">,</span><span class="n">fAvg</span><span class="p">,</span><span class="n">fStd</span><span class="p">,</span><span class="n">ilist</span> <span class="o">=</span> <span class="p">[],[],[],[]</span>
        <span class="c1"># isAllChi = isinstance(chi_list,basestring) and chi_list == &#39;All&#39;</span>
        <span class="c1"># if &#39;boot&#39; in self.FF_Fit_Stats:</span>
        <span class="c1">#     print self.FF_Fit_Stats[&#39;boot&#39;]</span>
        <span class="c1"># raise EnvironmentError(&#39;DEBUGGING&#39;)</span>
        <span class="k">for</span> <span class="n">ifit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_ranges</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ifit</span> <span class="o">==</span> <span class="s1">&#39;All&#39;</span><span class="p">:</span>
                <span class="n">ifitmin</span><span class="p">,</span><span class="n">ifitmax</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Qsqrdlist</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">ifit</span> <span class="o">=</span> <span class="s1">&#39;fitr&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ifitmin</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ifitmax</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ifitmin</span><span class="p">,</span><span class="n">ifitmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">unxmlfitr</span><span class="p">(</span><span class="n">ifit</span><span class="p">))</span>

            <span class="n">ifitmin</span><span class="p">,</span><span class="n">ifitmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ifitmin</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">ifitmax</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span>
                <span class="n">this_Qkeylist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">QsqrdKeyList</span><span class="p">[</span><span class="n">ifitmin</span><span class="p">:</span><span class="n">ifitmax</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">this_Qlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Qsqrdlist</span><span class="p">[</span><span class="n">ifitmin</span><span class="p">:</span><span class="n">ifitmax</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="c1"># if self.isCustomRFitR:</span>
                <span class="c1">#     if not hasattr(self,&#39;chi_fit_list&#39;) or not isinstance(self.chi_fit_list,(list,tuple,np.ndarray,pa.Series,pa.DataFrame)):</span>
                <span class="c1">#         print self.name</span>
                <span class="c1">#         print self.chi_fit_list</span>
                <span class="c1">#         raise EnvironmentError(&#39;chi_fit_list is not present even though it is needed when isCustomRFitR is set to true&#39;)</span>
                <span class="c1">#     this_chi_list = self.chi_fit_list</span>
                <span class="c1"># else:</span>
                <span class="k">for</span> <span class="n">itflow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">:</span>
                    <span class="n">this_chi_list</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">iQ</span> <span class="ow">in</span> <span class="n">this_Qkeylist</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">iQ</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chi_Qsqrd</span><span class="p">[</span><span class="n">itflow</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                            <span class="k">continue</span>
                        <span class="n">this_chi_len</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chi_Qsqrd</span><span class="p">[</span><span class="n">itflow</span><span class="p">][</span><span class="n">iQ</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">this_chi_len</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nchi_fit_threshold</span><span class="p">:</span>
                            <span class="n">this_rlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">this_chi_len</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nchi_fit_threshold</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                            <span class="n">this_chi_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;Chi&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ichi</span><span class="p">)</span> <span class="k">for</span> <span class="n">ichi</span> <span class="ow">in</span> <span class="n">this_rlist</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">this_chi_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;Chi&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ichi</span><span class="p">)</span> <span class="k">for</span> <span class="n">ichi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">this_chi_len</span><span class="p">)])</span>
                <span class="c1"># self.chi_fit_list = pa.Series(this_chi_list,index=this_Qkeylist)</span>
                    <span class="c1"># this_chi_list.append(list(self.FF_Stats[&#39;boot&#39;].index.get_loc_level((slice(None),iQ))[1]))</span>
                    <span class="c1"># this_chi_list.append(list(self.FF_Stats[&#39;boot&#39;].index.get_loc_level((slice(None),iQ))[1]))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Do_Chi_cutoff</span> <span class="ow">and</span> <span class="n">show_timer</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;number of fits for &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">thisFF</span><span class="p">,</span><span class="n">ifit</span><span class="p">,</span><span class="s1">&#39; is &#39;</span> <span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">this_chi_list</span><span class="p">))))</span>
                <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span>  <span class="n">linklist</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">this_chi_list</span><span class="p">))))),</span>
                                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Fitting Form Factors &#39;</span><span class="o">+</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">thisFF</span><span class="p">,</span><span class="n">ifit</span><span class="p">]))</span>

                <span class="k">for</span> <span class="n">ifit_chi</span><span class="p">,</span><span class="n">ichi_list</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">this_chi_list</span><span class="p">)):</span>
                    <span class="n">chi_key</span> <span class="o">=</span> <span class="s1">&#39;Chi&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ifit_chi</span><span class="p">)</span>
                    <span class="n">fit_chi_key</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">chi_key</span><span class="p">,</span><span class="n">thisFF</span><span class="p">,</span><span class="n">ifit</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span> <span class="ow">and</span> <span class="n">fit_chi_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">WipeFit</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="n">fit_chi_key</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span><span class="o">.</span><span class="n">Lap</span><span class="p">((</span><span class="s1">&#39;fit already computed: &#39;</span><span class="p">,</span><span class="n">chi_key</span><span class="p">))</span>
                            <span class="k">continue</span>
                    <span class="n">tdatarange</span><span class="p">,</span><span class="n">ydata</span> <span class="o">=</span> <span class="p">[[]],[]</span>
                    <span class="k">for</span> <span class="n">ichi</span><span class="p">,</span><span class="n">iQkey</span><span class="p">,</span><span class="n">iQ</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ichi_list</span><span class="p">,</span><span class="n">this_Qkeylist</span><span class="p">,</span><span class="n">this_Qlist</span><span class="p">):</span>
                        <span class="c1"># print &#39;DEBUG&#39;</span>
                        <span class="c1"># print (ichi,iQkey)</span>
                        <span class="c1"># print self.FF_Stats[&#39;boot&#39;]</span>
                        <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ichi</span><span class="p">,</span><span class="n">iQkey</span><span class="p">)</span>
                        <span class="n">key_str</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">this_key</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">this_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                            <span class="c1"># if show_timer: thistimer.Lap((&#39;key not present &#39;,thisFF,key_str))</span>
                            <span class="k">continue</span>
                        <span class="n">pardata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">this_key</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span>
                        <span class="c1"># pardata = self.FF_Stats.loc[(ichi,iQkey),&#39;boot&#39;]</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pardata</span><span class="p">,</span><span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
                            <span class="n">pardata</span> <span class="o">=</span> <span class="n">pardata</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">thisFF</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">pardata</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                            <span class="c1"># if show_timer: thistimer.Lap((&#39;key not present &#39;,thisFF,key_str))</span>
                            <span class="k">continue</span>
                        <span class="n">tdatarange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">iQ</span><span class="p">))</span>
                        <span class="n">ydata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pardata</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;Params&#39;</span><span class="p">][</span><span class="n">thisFF</span><span class="p">])</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fun</span><span class="p">[</span><span class="n">thisFF</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span><span class="o">.</span><span class="n">Lap</span><span class="p">((</span><span class="s1">&#39;not enough npar &#39;</span><span class="p">,</span><span class="n">thisFF</span><span class="p">,</span><span class="n">key_str</span><span class="p">))</span>
                        <span class="c1"># print &#39;ydata length &#39; ,len(ydata) , &#39;, npar len&#39; , self.Fun[thisFF][1]</span>
                        <span class="c1"># print &#39;WARNING, not enough fit parameters to fit function &#39; , self.Fun[thisFF][0].__name__ , &#39; to &#39; ,itflow,thisFF , &#39; with fit range &#39; , ifit</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">EstDir</span><span class="p">:</span>
                        <span class="n">thisff</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">Fitting</span><span class="p">(</span><span class="n">Funs</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Fun</span><span class="p">[</span><span class="n">thisFF</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">Fun</span><span class="p">[</span><span class="n">thisFF</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;Estimate&#39;</span><span class="p">],</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tdatarange</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ydata</span><span class="p">)],</span><span class="n">name</span><span class="o">=</span><span class="n">ifit</span><span class="o">+</span><span class="s1">&#39;$&#39;</span><span class="o">+</span><span class="n">tflowTOLeg</span><span class="p">(</span><span class="n">itflow</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;$&#39;</span><span class="p">,</span><span class="n">iGuess</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">thisff</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">Fitting</span><span class="p">(</span><span class="n">Funs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Fun</span><span class="p">[</span><span class="n">thisFF</span><span class="p">],</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tdatarange</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ydata</span><span class="p">)],</span><span class="n">name</span><span class="o">=</span><span class="n">ifit</span><span class="o">+</span><span class="s1">&#39;$&#39;</span><span class="o">+</span><span class="n">tflowTOLeg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;$&#39;</span><span class="p">,</span><span class="n">iGuess</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span><span class="p">)</span>
                    <span class="n">testff</span> <span class="o">=</span> <span class="n">thisff</span><span class="o">.</span><span class="n">FitBoots</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">testff</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span><span class="o">.</span><span class="n">Lap</span><span class="p">(</span><span class="n">chi_key</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="c1">## self.FitDict [itflow , iFF , ifit]</span>
                    <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fit_chi_key</span><span class="p">)</span>
                    <span class="n">fboot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisff</span><span class="p">)</span>
                    <span class="n">fAvg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisff</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;ParamsAvg&#39;</span><span class="p">])</span>
                    <span class="n">fStd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisff</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;ParamsStd&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span><span class="o">.</span><span class="n">Lap</span><span class="p">(</span><span class="n">chi_key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">this_Qkeylist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">QsqrdKeyList</span><span class="p">[</span><span class="n">ifitmin</span><span class="p">:</span><span class="n">ifitmax</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">this_Qlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Qsqrdlist</span><span class="p">[</span><span class="n">ifitmin</span><span class="p">:</span><span class="n">ifitmax</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">this_chi_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">iQ</span> <span class="ow">in</span> <span class="n">this_Qkeylist</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">iQ</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chi_Qsqrd</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="k">continue</span>
                    <span class="n">this_chi_len</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chi_Qsqrd</span><span class="p">[</span><span class="n">iQ</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">this_chi_len</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nchi_fit_threshold</span><span class="p">:</span>
                        <span class="n">this_rlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">this_chi_len</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nchi_fit_threshold</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        <span class="n">this_chi_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;Chi&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ichi</span><span class="p">)</span> <span class="k">for</span> <span class="n">ichi</span> <span class="ow">in</span> <span class="n">this_rlist</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">this_chi_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;Chi&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ichi</span><span class="p">)</span> <span class="k">for</span> <span class="n">ichi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">this_chi_len</span><span class="p">)])</span>
                    <span class="c1"># this_chi_list.append(list(self.FF_Stats[&#39;boot&#39;].index.get_loc_level((slice(None),iQ))[1]))</span>
                    <span class="c1"># this_chi_list.append(list(self.FF_Stats[&#39;boot&#39;].index.get_loc_level((slice(None),iQ))[1]))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Do_Chi_cutoff</span> <span class="ow">and</span> <span class="n">show_timer</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;number of fits for &#39;</span><span class="p">,</span><span class="n">thisFF</span><span class="p">,</span><span class="n">ifit</span><span class="p">,</span><span class="s1">&#39; is &#39;</span> <span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">this_chi_list</span><span class="p">))))</span>
                <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span>  <span class="n">linklist</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">this_chi_list</span><span class="p">))))),</span>
                                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Fitting Form Factors &#39;</span><span class="o">+</span><span class="n">thisFF</span><span class="o">+</span><span class="s1">&#39;, &#39;</span><span class="o">+</span><span class="n">ifit</span><span class="p">)</span>


                <span class="k">for</span> <span class="n">ifit_chi</span><span class="p">,</span><span class="n">ichi_list</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">this_chi_list</span><span class="p">)):</span>
                    <span class="n">chi_key</span> <span class="o">=</span> <span class="s1">&#39;Chi&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ifit_chi</span><span class="p">)</span>
                    <span class="n">fit_chi_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">chi_key</span><span class="p">,</span><span class="n">thisFF</span><span class="p">,</span><span class="n">ifit</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span> <span class="ow">and</span> <span class="n">fit_chi_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">WipeFit</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="n">fit_chi_key</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span><span class="o">.</span><span class="n">Lap</span><span class="p">((</span><span class="s1">&#39;fit already computed: &#39;</span><span class="p">,</span><span class="n">chi_key</span><span class="p">))</span>
                            <span class="k">continue</span>
                    <span class="n">tdatarange</span><span class="p">,</span><span class="n">ydata</span> <span class="o">=</span> <span class="p">[[]],[]</span>
                    <span class="k">for</span> <span class="n">ichi</span><span class="p">,</span><span class="n">iQkey</span><span class="p">,</span><span class="n">iQ</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ichi_list</span><span class="p">,</span><span class="n">this_Qkeylist</span><span class="p">,</span><span class="n">this_Qlist</span><span class="p">):</span>
                        <span class="c1"># print &#39;DEBUG&#39;</span>
                        <span class="c1"># print (ichi,iQkey)</span>
                        <span class="c1"># print self.FF_Stats[&#39;boot&#39;]</span>
                        <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">ichi</span><span class="p">,</span><span class="n">iQkey</span><span class="p">)</span>
                        <span class="n">key_str</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">this_key</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">this_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                            <span class="c1"># if show_timer: thistimer.Lap((&#39;key not present &#39;,thisFF,key_str))</span>
                            <span class="k">continue</span>
                        <span class="n">pardata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">this_key</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span>
                        <span class="c1"># pardata = self.FF_Stats.loc[(ichi,iQkey),&#39;boot&#39;]</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pardata</span><span class="p">,</span><span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
                            <span class="n">pardata</span> <span class="o">=</span> <span class="n">pardata</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">thisFF</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">pardata</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                            <span class="c1"># if show_timer: thistimer.Lap((&#39;key not present &#39;,thisFF,key_str))</span>
                            <span class="k">continue</span>
                        <span class="n">tdatarange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">iQ</span><span class="p">))</span>
                        <span class="n">ydata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pardata</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;Params&#39;</span><span class="p">][</span><span class="n">thisFF</span><span class="p">])</span>

                    <span class="c1"># ##debugging</span>
                    <span class="c1"># print</span>
                    <span class="c1"># print &#39;FitData:&#39;</span>
                    <span class="c1"># for it,iy in zip(tdatarange[0],ydata):</span>
                    <span class="c1">#     print it, iy</span>
                    <span class="c1"># print</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fun</span><span class="p">[</span><span class="n">thisFF</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">ifit_chi</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span><span class="o">.</span><span class="n">Lap</span><span class="p">((</span><span class="s1">&#39;not enough npar &#39;</span><span class="p">,</span><span class="n">thisFF</span><span class="p">,</span><span class="n">key_str</span><span class="p">))</span>
                        <span class="c1"># print</span>
                        <span class="c1"># print &#39;ydata length &#39; ,len(ydata) , &#39;, npar len&#39; , self.Fun[thisFF][1]</span>
                        <span class="c1"># print &#39;WARNING, not enough fit parameters to fit function &#39; , self.Fun[thisFF][0].__name__ , &#39; to &#39; ,thisFF , &#39; with fit range &#39; , ifit</span>
                        <span class="c1"># print</span>
                        <span class="c1"># thistimer.Lap(fit_chi_key)</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">EstDir</span><span class="p">:</span>
                        <span class="n">thisff</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">Fitting</span><span class="p">(</span><span class="n">Funs</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Fun</span><span class="p">[</span><span class="n">thisFF</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">Fun</span><span class="p">[</span><span class="n">thisFF</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;Estimate&#39;</span><span class="p">],</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tdatarange</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ydata</span><span class="p">)],</span><span class="n">name</span><span class="o">=</span><span class="n">ifit</span><span class="p">,</span><span class="n">iGuess</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">thisff</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">Fitting</span><span class="p">(</span><span class="n">Funs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Fun</span><span class="p">[</span><span class="n">thisFF</span><span class="p">],</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tdatarange</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ydata</span><span class="p">)],</span><span class="n">name</span><span class="o">=</span><span class="n">ifit</span><span class="p">,</span><span class="n">iGuess</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span><span class="p">)</span>
                    <span class="n">testff</span> <span class="o">=</span> <span class="n">thisff</span><span class="o">.</span><span class="n">FitBoots</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">testff</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span><span class="o">.</span><span class="n">Lap</span><span class="p">(</span><span class="n">chi_key</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="c1">## self.FitDict [iff , ifitr ] fitting instance</span>
                    <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fit_chi_key</span><span class="p">)</span>
                    <span class="n">fboot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisff</span><span class="p">)</span>
                    <span class="n">fAvg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisff</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;ParamsAvg&#39;</span><span class="p">])</span>
                    <span class="n">fStd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisff</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;ParamsStd&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span><span class="o">.</span><span class="n">Lap</span><span class="p">(</span><span class="n">chi_key</span><span class="p">)</span>
        <span class="c1"># debug_str = &#39; &#39;.join(map(str,[self.fit_ranges,WipeFit]))</span>
        <span class="c1"># raise Exception(&#39;Debugging, &#39;+debug_str)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Col_Names</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">this_df</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                <span class="n">this_df</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">fboot</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
                <span class="n">this_df</span><span class="p">[</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">fAvg</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
                <span class="n">this_df</span><span class="p">[</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">fStd</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_df</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">fboot</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">fAvg</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">fStd</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># print &#39;No Fits were done.&#39;</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="FFEquation.ValsAndFitPlot"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.ValsAndFitPlot">[docs]</a>    <span class="k">def</span> <span class="nf">ValsAndFitPlot</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span><span class="n">plot_class</span><span class="p">,</span><span class="n">thisFF</span><span class="p">,</span><span class="n">fitr</span><span class="o">=</span><span class="s1">&#39;All&#39;</span><span class="p">,</span><span class="n">xlims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;ToDataMax&#39;</span><span class="p">],</span>
                        <span class="n">thiscol</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">,</span><span class="n">thissym</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">,</span>
                        <span class="n">plottflow</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">,</span><span class="n">this_chi_list</span><span class="o">=</span><span class="s1">&#39;Chi0-Chi20&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">plottflow</span> <span class="o">==</span> <span class="s1">&#39;First&#39;</span><span class="p">:</span> <span class="n">plottflow</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="n">plot_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Plot</span><span class="p">(</span> <span class="n">plot_class</span><span class="p">,</span><span class="n">thisFF</span><span class="p">,</span><span class="n">this_chi_list</span><span class="o">=</span><span class="n">this_chi_list</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="n">thiscol</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="n">thisshift</span><span class="p">,</span>
                                <span class="n">thissym</span><span class="o">=</span><span class="n">thissym</span><span class="p">,</span><span class="n">plottflow</span><span class="o">=</span><span class="n">plottflow</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plottflow</span> <span class="o">==</span> <span class="s1">&#39;PreDefine&#39;</span><span class="p">:</span> <span class="n">plottflow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tflows</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflowfull</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">itflow</span> <span class="ow">in</span> <span class="n">plottflow</span><span class="p">:</span>
                <span class="n">plot_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FitPlot</span><span class="p">(</span>  <span class="n">plot_class</span><span class="p">,</span><span class="n">thisFF</span><span class="p">,</span><span class="n">this_chi_list</span><span class="o">=</span><span class="n">this_chi_list</span><span class="p">,</span>
                                            <span class="n">fitr</span><span class="o">=</span><span class="n">fitr</span><span class="p">,</span><span class="n">tflow</span><span class="o">=</span><span class="n">itflow</span><span class="p">,</span><span class="n">xlims</span><span class="o">=</span><span class="n">xlims</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="n">thiscol</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="n">thisshift</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FitPlot</span><span class="p">(</span>  <span class="n">plot_class</span><span class="p">,</span><span class="n">thisFF</span><span class="p">,</span><span class="n">this_chi_list</span><span class="o">=</span><span class="n">this_chi_list</span><span class="p">,</span>
                                        <span class="n">fitr</span><span class="o">=</span><span class="n">fitr</span><span class="p">,</span><span class="n">xlims</span><span class="o">=</span><span class="n">xlims</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="n">thiscol</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="n">thisshift</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plot_class</span></div>

    <span class="c1">## state is 1 or 2 state fit</span>
    <span class="c1">## fitr is fit range e.g. fitr5-10</span>
    <span class="c1">## fit range of &#39;Data&#39; is just the original fit range</span>
<div class="viewcode-block" id="FFEquation.FitPlot"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.FitPlot">[docs]</a>    <span class="k">def</span> <span class="nf">FitPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">plot_class</span><span class="p">,</span><span class="n">thisFF</span><span class="p">,</span><span class="n">fitr</span><span class="o">=</span><span class="s1">&#39;All&#39;</span><span class="p">,</span><span class="n">tflow</span><span class="o">=</span><span class="s1">&#39;First&#39;</span><span class="p">,</span>
                <span class="n">xlims</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;ToDataMax&#39;</span><span class="p">],</span><span class="n">this_chi_list</span><span class="o">=</span><span class="s1">&#39;Chi0-Chi20&#39;</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckCol</span><span class="p">(</span><span class="n">thiscol</span><span class="p">)</span>
        <span class="n">check</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># thisshift = self.GetShift(pl.xlim(),thisshift)</span>
        <span class="n">thisshift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tflow</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span> <span class="n">tflow</span> <span class="o">=</span> <span class="n">tflow</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;First Fit not present, please run Fit before calling fitplot&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">plot_class</span>
            <span class="c1"># raise EnvironmentError(&#39;First Fit not present, please run Fit&#39;)</span>
        <span class="k">if</span> <span class="n">fitr</span> <span class="o">==</span> <span class="s1">&#39;All&#39;</span><span class="p">:</span>
            <span class="n">ifitmin</span><span class="p">,</span><span class="n">ifitmax</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Qsqrdlist</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">fitr</span> <span class="o">=</span> <span class="s1">&#39;fitr&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ifitmin</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ifitmax</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">this_chi_list</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">this_chi_list</span> <span class="o">=</span> <span class="n">this_chi_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">chi_min</span><span class="p">,</span><span class="n">chi_max</span> <span class="o">=</span> <span class="n">this_chi_list</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tflow</span> <span class="o">==</span> <span class="s1">&#39;First&#39;</span><span class="p">:</span>
                 <span class="n">tflow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">tflow</span><span class="p">,</span><span class="n">chi_min</span><span class="p">,</span><span class="n">thisFF</span><span class="p">,</span><span class="n">fitr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">chi_min</span><span class="p">,</span><span class="n">thisFF</span><span class="p">,</span><span class="n">fitr</span><span class="p">)</span>
        <span class="c1"># print &#39;DEBUG&#39;,this_key, this_key not in self.FF_Fit_Stats[&#39;boot&#39;]</span>
        <span class="c1"># print self.FF_Fit_Stats[&#39;boot&#39;].index</span>

        <span class="k">if</span> <span class="n">this_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">this_key</span><span class="p">)</span> <span class="p">,</span> <span class="s1">&#39; has not been done, performing fit now&#39;</span><span class="p">)</span>
            <span class="n">check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">thisFF</span><span class="p">,</span><span class="n">fit_ranges</span><span class="o">=</span><span class="p">[</span><span class="n">fitr</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">check</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Warning, error with fitting &#39;</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">this_key</span><span class="p">))</span>
        <span class="n">vall</span><span class="p">,</span><span class="n">indexl</span> <span class="o">=</span> <span class="p">[],[]</span>
        <span class="k">for</span> <span class="n">ikey</span><span class="p">,</span><span class="n">ival</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CheckChi</span><span class="p">(</span><span class="n">ikey</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span><span class="n">this_chi_list</span><span class="p">):</span>
                <span class="n">vall</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ival</span><span class="p">)</span>
                <span class="n">indexl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ikey</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indexl</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">indexl</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
            <span class="n">fitr_params</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">vall</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning, no fits found that satisfy&#39;</span><span class="p">,</span><span class="n">this_chi_list</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">plot_class</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span>
            <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">tflow</span><span class="p">,</span><span class="n">chi_min</span><span class="p">,</span><span class="n">thisFF</span><span class="p">,</span><span class="n">fitr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">chi_min</span><span class="p">,</span><span class="n">thisFF</span><span class="p">,</span><span class="n">fitr</span><span class="p">)</span>
        <span class="c1"># if isinstance(fitr_params,pa.Series): fitr_params = fitr_params.iloc[-1]</span>
        <span class="c1">## TODO, plot from zero to data max</span>
        <span class="n">hold_series</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;x_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;y_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;yerr_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;xerr_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;boot_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;key_select&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_key</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;fit_vary&#39;</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;fit_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fitr_params</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;fit &#39;</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thissym</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;shift&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisshift</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;xdatarange&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xlims</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;ShowPar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Par2&#39;</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;fmt_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">KeyForamtting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ppparams</span><span class="p">)</span>
        <span class="n">plot_class</span><span class="o">.</span><span class="n">AppendData</span><span class="p">(</span><span class="n">hold_series</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plot_class</span></div>

<div class="viewcode-block" id="FFEquation.Get_Extrapolation"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.Get_Extrapolation">[docs]</a>    <span class="k">def</span> <span class="nf">Get_Extrapolation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">outl</span><span class="p">,</span><span class="n">indexl</span> <span class="o">=</span> <span class="p">[],[]</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;First Fit not present, please run Fit&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
        <span class="n">bool_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Col_Names</span><span class="p">)</span><span class="o">!=</span><span class="s1">&#39;Chi2pdf_number&#39;</span>
        <span class="n">col_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Col_Names</span><span class="p">)[</span><span class="n">bool_index</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ikey</span><span class="p">,</span><span class="n">chi_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">col_names</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">fit_key</span><span class="p">,</span><span class="n">fit_index</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;$Q^</span><span class="si">{2}</span><span class="s1">F^{</span><span class="se">\&#39;</span><span class="s1">}(0)$&#39;</span><span class="p">,</span><span class="s1">&#39;$F(0)$&#39;</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span>
                    <span class="n">indexl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chi_data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">chi_data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span><span class="o">+</span><span class="p">(</span><span class="n">fit_key</span><span class="p">,))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">indexl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chi_data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="p">(</span><span class="n">fit_key</span><span class="p">,))</span>
                <span class="n">outl</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                <span class="k">for</span> <span class="n">ic</span><span class="p">,(</span><span class="n">ichi</span><span class="p">,</span><span class="n">ichi_data</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chi_data</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                    <span class="k">if</span> <span class="n">ic</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nchi_fit_threshold</span><span class="o">**</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q2list</span><span class="p">)):</span> <span class="k">continue</span>
                    <span class="n">plot_chi_data</span> <span class="o">=</span> <span class="n">ichi_data</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plot_chi_data</span><span class="p">,</span><span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
                        <span class="c1">## assumes first parameter is constant part of linear function</span>
                        <span class="n">plot_chi_data</span> <span class="o">=</span> <span class="n">chi_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">outl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">plot_chi_data</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">fit_index</span><span class="p">]</span><span class="o">.</span><span class="n">bootvals</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                <span class="n">outl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">BootStrap</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">outl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span><span class="n">bootvals</span><span class="o">=</span><span class="n">outl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ikey</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indexl</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">indexl</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="n">col_names</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;fit parameter&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">outl</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span></div>

<div class="viewcode-block" id="FFEquation.PlotFitDistribution"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.PlotFitDistribution">[docs]</a>    <span class="k">def</span> <span class="nf">PlotFitDistribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">plot_class</span><span class="p">,</span><span class="n">thisFF</span><span class="p">,</span><span class="n">fitr</span><span class="o">=</span><span class="s1">&#39;All&#39;</span><span class="p">,</span><span class="n">tflow</span><span class="o">=</span><span class="s1">&#39;First&#39;</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">,</span><span class="n">chi_colapse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckCol</span><span class="p">(</span><span class="n">thiscol</span><span class="p">)</span>
        <span class="c1"># thisshift = self.GetShift(pl.xlim(),thisshift)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tflow</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span> <span class="n">tflow</span> <span class="o">=</span> <span class="n">tflow</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;First Fit not present, please run Fit&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">plot_class</span>
            <span class="c1"># raise EnvironmentError()</span>
        <span class="n">check</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">fitr</span> <span class="o">==</span> <span class="s1">&#39;All&#39;</span><span class="p">:</span>
            <span class="n">ifitmin</span><span class="p">,</span><span class="n">ifitmax</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Qsqrdlist</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">fitr</span> <span class="o">=</span> <span class="s1">&#39;fitr&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ifitmin</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ifitmax</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tflow</span> <span class="o">==</span> <span class="s1">&#39;First&#39;</span><span class="p">:</span>
                 <span class="n">tflow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tflows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">tflow</span><span class="p">,</span><span class="n">fitr</span><span class="p">,</span><span class="n">thisFF</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">tflow</span><span class="p">,</span><span class="n">thisFF</span><span class="p">,</span><span class="n">fitr</span> <span class="p">,</span> <span class="s1">&#39; has not been done, performing fit now&#39;</span><span class="p">)</span>
                <span class="n">check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">thisFF</span><span class="p">,</span><span class="n">fit_ranges</span><span class="o">=</span><span class="p">[</span><span class="n">fitr</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
                <span class="c1">## From Here!!</span>
                <span class="c1"># this_key = (tflow,thisFF,fitr)</span>
                <span class="c1"># fitr_label = self.FF_Fit_Stats[&#39;boot&#39;][(tflow,&#39;Chi0&#39;,thisFF,fitr)].name</span>
                <span class="k">if</span> <span class="n">chi_colapse</span><span class="p">:</span>
                    <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">tflow</span><span class="p">,</span><span class="n">thisFF</span><span class="p">,</span><span class="n">fitr</span><span class="p">,</span><span class="s1">&#39;$F(0)$&#39;</span><span class="p">)</span>
                    <span class="n">plot_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Get_Extrapolation</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">plot_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">## TODO, make this like above with an extra index for F(0) or Q2F&#39;</span>
                    <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">tflow</span><span class="p">,</span><span class="s1">&#39;Chi0&#39;</span><span class="p">,</span><span class="n">thisFF</span><span class="p">,</span><span class="n">fitr</span><span class="p">)</span>
                    <span class="n">plot_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1">## TODO, plot from zero to data max</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">fitr</span><span class="p">,</span><span class="n">thisFF</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">thisFF</span><span class="p">,</span><span class="n">fitr</span> <span class="p">,</span> <span class="s1">&#39; has not been done, performing fit now&#39;</span><span class="p">)</span>
                <span class="n">check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">thisFF</span><span class="p">,</span><span class="n">fit_ranges</span><span class="o">=</span><span class="p">[</span><span class="n">fitr</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">chi_colapse</span><span class="p">:</span>
                    <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">thisFF</span><span class="p">,</span><span class="n">fitr</span><span class="p">,</span><span class="s1">&#39;$F(0)$&#39;</span><span class="p">)</span>
                    <span class="n">plot_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Get_Extrapolation</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">plot_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Chi0&#39;</span><span class="p">,</span><span class="n">thisFF</span><span class="p">,</span><span class="n">fitr</span><span class="p">)</span>
                    <span class="n">plot_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
            <span class="n">hold_series</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
            <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;boot_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot_data</span>
            <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;x_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;y_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;yerr_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;xerr_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;histogram_vary&#39;</span>
            <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;fit_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;key_select&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_key</span>
            <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;fit_result&#39;</span>
            <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span>
            <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;shift&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;xdatarange&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;ShowPar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;fmt_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">KeyForamtting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ppparams</span><span class="p">)</span>
            <span class="n">plot_class</span><span class="o">.</span><span class="n">AppendData</span><span class="p">(</span><span class="n">hold_series</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Fit was unable to be constructed, no fit is plotted.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plot_class</span></div>

    <span class="c1">### OVERLOADING OPERATOR FUNCTIONS ###</span>
<div class="viewcode-block" id="FFEquation.Overload_wrap"><a class="viewcode-back" href="../FFSolve.html#FFSolve.FFEquation.Overload_wrap">[docs]</a>    <span class="k">def</span> <span class="nf">Overload_wrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">FF2</span><span class="p">,</span><span class="n">this_fun</span><span class="p">):</span>
        <span class="c1">## TODO, include some name and filename formatting</span>
        <span class="n">thisname</span><span class="p">,</span><span class="n">thisfilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">FF2</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">):</span>
            <span class="n">thisname</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">FF2</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">FF2</span><span class="p">,</span><span class="s1">&#39;filename&#39;</span><span class="p">):</span>
            <span class="n">thisfilename</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">FF2</span><span class="o">.</span><span class="n">filename</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">FFEquation</span><span class="p">(</span>  <span class="bp">self</span><span class="o">.</span><span class="n">currtype</span><span class="p">,</span><span class="n">q2list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q2list</span><span class="p">,</span><span class="n">pp2list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pp2list</span><span class="p">,</span>
                                <span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglistin</span><span class="p">,</span> <span class="n">Info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">,</span>
                                <span class="n">fit2pt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fit2ptin</span><span class="p">,</span><span class="n">fitAlpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fitAlphain</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">namein</span><span class="p">,</span>
                                <span class="n">thissym</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thissym</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">FF_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
        <span class="n">result</span><span class="o">.</span><span class="n">Qsqrdlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Qsqrdlist</span>
        <span class="n">result</span><span class="o">.</span><span class="n">QsqrdKeyList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">QsqrdKeyList</span>
        <span class="n">result</span><span class="o">.</span><span class="n">chi_Qsqrd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chi_Qsqrd</span>
        <span class="n">result</span><span class="o">.</span><span class="n">C2forMass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2forMass</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">C2FOforAlpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2FOforAlpha</span>
        <span class="n">result</span><span class="o">.</span><span class="n">thisFF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisFF</span>
        <span class="n">result</span><span class="o">.</span><span class="n">RatioFileList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RatioFileList</span>
        <span class="n">result</span><span class="o">.</span><span class="n">Inefm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Inefm</span>
        <span class="n">result</span><span class="o">.</span><span class="n">nchi_fit_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nchi_fit_threshold</span>
        <span class="n">result</span><span class="o">.</span><span class="n">nchi_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nchi_threshold</span>

        <span class="c1"># result.UpdateName(&#39;+&#39;,self,FF2)</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">FF2</span><span class="p">,</span><span class="n">FFEquation</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">RatioFileList</span> <span class="o">+=</span> <span class="n">FF2</span><span class="o">.</span><span class="n">RatioFileList</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DS</span> <span class="o">!=</span> <span class="n">FF2</span><span class="o">.</span><span class="n">DS</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">DS</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span> <span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="n">FF2</span><span class="o">.</span><span class="n">DS</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Inefm</span> <span class="o">!=</span> <span class="n">FF2</span><span class="o">.</span><span class="n">Inefm</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING:, combining two form factors, where one is in [efm]&#39;</span><span class="p">)</span>
                <span class="n">result</span><span class="o">.</span><span class="n">SetCustomName</span><span class="p">()</span>

                <span class="c1"># result.FF_Stats.loc[:,&#39;boot&#39;] = this_fun(self.FF_Stats.loc[:,&#39;boot&#39;],FF2.FF_Stats.loc[:,&#39;boot&#39;])</span>
                <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="n">FF2</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">:</span>
                    <span class="n">vall</span><span class="p">,</span><span class="n">ilist</span> <span class="o">=</span> <span class="p">[],[]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span> <span class="ow">and</span> <span class="n">FF2</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span>
                        <span class="k">for</span> <span class="p">(</span><span class="n">itflow</span><span class="p">,</span><span class="n">ichi</span><span class="p">,</span><span class="n">iQ2</span><span class="p">),</span><span class="n">iFF</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">itflow</span><span class="p">,</span><span class="n">iQ2</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">FF2</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
                                <span class="k">if</span> <span class="n">ichi</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;chi0&#39;</span><span class="p">:</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="n">itflow</span><span class="p">,</span><span class="n">iQ2</span><span class="p">,</span><span class="s1">&#39;not key found in &#39;</span><span class="p">,</span><span class="n">FF2</span><span class="o">.</span><span class="n">name</span> <span class="p">,</span> <span class="s1">&#39;skipping&#39;</span><span class="p">)</span>
                                    <span class="c1"># print &#39;DEBUG&#39;</span>
                                    <span class="c1"># print FF2.FF_Stats[&#39;boot&#39;].index.swaplevel(1,2)</span>
                                <span class="k">continue</span>
                                <span class="c1"># out_str = &#39; missmatch in euclidian times / flow time / op times  &#39;</span>
                                <span class="c1"># out_str += itflow+&#39; &#39;+iQ2+&#39;\n&#39;</span>
                                <span class="c1">#</span>
                                <span class="c1"># out_str += &#39; when combining form factors \n&#39;</span>
                                <span class="c1"># out_str += str(self) + &#39;\n&#39;</span>
                                <span class="c1"># out_str += this_fun.__name__+&#39;\n&#39;</span>
                                <span class="c1"># out_str += str(FF2) + &#39;\n&#39;</span>
                                <span class="c1"># raise EnvironmentError(out_str)</span>
                            <span class="n">ichi_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">FF2</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">itflow</span><span class="p">,</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">iQ2</span><span class="p">),</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
                            <span class="n">inside_chi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ichi</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Chi&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">*</span><span class="n">ichi_len</span>

                            <span class="k">for</span> <span class="p">(</span><span class="n">itflow_dump</span><span class="p">,</span><span class="n">ichi2</span><span class="p">,</span><span class="n">iQ2_dump</span><span class="p">),</span><span class="n">iFF2</span> <span class="ow">in</span> <span class="n">FF2</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">itflow</span><span class="p">,</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">iQ2</span><span class="p">),</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                <span class="n">this_chi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ichi2</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Chi&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="n">inside_chi</span>
                                <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">itflow</span><span class="p">,</span><span class="s1">&#39;Chi&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">this_chi</span><span class="p">),</span><span class="n">iQ2</span><span class="p">))</span>
                                <span class="n">vall</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_fun</span><span class="p">(</span><span class="n">iFF</span><span class="p">,</span><span class="n">iFF2</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span>
                        <span class="k">for</span> <span class="p">(</span><span class="n">iflow</span><span class="p">,</span><span class="n">ichi</span><span class="p">,</span><span class="n">iQ2</span><span class="p">),</span><span class="n">iFF</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">ichi_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">FF2</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">itflow</span><span class="p">,</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">iQ2</span><span class="p">),</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
                            <span class="n">inside_chi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ichi</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Chi&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">*</span><span class="n">ichi_len</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">iQ2</span><span class="p">,)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">FF2</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
                                <span class="k">if</span> <span class="n">ichi</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;chi0&#39;</span><span class="p">:</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="n">iQ2</span><span class="p">,</span><span class="s1">&#39;not found in &#39;</span><span class="p">,</span><span class="n">FF2</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="s1">&#39;skipping&#39;</span><span class="p">)</span>
                                <span class="k">continue</span>
                                <span class="c1"># out_str = &#39; missmatch in euclidian times / flow time / op times \</span>
                                <span class="c1">#             when combining form factors \n&#39;</span>
                                <span class="c1"># out_str += str(self) + &#39;\n&#39;</span>
                                <span class="c1"># out_str += this_fun.__name__+&#39;\n&#39;</span>
                                <span class="c1"># out_str += str(FF2) + &#39;\n&#39;</span>
                                <span class="c1"># raise EnvironmentError(out_str)</span>
                            <span class="k">for</span> <span class="p">(</span><span class="n">ichi2</span><span class="p">,</span><span class="n">iQ2_dump</span><span class="p">),</span><span class="n">iFF2</span> <span class="ow">in</span> <span class="n">FF2</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">iQ2</span><span class="p">),</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                <span class="n">this_chi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ichi2</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Chi&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="n">inside_chi</span>
                                <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">itflow</span><span class="p">,</span><span class="s1">&#39;Chi&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">this_chi</span><span class="p">),</span><span class="n">iQ2</span><span class="p">))</span>
                                <span class="n">vall</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_fun</span><span class="p">(</span><span class="n">iFF</span><span class="p">,</span><span class="n">iFF2</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">FF2</span><span class="o">.</span><span class="n">doflow</span><span class="p">:</span>
                        <span class="k">for</span> <span class="p">(</span><span class="n">ichi</span><span class="p">,</span><span class="n">iQ2</span><span class="p">),</span><span class="n">iFF</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">ichi_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">FF2</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">iQ2</span><span class="p">),</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
                            <span class="n">inside_chi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ichi</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Chi&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">*</span><span class="n">ichi_len</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">iQ2</span><span class="p">,)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">FF2</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
                                <span class="k">if</span> <span class="n">ichi</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;chi0&#39;</span><span class="p">:</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="n">iQ2</span><span class="p">,</span><span class="s1">&#39;not found in &#39;</span><span class="p">,</span><span class="n">FF2</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="s1">&#39;skipping&#39;</span><span class="p">)</span>
                                <span class="k">continue</span>
                                <span class="c1"># out_str = &#39; missmatch in euclidian times / flow time / op times \</span>
                                <span class="c1">#             when combining form factors \n&#39;</span>
                                <span class="c1"># out_str += str(self) + &#39;\n&#39;</span>
                                <span class="c1"># out_str += this_fun.__name__+&#39;\n&#39;</span>
                                <span class="c1"># out_str += str(FF2) + &#39;\n&#39;</span>
                                <span class="c1"># raise EnvironmentError(out_str)</span>
                            <span class="k">for</span> <span class="p">(</span><span class="n">itflow</span><span class="p">,</span><span class="n">ichi2</span><span class="p">,</span><span class="n">iQ2_dump</span><span class="p">),</span><span class="n">iFF2</span> <span class="ow">in</span> <span class="n">FF2</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">iQ2</span><span class="p">),</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                <span class="n">this_chi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ichi2</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Chi&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="n">inside_chi</span>
                                <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">itflow</span><span class="p">,</span><span class="s1">&#39;Chi&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">this_chi</span><span class="p">),</span><span class="n">iQ2</span><span class="p">))</span>
                                <span class="n">vall</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_fun</span><span class="p">(</span><span class="n">iFF</span><span class="p">,</span><span class="n">iFF2</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="p">(</span><span class="n">ichi</span><span class="p">,</span><span class="n">iQ2</span><span class="p">),</span><span class="n">iFF</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">ichi_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">FF2</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">iQ2</span><span class="p">),</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
                            <span class="n">inside_chi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ichi</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Chi&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">*</span><span class="n">ichi_len</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">iQ2</span><span class="p">,)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">FF2</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
                                <span class="k">if</span> <span class="n">ichi</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;chi0&#39;</span><span class="p">:</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="n">iQ2</span><span class="p">,</span><span class="s1">&#39;not found in &#39;</span><span class="p">,</span><span class="n">FF2</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="s1">&#39;skipping&#39;</span><span class="p">)</span>
                                <span class="k">continue</span>
                                <span class="c1"># out_str = &#39; missmatch in euclidian times / flow time / op times \</span>
                                <span class="c1">#             when combining form factors \n&#39;</span>
                                <span class="c1"># out_str += str(self) + &#39;\n&#39;</span>
                                <span class="c1"># out_str += this_fun.__name__+&#39;\n&#39;</span>
                                <span class="c1"># out_str += str(FF2) + &#39;\n&#39;</span>
                                <span class="c1"># raise EnvironmentError(out_str)</span>
                            <span class="k">for</span> <span class="p">(</span><span class="n">ichi2</span><span class="p">,</span><span class="n">iQ2_dump</span><span class="p">),</span><span class="n">iFF2</span> <span class="ow">in</span> <span class="n">FF2</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">iQ2</span><span class="p">),</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                <span class="n">this_chi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ichi2</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Chi&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="n">inside_chi</span>
                                <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Chi&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">this_chi</span><span class="p">),</span><span class="n">iQ2</span><span class="p">))</span>
                                <span class="n">vall</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_fun</span><span class="p">(</span><span class="n">iFF</span><span class="p">,</span><span class="n">iFF2</span><span class="p">))</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Col_Names</span><span class="p">)</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">vall</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s1">&#39;Run Bootstrap on second class before combining ratio functions&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_fun</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">],</span> <span class="n">FF2</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">FF2</span><span class="p">),</span> <span class="n">FF2</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FF_Stats</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Invalid value to combine with FF_Stats class&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s1">&#39;Run Bootstrap on first class before combining FF_Stats functions&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">FF2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">FF2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">FFEquation</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">FF2</span><span class="o">.</span><span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">FF2</span><span class="p">,</span><span class="n">op</span><span class="o">.</span><span class="n">add</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">FF2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">FF2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">FFEquation</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">FF2</span><span class="o">.</span><span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">FF2</span><span class="p">,</span><span class="n">op</span><span class="o">.</span><span class="n">sub</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">FF2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">FF2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">FFEquation</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">FF2</span><span class="o">.</span><span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">FF2</span><span class="p">,</span><span class="n">op</span><span class="o">.</span><span class="n">mul</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">FF2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">FF2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">FFEquation</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">FF2</span><span class="o">.</span><span class="n">__rdiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">FF2</span><span class="p">,</span><span class="n">op</span><span class="o">.</span><span class="n">truediv</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">FF2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">FF2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">FFEquation</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">FF2</span><span class="o">.</span><span class="fm">__rpow__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">FF2</span><span class="p">,</span><span class="n">op</span><span class="o">.</span><span class="n">pow</span><span class="p">)</span>


    <span class="c1">## Right multiplication functions</span>


    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">FF2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">FF2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">FFEquation</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">FF2</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">FF2</span><span class="p">,</span><span class="n">flip_fun_2arg</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">add</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">FF2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">FF2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">FFEquation</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">FF2</span><span class="o">.</span><span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">FF2</span><span class="p">,</span><span class="n">flip_fun_2arg</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">sub</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">FF2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">FF2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">FFEquation</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">FF2</span><span class="o">.</span><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">FF2</span><span class="p">,</span><span class="n">flip_fun_2arg</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">mul</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rdiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">FF2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">FF2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">FFEquation</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">FF2</span><span class="o">.</span><span class="n">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">FF2</span><span class="p">,</span><span class="n">flip_fun_2arg</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">truediv</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">__rpow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">FF2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">FF2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">FFEquation</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">FF2</span><span class="o">.</span><span class="fm">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">FF2</span><span class="p">,</span><span class="n">flip_fun_2arg</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">pow</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestFFSolve"><a class="viewcode-back" href="../FFSolve.html#FFSolve.TestFFSolve">[docs]</a><span class="k">def</span> <span class="nf">TestFFSolve</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">q2list</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span><span class="n">DS</span><span class="o">=</span><span class="s1">&#39;Proton&#39;</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">Params</span> <span class="k">import</span> <span class="n">defInfo</span>
    <span class="n">defInfo</span><span class="p">[</span><span class="s1">&#39;Chi_Cutoff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">defInfo</span><span class="p">[</span><span class="s1">&#39;Chi2pdf_Min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">defInfo</span><span class="p">[</span><span class="s1">&#39;Chi2pdf_Max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">defInfo</span><span class="p">[</span><span class="s1">&#39;Important_FF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">defInfo</span><span class="p">[</span><span class="s1">&#39;Reduce_System&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">defInfo</span><span class="p">[</span><span class="s1">&#39;DoubSing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DS</span>

    <span class="n">this_info</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
    <span class="n">this_info</span><span class="p">[</span><span class="s1">&#39;save_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;./TestGraphs/testFF.pdf&#39;</span>
    <span class="n">this_info</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Test Form Factor&#39;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">FFEquation</span><span class="p">(</span><span class="s1">&#39;GeGm&#39;</span><span class="p">,</span><span class="n">Info</span><span class="o">=</span><span class="n">defInfo</span><span class="p">,</span><span class="n">q2list</span><span class="o">=</span><span class="n">q2list</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">SetupPickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">SolvePickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">PlotData</span> <span class="k">as</span> <span class="nn">jpl</span>
    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">jpl</span><span class="o">.</span><span class="n">Plotting</span><span class="p">(</span><span class="n">plot_info</span><span class="o">=</span><span class="n">this_info</span><span class="p">)</span>
    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Plot</span><span class="p">(</span><span class="n">data_plot</span><span class="p">,</span><span class="s1">&#39;G_</span><span class="si">{E}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="s1">&#39;Blue&#39;</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">thissym</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">FitPlot</span><span class="p">(</span><span class="n">data_plot</span><span class="p">,</span><span class="s1">&#39;G_</span><span class="si">{E}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">data_plot</span><span class="o">.</span><span class="n">PrintData</span><span class="p">()</span>
    <span class="n">data_plot</span><span class="o">.</span><span class="n">PlotAll</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="TestFFFlowSolve"><a class="viewcode-back" href="../FFSolve.html#FFSolve.TestFFFlowSolve">[docs]</a><span class="k">def</span> <span class="nf">TestFFFlowSolve</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">q2list</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">]):</span>
    <span class="kn">from</span> <span class="nn">Params</span> <span class="k">import</span> <span class="n">defInfoFlow</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;Chi_Cutoff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;Chi2pdf_Min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;Chi2pdf_Max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;Important_FF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;Reduce_System&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;tflowlist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;t_f6.01&#39;</span><span class="p">])</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;tflowfit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;tflowlist&#39;</span><span class="p">]</span>
    <span class="n">this_info</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
    <span class="n">this_info</span><span class="p">[</span><span class="s1">&#39;save_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;./TestGraphs/testFF.pdf&#39;</span>
    <span class="n">this_info</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Test Form Factor&#39;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">FFEquation</span><span class="p">(</span><span class="s1">&#39;VectorTop&#39;</span><span class="p">,</span><span class="n">Info</span><span class="o">=</span><span class="n">defInfoFlow</span><span class="p">,</span><span class="n">q2list</span><span class="o">=</span><span class="n">q2list</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">SetupPickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">SolvePickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">PlotData</span> <span class="k">as</span> <span class="nn">jpl</span>
    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">jpl</span><span class="o">.</span><span class="n">Plotting</span><span class="p">(</span><span class="n">plot_info</span><span class="o">=</span><span class="n">this_info</span><span class="p">)</span>
    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Plot</span><span class="p">(</span><span class="n">data_plot</span><span class="p">,</span><span class="s1">&#39;G_</span><span class="si">{E}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="s1">&#39;Blue&#39;</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">thissym</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">FitPlot</span><span class="p">(</span><span class="n">data_plot</span><span class="p">,</span><span class="s1">&#39;G_</span><span class="si">{E}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">data_plot</span><span class="o">.</span><span class="n">PrintData</span><span class="p">()</span>
    <span class="n">data_plot</span><span class="o">.</span><span class="n">PlotAll</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">data</span></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">dataFF</span> <span class="o">=</span> <span class="n">TestFFSolve</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table of Contents</h3>
          <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Python_Analysis</a></li>
</ul>

          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="../search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
            </form>
          </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="../py-modindex.html" title="Python Module Index"
              >modules</a> |
            <a href="../genindex.html" title="General Index"
              >index</a>
          </div>
          <div role="note" aria-label="source link">
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Jack Dragos.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.2.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>