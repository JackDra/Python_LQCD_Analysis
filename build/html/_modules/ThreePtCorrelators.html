

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ThreePtCorrelators &mdash; LQCD Analysis Codebase TF Fits documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/my_theme.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> LQCD Analysis Codebase
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Python_Analysis</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">LQCD Analysis Codebase</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>ThreePtCorrelators</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for ThreePtCorrelators</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>


<span class="c1">#IMPORT THIS FIRST, put in base import file</span>
<span class="kn">from</span> <span class="nn">Params</span> <span class="k">import</span> <span class="n">nboot</span><span class="p">,</span><span class="n">cfg_file_type</span><span class="p">,</span><span class="n">Wipe_All_Fits</span>
<span class="kn">from</span> <span class="nn">Params</span> <span class="k">import</span> <span class="n">cfundir</span><span class="p">,</span><span class="n">outputdir</span><span class="p">,</span><span class="n">cfgfmtdir</span>
<span class="kn">from</span> <span class="nn">MiscFuns</span> <span class="k">import</span> <span class="n">ODNested</span><span class="p">,</span><span class="n">mkdir_p</span><span class="p">,</span><span class="n">CheckClass</span><span class="p">,</span><span class="n">CombineCfgs</span><span class="p">,</span><span class="n">fmt_file_type</span>
<span class="kn">from</span> <span class="nn">XmlFormatting</span> <span class="k">import</span> <span class="n">AvgStdToFormat</span><span class="p">,</span><span class="n">tstr</span><span class="p">,</span><span class="n">unxmlfitr</span><span class="p">,</span><span class="n">untstr</span><span class="p">,</span><span class="n">tsumstr</span>
<span class="kn">from</span> <span class="nn">FlowOpps</span> <span class="k">import</span> <span class="n">FlowOp</span><span class="p">,</span><span class="n">FlowOpFullSquared</span>
<span class="kn">from</span> <span class="nn">PredefFitFuns</span> <span class="k">import</span> <span class="n">C3OneStateFitFunNoExp</span><span class="p">,</span><span class="n">C3MomTwoStateFitFunNoExp</span>

<span class="kn">from</span> <span class="nn">ReadBinaryCfuns</span> <span class="k">import</span> <span class="n">ReadFSCfunPickCHROMA</span><span class="p">,</span><span class="n">RC3Full</span>
<span class="kn">from</span> <span class="nn">BootStrapping</span> <span class="k">import</span> <span class="n">BootStrap</span>
<span class="kn">from</span> <span class="nn">FileIO</span> <span class="k">import</span> <span class="n">WriteXml</span><span class="p">,</span><span class="n">WritePickle</span><span class="p">,</span><span class="n">ReadPickleWrap</span><span class="p">,</span><span class="n">WriteExcel</span><span class="p">,</span><span class="n">ReadWithMeta</span><span class="p">,</span><span class="n">WriteWithMeta</span>
<span class="kn">from</span> <span class="nn">FileIO</span> <span class="k">import</span> <span class="n">Construct_File_Object</span>
<span class="c1"># import cPickle as pickle</span>
<span class="c1"># import dill as pickle</span>
<span class="kn">from</span> <span class="nn">DSDefines</span> <span class="k">import</span> <span class="n">DSfundict</span>
<span class="kn">import</span> <span class="nn">FitFunctions</span> <span class="k">as</span> <span class="nn">ff</span>
<span class="kn">import</span> <span class="nn">MomParams</span> <span class="k">as</span> <span class="nn">mp</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">re</span><span class="o">,</span><span class="nn">glob</span><span class="o">,</span><span class="nn">os</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span><span class="p">,</span><span class="n">copy</span>
<span class="kn">from</span> <span class="nn">TwoPtCorrelators</span> <span class="k">import</span> <span class="n">TwoPointCorr</span>
<span class="kn">from</span> <span class="nn">TimeStuff</span> <span class="k">import</span> <span class="n">Timer</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pa</span>

<span class="c1"># from FlowOpps import FlowOp</span>




<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">How to use:</span>

<span class="sd">ThreePointCorr(cfglist=[], Info={})</span>
<span class="sd">creates class using:</span>
<span class="sd"> configuration list cfglist</span>
<span class="sd"> Information Dictionary Info (See below for what can be in Info)</span>


<span class="sd">.ReadAndWrite()</span>
<span class="sd">Does everything basically.</span>


<span class="sd">WARNING: only 1 stream is implemented now. only pass in config lists or have directories</span>
<span class="sd">         with 1 steam (-a- for example)</span>

<span class="sd">TODO:</span>
<span class="sd">also contains NJNQCorr(cfglist=[], Info={})</span>

<span class="sd">&quot;&quot;&quot;</span>



<div class="viewcode-block" id="ThreePointCorr"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr">[docs]</a><span class="k">class</span> <span class="nc">ThreePointCorr</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    C3(q,tau,pp,t) uses bootstrap class</span>
<span class="sd">    pp  = sink momentum</span>
<span class="sd">    t   = source sink separation time</span>
<span class="sd">    q   = current insersion momentum</span>
<span class="sd">    tau = current insersion time</span>

<span class="sd">    Info is a dictionary containing information for the correlator:</span>
<span class="sd">    see comments below to see what is required.</span>
<span class="sd">    missing elements just sets field to default</span>


<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ThreePointCorr.Construct_3pt_File"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.Construct_3pt_File">[docs]</a>    <span class="k">def</span> <span class="nf">Construct_3pt_File</span><span class="p">(</span><span class="n">this_file</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Construct_File_Object</span><span class="p">(</span><span class="n">this_file</span><span class="p">,</span><span class="n">ThreePointCorr</span><span class="p">)</span></div>


    <span class="c1">## TODO: create variational flag and interface with this function.</span>

    <span class="c1">## array of all classes that inherit this class. Append this when adding new classes please!</span>
    <span class="n">parentlist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RatioCorrelators.RatioCorr&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thisnboot</span><span class="o">=</span><span class="n">nboot</span><span class="p">,</span> <span class="n">cfglist</span><span class="o">=</span><span class="p">{},</span> <span class="n">Info</span><span class="o">=</span><span class="p">{},</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">man_load_cfgs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">thischecklist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nboot&#39;</span><span class="p">,</span><span class="s1">&#39;nt&#39;</span><span class="p">,</span><span class="s1">&#39;ism&#39;</span><span class="p">,</span><span class="s1">&#39;jsm&#39;</span><span class="p">,</span><span class="s1">&#39;tsink&#39;</span><span class="p">,</span><span class="s1">&#39;DS&#39;</span><span class="p">,</span><span class="s1">&#39;ppmom&#39;</span><span class="p">,</span><span class="s1">&#39;Proj&#39;</span><span class="p">,</span><span class="s1">&#39;tsrc&#39;</span><span class="p">,</span><span class="s1">&#39;kud&#39;</span><span class="p">,</span><span class="s1">&#39;ks&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">## Initialising plotting parameters</span>



        <span class="c1">#self.C3 = [ igamma , ip , it , iconf ]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span>    <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        self.C3_cfgs DataFrame:</span>

<span class="sd">        columns =   config_number , C3[igamma, ip, it]</span>

<span class="sd">        rows =      stream , configuration</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">C3_Col_Names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;current_operator&#39;</span><span class="p">,</span><span class="s1">&#39;momentum&#39;</span><span class="p">,</span><span class="s1">&#39;source_sink_separation&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        self.C3_Stats DataFrame:</span>

<span class="sd">        columns =   boot,   Avg,        Std</span>

<span class="sd">        rows =      current_operator,   momenta,    time separation</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># # C3boot [ igamma , ip , it ] bs</span>
        <span class="c1"># self.C3boot = ODNested()</span>
        <span class="c1"># self.C3Avg  = ODNested()</span>
        <span class="c1"># self.C3Std  = ODNested()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3_Fit_Col_Names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;states&#39;</span><span class="p">,</span><span class="s1">&#39;current_operator&#39;</span><span class="p">,</span><span class="s1">&#39;momentum&#39;</span><span class="p">,</span> <span class="s1">&#39;time_fit_range&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3_Fit_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        self.C3_Fit_Stats DataFrame:</span>

<span class="sd">        columns =   boot,   Avg,        Std</span>

<span class="sd">        rows =       states fitted to,current _operator, momenta, time fit range</span>

<span class="sd">        Avg/Std elements are pa.Series instances with:</span>
<span class="sd">            index = fit parameters</span>
<span class="sd">            values = Avg/Std values</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># # FitDict [ States_Fitted_To , Fit_range , ip , Fit_Parameter ] bs</span>
        <span class="c1"># self.FitDict    = ODNested()</span>
        <span class="c1"># self.FitDictAvg = ODNested()</span>
        <span class="c1"># self.FitDictStd = ODNested()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TwoPtPars</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nboot</span> <span class="o">=</span> <span class="n">thisnboot</span>


        <span class="k">if</span> <span class="s1">&#39;show_cfgs&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cfgs</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;show_cfgs&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cfgs</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1">## used to pick out different configuraiton/source lists.</span>
        <span class="c1">## for example, if there are less flowed operators than 2 point correlators, passing &#39;TopCharge&#39; will read that result</span>
        <span class="k">if</span> <span class="s1">&#39;fo_for_cfgs&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">fo_for_cfgs</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;fo_for_cfgs&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fo_for_cfgs</span> <span class="o">=</span> <span class="kc">False</span>


        <span class="c1">## Info can contain fit ranges to be calculated</span>
        <span class="c1">## must bein form Info[&#39;Fits&#39;] = [ (&#39;state#&#39; , &#39;fit#-#&#39; ) , ...]</span>
        <span class="k">if</span> <span class="s1">&#39;Fits3pt&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">PredefFits</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;Fits3pt&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">PredefFits</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1">## Info can contain initial guess for fits, make sure it array of correct length</span>
        <span class="k">if</span> <span class="s1">&#39;iGuessC3&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;iGuessC3&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span> <span class="c1">## Defaults to value set for function in FitFunctions.py</span>

        <span class="c1">## Source Smearing ism value ( in integer form)</span>
        <span class="k">if</span> <span class="s1">&#39;ism&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">ism</span> <span class="o">=</span> <span class="s1">&#39;ism&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;ism&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ism</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="s1">&#39;cfg_file_type&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg_file_type</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;cfg_file_type&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg_file_type</span> <span class="o">=</span> <span class="n">cfg_file_type</span>


        <span class="c1">## Sink Smearing type value.</span>
        <span class="c1">## Distinguish from jsm since combined sink smearings is a thing.</span>
        <span class="k">if</span> <span class="s1">&#39;jsm3pt&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">jsm</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;jsm3pt&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">jsm</span> <span class="o">=</span> <span class="s1">&#39;PoF0D1&#39;</span>

        <span class="c1">## t_source location ( in integer form)</span>
        <span class="k">if</span> <span class="s1">&#39;tsrc&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsrc</span> <span class="o">=</span> <span class="s1">&#39;tsrc&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;tsrc&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsrc</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="c1">## t_sink location ( in integer form)</span>
        <span class="k">if</span> <span class="s1">&#39;tsink&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsink</span> <span class="o">=</span> <span class="s1">&#39;tsink&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;tsink&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsink</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="c1"># ## x_source list has been pushed to cfglist, this is depriciated</span>
        <span class="c1"># if &#39;xsrc&#39; in Info.keys(): self.xsrc = [&#39;xsrc&#39;+str(isrc) for isrc in Info[&#39;xsrc&#39;]]</span>
        <span class="c1"># else: self.xsrc = [&#39;xsrc1&#39;]</span>

        <span class="c1">## current momentum list ( in form of [px py pz] )</span>
        <span class="c1">## this now corresponds to the current insersion momentum q</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">LatticeParameters</span><span class="p">(</span><span class="n">Info</span><span class="o">=</span><span class="n">Info</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">nt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nxyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">nxyz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span> <span class="o">=</span> <span class="s1">&#39;RC&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nxyz</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;x&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim_ll</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nxyz</span><span class="p">)</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;^</span><span class="si">{3}</span><span class="s1">\times &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;qmom&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;qmom&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;All&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qmom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">GetMomList</span><span class="p">(</span><span class="n">list_type</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qmom</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;qmom&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qmom</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0 0 0&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qform</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">TOpform</span><span class="p">(</span><span class="n">ival</span><span class="p">,</span><span class="n">pref</span><span class="o">=</span><span class="s1">&#39;q&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">qmom</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkmomlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qform</span>

        <span class="c1">## sink momentum ( in form of &#39;ppx ppy ppz&#39; )</span>
        <span class="k">if</span> <span class="s1">&#39;ppmom&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">ppmom</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;ppmom&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ppmom</span> <span class="o">=</span> <span class="s1">&#39;0 0 0&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ppform</span> <span class="o">=</span> <span class="s1">&#39;pp&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ppmom</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="c1">## file has p###, not pp###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filepp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ppform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;pp&#39;</span><span class="p">,</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>


        <span class="c1">## kappa up down (in integer form)</span>
        <span class="k">if</span> <span class="s1">&#39;kud&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">kud</span> <span class="o">=</span> <span class="s1">&#39;kud&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;kud&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kud</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="c1">## kappa strange (in integer form)</span>
        <span class="k">if</span> <span class="s1">&#39;ks&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">ks</span> <span class="o">=</span> <span class="s1">&#39;ks&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;ks&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ks</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="c1">## these CurrOps contain a list of &#39;_&#39; separated parameters refering to:</span>
        <span class="c1">## projectors, operator and real/complex part.\</span>
        <span class="c1">## e.g. P3_g1g2_cmplx is z polarized projection of the operator g1g2, looking at the complex part</span>
        <span class="k">if</span> <span class="s1">&#39;gammas&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">gammalist</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;gammas&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;gammas not set, defaulting to vector current g4&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gammalist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;g4&#39;</span><span class="p">]</span> <span class="c1">## default to the vector current</span>

        <span class="c1">## Projector tells whether to read the unpolarized (P4) or polarized (P1/P2/P3) projections</span>
        <span class="k">if</span> <span class="s1">&#39;Projector&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">Proj</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;Projector&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Projector not set, defaulting to unpolarized projector P4&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Proj</span> <span class="o">=</span> <span class="s1">&#39;P4&#39;</span> <span class="c1">## default to unpolarized projector</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ProjNumb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Proj</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1">## DoubSing tells whether to read doublet (doub) or singlet (sing) contribution</span>
        <span class="k">if</span> <span class="s1">&#39;DoubSing&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;DoubSing&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">DSfundict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DSList (from DSDefines.py):&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">DSfundict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Doublet,Singlet type (Info[&#39;DoubSing&#39;]) not recognised&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DS</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;DoubSing&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Please set DoubSing in Info for ThreePtCorrelators &#39;</span><span class="p">)</span>

        <span class="c1">## will attempt to find all replica streams in directory.</span>
        <span class="c1">## set self.nstream to number of streams you want to find.</span>
        <span class="k">if</span> <span class="s1">&#39;stream_list&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;stream_list&#39;</span><span class="p">],</span><span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;stream_list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;stream_list&#39;</span><span class="p">]]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">iinfo</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">iinfo</span> <span class="ow">in</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;stream_list&#39;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span>


        <span class="c1">## kappa strange (in integer form)</span>
        <span class="k">if</span> <span class="s1">&#39;Csw&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">Csw</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;Csw&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Csw</span> <span class="o">=</span> <span class="s1">&#39;C1715&#39;</span>
        <span class="c1">## kappa strange (in integer form)</span>
        <span class="k">if</span> <span class="s1">&#39;Beta&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">Beta</span> <span class="o">=</span> <span class="s1">&#39;B&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;Beta&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Beta</span> <span class="o">=</span> <span class="s1">&#39;B1900&#39;</span>


        <span class="n">fileism</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ism</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;ism&#39;</span><span class="p">,</span><span class="s1">&#39;sm&#39;</span><span class="p">)</span>
        <span class="n">filejsm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jsm</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;jsm&#39;</span><span class="p">,</span><span class="s1">&#39;sm&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kappafolder</span> <span class="o">=</span> <span class="s1">&#39;Kud0&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kud</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;kud&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Ks0&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ks</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;ks&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kappafolder2</span> <span class="o">=</span> <span class="s1">&#39;Kud0&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kud</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;kud&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;Ks0&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ks</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;ks&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">readfilename</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Beta</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kappafolder</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Csw</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;_k&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kud</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;kud&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">tsrc</span><span class="o">+</span><span class="n">fileism</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">filejsm</span><span class="o">+</span><span class="s1">&#39;GMA&#39;</span>
                            <span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ProjNumb</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tsink</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filepp</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="o">+</span><span class="s1">&#39;NDer0.3cf&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readfilename2</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Beta</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kappafolder2</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Csw</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;_k&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kud</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;kud&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                            <span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">tsrc</span><span class="o">+</span><span class="n">fileism</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">filejsm</span><span class="o">+</span><span class="s1">&#39;GMA&#39;</span>
                            <span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ProjNumb</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tsink</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filepp</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="o">+</span><span class="s1">&#39;NDer0.3cf&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readfilename3</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Beta</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kappafolder2</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Csw</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;_k1382500_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">tsrc</span><span class="o">+</span><span class="n">fileism</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">filejsm</span><span class="o">+</span><span class="s1">&#39;GMA&#39;</span>
                            <span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ProjNumb</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tsink</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filepp</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="o">+</span><span class="s1">&#39;NDer0.3cf&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">cfundir</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kappafolder</span><span class="o">+</span><span class="s1">&#39;_AY&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filedir</span> <span class="o">=</span> <span class="n">cfundir</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kappafolder</span><span class="o">+</span><span class="s1">&#39;_AY/threept/&#39;</span><span class="o">+</span><span class="n">fileism</span><span class="o">+</span><span class="n">filejsm</span><span class="o">+</span><span class="s1">&#39;GMA&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ProjNumb</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tsink</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filepp</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">cfundir</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kappafolder</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filedir</span> <span class="o">=</span> <span class="n">cfundir</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kappafolder</span><span class="o">+</span><span class="s1">&#39;/threept/&#39;</span><span class="o">+</span><span class="n">fileism</span><span class="o">+</span><span class="n">filejsm</span><span class="o">+</span><span class="s1">&#39;GMA&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ProjNumb</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tsink</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filepp</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">cfundir</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kappafolder</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;directory not found, using instead:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">cfundir</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kappafolder</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filedir</span> <span class="o">=</span> <span class="n">cfundir</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kappafolder</span><span class="o">+</span><span class="s1">&#39;/threept/&#39;</span><span class="o">+</span><span class="n">fileism</span><span class="o">+</span><span class="n">filejsm</span><span class="o">+</span><span class="s1">&#39;GMA&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ProjNumb</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tsink</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filepp</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>

        <span class="c1">## cfglist { configuration : [ x-source numbers ] }</span>


        <span class="c1">## is needed?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Info</span> <span class="o">=</span> <span class="n">Info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span> <span class="o">=</span> <span class="n">cfglist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetCustomName</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">stringfn</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">man_load_cfgs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LoadCfgs</span><span class="p">(</span><span class="n">cfglist</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">filename</span><span class="p">)</span>

<div class="viewcode-block" id="ThreePointCorr.LoadCfgs"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.LoadCfgs">[docs]</a>    <span class="k">def</span> <span class="nf">LoadCfgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cfglist</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cfglist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GetCfgList</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">cfglist</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetCustomName</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">stringfn</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span></div>


<div class="viewcode-block" id="ThreePointCorr.GetDSCfgList"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.GetDSCfgList">[docs]</a>    <span class="k">def</span> <span class="nf">GetDSCfgList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">thisInfo</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">)</span>
        <span class="n">thisInfo</span><span class="p">[</span><span class="s1">&#39;DoubSing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;doub&#39;</span>
        <span class="n">doubclass</span> <span class="o">=</span> <span class="n">ThreePointCorr</span><span class="p">(</span><span class="n">thisnboot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">,</span> <span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span><span class="p">,</span>
                                        <span class="n">Info</span><span class="o">=</span><span class="n">thisInfo</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;DoubSing&#39;</span><span class="p">],</span><span class="s1">&#39;doub&#39;</span><span class="p">)</span>
                                        <span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;DoubSing&#39;</span><span class="p">],</span><span class="s1">&#39;doub&#39;</span><span class="p">))</span>

        <span class="n">thisInfo</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">)</span>
        <span class="n">thisInfo</span><span class="p">[</span><span class="s1">&#39;DoubSing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;sing&#39;</span>
        <span class="n">singclass</span> <span class="o">=</span> <span class="n">ThreePointCorr</span><span class="p">(</span><span class="n">thisnboot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">,</span> <span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span><span class="p">,</span>
                                        <span class="n">Info</span><span class="o">=</span><span class="n">thisInfo</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;DoubSing&#39;</span><span class="p">],</span><span class="s1">&#39;sing&#39;</span><span class="p">)</span>
                                        <span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;DoubSing&#39;</span><span class="p">],</span><span class="s1">&#39;sing&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">CombineCfgs</span><span class="p">(</span><span class="n">doubclass</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">,</span><span class="n">singclass</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">))</span></div>


<div class="viewcode-block" id="ThreePointCorr.GetCfgList"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.GetCfgList">[docs]</a>    <span class="k">def</span> <span class="nf">GetCfgList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">SplitCfgSrc</span><span class="p">(</span><span class="n">ifile</span><span class="p">):</span>
            <span class="n">isrc</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;_xsrc.*_k&#39;</span><span class="p">,</span><span class="n">ifile</span><span class="p">)</span>
            <span class="n">icfg</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;-.-00.*_xsrc&#39;</span><span class="p">,</span><span class="n">ifile</span><span class="p">)</span>
            <span class="n">istream</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;-.-&#39;</span><span class="p">,</span><span class="n">ifile</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">isrc</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">icfg</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: file does not have xsrc or -.-####### (source or cfg number)&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">ifile</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">()</span>
                <span class="k">return</span> <span class="s1">&#39;-ERROR-&#39;</span><span class="p">,</span><span class="s1">&#39;xsrc-1&#39;</span><span class="p">,</span><span class="mi">0</span>
            <span class="n">isrc</span> <span class="o">=</span> <span class="n">isrc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">icfg</span> <span class="o">=</span> <span class="n">icfg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_xsrc&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)[</span><span class="mi">5</span><span class="p">:]</span>
            <span class="n">istream</span> <span class="o">=</span> <span class="n">istream</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># return istream,isrc,icfg,int(icfg),int(isrc.replace(&#39;xsrc&#39;,&#39;&#39;))</span>
            <span class="k">return</span> <span class="n">istream</span><span class="p">,</span><span class="n">isrc</span><span class="p">,</span><span class="n">icfg</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DS</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;doub&#39;</span><span class="p">,</span><span class="s1">&#39;sing&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GetDSCfgList</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="n">cfg_dict</span> <span class="o">=</span> <span class="n">ODNested</span><span class="p">()</span>
        <span class="n">this_check</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span>
        <span class="k">for</span> <span class="n">ifile</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filedir</span><span class="o">+</span><span class="s1">&#39;/*&#39;</span><span class="p">):</span>
            <span class="n">istream</span><span class="p">,</span><span class="n">ixsrc</span><span class="p">,</span><span class="n">icfg</span> <span class="o">=</span> <span class="n">SplitCfgSrc</span><span class="p">(</span><span class="n">ifile</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">this_check</span> <span class="ow">or</span> <span class="n">istream</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;ERROR&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">istream</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">istream</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">cfg_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">or</span> <span class="n">icfg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">cfg_dict</span><span class="p">[</span><span class="n">istream</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">cfg_dict</span><span class="p">[</span><span class="n">istream</span><span class="p">][</span><span class="n">icfg</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ixsrc</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cfg_dict</span><span class="p">[</span><span class="n">istream</span><span class="p">][</span><span class="n">icfg</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ixsrc</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cfg_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no configs found in &#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filedir</span><span class="p">)</span>

        <span class="n">cfglist</span><span class="p">,</span><span class="n">xsrclist</span><span class="p">,</span><span class="n">ilist</span> <span class="o">=</span> <span class="p">[],[],[]</span>
        <span class="n">this_lambda</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">ix</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">ix</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;xsrc&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">istream</span><span class="p">,</span><span class="n">stream_dict</span> <span class="ow">in</span> <span class="n">cfg_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">icfg</span><span class="p">,(</span><span class="n">the_cfg</span><span class="p">,</span><span class="n">ixsrc_list</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stream_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">istream</span><span class="p">,</span><span class="n">icfg</span><span class="p">))</span>
                <span class="n">cfglist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">the_cfg</span><span class="p">)</span>
                <span class="c1">## sorting xsrc list with respect to its INTEGER value (not string sort!)</span>
                <span class="n">ixsrc_int_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">this_lambda</span><span class="p">,</span><span class="n">ixsrc_list</span><span class="p">))</span>
                <span class="n">xsrclist</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ix</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">ix</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">ixsrc_int_list</span><span class="p">,</span><span class="n">ixsrc_list</span><span class="p">))])</span>
        <span class="c1">## finds cfgs and xsrcs conbinations that are in all streams.</span>
        <span class="c1">##MAKE SURE TO ORDER CFG AND SRC</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s1">&#39;No configs found for </span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;stream&#39;</span><span class="p">,</span><span class="s1">&#39;config_number&#39;</span><span class="p">])</span>
        <span class="n">cfg_df</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cfglist</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;configs&#39;</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
        <span class="n">cfg_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">xsrclist</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
        <span class="n">cfg_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;int_configs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="n">cfglist</span><span class="p">)),</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
        <span class="n">cfg_df</span> <span class="o">=</span> <span class="n">cfg_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;int_configs&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;stream&#39;</span><span class="p">,</span><span class="n">sort_remaining</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">cfg_df</span><span class="p">[</span><span class="s1">&#39;int_configs&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">cfg_df</span><span class="p">)</span></div>

    <span class="c1"># def MakeOutputFile(self):</span>
    <span class="c1">#     self.name = &#39;_&#39;.join([self.tsrc,self.ism,self.jsm])</span>
    <span class="c1">#     self.HumanFile = &#39;/&#39;+self.kappafolder+&#39;/G2/&#39;+self.name+&#39;.xml&#39;</span>
    <span class="c1">#     self.PickleFile = &#39;/&#39;+self.kappafolder+&#39;/G2/Pickle/&#39;+self.name+&#39;.py3p&#39;</span>

    <span class="c1">#self.C3 = [ igamma , ip , it , iconf ]</span>
<div class="viewcode-block" id="ThreePointCorr.WriteCfgsToFile"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.WriteCfgsToFile">[docs]</a>    <span class="k">def</span> <span class="nf">WriteCfgsToFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thisdir</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">thisoutdir</span> <span class="o">=</span> <span class="n">thisdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kappafolder</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">tsrc</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tsink</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ism</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">jsm</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ppform</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
        <span class="c1"># for igamma,gammadata in zip(self.gammalist,self.C3_cfgs[&#39;C3&#39;]):</span>
        <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span><span class="n">linklist</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;configs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">gammalist</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Writing 3-ptCorrs &#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">((</span><span class="n">istream</span><span class="p">,</span><span class="n">iccfg</span><span class="p">),</span><span class="n">cfgdata</span><span class="p">),</span><span class="n">icfg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;C3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span><span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;configs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">icgamma</span><span class="p">,</span><span class="n">gammadata</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cfgdata</span><span class="p">):</span>
                <span class="n">igamma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gammalist</span><span class="p">[</span><span class="n">icgamma</span><span class="p">]</span>
                <span class="n">insidedir</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">Proj</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span><span class="n">igamma</span><span class="p">])</span>
                <span class="n">mkdir_p</span><span class="p">(</span><span class="n">thisoutdir</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">insidedir</span><span class="p">)</span>
                <span class="n">cfgstr</span> <span class="o">=</span> <span class="n">istream</span><span class="o">+</span><span class="s1">&#39;cfg&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icfg</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                <span class="n">thisfile</span> <span class="o">=</span> <span class="n">thisoutdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">insidedir</span> <span class="o">+</span> <span class="s1">&#39;/C3&#39;</span><span class="o">+</span><span class="n">cfgstr</span><span class="o">+</span><span class="s1">&#39;.xml&#39;</span>
                <span class="n">dictout</span> <span class="o">=</span> <span class="n">ODNested</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">iq</span><span class="p">,</span><span class="n">qdata</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmom</span><span class="p">,</span><span class="n">gammadata</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">it</span><span class="p">,</span><span class="n">tdata</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">qdata</span><span class="p">):</span>
                        <span class="n">itstr</span> <span class="o">=</span> <span class="n">tstr</span><span class="p">(</span><span class="n">it</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">dictout</span><span class="p">[</span><span class="n">iq</span><span class="p">][</span><span class="n">itstr</span><span class="p">]</span> <span class="o">=</span> <span class="n">tdata</span>
                <span class="n">WriteXml</span><span class="p">(</span><span class="n">thisfile</span><span class="p">,{</span><span class="s1">&#39;Results&#39;</span><span class="p">:{</span><span class="n">insidedir</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">cfgstr</span><span class="p">:</span><span class="n">dictout</span><span class="p">}})</span>
                <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span><span class="o">.</span><span class="n">Lap</span><span class="p">((</span><span class="n">istream</span><span class="p">,</span><span class="n">icfg</span><span class="p">,</span><span class="n">igamma</span><span class="p">))</span></div>

<div class="viewcode-block" id="ThreePointCorr.SetCustomName"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.SetCustomName">[docs]</a>    <span class="k">def</span> <span class="nf">SetCustomName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">stringfn</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">stringLL</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;stream_name&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="s1">&#39;-def-&#39;</span>
        <span class="k">if</span> <span class="n">string</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="c1"># self.name = &#39;_&#39;.join([self.kappafolder,self.Proj,&#39;_&#39;.join(self.gammalist),self.DS,</span>
            <span class="c1">#                       self.ppform,self.tsrc,self.tsink,self.ism,self.jsm])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kappafolder</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Proj</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gammalist</span><span class="p">),</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qform</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ppform</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tsrc</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tsink</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ism</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">jsm</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">string</span>
        <span class="k">if</span> <span class="n">stringfn</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="c1"># self.filename = &#39;_&#39;.join([self.tsrc,self.tsink,self.ism,self.jsm])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kappafolder</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Proj</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gammalist</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">ppform</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">qform</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">tsrc</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tsink</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ism</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">jsm</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">stringfn</span>
        <span class="k">if</span> <span class="n">stringLL</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span> <span class="o">=</span> <span class="s1">&#39;$&#39;</span><span class="o">+</span><span class="s1">&#39;\ &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_ll</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">GetPionMassLab</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ism</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">jsm</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">qform</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span><span class="o">+</span><span class="s1">&#39;$&#39;</span> <span class="c1">## customise this how you like</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span> <span class="o">=</span> <span class="n">stringLL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SubDir</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">Proj</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ppform</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fo_for_cfgs</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">G3dir</span> <span class="o">=</span> <span class="n">outputdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kappafolder</span><span class="o">+</span><span class="s1">&#39;/G3/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">fo_for_cfgs</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">SubDir</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">G3Cfgdir</span> <span class="o">=</span> <span class="n">cfgfmtdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kappafolder</span><span class="o">+</span><span class="s1">&#39;/G3/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">fo_for_cfgs</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">SubDir</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">G3dir</span> <span class="o">=</span> <span class="n">outputdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kappafolder</span><span class="o">+</span><span class="s1">&#39;/G3/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">SubDir</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">G3Cfgdir</span> <span class="o">=</span> <span class="n">cfgfmtdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kappafolder</span><span class="o">+</span><span class="s1">&#39;/G3/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">SubDir</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
        <span class="n">mkdir_p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G3dir</span><span class="o">+</span><span class="s1">&#39;/Pickle/&#39;</span><span class="p">)</span>
        <span class="n">mkdir_p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G3dir</span><span class="o">+</span><span class="s1">&#39;/Excel/&#39;</span><span class="p">)</span>
        <span class="n">mkdir_p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G3Cfgdir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G3dir</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.xml&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G3dir</span><span class="o">+</span><span class="s1">&#39;/Excel/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.xlsx&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G3dir</span><span class="o">+</span><span class="s1">&#39;/Pickle/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.py3p&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CfgFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G3Cfgdir</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">qform</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gammalist</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.cfgs&#39;</span></div>


<div class="viewcode-block" id="ThreePointCorr.ImportCfgList"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.ImportCfgList">[docs]</a>    <span class="k">def</span> <span class="nf">ImportCfgList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cfgsrclist</span><span class="p">,</span><span class="n">stream_list</span> <span class="o">=</span> <span class="s1">&#39;PreDefine&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfgsrclist</span><span class="p">,</span><span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stream_list</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span> <span class="o">=</span> <span class="n">stream_list</span>
            <span class="c1">## cfgsrclist is [cfglist , xsrclist]</span>
            <span class="c1">## cfglist must be 2-d array, first dimension is stream, second dimension is configuraiton number</span>
            <span class="c1">## xsrclist is 3-d array, first dimension is stream, second dimension is cfg number, third is xsrc number</span>
            <span class="c1">## xsrclist must have values &#39;xsrc##&#39; with no zero pre buffering</span>
            <span class="n">ilist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">xsrc_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">istream</span><span class="p">,(</span><span class="n">is_cfg</span><span class="p">,</span><span class="n">is_xsrc</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">cfgsrclist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cfgsrclist</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                <span class="k">for</span> <span class="n">icf</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">is_cfg</span><span class="p">):</span>
                    <span class="n">xsrc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">is_xsrc</span><span class="p">)</span>
                    <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">istream</span><span class="p">,</span><span class="n">is_cfg</span><span class="p">))</span>
            <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;stream&#39;</span><span class="p">,</span><span class="s1">&#39;config_number&#39;</span><span class="p">])</span>
            <span class="n">cfg_df</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cfgsrclist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;configs&#39;</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="n">cfg_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">xsrc_list</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span> <span class="o">=</span> <span class="n">cfg_df</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span> <span class="o">=</span> <span class="n">cfgsrclist</span>
        <span class="k">if</span> <span class="s1">&#39;configs&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;stream_cfgs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;00&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">istream</span><span class="p">,</span><span class="n">icfg</span><span class="p">))</span> <span class="k">for</span> <span class="p">(</span><span class="n">istream</span><span class="p">,</span><span class="n">iccfg</span><span class="p">),</span><span class="n">icfg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;configs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Update_Stream_List</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ncfg_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">icfg</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">istream</span><span class="p">,</span><span class="n">icfg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;configs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;stream&#39;</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xsrcAvg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nMeas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xsrcAvg</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ncfg_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span></div>

<div class="viewcode-block" id="ThreePointCorr.Update_Stream_List"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.Update_Stream_List">[docs]</a>    <span class="k">def</span> <span class="nf">Update_Stream_List</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;configs&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nstream</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;stream_name&#39;</span><span class="p">):</span>
                <span class="n">old_sn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">istr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">istr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;-&#39;</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;filename&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old_sn</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old_sn</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;LegLab&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old_sn</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">istr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">istr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;-&#39;</span></div>

<div class="viewcode-block" id="ThreePointCorr.Stats"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.Stats">[docs]</a>    <span class="k">def</span> <span class="nf">Stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_Stats</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">lAvg</span><span class="p">,</span><span class="n">lStd</span> <span class="o">=</span> <span class="p">[],[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">),</span><span class="n">iC3</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">iC3</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
            <span class="n">lAvg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iC3</span><span class="o">.</span><span class="n">Avg</span><span class="p">)</span>
            <span class="n">lStd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iC3</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
        <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3_Stats</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C3_Col_Names</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lAvg</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lStd</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span></div>



<div class="viewcode-block" id="ThreePointCorr.RemoveVals"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.RemoveVals">[docs]</a>    <span class="k">def</span> <span class="nf">RemoveVals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;C3&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">:</span> <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;C3&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;C2&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">:</span> <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;C2&#39;</span><span class="p">]</span></div>

    <span class="c1">## self.C3 = [ igamma , ip, it , iconf ]</span>
<div class="viewcode-block" id="ThreePointCorr.Read"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.Read">[docs]</a>    <span class="k">def</span> <span class="nf">Read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">Full</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">file_type</span><span class="o">=</span><span class="s1">&#39;PreDef&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DS</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;doub&#39;</span><span class="p">,</span><span class="s1">&#39;sing&#39;</span><span class="p">]:</span> <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Read_Cfgs</span><span class="p">(</span><span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">,</span><span class="n">Full</span><span class="o">=</span><span class="n">Full</span><span class="p">):</span> <span class="k">return</span>
        <span class="c1">## making interpolator number more human readable</span>
        <span class="n">thisdata</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">prop_src</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">## this part isnt really nessisary, maybe later when we implement operator overloaing more precisly.</span>
        <span class="c1"># if len(self.filename.split(&#39;_&#39;)) &gt; 4:</span>
        <span class="c1">#     raise IOError(&#39;Do not read after combining correlators, please recreate the correlator&#39;)</span>
        <span class="n">fix_file_size</span> <span class="o">=</span> <span class="s1">&#39;RC32x64&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span> <span class="ow">and</span> <span class="s1">&#39;13754&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kud</span> <span class="ow">and</span> <span class="s1">&#39;1364&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ks</span>
        <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span><span class="n">linklist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;stream_cfgs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Reading 3-ptCorrs &#39;</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qform</span><span class="p">),</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i_stream_cfg</span><span class="p">,</span><span class="n">ixsrc_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;stream_cfgs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
            <span class="n">thisxsrclist</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">filedir</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">readfilename</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">i_stream_cfg</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">readfilename</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ixsrc</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">readfilename</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">ixsrc</span> <span class="ow">in</span> <span class="n">ixsrc_list</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">thisxsrclist</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">thisxsrclist</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">filedir</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">readfilename2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">i_stream_cfg</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">readfilename2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ixsrc</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">readfilename2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">ixsrc</span> <span class="ow">in</span> <span class="n">ixsrc_list</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">thisxsrclist</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">thisxsrclist</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">filedir</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">readfilename3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">i_stream_cfg</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">readfilename3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ixsrc</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">readfilename3</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">ixsrc</span> <span class="ow">in</span> <span class="n">ixsrc_list</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">Full</span><span class="p">:</span>
                <span class="n">idata</span> <span class="o">=</span> <span class="n">RC3Full</span><span class="p">(</span><span class="n">thisxsrclist</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">qmom</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">gammalist</span><span class="p">,</span><span class="n">forcent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">,</span><span class="n">check_fs</span><span class="o">=</span><span class="n">fix_file_size</span><span class="p">)</span>
                <span class="n">thisdata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idata</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                <span class="n">prop_src</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ifinfo</span><span class="p">[</span><span class="s1">&#39;tsource&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">ifinfo</span> <span class="ow">in</span> <span class="n">idata</span><span class="o">.</span><span class="n">f_info</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thisdata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReadFSCfunPickCHROMA</span><span class="p">(</span><span class="n">thisxsrclist</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">qmom</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">gammalist</span><span class="p">,</span><span class="n">forcent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">,</span><span class="n">check_fs</span><span class="o">=</span><span class="n">fix_file_size</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span><span class="o">.</span><span class="n">Lap</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">Full</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;tsrc_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">prop_src</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;C3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">thisdata</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Write_Cfgs</span><span class="p">(</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">,</span><span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThreePointCorr.Bootstrap"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.Bootstrap">[docs]</a>    <span class="k">def</span> <span class="nf">Bootstrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">WipeData</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DS</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;doub&#39;</span><span class="p">,</span><span class="s1">&#39;sing&#39;</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LoadDS</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;reading doublet and singlet failed, reading with wipeing now&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LoadDS</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;C3&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Read</span><span class="p">()</span>
            <span class="n">lC3</span><span class="p">,</span><span class="n">lC3Avg</span><span class="p">,</span><span class="n">lC3Std</span> <span class="o">=</span> <span class="p">[],[],[]</span>
            <span class="n">ilist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">rlist</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span>   <span class="n">linklist</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gammalist</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">qform</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">nt</span><span class="p">))],</span>
                                                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;BS C3 &#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">icgamma</span><span class="p">,</span><span class="n">igamma</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gammalist</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">icp</span><span class="p">,</span><span class="n">ip</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qform</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">nt</span><span class="p">):</span>
                        <span class="n">strit</span> <span class="o">=</span> <span class="n">tstr</span><span class="p">(</span><span class="n">it</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">strit</span><span class="p">))</span>
                        <span class="n">this_lambda</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">icgamma</span><span class="p">][</span><span class="n">icp</span><span class="p">][</span><span class="n">it</span><span class="p">]</span>
                        <span class="n">tdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;C3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">this_lambda</span><span class="p">)</span>
                        <span class="n">thisboot</span> <span class="o">=</span> <span class="n">BootStrap</span><span class="p">(</span>   <span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;G_</span><span class="si">{3}</span><span class="s1">(&#39;</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">strit</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">,</span>
                                                <span class="n">cfgvals</span><span class="o">=</span><span class="n">tdata</span><span class="p">,</span><span class="n">rand_list</span><span class="o">=</span><span class="n">rlist</span><span class="p">)</span>
                        <span class="n">rlist</span> <span class="o">=</span> <span class="n">thisboot</span><span class="o">.</span><span class="n">Get_Rand_List</span><span class="p">()</span>
                        <span class="n">lC3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisboot</span><span class="p">)</span>
                        <span class="n">lC3Avg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisboot</span><span class="o">.</span><span class="n">Avg</span><span class="p">)</span>
                        <span class="n">lC3Std</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisboot</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span><span class="o">.</span><span class="n">Lap</span><span class="p">((</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">strit</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C3_Col_Names</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C3_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lC3</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C3_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lC3Avg</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C3_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lC3Std</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">WipeData</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">RemoveVals</span><span class="p">()</span></div>




    <span class="c1"># def ReadAndBoot(self):</span>
    <span class="c1">#     self.Read()</span>
    <span class="c1">#     self.Bootstrap()</span>

<div class="viewcode-block" id="ThreePointCorr.ImportFitRanges"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.ImportFitRanges">[docs]</a>    <span class="k">def</span> <span class="nf">ImportFitRanges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fit_ranges</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_ranges</span> <span class="o">=</span> <span class="n">fit_ranges</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_ranges</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_ranges</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_ranges</span><span class="p">]</span></div>


    <span class="c1">## you can either just pass in the two point correlator class instance</span>
    <span class="c1">## or pass in a bootstrapped parameters list</span>
    <span class="c1">## or just pass in average values</span>
<div class="viewcode-block" id="ThreePointCorr.ImportTwoPtFits"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.ImportTwoPtFits">[docs]</a>    <span class="k">def</span> <span class="nf">ImportTwoPtFits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">sourcepars</span><span class="p">,</span><span class="n">sinkpars</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TwoPtPars</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">iq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">qform</span><span class="p">:</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="n">iq</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">,</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TwoPtPars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetTwoPtPars</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">sourcepars</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetTwoPtPars</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">sinkpars</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span></div>


<div class="viewcode-block" id="ThreePointCorr.GetTwoPtPars"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.GetTwoPtPars">[docs]</a>    <span class="k">def</span> <span class="nf">GetTwoPtPars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">pars</span><span class="p">,</span><span class="n">fitr</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span><span class="n">TwoPointCorr</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;state&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
                <span class="n">thisstate</span> <span class="o">=</span> <span class="s1">&#39;state&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>


            <span class="k">if</span> <span class="n">fitr</span> <span class="o">==</span> <span class="s1">&#39;first&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="n">ip</span><span class="p">)</span> <span class="ow">in</span> <span class="n">pars</span><span class="o">.</span><span class="n">C2_Fit_Stats</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                <span class="n">fitr_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pars</span><span class="o">.</span><span class="n">C2_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">][</span><span class="n">thisstate</span><span class="p">,</span><span class="n">ip</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fitr_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;More than 1 fit parameter found in two point correlator fit parameters, &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;choosing &#39;</span><span class="p">,</span><span class="n">fitr_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">return</span> <span class="n">pars</span><span class="o">.</span><span class="n">C2_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">][</span><span class="n">thisstate</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">fitr_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">fitr</span><span class="p">)</span> <span class="ow">in</span> <span class="n">pars</span><span class="o">.</span><span class="n">C2_Fit_Stats</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pars</span><span class="o">.</span><span class="n">C2_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">][</span><span class="n">thisstate</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">fitr</span><span class="p">]</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span><span class="n">ff</span><span class="o">.</span><span class="n">Fitting</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">pars</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;Params&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">BootStrap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">,</span><span class="n">bootvals</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">ipar</span><span class="p">)]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">)</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;two point fit parameters not recognised&#39;</span><span class="p">)</span></div>

    <span class="c1">## fit_ranges is list of fit ranges to fit the correlator to</span>
    <span class="c1">## formatted as fitr#-# where # are the min and max fit values.</span>
    <span class="c1">## states correspond to how many states to fit to (currenlty only working for states = 1 or 2)</span>
    <span class="c1">## C2pars is list of size 2, containing source and sink fit parameters used in the three point correlator fits</span>
    <span class="c1">## C2pars can be class instances of TwoPointCorr, Fitting, or just a list of values.</span>
    <span class="c1">## Word of caution, the bootstraps need to have been constructed with the same configurations.</span>
    <span class="c1">## Best to have this run from RatioFunction class only.</span>
<div class="viewcode-block" id="ThreePointCorr.Fit"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.Fit">[docs]</a>    <span class="k">def</span> <span class="nf">Fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">C2pars</span><span class="o">=</span><span class="s1">&#39;PreDef&#39;</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="s1">&#39;PreDef&#39;</span><span class="p">,</span><span class="n">fit_ranges</span><span class="o">=</span><span class="s1">&#39;PreDef&#39;</span><span class="p">,</span><span class="n">iGuess</span><span class="o">=</span><span class="s1">&#39;PreDef&#39;</span><span class="p">,</span><span class="n">EstDir</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">WipeFit</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">RunPredefFits</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;PreDef&#39;</span> <span class="ow">and</span> <span class="n">fit_ranges</span> <span class="o">==</span> <span class="s1">&#39;PreDef&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">izip</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PredefFits</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">izip</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">C2pars</span><span class="o">=</span><span class="n">C2pars</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="n">izip</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fit_ranges</span><span class="o">=</span><span class="p">[</span><span class="n">izip</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">EstDir</span><span class="o">=</span><span class="n">EstDir</span><span class="p">,</span><span class="n">WipeFit</span><span class="o">=</span><span class="n">WipeFit</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">C2pars</span><span class="o">=</span><span class="n">C2pars</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="n">izip</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fit_ranges</span><span class="o">=</span><span class="p">[</span><span class="n">izip</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">iGuess</span><span class="o">=</span><span class="n">izip</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">EstDir</span><span class="o">=</span><span class="n">EstDir</span><span class="p">,</span><span class="n">WipeFit</span><span class="o">=</span><span class="n">WipeFit</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;PreDef&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">izip</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PredefFits</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">izip</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">fit_ranges</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">izip</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">C2pars</span><span class="o">=</span><span class="n">C2pars</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="n">izip</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fit_ranges</span><span class="o">=</span><span class="p">[</span><span class="n">izip</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">EstDir</span><span class="o">=</span><span class="n">EstDir</span><span class="p">,</span><span class="n">WipeFit</span><span class="o">=</span><span class="n">WipeFit</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">C2pars</span><span class="o">=</span><span class="n">C2pars</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="n">izip</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fit_ranges</span><span class="o">=</span><span class="p">[</span><span class="n">izip</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">iGuess</span><span class="o">=</span><span class="n">izip</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">EstDir</span><span class="o">=</span><span class="n">EstDir</span><span class="p">,</span><span class="n">WipeFit</span><span class="o">=</span><span class="n">WipeFit</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">fit_ranges</span> <span class="o">==</span> <span class="s1">&#39;PreDef&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">izip</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PredefFits</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">izip</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">state</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">izip</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">C2pars</span><span class="o">=</span><span class="n">C2pars</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="n">izip</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fit_ranges</span><span class="o">=</span><span class="p">[</span><span class="n">izip</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">EstDir</span><span class="o">=</span><span class="n">EstDir</span><span class="p">,</span><span class="n">WipeFit</span><span class="o">=</span><span class="n">WipeFit</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">C2pars</span><span class="o">=</span><span class="n">C2pars</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="n">izip</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fit_ranges</span><span class="o">=</span><span class="p">[</span><span class="n">izip</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">iGuess</span><span class="o">=</span><span class="n">izip</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">EstDir</span><span class="o">=</span><span class="n">EstDir</span><span class="p">,</span><span class="n">WipeFit</span><span class="o">=</span><span class="n">WipeFit</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;PreDef&#39;</span> <span class="ow">in</span> <span class="p">[</span><span class="n">state</span><span class="p">,</span><span class="n">fit_ranges</span><span class="p">]:</span>
            <span class="n">RunPredefFits</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">iGuess</span> <span class="o">!=</span> <span class="s1">&#39;PreDef&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span> <span class="o">=</span> <span class="n">iGuess</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;state&#39;</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">state</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">C2pars</span> <span class="o">!=</span> <span class="s1">&#39;PreDef&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImportTwoPtFits</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="n">C2pars</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">C2pars</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImportFitRanges</span><span class="p">(</span><span class="n">fit_ranges</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># thisfitfun = C3OneStateFitFunNoExp</span>
            <span class="n">thisfitfun</span> <span class="o">=</span> <span class="n">C3OneStateFitFunNoExp</span>
            <span class="n">npar</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># thisfitfun = C3TwoStateFitFunNoExp</span>
            <span class="n">thisfitfun</span> <span class="o">=</span> <span class="n">C3MomTwoStateFitFunNoExp</span>
            <span class="n">npar</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">elif</span> <span class="n">state</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;fitting state is only implemented up to 2 state so far. Cannot do &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>
        <span class="n">ststr</span> <span class="o">=</span> <span class="s1">&#39;state&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="n">legstate</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;SF&#39;</span>
        <span class="n">lFit</span><span class="p">,</span><span class="n">lFitA</span><span class="p">,</span><span class="n">lFitS</span> <span class="o">=</span> <span class="p">[],[],[]</span>
        <span class="n">ilist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">igamma</span><span class="p">,</span><span class="n">gammadata</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;current_operator&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">pdata</span><span class="p">),</span><span class="n">ptwopt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gammadata</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;momentum&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">TwoPtPars</span><span class="p">):</span>
                <span class="c1"># print &#39;Fitting state&#39;,str(state) , &#39; &#39; , ifit</span>
                <span class="k">for</span> <span class="n">ifit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_ranges</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">ststr</span><span class="p">,</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">ifit</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_Fit_Stats</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">WipeFit</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">C3_Fit_Stats</span><span class="o">.</span><span class="n">drop</span><span class="p">([(</span><span class="n">ststr</span><span class="p">,</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">ifit</span><span class="p">)],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">continue</span>
                    <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ststr</span><span class="p">,</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">ifit</span><span class="p">))</span>
                    <span class="n">ifitmin</span><span class="p">,</span><span class="n">ifitmax</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="n">unxmlfitr</span><span class="p">(</span><span class="n">ifit</span><span class="p">)))</span>
                    <span class="c1"># print &#39;     Fitting &#39;, ip</span>
                    <span class="c1">## is this the right ordering of dictionary dimensions?</span>
                    <span class="n">tdatarange</span> <span class="o">=</span> <span class="p">[[]]</span>
                    <span class="n">ydata</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">it</span><span class="p">,</span><span class="n">tdata</span> <span class="ow">in</span> <span class="n">pdata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">tint</span> <span class="o">=</span> <span class="n">untstr</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">ifitmin</span> <span class="o">&lt;=</span> <span class="n">tint</span> <span class="o">&lt;=</span> <span class="n">ifitmax</span><span class="p">:</span>
                            <span class="n">tcurrboot</span> <span class="o">=</span> <span class="n">BootStrap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">,</span><span class="n">bootvals</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">tint</span><span class="p">)]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">)</span>
                            <span class="n">tdatarange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tcurrboot</span><span class="p">)</span>
                            <span class="n">ydata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tdata</span><span class="p">)</span>
                    <span class="n">thistlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tdatarange</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="c1">## this + 3 is just calabrated from looking at the conserved current two- and three- point correlators. Not sure why exactly.</span>
                    <span class="n">tsinkboot</span> <span class="o">=</span> <span class="n">BootStrap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">,</span><span class="n">bootvals</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tsink</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;tsink&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">)</span>
                    <span class="n">tdatarange</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">tsinkboot</span><span class="p">]</span><span class="o">*</span><span class="n">thistlen</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">iparam</span> <span class="ow">in</span> <span class="n">ptwopt</span><span class="p">:</span>
                        <span class="n">tdatarange</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">iparam</span><span class="p">]</span><span class="o">*</span><span class="n">thistlen</span><span class="p">)</span>

                    <span class="c1"># print &#39;DEBUG&#39;</span>
                    <span class="c1"># for it,iy in zip(np.rollaxis(np.array(tdatarange),1),ydata):</span>
                    <span class="c1">#     print it[0].Avg,it[1].Avg,it[2].Avg,it[3].Avg,it[4].Avg,it[5].Avg,iy.Avg</span>

                    <span class="k">if</span> <span class="n">EstDir</span><span class="p">:</span>
                        <span class="n">thisff</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">Fitting</span><span class="p">(</span><span class="n">Funs</span><span class="o">=</span><span class="p">[</span><span class="n">thisfitfun</span><span class="p">,</span><span class="n">npar</span><span class="p">,</span><span class="s1">&#39;Estimate&#39;</span><span class="p">],</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">tdatarange</span><span class="p">,</span><span class="n">ydata</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">legstate</span><span class="p">,</span><span class="n">ifit</span><span class="p">]),</span><span class="n">iGuess</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">thisff</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">Fitting</span><span class="p">(</span><span class="n">Funs</span><span class="o">=</span><span class="p">[</span><span class="n">thisfitfun</span><span class="p">,</span><span class="n">npar</span><span class="p">],</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">tdatarange</span><span class="p">,</span><span class="n">ydata</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">legstate</span><span class="p">,</span><span class="n">ifit</span><span class="p">]),</span><span class="n">iGuess</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span><span class="p">)</span>
                    <span class="n">thistest</span> <span class="o">=</span> <span class="n">thisff</span><span class="o">.</span><span class="n">FitBoots</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">thistest</span><span class="p">):</span>
                        <span class="n">lFit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisff</span><span class="p">)</span>
                        <span class="n">lFitA</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisff</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;ParamsAvg&#39;</span><span class="p">])</span>
                        <span class="n">lFitS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisff</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;ParamsStd&#39;</span><span class="p">])</span>
        <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C3_Fit_Col_Names</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_Fit_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">this_df</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="n">this_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lFit</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="n">this_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lFitA</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="n">this_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lFitS</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C3_Fit_Stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_Fit_Stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_df</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C3_Fit_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lFit</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C3_Fit_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lFitA</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C3_Fit_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lFitS</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>

                    <span class="c1"># self.FitDict[ststr][igamma][ip][ifit] = thisff</span>
                    <span class="c1"># self.FitDictAvg[ststr][igamma][ip][ifit] = thisff.ParamsAvg</span>
                    <span class="c1"># self.FitDictStd[ststr][igamma][ip][ifit] = thisff.ParamsStd</span>
                    <span class="c1">#</span>
                    <span class="c1"># if state == 1:</span>
                    <span class="c1">#     self.FitDictAvg[ststr][igamma][ip][ifit][&#39;A_Ep&#39;] = ptwopt[0].Avg</span>
                    <span class="c1">#     self.FitDictStd[ststr][igamma][ip][ifit][&#39;A_Ep&#39;] = ptwopt[0].Std</span>
                    <span class="c1">#     self.FitDictAvg[ststr][igamma][ip][ifit][&#39;Ep&#39;] = ptwopt[1].Avg</span>
                    <span class="c1">#     self.FitDictStd[ststr][igamma][ip][ifit][&#39;Ep&#39;] = ptwopt[1].Std</span>
                    <span class="c1">#     self.FitDictAvg[ststr][igamma][ip][ifit][&#39;A_Epp&#39;] = ptwopt[2].Avg</span>
                    <span class="c1">#     self.FitDictStd[ststr][igamma][ip][ifit][&#39;A_Epp&#39;] = ptwopt[2].Std</span>
                    <span class="c1">#     self.FitDictAvg[ststr][igamma][ip][ifit][&#39;Epp&#39;] = ptwopt[3].Avg</span>
                    <span class="c1">#     self.FitDictStd[ststr][igamma][ip][ifit][&#39;Epp&#39;] = ptwopt[3].Std</span>
                    <span class="c1"># elif state == 2:</span>
                    <span class="c1">#     self.FitDictAvg[ststr][igamma][ip][ifit][&#39;A_Ep&#39;] = ptwopt[0].Avg</span>
                    <span class="c1">#     self.FitDictStd[ststr][igamma][ip][ifit][&#39;A_Ep&#39;] = ptwopt[0].Std</span>
                    <span class="c1">#     self.FitDictAvg[ststr][igamma][ip][ifit][&#39;Ep&#39;] = ptwopt[1].Avg</span>
                    <span class="c1">#     self.FitDictStd[ststr][igamma][ip][ifit][&#39;Ep&#39;] = ptwopt[1].Std</span>
                    <span class="c1">#     self.FitDictAvg[ststr][igamma][ip][ifit][&#39;Ap_Ep&#39;] = ptwopt[2].Avg</span>
                    <span class="c1">#     self.FitDictStd[ststr][igamma][ip][ifit][&#39;Ap_Ep&#39;] = ptwopt[2].Std</span>
                    <span class="c1">#     self.FitDictAvg[ststr][igamma][ip][ifit][&#39;DEp&#39;] = ptwopt[3].Avg</span>
                    <span class="c1">#     self.FitDictStd[ststr][igamma][ip][ifit][&#39;DEp&#39;] = ptwopt[3].Std</span>
                    <span class="c1">#     self.FitDictAvg[ststr][igamma][ip][ifit][&#39;A_Epp&#39;] = ptwopt[4].Avg</span>
                    <span class="c1">#     self.FitDictStd[ststr][igamma][ip][ifit][&#39;A_Epp&#39;] = ptwopt[4].Std</span>
                    <span class="c1">#     self.FitDictAvg[ststr][igamma][ip][ifit][&#39;Epp&#39;] = ptwopt[5].Avg</span>
                    <span class="c1">#     self.FitDictStd[ststr][igamma][ip][ifit][&#39;Epp&#39;] = ptwopt[5].Std</span>
                    <span class="c1">#     self.FitDictAvg[ststr][igamma][ip][ifit][&#39;Ap_Epp&#39;] = ptwopt[6].Avg</span>
                    <span class="c1">#     self.FitDictStd[ststr][igamma][ip][ifit][&#39;Ap_Epp&#39;] = ptwopt[6].Std</span>
                    <span class="c1">#     self.FitDictAvg[ststr][igamma][ip][ifit][&#39;DEpp&#39;] = ptwopt[7].Avg</span>
                    <span class="c1">#     self.FitDictStd[ststr][igamma][ip][ifit][&#39;DEpp&#39;] = ptwopt[7].Std</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span></div>



<div class="viewcode-block" id="ThreePointCorr.Write"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.Write">[docs]</a>    <span class="k">def</span> <span class="nf">Write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">FixDictArray</span><span class="p">(</span><span class="n">thislist</span><span class="p">,</span><span class="n">ikey</span><span class="p">):</span>
            <span class="n">outDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">ic</span><span class="p">,</span><span class="n">ilist</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">thislist</span><span class="p">):</span>
                <span class="n">outDict</span><span class="p">[</span><span class="n">ikey</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ic</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ilist</span>
            <span class="k">return</span> <span class="n">outDict</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;show_cfgs&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_cfgs</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">outDict</span> <span class="o">=</span> <span class="n">ODNested</span><span class="p">()</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;kud&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kud</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ks</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;nt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nt</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;nxyz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nxyz</span>

        <span class="k">for</span> <span class="n">istream</span><span class="p">,</span><span class="n">incfg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ncfg_list</span><span class="p">):</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ncfg_&#39;</span><span class="o">+</span><span class="n">istream</span><span class="p">]</span> <span class="o">=</span> <span class="n">incfg</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;nxsrc_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xsrcAvg</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;nMeas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nMeas</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;nboot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nboot</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;tsrc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsrc</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;tsink&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsink</span>
        <span class="c1"># outDict[&#39;xsrc&#39;] = FixDictArray(self.xsrc,&#39;xsrc&#39;)</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ism&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ism</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;sink_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jsm</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;Projector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Proj</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;Doub_Sing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DS</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ppmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ppmom</span>
        <span class="k">for</span> <span class="n">icg</span><span class="p">,</span><span class="n">igamma</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gammalist</span><span class="p">):</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icg</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">igamma</span>
        <span class="k">for</span> <span class="n">icq</span><span class="p">,</span><span class="n">iqmom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmom</span><span class="p">):</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;qmom&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icq</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">iqmom</span>

        <span class="n">excel_params</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">outDict</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">icg</span><span class="p">,</span><span class="n">igamma</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gammalist</span><span class="p">):</span>
            <span class="k">del</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icg</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">icq</span><span class="p">,</span><span class="n">iqmom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmom</span><span class="p">):</span>
            <span class="k">del</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;qmom&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icq</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>

        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;gamma_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FixDictArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gammalist</span><span class="p">,</span><span class="s1">&#39;gamma&#39;</span><span class="p">)</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;qmom_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FixDictArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmom</span><span class="p">,</span><span class="s1">&#39;qmom&#39;</span><span class="p">)</span>


        <span class="k">for</span> <span class="n">col_key</span><span class="p">,</span><span class="n">col_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_Stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;Avg&#39;</span> <span class="ow">in</span> <span class="n">col_key</span> <span class="ow">or</span> <span class="s1">&#39;Std&#39;</span> <span class="ow">in</span> <span class="n">col_key</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">),</span><span class="n">idata</span> <span class="ow">in</span> <span class="n">col_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">outDict</span><span class="p">[</span><span class="n">col_key</span><span class="p">][</span><span class="n">igamma</span><span class="p">][</span><span class="n">ip</span><span class="p">][</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">AvgStdToFormat</span><span class="p">(</span><span class="n">idata</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span><span class="n">idata</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>


        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_Fit_Stats</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">istate</span><span class="p">,</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itr</span><span class="p">),</span><span class="n">fitdict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fitdict</span><span class="p">,</span><span class="n">ff</span><span class="o">.</span><span class="n">Fitting</span><span class="p">):</span> <span class="k">continue</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;Fits&#39;</span><span class="p">][</span><span class="n">istate</span><span class="p">][</span><span class="n">igamma</span><span class="p">][</span><span class="n">ip</span><span class="p">][</span><span class="n">itr</span><span class="p">]</span> <span class="o">=</span> <span class="n">fitdict</span><span class="o">.</span><span class="n">GetOutputDict</span><span class="p">()</span>


        <span class="c1"># for ststr,statedict in self.FitDict.iteritems():</span>
        <span class="c1">#     if len(statedict.keys()) == 0: continue</span>
        <span class="c1">#     for igamma,gammadict in statedict.iteritems():</span>
        <span class="c1">#         for ip,pdict in gammadict.iteritems():</span>
        <span class="c1">#             for ifit,fitdict in pdict.iteritems():</span>
        <span class="c1">#                 thisfitAvg,thisfitStd = self.FitDictAvg[ststr][igamma][ip][ifit],self.FitDictStd[ststr][igamma][ip][ifit]</span>
        <span class="c1">#                 for (ipar,paravg),parstd in zip(thisfitAvg.iteritems(),thisfitStd.itervalues):</span>
        <span class="c1">#                     thisfmtflag = &#39;f&#39;</span>
        <span class="c1">#                     if &#39;A_Ep&#39; == ipar or &#39;A_Epp&#39; == ipar: thisfmtflag = &#39;e&#39;</span>
        <span class="c1">#                     outDict[&#39;Fits&#39;][ststr][igamma][ip][ifit][ipar] = AvgStdToFormat(paravg,parstd,frmtflag=thisfmtflag)</span>
        <span class="c1">#                 outDict[&#39;Fits&#39;][ststr][igamma][ip][ifit][&#39;Chi^2_pdf&#39;] = AvgStdToFormat(fitdict.Chi2DoF.Avg,fitdict.Chi2DoF.Std)</span>
        <span class="c1">#                 outDict[&#39;Fits&#39;][ststr][igamma][ip][ifit][&#39;MaxIter&#39;] = fitdict.MaxIter</span>
        <span class="c1">#                 outDict[&#39;Fits&#39;][ststr][igamma][ip][ifit][&#39;Prec&#39;] = fitdict.Prec</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ncfg_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cfgs</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">((</span><span class="n">istream</span><span class="p">,</span><span class="n">iccfg</span><span class="p">),</span><span class="n">icfg</span><span class="p">),</span><span class="n">ixsrc_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;configs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span><span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;cfglist&#39;</span><span class="p">][</span><span class="n">istream</span><span class="p">][</span><span class="n">icfg</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;n_xsrc_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ixsrc_list</span><span class="p">))</span>
        <span class="c1">#</span>
        <span class="c1"># if self.ncfg &gt; 0 and self.show_cfgs:</span>
        <span class="c1">#     for icfg,xsrclist in self.cfglist.iteritems():</span>
        <span class="c1">#         outDict[&#39;cfglist&#39;][icfg] = FixDictArray(xsrclist,&#39;xsrc&#39;)</span>


        <span class="c1">## Write human readable file with data</span>
        <span class="n">WriteXml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span><span class="p">,{</span><span class="s1">&#39;Results&#39;</span><span class="p">:</span><span class="n">outDict</span><span class="p">})</span>


        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ncfg_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">for</span> <span class="p">((</span><span class="n">istream</span><span class="p">,</span><span class="n">iccfg</span><span class="p">),</span><span class="n">icfg</span><span class="p">),</span><span class="n">ixsrc_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;configs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span><span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;cfglist&#39;</span><span class="p">][</span><span class="n">istream</span><span class="p">][</span><span class="n">icfg</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;n_xsrc_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ixsrc_list</span><span class="p">))</span>

        <span class="c1">## TODO, include fitting in the excell file</span>
        <span class="n">WriteExcel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">,{</span><span class="s1">&#39;C3_results&#39;</span><span class="p">:</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3_Stats</span><span class="p">)},</span><span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">excel_params</span><span class="p">)</span>


        <span class="c1"># if self.ncfg &gt; 0:</span>
        <span class="c1">#     for icfg,xsrclist in self.cfglist.iteritems():</span>
        <span class="c1">#         outDict[&#39;cfglist&#39;][icfg] = FixDictArray(xsrclist,&#39;xsrc&#39;)</span>

        <span class="c1">## pickles rest of data for reading</span>
        <span class="n">WritePickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span></div>

    <span class="c1">##################################</span>

<div class="viewcode-block" id="ThreePointCorr.LoadDS"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.LoadDS">[docs]</a>    <span class="k">def</span> <span class="nf">LoadDS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">WipeData</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">CheckMom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">thisInfo</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">)</span>
        <span class="n">thisInfo</span><span class="p">[</span><span class="s1">&#39;DoubSing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;doub&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doubclass</span> <span class="o">=</span> <span class="n">ThreePointCorr</span><span class="p">(</span><span class="n">thisnboot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">,</span> <span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span><span class="p">,</span> <span class="n">Info</span><span class="o">=</span><span class="n">thisInfo</span><span class="p">,</span>
                                        <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;DoubSing&#39;</span><span class="p">],</span><span class="s1">&#39;doub&#39;</span><span class="p">),</span>
                                        <span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;DoubSing&#39;</span><span class="p">],</span><span class="s1">&#39;doub&#39;</span><span class="p">))</span>

        <span class="n">thisInfo</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">)</span>
        <span class="n">thisInfo</span><span class="p">[</span><span class="s1">&#39;DoubSing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;sing&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">singclass</span> <span class="o">=</span> <span class="n">ThreePointCorr</span><span class="p">(</span><span class="n">thisnboot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">,</span> <span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span><span class="p">,</span> <span class="n">Info</span><span class="o">=</span><span class="n">thisInfo</span><span class="p">,</span>
                                        <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;DoubSing&#39;</span><span class="p">],</span><span class="s1">&#39;sing&#39;</span><span class="p">),</span>
                                        <span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;DoubSing&#39;</span><span class="p">],</span><span class="s1">&#39;sing&#39;</span><span class="p">))</span>


        <span class="c1"># self.doubclass.GetCfgList()</span>
        <span class="c1"># self.singclass.GetCfgList()</span>
        <span class="k">if</span> <span class="n">CheckCfgs</span><span class="p">:</span>
            <span class="n">comb_cfgs</span> <span class="o">=</span> <span class="n">CombineCfgs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doubclass</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">singclass</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doubclass</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="n">comb_cfgs</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">singclass</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="n">comb_cfgs</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doubclass</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span>  <span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span>
                                    <span class="n">CheckCfgs</span><span class="o">=</span><span class="n">CheckCfgs</span><span class="p">,</span><span class="n">CheckMom</span><span class="o">=</span><span class="n">CheckMom</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">singclass</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span>  <span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span>
                                    <span class="n">CheckCfgs</span><span class="o">=</span><span class="n">CheckCfgs</span><span class="p">,</span><span class="n">CheckMom</span><span class="o">=</span><span class="n">CheckMom</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DS</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">DSfundict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s1">&#39;Doublet Singlet combination&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; not reconised, add to DSDefines.py&#39;</span><span class="p">)</span>

        <span class="n">outlist</span><span class="p">,</span><span class="n">ilist</span> <span class="o">=</span> <span class="p">[],[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">),</span><span class="n">idoubdata</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">doubclass</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">singclass</span><span class="o">.</span><span class="n">C3_Stats</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">))</span>
                <span class="n">outlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DSfundict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="p">](</span><span class="n">idoubdata</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">singclass</span><span class="o">.</span><span class="n">C3_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">][</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">]))</span>
        <span class="n">iindex</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C3_Col_Names</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">outlist</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">iindex</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;boot&#39;</span><span class="p">)</span>
        <span class="c1"># self.Stats()</span>
        <span class="k">if</span> <span class="n">DefWipe</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doubclass</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">singclass</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span></div>

<div class="viewcode-block" id="ThreePointCorr.ReadAndWrite"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.ReadAndWrite">[docs]</a>    <span class="k">def</span> <span class="nf">ReadAndWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">WipeData</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DS</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;doub&#39;</span><span class="p">,</span><span class="s1">&#39;sing&#39;</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LoadDS</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;reading doublet and singlet failed, reading with wipeing now&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LoadDS</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Bootstrap</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Read</span><span class="p">(</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Bootstrap</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
        <span class="c1"># self.Fit()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span></div>

<div class="viewcode-block" id="ThreePointCorr.FixRead"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.FixRead">[docs]</a>    <span class="k">def</span> <span class="nf">FixRead</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">readdict</span><span class="p">):</span>
        <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;Info&#39;</span><span class="p">][</span><span class="s1">&#39;outdir&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;outdir&#39;</span><span class="p">]</span>
        <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;latparams&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">outputdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">outputdir</span>
        <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;latparams&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">PickleFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">PickleFile</span>
        <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;latparams&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">HumanFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">HumanFile</span>
        <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;PickleFile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span>
        <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;ExcelFile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span>
        <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;HumanFile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span>
        <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;CfgFile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CfgFile</span>
        <span class="k">if</span> <span class="s1">&#39;cfg_file_type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">readdict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;cfg_file_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg_file_type</span>
        <span class="k">return</span> <span class="n">readdict</span></div>

<div class="viewcode-block" id="ThreePointCorr.LoadPickle"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.LoadPickle">[docs]</a>    <span class="k">def</span> <span class="nf">LoadPickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">WipeData</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">CheckMom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">DefWipe</span><span class="p">:</span>
            <span class="c1"># print &#39;Loading Pickle for &#39; , self.name</span>
            <span class="n">loadeddict</span> <span class="o">=</span> <span class="n">ReadPickleWrap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span>
            <span class="n">loadeddict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FixRead</span><span class="p">(</span><span class="n">loadeddict</span><span class="p">)</span>
            <span class="n">checklist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thischecklist</span>
            <span class="k">if</span> <span class="n">CheckCfgs</span><span class="p">:</span> <span class="n">checklist</span> <span class="o">=</span> <span class="n">checklist</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;C3_cfgs&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">CheckMom</span><span class="p">:</span> <span class="n">checklist</span> <span class="o">=</span> <span class="n">checklist</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;checkmomlist&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">CheckClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span><span class="n">loadeddict</span><span class="p">,</span><span class="n">checklist</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">loadeddict</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_cfgs_from_file</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">Wipe_All_Fits</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">C3_Fit_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                <span class="c1"># if len(self.C3_Fit_Stats.values)&gt; 0 and not isinstance(self.C3_Fit_Stats.values,sff.SetOfFitFuns):</span>
                <span class="c1">#     self.C3_Fit_Stats = pa.DataFrame()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;using backupfile for &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">,</span><span class="s1">&#39;.bak.xlsx&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="n">CheckCfgs</span><span class="p">,</span><span class="n">CheckMom</span><span class="o">=</span><span class="n">CheckMom</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning, file &#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span> <span class="p">,</span> <span class="s1">&#39; has different parameters than this instance, reading and writing over file now&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ReadAndWrite</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
            <span class="c1"># self.Write()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ReadAndWrite</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span></div>


<div class="viewcode-block" id="ThreePointCorr.Write_Cfgs"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.Write_Cfgs">[docs]</a>    <span class="k">def</span> <span class="nf">Write_Cfgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file_type</span><span class="o">=</span><span class="s1">&#39;PreDef&#39;</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;read_cfgs_from_file&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_cfgs_from_file</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;PreDef&#39;</span><span class="p">:</span>
            <span class="n">file_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg_file_type</span>
        <span class="k">if</span> <span class="s1">&#39;to_&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file_type</span><span class="p">:</span>
            <span class="n">file_type</span> <span class="o">=</span> <span class="s1">&#39;to_&#39;</span><span class="o">+</span><span class="n">file_type</span>
        <span class="n">this_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CfgFile</span><span class="o">+</span><span class="n">fmt_file_type</span><span class="p">(</span><span class="n">file_type</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;to_&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Writing Cfgs &#39;</span><span class="o">+</span><span class="n">this_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Read</span><span class="p">(</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
        <span class="c1"># this_df,dump = self.Get_Flattened_Cfgs()</span>
        <span class="n">this_meta</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gammalist</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">qmom</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">]</span>
        <span class="n">WriteWithMeta</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">,</span><span class="n">this_meta</span><span class="p">,</span><span class="n">this_file</span><span class="p">,</span><span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span><span class="o">.</span><span class="n">Stop</span><span class="p">()</span></div>

<div class="viewcode-block" id="ThreePointCorr.ChopDepVarList"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.ChopDepVarList">[docs]</a>    <span class="k">def</span> <span class="nf">ChopDepVarList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">this_df</span><span class="p">,</span><span class="n">read_meta</span><span class="p">,</span><span class="n">show_err</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">isin</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">name_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gamma_list&#39;</span><span class="p">,</span><span class="s1">&#39;momentum_list&#39;</span><span class="p">]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nt</span> <span class="o">!=</span> <span class="n">read_meta</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">show_err</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> missmatch in euclidian time, read_nt=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">read_meta</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;, setup_nt=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">this_df</span><span class="p">,</span><span class="kc">False</span>
        <span class="n">gamma_list</span> <span class="o">=</span> <span class="n">read_meta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mom_list</span> <span class="o">=</span> <span class="n">read_meta</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">ic</span><span class="p">,(</span><span class="n">ithis_list</span><span class="p">,</span><span class="n">icheck_list</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([(</span><span class="bp">self</span><span class="o">.</span><span class="n">gammalist</span><span class="p">,</span><span class="n">gamma_list</span><span class="p">),(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmom</span><span class="p">,</span><span class="n">mom_list</span><span class="p">)]):</span>
            <span class="n">isin</span> <span class="o">=</span> <span class="n">isin</span> <span class="ow">and</span> <span class="nb">set</span><span class="p">(</span><span class="n">ithis_list</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">icheck_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">isin</span><span class="p">:</span>
                <span class="n">same_list</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ithis_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">icheck_list</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">same_list</span><span class="p">:</span>
                    <span class="n">index_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">icheck_list</span><span class="p">)</span> <span class="o">==</span> <span class="n">it</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">ithis_list</span><span class="p">]</span>
                    <span class="n">index</span><span class="p">[</span><span class="n">ic</span><span class="p">]</span> <span class="o">=</span> <span class="n">index_list</span>
            <span class="k">elif</span> <span class="n">show_err</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> missmatch in &#39;</span><span class="p">,</span><span class="n">name_list</span><span class="p">[</span><span class="n">ic</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">ithis_list</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">icheck_list</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">isin</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">Chop_fun</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">val</span><span class="p">)[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">index</span><span class="p">)]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">this_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;C3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;C3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">Chop_fun</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">this_df</span><span class="p">,</span><span class="n">isin</span></div>




<div class="viewcode-block" id="ThreePointCorr.Read_Cfgs"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.Read_Cfgs">[docs]</a>    <span class="k">def</span> <span class="nf">Read_Cfgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file_type</span><span class="o">=</span><span class="s1">&#39;PreDef&#39;</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">Full</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">CheckCfgList</span><span class="p">(</span><span class="n">cfg_data</span><span class="p">,</span><span class="n">read_meta</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">cfg_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span><span class="kc">False</span>
            <span class="k">if</span> <span class="n">CheckCfgs</span> <span class="ow">and</span> <span class="s1">&#39;stream_cfgs&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">:</span>
                <span class="n">second_class</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">cfg_data</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;C3_cfgs&#39;</span><span class="p">])</span>
                <span class="n">cfg_bool</span> <span class="o">=</span> <span class="n">CheckClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span><span class="n">second_class</span><span class="p">,[</span><span class="s1">&#39;C3_cfgs&#39;</span><span class="p">])</span>
                <span class="c1"># cfg_bool = np.array(self.C3_cfgs[&#39;stream_cfgs&#39;].values) == np.array(cfg_data[&#39;stream_cfgs&#39;].values)</span>
                <span class="c1"># if isinstance(cfg_bool,np.ndarray):</span>
                <span class="c1">#     cfg_bool = all(cfg_bool)</span>
                <span class="c1"># if show_timer and not cfg_bool:</span>
                <span class="c1">#     print &#39;\n&#39;+GetCfgMissmatch( np.array(self.C3_cfgs[&#39;stream_cfgs&#39;].values),</span>
                <span class="c1">#                                 np.array(cfg_data[&#39;stream_cfgs&#39;].values))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cfg_bool</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">cfg_bool</span><span class="p">:</span>
                <span class="n">cfg_data</span><span class="p">,</span><span class="n">outbool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChopDepVarList</span><span class="p">(</span><span class="n">cfg_data</span><span class="p">,</span><span class="n">read_meta</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">Full</span> <span class="ow">and</span> <span class="s1">&#39;tsrc_list&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cfg_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">outbool</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">return</span> <span class="n">cfg_data</span><span class="p">,</span><span class="n">outbool</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span><span class="kc">False</span>

        <span class="k">if</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;PreDef&#39;</span><span class="p">:</span>
            <span class="n">file_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg_file_type</span>
        <span class="k">if</span> <span class="s1">&#39;read_&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file_type</span><span class="p">:</span>
            <span class="n">file_type</span> <span class="o">=</span> <span class="s1">&#39;read_&#39;</span><span class="o">+</span><span class="n">file_type</span>
        <span class="n">this_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CfgFile</span><span class="o">+</span><span class="n">fmt_file_type</span><span class="p">(</span><span class="n">file_type</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;read_&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">this_file</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;-def-&#39;</span> <span class="ow">in</span> <span class="n">this_file</span><span class="p">:</span>
                <span class="n">this_file</span> <span class="o">=</span> <span class="n">this_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-def-&#39;</span><span class="p">,</span><span class="s1">&#39;-*-&#39;</span><span class="p">)</span>
                <span class="n">file_list</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">this_file</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cfg FNF: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">this_file</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">this_file</span> <span class="o">=</span> <span class="n">file_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">this_file</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cfg FNF: &#39;</span> <span class="o">+</span> <span class="n">this_file</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Reading Cfgs &#39;</span><span class="o">+</span><span class="n">this_file</span><span class="p">)</span>
        <span class="n">meta_data</span><span class="p">,</span><span class="n">cfg_data</span> <span class="o">=</span> <span class="n">ReadWithMeta</span><span class="p">(</span><span class="n">this_file</span><span class="p">,</span><span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">)</span>
        <span class="n">cfg_data</span><span class="p">,</span><span class="n">check_bool</span> <span class="o">=</span> <span class="n">CheckCfgList</span><span class="p">(</span><span class="n">cfg_data</span><span class="p">,</span><span class="n">meta_data</span><span class="p">)</span>
        <span class="c1"># cfg_data = self.Format_Flattened_Cfgs(cfg_data)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_cfgs_from_file</span> <span class="o">=</span> <span class="n">check_bool</span>
        <span class="k">if</span> <span class="n">check_bool</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">cfg_data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span> <span class="o">=</span> <span class="n">thistimer</span><span class="o">.</span><span class="n">Stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ncfg_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">icfg</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">istream</span><span class="p">,</span><span class="n">icfg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;configs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;stream&#39;</span><span class="p">)]</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> file incorrect,&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CfgFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CfgFile</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.cfgs&#39;</span><span class="p">,</span><span class="s1">&#39;.cfgs.bak&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">this_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.cfgs&#39;</span><span class="p">,</span><span class="s1">&#39;.cfgs.bak&#39;</span><span class="p">)):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; found backup file&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Read_Cfgs</span><span class="p">(</span><span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="n">CheckCfgs</span><span class="p">,</span><span class="n">Full</span><span class="o">=</span><span class="n">Full</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; reading unformatted&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span></div>


    <span class="c1">## Comparisons</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="ThreePointCorr.iteritems"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.iteritems">[docs]</a>    <span class="k">def</span> <span class="nf">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span></div>

<div class="viewcode-block" id="ThreePointCorr.items"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.items">[docs]</a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span></div>

<div class="viewcode-block" id="ThreePointCorr.itemsAvgStd"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.itemsAvgStd">[docs]</a>    <span class="k">def</span> <span class="nf">itemsAvgStd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">outlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ivals</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_Stats</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
            <span class="n">outlist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ivals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ivals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">ivals</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">outlist</span></div>

<div class="viewcode-block" id="ThreePointCorr.values"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.values">[docs]</a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span></div>

<div class="viewcode-block" id="ThreePointCorr.itervalues"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.itervalues">[docs]</a>    <span class="k">def</span> <span class="nf">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThreePointCorr.valuesAvgStd"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.valuesAvgStd">[docs]</a>    <span class="k">def</span> <span class="nf">valuesAvgStd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">outlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ivals</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_Stats</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
            <span class="n">outlist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ivals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">ivals</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">outlist</span></div>

<div class="viewcode-block" id="ThreePointCorr.keys"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.ThreePointCorr.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_Stats</span><span class="o">.</span><span class="n">index</span></div>


    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__reversed__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3_Stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3_Stats</span><span class="o">.</span><span class="n">iiloc</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thiskey</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">thiskey</span><span class="p">]</span>



    <span class="c1">## Operator overloading Starting to get tedious, leave to last or think of better way of implementing (maybe use predefined funtion passed in?)</span>

    <span class="c1">#Too Much work, only works for one operator. Please use SetCustomName after doing all algebraic manipulation</span>


    <span class="c1"># def UpdateName(self,opp,C3,C32):</span>
    <span class="c1">#     def GetOppSelf(opp):</span>
    <span class="c1">#         if opp == &#39;+&#39;:</span>
    <span class="c1">#             return &#39;x2&#39;</span>
    <span class="c1">#         elif opp == &#39;-&#39;:</span>
    <span class="c1">#             return &#39;x0&#39;</span>
    <span class="c1">#         elif opp == &#39;x&#39;:</span>
    <span class="c1">#             return &#39;pow2&#39;</span>
    <span class="c1">#         elif opp == &#39;div&#39;:</span>
    <span class="c1">#             return &#39;divself&#39;</span>
    <span class="c1">#         elif opp == &#39;pow&#39;:</span>
    <span class="c1">#             return &#39;powself&#39;</span>
    <span class="c1">#     def GetLegSelf(opp):</span>
    <span class="c1">#         if opp == &#39;+&#39;:</span>
    <span class="c1">#             return &#39;\times 2&#39;</span>
    <span class="c1">#         elif opp == &#39;-&#39;:</span>
    <span class="c1">#             return &#39;\times 0&#39;</span>
    <span class="c1">#         elif opp == &#39;x&#39;:</span>
    <span class="c1">#             return &#39;^{2}&#39;</span>
    <span class="c1">#         elif opp == &#39;div&#39;:</span>
    <span class="c1">#             return &#39;divself&#39;</span>
    <span class="c1">#         elif opp == &#39;pow&#39;:</span>
    <span class="c1">#             return &#39;powself&#39;</span>

    <span class="c1">#     def LLFormatOp(opp):</span>
    <span class="c1">#         oppout = opp.replace(&#39;x&#39;,r&#39;\times &#39;)</span>
    <span class="c1">#         oppout = oppout.replace(&#39;pow&#39;,&#39;^{}&#39;)</span>
    <span class="c1">#         return oppout</span>

    <span class="c1">#     outname = []</span>
    <span class="c1">#     outLL = []</span>
    <span class="c1">#     oppLL = LLFormatOp(opp) ## \times looks better :)</span>
    <span class="c1">#     if isinstance(C32,ThreePointCorr) and isinstance(Op,ThreePointCorr):</span>
    <span class="c1">#         op1LL = C3.LegLab[1:-1] ## removes $ symbols, re adds at end</span>
    <span class="c1">#         op2LL = C32.LegLab[1:-1] ## removes $ symbols, re adds at end</span>
    <span class="c1">#         if C3.name == C32.name:</span>
    <span class="c1">#             outname = C3.name,GetOppSelf(opp)</span>
    <span class="c1">#             outLL = op1LL,&#39; Comb &#39;,GetLegSelf(oppLL)</span>
    <span class="c1">#         else:</span>
    <span class="c1">#             for iname,iname2 in zip(C3.name.split(&#39;_&#39;),C32.name.split(&#39;_&#39;)):</span>
    <span class="c1">#                 if iname in iname2:</span>
    <span class="c1">#                     outname.append(iname2)</span>
    <span class="c1">#                 elif iname2 in iname:</span>
    <span class="c1">#                     outname.append(iname)</span>
    <span class="c1">#                 else:</span>
    <span class="c1">#                     outname.append(iname+opp+iname2)</span>
    <span class="c1">#             outname = &#39;_&#39;.join(outname)</span>
    <span class="c1">#             for iLegLab,iLegLab2 in zip(op1LL.split(&#39;_&#39;),op2LL.split(&#39;\ &#39;)):</span>
    <span class="c1">#                 if iLegLab in iLegLab2:</span>
    <span class="c1">#                     outLL.append(iLegLab2)</span>
    <span class="c1">#                 elif iLegLab2 in iLegLab:</span>
    <span class="c1">#                     outLL.append(iLegLab)</span>
    <span class="c1">#                 else:</span>
    <span class="c1">#                     outLL.append(iLegLab+oppLL+iLegLab2)</span>
    <span class="c1">#             outLL = &#39;_&#39;.join(outLL)</span>
    <span class="c1">#     elif isinstance(C3,ThreePointCorr):</span>
    <span class="c1">#         op1LL = C3.LegLab[1:-1] ## removes $ symbols, re adds at end</span>
    <span class="c1">#         if isinstance(C32,int):</span>
    <span class="c1">#             outname  =  C3.name,opp+str(C32)</span>
    <span class="c1">#             outLL  =  op1LL,oppLL+str(C32)</span>
    <span class="c1">#         else:</span>
    <span class="c1">#             if C32 &gt; 0.01:</span>
    <span class="c1">#                 outname = C3.name,opp+&#39;{:.2f}&#39;.format(C32)</span>
    <span class="c1">#                 outLL = op1LL,oppLL+&#39;{:.2f}&#39;.format(C32)</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         op2LL = C32.LegLab[1:-1] ## removes $ symbols, re adds at end</span>
    <span class="c1">#         if isinstance(C3,int):</span>
    <span class="c1">#             outname  =  str(C3) + opp ,C32.name</span>
    <span class="c1">#             outLL  =  str(C3) + oppLL,op2LL</span>
    <span class="c1">#         else:</span>
    <span class="c1">#             if C3 &gt; 0.01:</span>
    <span class="c1">#                 outname = &#39;{:.2f}&#39;.format(C3) + opp,C32.name</span>
    <span class="c1">#                 outLL = &#39;{:.2f}&#39;.format(C3) + oppLL,op2LL</span>
    <span class="c1">#     # print r&#39;$&#39;+r&#39;\ &#39;.join(outLL)+&#39;$&#39;</span>
    <span class="c1">#     outLL = list(outLL)</span>
    <span class="c1">#     for ic,iLL in enumerate(outLL):</span>
    <span class="c1">#         if &#39;^{}&#39; in iLL:</span>
    <span class="c1">#             outLL[ic] = iLL.replace(&#39;^{}&#39;,&#39;^{&#39;)+&#39;}&#39;</span>
    <span class="c1">#     self.SetCustomName(&#39;_&#39;.join(outname),r&#39;$&#39;+r&#39;\ &#39;.join(outLL)+&#39;$&#39;)</span>




    <span class="c1">## Numerical operatoions</span>

    <span class="c1"># def __add__(self,C32):</span>
    <span class="c1">#     if type(C32) in ThreePointCorr.parentlist:</span>
    <span class="c1">#         return C32.__radd__(self)</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         result = ThreePointCorr(thisnboot=self.nboot, thisnt=self.nt, cfglist=self.cfglist,</span>
    <span class="c1">#                               Info=self.Info,thissym=self.thissym,thiscol=self.thiscol,thisshift=self.thisshift)</span>
    <span class="c1">#         result.UpdateName(&#39;+&#39;,self,C32)</span>
    <span class="c1">#         if isinstance(C32,ThreePointCorr):</span>
    <span class="c1">#             for (ip,it,iC3) in self.items():</span>
    <span class="c1">#                 result[(ip,it)] = iC3 + C32[(ip,it)]</span>
    <span class="c1">#         else:</span>
    <span class="c1">#             try:</span>
    <span class="c1">#                 for ip,it,iC3 in self.items():</span>
    <span class="c1">#                     result[(ip,it)] = iC3 + C32</span>
    <span class="c1">#             except Exception as err:</span>
    <span class="c1">#                 raise EnvironmentError(&#39;Invalid value to combine with BootStrap class&#39;)</span>
    <span class="c1">#         return result</span>

    <span class="c1"># def __sub__(self,C32):</span>
    <span class="c1">#     if type(C32) in ThreePointCorr.parentlist:</span>
    <span class="c1">#         return C32.__rsub__(self)</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         result = ThreePointCorr(thisnboot=self.nboot, thisnt=self.nt, cfglist=self.cfglist,</span>
    <span class="c1">#                               Info=self.Info,thissym=self.thissym,thiscol=self.thiscol,thisshift427=self.thisshift)</span>
    <span class="c1">#         result.UpdateName(&#39;-&#39;,self,C32)</span>
    <span class="c1">#         if isinstance(C32,ThreePointCorr):</span>
    <span class="c1">#             for (ip,it,iC3) in self.items():</span>
    <span class="c1">#                 result[(ip,it)] = iC3 - C32[(ip,it)]</span>
    <span class="c1">#         else:</span>
    <span class="c1">#             try:</span>
    <span class="c1">#                 for ip,it,iC3 in self.items():</span>
    <span class="c1">#                     result[(ip,it)] = iC3 - C32</span>
    <span class="c1">#             except Exception as err:</span>
    <span class="c1">#                 raise EnvironmentError(&#39;Invalid value to combine with BootStrap class&#39;)</span>
    <span class="c1">#         return result</span>

    <span class="c1"># def __mul__(self,C32):</span>
    <span class="c1">#     if type(C32) in ThreePointCorr.parentlist:</span>
    <span class="c1">#         return C32.__rmul__(self)</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         result = ThreePointCorr(thisnboot=self.nboot, thisnt=self.nt, cfglist=self.cfglist,</span>
    <span class="c1">#                               Info=self.Info,thissym=self.thissym,thiscol=self.thiscol,thisshift=self.thisshift)</span>
    <span class="c1">#         result.UpdateName(&#39;x&#39;,self,C32)</span>
    <span class="c1">#         if isinstance(C32,ThreePointCorr):</span>
    <span class="c1">#             for (ip,it,iC3) in self.items():</span>
    <span class="c1">#                 result[(ip,it)] = iC3 * C32[(ip,it)]</span>
    <span class="c1">#         else:</span>
    <span class="c1">#             try:</span>
    <span class="c1">#                 for ip,it,iC3 in self.items():</span>
    <span class="c1">#                     result[(ip,it)] = iC3 * C32</span>
    <span class="c1">#             except Exception as err:</span>
    <span class="c1">#                 raise EnvironmentError(&#39;Invalid value to combine with BootStrap class&#39;)</span>
    <span class="c1">#         return result</span>

    <span class="c1"># def __div__(self,C32):</span>
    <span class="c1">#     if type(C32) in ThreePointCorr.parentlist:</span>
    <span class="c1">#         return C32.__rdiv__(self)</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         result = ThreePointCorr(thisnboot=self.nboot, thisnt=self.nt, cfglist=self.cfglist,</span>
    <span class="c1">#                               Info=self.Info,thissym=self.thissym,thiscol=self.thiscol,thisshift=self.thisshift)</span>
    <span class="c1">#         result.UpdateName(&#39;div&#39;,self,C32)</span>
    <span class="c1">#         if isinstance(C32,ThreePointCorr):</span>
    <span class="c1">#             for (ip,it,iC3) in self.items():</span>
    <span class="c1">#                 try:</span>
    <span class="c1">#                     result[(ip,it)] = iC3 / C32[(ip,it)]</span>
    <span class="c1">#                 except Exception as err:</span>
    <span class="c1">#                     if any([ibs == 0 for ibs in C32[(ip,it)].bootvals]):</span>
    <span class="c1">#                         raise ZeroDivisionError(&#39;Dividing by zero found in bootstrap division for &#39;+C32.name + &#39; &#39;+C32[(ip,it)].name)</span>

    <span class="c1">#         else:</span>
    <span class="c1">#             if C32 == 0:</span>
    <span class="c1">#                 raise ZeroDivisionError(&#39;Dividing by zero found in bootstrap division&#39;)</span>
    <span class="c1">#             try:</span>
    <span class="c1">#                 for ip,it,iC3 in self.items():</span>
    <span class="c1">#                     result[(ip,it)] = iC3 / C32</span>
    <span class="c1">#             except Exception as err:</span>
    <span class="c1">#                 raise EnvironmentError(&#39;Invalid value to combine with BootStrap class&#39;)</span>
    <span class="c1">#         return result</span>


    <span class="c1"># def __pow__(self,C32):</span>
    <span class="c1">#     if type(C32) in ThreePointCorr.parentlist:</span>
    <span class="c1">#         return C32.__rpow__(self)</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         result = ThreePointCorr(thisnboot=self.nboot, thisnt=self.nt, cfglist=self.cfglist,</span>
    <span class="c1">#                               Info=self.Info,thissym=self.thissym,thiscol=self.thiscol,thisshift=self.thisshift)</span>
    <span class="c1">#         result.UpdateName(&#39;pow&#39;,self,C32)</span>
    <span class="c1">#         if isinstance(C32,ThreePointCorr):</span>
    <span class="c1">#             for (ip,it,iC3) in self.items():</span>
    <span class="c1">#                 result[(ip,it)] = iC3 ** C32[(ip,it)]</span>
    <span class="c1">#         else:</span>
    <span class="c1">#             try:</span>
    <span class="c1">#                 for ip,it,iC3 in self.items():</span>
    <span class="c1">#                     result[(ip,it)] = iC3 ** C32</span>
    <span class="c1">#             except Exception as err:</span>
    <span class="c1">#                 raise EnvironmentError(&#39;Invalid value to combine with BootStrap class&#39;)</span>
    <span class="c1">#         return result</span>


    <span class="c1"># ## Right multiplication functions</span>


    <span class="c1"># def __radd__(self,C32):</span>
    <span class="c1">#     result = ThreePointCorr(thisnboot=self.nboot, thisnt=self.nt, cfglist=self.cfglist,</span>
    <span class="c1">#                           Info=self.Info,thissym=self.thissym,thiscol=self.thiscol,thisshift=self.thisshift)</span>
    <span class="c1">#     result.UpdateName(&#39;+&#39;,C32,self)</span>
    <span class="c1">#     if isinstance(C32,ThreePointCorr):</span>
    <span class="c1">#         for (ip,it,iC3) in self.items():</span>
    <span class="c1">#             result[(ip,it)] = C32[(ip,it)] + iC3</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         try:</span>
    <span class="c1">#             for ip,it,iC3 in self.items():</span>
    <span class="c1">#                 result[(ip,it)] = C32 + iC3</span>
    <span class="c1">#         except Exception as err:</span>
    <span class="c1">#             raise EnvironmentError(&#39;Invalid value to combine with BootStrap class&#39;)</span>
    <span class="c1">#     return result</span>

    <span class="c1"># def __rsub__(self,C32):</span>
    <span class="c1">#     result = ThreePointCorr(thisnboot=self.nboot, thisnt=self.nt, cfglist=self.cfglist,</span>
    <span class="c1">#                           Info=self.Info,thissym=self.thissym,thiscol=self.thiscol,thisshift=self.thisshift)</span>
    <span class="c1">#     result.UpdateName(&#39;-&#39;,C32,self)</span>
    <span class="c1">#     if isinstance(C32,ThreePointCorr):</span>
    <span class="c1">#         for (ip,it,iC3) in self.items():</span>
    <span class="c1">#             result[(ip,it)] =  C32[(ip,it)] - iC3</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         try:</span>
    <span class="c1">#             for ip,it,iC3 in self.items():</span>
    <span class="c1">#                 result[(ip,it)] =  C32 - iC3</span>
    <span class="c1">#         except Exception as err:</span>
    <span class="c1">#             raise EnvironmentError(&#39;Invalid value to combine with BootStrap class&#39;)</span>
    <span class="c1">#     return result</span>

    <span class="c1"># def __rmul__(self,C32):</span>
    <span class="c1">#     result = ThreePointCorr(thisnboot=self.nboot, thisnt=self.nt, cfglist=self.cfglist,</span>
    <span class="c1">#                           Info=self.Info,thissym=self.thissym,thiscol=self.thiscol,thisshift=self.thisshift)</span>
    <span class="c1">#     result.UpdateName(&#39;x&#39;,C32,self)</span>
    <span class="c1">#     if isinstance(C32,ThreePointCorr):</span>
    <span class="c1">#         for (ip,it,iC3) in self.items():</span>
    <span class="c1">#             result[(ip,it)] =  C32[(ip,it)] * iC3</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         try:</span>
    <span class="c1">#             for ip,it,iC3 in self.items():</span>
    <span class="c1">#                 result[(ip,it)] = C32 * iC3</span>
    <span class="c1">#         except Exception as err:</span>
    <span class="c1">#             raise EnvironmentError(&#39;Invalid value to combine with BootStrap class&#39;)</span>
    <span class="c1">#     return result</span>

    <span class="c1"># def __rdiv__(self,C32):</span>
    <span class="c1">#     result = ThreePointCorr(thisnboot=self.nboot, thisnt=self.nt, cfglist=self.cfglist,</span>
    <span class="c1">#                           Info=self.Info,thissym=self.thissym,thiscol=self.thiscol,thisshift=self.thisshift)</span>
    <span class="c1">#     result.UpdateName(&#39;div&#39;,C32,self)</span>
    <span class="c1">#     if isinstance(C32,ThreePointCorr):</span>
    <span class="c1">#         for (ip,it,iC3) in self.items():</span>
    <span class="c1">#             try:</span>
    <span class="c1">#                 result[(ip,it)] = C32[(ip,it)] / iC3</span>
    <span class="c1">#             except Exception as err:</span>
    <span class="c1">#                 if any([ibs == 0 for ibs in iC3.bootvals]):</span>
    <span class="c1">#                     raise ZeroDivisionError(&#39;Dividing by zero found in bootstrap division for &#39;+self.name + &#39; &#39;+iC3.name)</span>

    <span class="c1">#     else:</span>
    <span class="c1">#         for ip,it,iC3 in self.items():</span>
    <span class="c1">#             try:</span>
    <span class="c1">#                 result[(ip,it)] = C32 / iC3</span>
    <span class="c1">#             except Exception as err:</span>
    <span class="c1">#                 if iC3 == 0:</span>
    <span class="c1">#                     raise ZeroDivisionError(&#39;Dividing by zero found in bootstrap division&#39;)</span>
    <span class="c1">#                 else:</span>
    <span class="c1">#                     raise EnvironmentError(&#39;Invalid value to combine with BootStrap class&#39;)</span>
    <span class="c1">#     return result</span>


    <span class="c1"># def __rpow__(self,C32):</span>
    <span class="c1">#     result = ThreePointCorr(thisnboot=self.nboot, thisnt=self.nt, cfglist=self.cfglist,</span>
    <span class="c1">#                           Info=self.Info,thissym=self.thissym,thiscol=self.thiscol,thisshift=self.thisshift)</span>
    <span class="c1">#     result.UpdateName(&#39;pow&#39;,C32,self)</span>
    <span class="c1">#     if isinstance(C32,ThreePointCorr):</span>
    <span class="c1">#         for (ip,it,iC3) in self.items():</span>
    <span class="c1">#             result[(ip,it)] =  C32[(ip,it)] ** iC3</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         try:</span>
    <span class="c1">#             for ip,it,iC3 in self.items():</span>
    <span class="c1">#                 result[(ip,it)] = C32 ** iC3</span>
    <span class="c1">#         except Exception as err:</span>
    <span class="c1">#             raise EnvironmentError(&#39;Invalid value to combine with BootStrap class&#39;)</span>
    <span class="c1">#     return result</span>


    <span class="c1">## unitary arithmetic operations</span>

    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span>


    <span class="k">def</span> <span class="nf">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1">## Casting, just casts the bootstrap values, ignore return value (only needed since return has to be same type).</span>


    <span class="k">def</span> <span class="nf">__complex__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="nb">complex</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">+</span><span class="mi">0</span><span class="n">j</span>

    <span class="k">def</span> <span class="nf">__int__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__float__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="k">return</span> <span class="mf">1.0</span></div>

<span class="c1">####################################################################################################################</span>
<span class="c1">####################################################################################################################</span>
<span class="c1">####################################################################################################################</span>
<span class="c1">####################################################################################################################</span>
<span class="c1">####################################################################################################################</span>


<div class="viewcode-block" id="NJNQCorr"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr">[docs]</a><span class="k">class</span> <span class="nc">NJNQCorr</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    NJNQ(q,tau,pp,t,tf) uses bootstrap class</span>
<span class="sd">    pp  = sink momentum</span>
<span class="sd">    t   = source sink separation time</span>
<span class="sd">    q   = current insersion momentum</span>
<span class="sd">    tau = current insersion time</span>
<span class="sd">    tflow = flow time</span>

<span class="sd">    Info is a dictionary containing information for the correlator:</span>
<span class="sd">    see comments below to see what is required.</span>
<span class="sd">    missing elements just sets field to default</span>


<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="NJNQCorr.Construct_NJNQ_File"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.Construct_NJNQ_File">[docs]</a>    <span class="k">def</span> <span class="nf">Construct_NJNQ_File</span><span class="p">(</span><span class="n">this_file</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Construct_File_Object</span><span class="p">(</span><span class="n">this_file</span><span class="p">,</span><span class="n">NJNQCorr</span><span class="p">)</span></div>


    <span class="c1">## TODO: create variational flag and interface with this function.</span>

    <span class="c1">## array of all classes that inherit this class. Append this when adding new classes please!</span>
    <span class="n">parentlist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RatioCorrelators.RatioCorr&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thisnboot</span><span class="o">=</span><span class="n">nboot</span><span class="p">,</span> <span class="n">cfglist</span><span class="o">=</span><span class="p">{},</span> <span class="n">Info</span><span class="o">=</span><span class="p">{},</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">man_load_cfgs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">## initialising instance of three point correlator as NJN</span>
        <span class="c1">## DoubSing tells whether to read doublet (doub) or singlet (sing) contribution</span>
        <span class="k">if</span> <span class="s1">&#39;DoubSing&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;DoubSing&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">DSfundict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DSList (from DSDefines.py):&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">DSfundict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Doublet,Singlet type (Info[&#39;DoubSing&#39;]) not recognised&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DS</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;DoubSing&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Please set DoubSing in Info for ThreePtCorrelators &#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">isDScomb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DS</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;doub&#39;</span><span class="p">,</span><span class="s1">&#39;sing&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">FO</span> <span class="o">=</span> <span class="n">FlowOp</span><span class="p">(</span><span class="n">thisnboot</span><span class="p">,</span><span class="n">cfglist</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span>

        <span class="n">thisinfo</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">Info</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Observ</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">thisinfo</span><span class="p">[</span><span class="s1">&#39;fo_for_cfgs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thisinfo</span><span class="p">[</span><span class="s1">&#39;fo_for_cfgs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Observ</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDScomb</span><span class="p">:</span>
            <span class="n">thisinfo</span><span class="p">[</span><span class="s1">&#39;DoubSing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;doub&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span> <span class="o">=</span> <span class="n">ThreePointCorr</span><span class="p">(</span><span class="n">thisnboot</span><span class="o">=</span><span class="n">thisnboot</span><span class="p">,</span><span class="n">cfglist</span><span class="o">=</span><span class="n">cfglist</span><span class="p">,</span><span class="n">Info</span><span class="o">=</span><span class="n">thisinfo</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>

            <span class="n">thisinfo</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">Info</span><span class="p">)</span>
            <span class="n">thisinfo</span><span class="p">[</span><span class="s1">&#39;DoubSing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;sing&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJNsing</span> <span class="o">=</span> <span class="n">ThreePointCorr</span><span class="p">(</span><span class="n">thisnboot</span><span class="o">=</span><span class="n">thisnboot</span><span class="p">,</span><span class="n">cfglist</span><span class="o">=</span><span class="n">cfglist</span><span class="p">,</span><span class="n">Info</span><span class="o">=</span><span class="n">thisinfo</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span> <span class="o">=</span> <span class="n">ThreePointCorr</span><span class="p">(</span><span class="n">thisnboot</span><span class="o">=</span><span class="n">thisnboot</span><span class="p">,</span><span class="n">cfglist</span><span class="o">=</span><span class="n">cfglist</span><span class="p">,</span><span class="n">Info</span><span class="o">=</span><span class="n">Info</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">thischecklist</span> <span class="o">=</span> <span class="p">[</span>  <span class="s1">&#39;nboot&#39;</span><span class="p">,</span><span class="s1">&#39;nt&#39;</span><span class="p">,</span><span class="s1">&#39;ism&#39;</span><span class="p">,</span><span class="s1">&#39;jsm&#39;</span><span class="p">,</span><span class="s1">&#39;tsink&#39;</span><span class="p">,</span><span class="s1">&#39;DS&#39;</span><span class="p">,</span><span class="s1">&#39;ppmom&#39;</span><span class="p">,</span><span class="s1">&#39;Proj&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;tsrc&#39;</span><span class="p">,</span><span class="s1">&#39;kud&#39;</span><span class="p">,</span><span class="s1">&#39;ks&#39;</span><span class="p">,</span><span class="s1">&#39;NJNfile&#39;</span><span class="p">,</span><span class="s1">&#39;FOfile&#39;</span><span class="p">,</span><span class="s1">&#39;tflowlist&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tflowlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">tflowlist</span>


        <span class="c1">## Grab some stuff (from .NJN and .FO)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJNfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">PickleFile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FOfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">flowPickleFile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nboot</span> <span class="o">=</span> <span class="n">thisnboot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">nt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nxyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">nxyz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span> <span class="o">=</span> <span class="s1">&#39;RC&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nxyz</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;x&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim_ll</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nxyz</span><span class="p">)</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;^</span><span class="si">{3}</span><span class="s1">\times &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ism</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ism</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jsm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">jsm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tsink</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">tsink</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ppmom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ppmom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Proj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">Proj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tsrc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">tsrc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kud</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">kud</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Info</span> <span class="o">=</span> <span class="n">Info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">iGuess</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkmomlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">checkmomlist</span>

        <span class="k">if</span> <span class="s1">&#39;show_cfgs&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cfgs</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;show_cfgs&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cfgs</span> <span class="o">=</span> <span class="kc">True</span>


        <span class="k">if</span> <span class="s1">&#39;tflowfit&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetTflowFit</span><span class="p">(</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;tflowfit&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetTflowFit</span><span class="p">([])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Col_Names</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;current_operator&#39;</span><span class="p">,</span><span class="s1">&#39;momentum&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;source_sink_separation&#39;</span><span class="p">,</span><span class="s1">&#39;flow_times&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        self.NJNQ_Stats DataFrame:</span>

<span class="sd">        columns =   boot,   Avg,        Std</span>

<span class="sd">        rows =      current_operator,   momenta,    time separation,    flow_times</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Fit_Col_Names</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;states&#39;</span><span class="p">,</span><span class="s1">&#39;current_operator&#39;</span><span class="p">,</span><span class="s1">&#39;momentum&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;time_fit_range&#39;</span><span class="p">,</span><span class="s1">&#39;flow_times&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Fit_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        self.NJNQ_Fit_Stats DataFrame:</span>

<span class="sd">        columns =   boot,   Avg,        Std</span>

<span class="sd">        rows =      states fitted to,   current _operator,  momenta,</span>
<span class="sd">                    time fit range ,    flow_times</span>

<span class="sd">        Avg/Std elements are pa.Series instances with:</span>
<span class="sd">            index = fit parameters</span>
<span class="sd">            values = Avg/Std values</span>
<span class="sd">        &#39;&#39;&#39;</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">SetCustomName</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">stringfn</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1">## is needed?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Info</span> <span class="o">=</span> <span class="n">Info</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">man_load_cfgs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LoadCfgs</span><span class="p">(</span><span class="n">cfglist</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">filename</span><span class="p">)</span>

<div class="viewcode-block" id="NJNQCorr.LoadCfgs"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.LoadCfgs">[docs]</a>    <span class="k">def</span> <span class="nf">LoadCfgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cfglist</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cfglist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GetCfgList</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">cfglist</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetCustomName</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">stringfn</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span></div>


<div class="viewcode-block" id="NJNQCorr.GetCfgList"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.GetCfgList">[docs]</a>    <span class="k">def</span> <span class="nf">GetCfgList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CombineCfgLists</span><span class="p">()</span></div>

<div class="viewcode-block" id="NJNQCorr.CombineCfgLists"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.CombineCfgLists">[docs]</a>    <span class="k">def</span> <span class="nf">CombineCfgLists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cfglist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">C3_cfgs</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDScomb</span><span class="p">:</span>
            <span class="n">cfglist</span> <span class="o">=</span> <span class="n">CombineCfgs</span><span class="p">(</span><span class="n">cfglist</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNsing</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">)</span>
        <span class="n">cfglist</span> <span class="o">=</span> <span class="n">CombineCfgs</span><span class="p">(</span><span class="n">cfglist</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Op_cfgs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="n">cfglist</span><span class="p">))</span></div>


<div class="viewcode-block" id="NJNQCorr.Stats"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.Stats">[docs]</a>    <span class="k">def</span> <span class="nf">Stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDScomb</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNsing</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">FlowStats</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Stats</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">lAvg</span><span class="p">,</span><span class="n">lStd</span> <span class="o">=</span> <span class="p">[],[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">itflow</span><span class="p">),</span><span class="n">iNJNQ</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">iNJNQ</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
            <span class="n">lAvg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iNJNQ</span><span class="o">.</span><span class="n">Avg</span><span class="p">)</span>
            <span class="n">lStd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iNJNQ</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
        <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Stats</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Col_Names</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lAvg</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lStd</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span></div>

<div class="viewcode-block" id="NJNQCorr.Bootstrap"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.Bootstrap">[docs]</a>    <span class="k">def</span> <span class="nf">Bootstrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">WipeData</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1">## Do not wipe the data, we need it for combining on the configuration level!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">Bootstrap</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDScomb</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNsing</span><span class="o">.</span><span class="n">Bootstrap</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">FlowBootstrap</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
        <span class="n">lNJNQ</span><span class="p">,</span><span class="n">lNJNQAvg</span><span class="p">,</span><span class="n">lNJNQStd</span> <span class="o">=</span> <span class="p">[],[],[]</span>
        <span class="n">ilist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rlist</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span>   <span class="n">linklist</span><span class="o">=</span><span class="p">[</span>  <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">gammalist</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">qform</span><span class="p">,</span>
                                                        <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">)),</span><span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">tflowlist</span><span class="p">],</span>
                                            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;BS NJNQ &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDScomb</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">icg</span><span class="p">,</span><span class="n">igamma</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">gammalist</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">icp</span><span class="p">,</span><span class="n">ip</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">qform</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">):</span>
                        <span class="n">strit</span> <span class="o">=</span> <span class="n">tstr</span><span class="p">(</span><span class="n">it</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">NJN_lambda</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">icg</span><span class="p">][</span><span class="n">icp</span><span class="p">][</span><span class="n">it</span><span class="p">]</span>
                        <span class="n">doub_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;C3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">NJN_lambda</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
                        <span class="n">sing_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNsing</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;C3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">NJN_lambda</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
                        <span class="k">for</span> <span class="n">ictflow</span><span class="p">,</span><span class="n">itflow</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">tflowlist</span><span class="p">):</span>
                            <span class="n">FO_lambda</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">ictflow</span><span class="p">]</span>
                            <span class="n">FO_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Op_cfgs</span><span class="p">[</span><span class="s1">&#39;Op&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">FO_lambda</span><span class="p">)</span>
                            <span class="n">thisdata</span> <span class="o">=</span> <span class="n">DSfundict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="p">](</span><span class="n">doub_data</span><span class="p">,</span><span class="n">sing_data</span><span class="p">)</span> <span class="o">*</span> <span class="n">FO_data</span>
                            <span class="n">thisboot</span> <span class="o">=</span> <span class="n">BootStrap</span><span class="p">(</span>   <span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;G_</span><span class="si">{3}</span><span class="s1">(&#39;</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">strit</span><span class="p">,</span><span class="n">itflow</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">,</span>
                                                                <span class="n">cfgvals</span><span class="o">=</span><span class="n">thisdata</span><span class="p">,</span><span class="n">rand_list</span><span class="o">=</span><span class="n">rlist</span><span class="p">)</span>
                            <span class="n">rlist</span> <span class="o">=</span> <span class="n">thisboot</span><span class="o">.</span><span class="n">Get_Rand_List</span><span class="p">()</span>
                            <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">strit</span><span class="p">,</span><span class="n">itflow</span><span class="p">))</span>
                            <span class="n">lNJNQ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisboot</span><span class="p">)</span>
                            <span class="n">lNJNQAvg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisboot</span><span class="o">.</span><span class="n">Avg</span><span class="p">)</span>
                            <span class="n">lNJNQStd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisboot</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span><span class="o">.</span><span class="n">Lap</span><span class="p">((</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">strit</span><span class="p">,</span><span class="n">itflow</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">icg</span><span class="p">,</span><span class="n">igamma</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">gammalist</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">icp</span><span class="p">,</span><span class="n">ip</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">qform</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">):</span>
                        <span class="n">strit</span> <span class="o">=</span> <span class="n">tstr</span><span class="p">(</span><span class="n">it</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">NJN_lambda</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">icg</span><span class="p">][</span><span class="n">icp</span><span class="p">][</span><span class="n">it</span><span class="p">])</span>
                        <span class="n">doub_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;C3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">NJN_lambda</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
                        <span class="k">for</span> <span class="n">ictflow</span><span class="p">,</span><span class="n">itflow</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">tflowlist</span><span class="p">):</span>
                            <span class="n">FO_lambda</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ictflow</span><span class="p">])</span>
                            <span class="n">FO_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Op_cfgs</span><span class="p">[</span><span class="s1">&#39;Op&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">FO_lambda</span><span class="p">)</span>
                            <span class="n">thisdata</span> <span class="o">=</span> <span class="n">doub_data</span> <span class="o">*</span> <span class="n">FO_data</span>
                            <span class="n">thisboot</span> <span class="o">=</span> <span class="n">BootStrap</span><span class="p">(</span>   <span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;G_</span><span class="si">{3}</span><span class="s1">(&#39;</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">strit</span><span class="p">,</span><span class="n">itflow</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">,</span>
                                                                                    <span class="n">cfgvals</span><span class="o">=</span><span class="n">thisdata</span><span class="p">,</span><span class="n">rand_list</span><span class="o">=</span><span class="n">rlist</span><span class="p">)</span>
                            <span class="n">rlist</span> <span class="o">=</span> <span class="n">thisboot</span><span class="o">.</span><span class="n">Get_Rand_List</span><span class="p">()</span>
                            <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">strit</span><span class="p">,</span><span class="n">itflow</span><span class="p">))</span>
                            <span class="n">lNJNQ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisboot</span><span class="p">)</span>
                            <span class="n">lNJNQAvg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisboot</span><span class="o">.</span><span class="n">Avg</span><span class="p">)</span>
                            <span class="n">lNJNQStd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisboot</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span><span class="o">.</span><span class="n">Lap</span><span class="p">((</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">strit</span><span class="p">,</span><span class="n">itflow</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Col_Names</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lNJNQ</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lNJNQAvg</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lNJNQStd</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RemoveVals</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span> <span class="n">WipeData</span><span class="p">)</span></div>

<div class="viewcode-block" id="NJNQCorr.ObsToName"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.ObsToName">[docs]</a>    <span class="k">def</span> <span class="nf">ObsToName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thisop</span><span class="p">):</span>
        <span class="n">thisobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">FlowObsToName</span><span class="p">(</span><span class="n">thisop</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">thisobs</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;\alpha_{&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;}&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NJNQCorr.SetCustomName"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.SetCustomName">[docs]</a>    <span class="k">def</span> <span class="nf">SetCustomName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">stringfn</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">stringLL</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">string</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">kappafolder</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">stream_name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">Proj</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">gammalist</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ppform</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">tsrc</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">tsink</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ism</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">jsm</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Observ</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">string</span>
        <span class="k">if</span> <span class="n">stringfn</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">kappafolder</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">stream_name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">Proj</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">gammalist</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ppform</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">qform</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">tsrc</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">tsink</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ism</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">jsm</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Observ</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">stringfn</span>
        <span class="k">if</span> <span class="n">stringLL</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span> <span class="o">=</span> <span class="s1">&#39;$&#39;</span><span class="o">+</span><span class="s1">&#39;\ &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>   <span class="bp">self</span><span class="o">.</span><span class="n">dim_ll</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">GetPionMassLab</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">stream_name</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ism</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">jsm</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ObsToName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Observ</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">qform</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span><span class="o">+</span><span class="s1">&#39;$&#39;</span> <span class="c1">## customise this how you like</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span> <span class="o">=</span> <span class="n">stringLL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SubDir</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">Proj</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ppform</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJNQdir</span> <span class="o">=</span> <span class="n">outputdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">kappafolder</span><span class="o">+</span><span class="s1">&#39;/G3/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Observ</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">SubDir</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
        <span class="n">mkdir_p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQdir</span><span class="o">+</span><span class="s1">&#39;/Pickle/&#39;</span><span class="p">)</span>
        <span class="n">mkdir_p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQdir</span><span class="o">+</span><span class="s1">&#39;/Excel/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQdir</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.xml&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQdir</span><span class="o">+</span><span class="s1">&#39;/Excel/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.xlsx&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQdir</span><span class="o">+</span><span class="s1">&#39;/Pickle/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.py3p&#39;</span></div>


    <span class="c1"># def MakeOutputFile(self):</span>
    <span class="c1">#     self.name = &#39;_&#39;.join([self.tsrc,self.ism,self.jsm])</span>
    <span class="c1">#     self.HumanFile = &#39;/&#39;+self.kappafolder+&#39;/G2/&#39;+self.name+&#39;.xml&#39;</span>
    <span class="c1">#     self.PickleFile = &#39;/&#39;+self.kappafolder+&#39;/G2/Pickle/&#39;+self.name+&#39;.py3p&#39;</span>


<div class="viewcode-block" id="NJNQCorr.ImportCfgList"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.ImportCfgList">[docs]</a>    <span class="k">def</span> <span class="nf">ImportCfgList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cfgsrclist</span><span class="p">,</span><span class="n">stream_list</span> <span class="o">=</span> <span class="s1">&#39;PreDefine&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfgsrclist</span><span class="p">,</span><span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stream_list</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span> <span class="o">=</span> <span class="n">stream_list</span>
            <span class="c1">## cfgsrclist is [cfglist , xsrclist]</span>
            <span class="c1">## cfglist must be 2-d array, first dimension is stream, second dimension is configuraiton number</span>
            <span class="c1">## xsrclist is 3-d array, first dimension is stream, second dimension is cfg number, third is xsrc number</span>
            <span class="c1">## xsrclist must have values &#39;xsrc##&#39; with no zero pre buffering</span>
            <span class="n">ilist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">xsrc_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">istream</span><span class="p">,(</span><span class="n">is_cfg</span><span class="p">,</span><span class="n">is_xsrc</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">cfgsrclist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cfgsrclist</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                <span class="k">for</span> <span class="n">icf</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">is_cfg</span><span class="p">):</span>
                    <span class="n">xsrc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">is_xsrc</span><span class="p">)</span>
                    <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">istream</span><span class="p">,</span><span class="n">is_cfg</span><span class="p">))</span>
            <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;stream&#39;</span><span class="p">,</span><span class="s1">&#39;config_number&#39;</span><span class="p">])</span>
            <span class="n">cfg_df</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cfgsrclist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;configs&#39;</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="n">cfg_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">xsrc_list</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_cfgs</span> <span class="o">=</span> <span class="n">cfg_df</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_cfgs</span> <span class="o">=</span> <span class="n">cfgsrclist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Update_Stream_List</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ncfg_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">icfg</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">istream</span><span class="p">,</span><span class="n">icfg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_cfgs</span><span class="p">[</span><span class="s1">&#39;configs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;stream&#39;</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xsrcAvg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_cfgs</span><span class="p">[</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nMeas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xsrcAvg</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ncfg_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_cfgs</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDScomb</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJNsing</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">FlowImportCfgList</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span><span class="p">))</span></div>

<div class="viewcode-block" id="NJNQCorr.Update_Stream_List"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.Update_Stream_List">[docs]</a>    <span class="k">def</span> <span class="nf">Update_Stream_List</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_cfgs</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nstream</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;stream_name&#39;</span><span class="p">):</span>
            <span class="n">old_sn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">istr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">istr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;-&#39;</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;filename&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old_sn</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old_sn</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;LegLab&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old_sn</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">istr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">istr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;-&#39;</span></div>


<div class="viewcode-block" id="NJNQCorr.RemoveVals"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.RemoveVals">[docs]</a>    <span class="k">def</span> <span class="nf">RemoveVals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">WipeData</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;C3&#39;</span> <span class="o">==</span> <span class="n">WipeData</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">RemoveVals</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDScomb</span><span class="p">:</span>  <span class="bp">self</span><span class="o">.</span><span class="n">NJNsing</span><span class="o">.</span><span class="n">RemoveVals</span><span class="p">()</span>
        <span class="k">elif</span> <span class="s1">&#39;Flow&#39;</span> <span class="o">==</span>  <span class="n">WipeData</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">FlowRemoveVals</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">WipeData</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">RemoveVals</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDScomb</span><span class="p">:</span>  <span class="bp">self</span><span class="o">.</span><span class="n">NJNsing</span><span class="o">.</span><span class="n">RemoveVals</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">FlowRemoveVals</span><span class="p">()</span></div>


<div class="viewcode-block" id="NJNQCorr.Read"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.Read">[docs]</a>    <span class="k">def</span> <span class="nf">Read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">Read</span><span class="p">(</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDScomb</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNsing</span><span class="o">.</span><span class="n">Read</span><span class="p">(</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">FlowRead</span><span class="p">(</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span></div>

    <span class="c1"># def ReadAndBoot(self):</span>
    <span class="c1">#     self.Read()</span>
    <span class="c1">#     self.Bootstrap()</span>

<div class="viewcode-block" id="NJNQCorr.ImportFitRanges"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.ImportFitRanges">[docs]</a>    <span class="k">def</span> <span class="nf">ImportFitRanges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fit_ranges</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_ranges</span> <span class="o">=</span> <span class="n">fit_ranges</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_ranges</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_ranges</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_ranges</span><span class="p">]</span></div>


<div class="viewcode-block" id="NJNQCorr.SetTflowFit"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.SetTflowFit">[docs]</a>    <span class="k">def</span> <span class="nf">SetTflowFit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tflow</span><span class="p">):</span>
        <span class="c1"># if tflow not in self.FO.tflowlist and tflow != &#39;Not Set&#39;:</span>
        <span class="c1">#     print &#39;Warning: &#39;, tflow, &#39; not in flow list, tflowfit not added&#39;</span>
        <span class="c1"># else:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tflowfit</span> <span class="o">=</span> <span class="n">tflow</span></div>

<div class="viewcode-block" id="NJNQCorr.SetTFit"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.SetTFit">[docs]</a>    <span class="k">def</span> <span class="nf">SetTFit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tsink</span><span class="p">):</span>
        <span class="c1"># if tsink not in [&#39;t&#39;+str(it) for it in xrange(1,self.nt+1)] and tsink != &#39;Not Set&#39;:</span>
        <span class="c1">#     print &#39;Warning: &#39;, tsink, &#39; not in  list, tsinkfit not added&#39;</span>
        <span class="c1"># else:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tsinkfit</span> <span class="o">=</span> <span class="n">tsink</span></div>


<div class="viewcode-block" id="NJNQCorr.ImportTwoPtFits"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.ImportTwoPtFits">[docs]</a>    <span class="k">def</span> <span class="nf">ImportTwoPtFits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">sourcepars</span><span class="p">,</span><span class="n">sinkpars</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ImportTwoPtFits</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="n">sourcepars</span><span class="p">,</span><span class="n">sinkpars</span><span class="p">)</span></div>

<div class="viewcode-block" id="NJNQCorr.GetTwoPtPars"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.GetTwoPtPars">[docs]</a>    <span class="k">def</span> <span class="nf">GetTwoPtPars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">pars</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">GetTwoPtPars</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">pars</span><span class="p">)</span></div>


    <span class="c1">## fit_ranges is list of fit ranges to fit the correlator to</span>
    <span class="c1">## formatted as fitr#-# where # are the min and max fit values.</span>
    <span class="c1">## states correspond to how many states to fit to (currenlty only working for states = 1 or 2)</span>
    <span class="c1">## C2pars is list of size 2, containing source and sink fit parameters used in the three point correlator fits</span>
    <span class="c1">## C2pars can be class instances of TwoPointCorr, Fitting, or just a list of values.</span>
    <span class="c1">## Word of caution, theb ootstraps need to have been constructed with the same configurations.</span>
    <span class="c1">## Best to have this run from RatioFunction class only.</span>

<div class="viewcode-block" id="NJNQCorr.Fit"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.Fit">[docs]</a>    <span class="k">def</span> <span class="nf">Fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">C2pars</span><span class="o">=</span><span class="s1">&#39;PreDef&#39;</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="s1">&#39;PreDef&#39;</span><span class="p">,</span><span class="n">fit_ranges</span><span class="o">=</span><span class="s1">&#39;PreDef&#39;</span><span class="p">,</span><span class="n">iGuess</span><span class="o">=</span><span class="s1">&#39;PreDef&#39;</span><span class="p">,</span><span class="n">EstDir</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">thistflowlist</span><span class="o">=</span> <span class="s1">&#39;PreDef&#39;</span><span class="p">,</span><span class="n">WipeFit</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">RunPredefFits</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;PreDef&#39;</span> <span class="ow">and</span> <span class="n">fit_ranges</span> <span class="o">==</span> <span class="s1">&#39;PreDef&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">izip</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PredefFits</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">izip</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">C2pars</span><span class="o">=</span><span class="n">C2pars</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="n">izip</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fit_ranges</span><span class="o">=</span><span class="p">[</span><span class="n">izip</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">EstDir</span><span class="o">=</span><span class="n">EstDir</span><span class="p">,</span><span class="n">WipeFit</span><span class="o">=</span><span class="n">WipeFit</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">C2pars</span><span class="o">=</span><span class="n">C2pars</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="n">izip</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fit_ranges</span><span class="o">=</span><span class="p">[</span><span class="n">izip</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">iGuess</span><span class="o">=</span><span class="n">izip</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">EstDir</span><span class="o">=</span><span class="n">EstDir</span><span class="p">,</span><span class="n">WipeFit</span><span class="o">=</span><span class="n">WipeFit</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;PreDef&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">izip</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PredefFits</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">izip</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">fit_ranges</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">izip</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">C2pars</span><span class="o">=</span><span class="n">C2pars</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="n">izip</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fit_ranges</span><span class="o">=</span><span class="p">[</span><span class="n">izip</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">EstDir</span><span class="o">=</span><span class="n">EstDir</span><span class="p">,</span><span class="n">WipeFit</span><span class="o">=</span><span class="n">WipeFit</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">C2pars</span><span class="o">=</span><span class="n">C2pars</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="n">izip</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fit_ranges</span><span class="o">=</span><span class="p">[</span><span class="n">izip</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">iGuess</span><span class="o">=</span><span class="n">izip</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">EstDir</span><span class="o">=</span><span class="n">EstDir</span><span class="p">,</span><span class="n">WipeFit</span><span class="o">=</span><span class="n">WipeFit</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">fit_ranges</span> <span class="o">==</span> <span class="s1">&#39;PreDef&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">izip</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PredefFits</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">izip</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">state</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">izip</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">C2pars</span><span class="o">=</span><span class="n">C2pars</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="n">izip</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fit_ranges</span><span class="o">=</span><span class="p">[</span><span class="n">izip</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">EstDir</span><span class="o">=</span><span class="n">EstDir</span><span class="p">,</span><span class="n">WipeFit</span><span class="o">=</span><span class="n">WipeFit</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">C2pars</span><span class="o">=</span><span class="n">C2pars</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="n">izip</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fit_ranges</span><span class="o">=</span><span class="p">[</span><span class="n">izip</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">iGuess</span><span class="o">=</span><span class="n">izip</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">EstDir</span><span class="o">=</span><span class="n">EstDir</span><span class="p">,</span><span class="n">WipeFit</span><span class="o">=</span><span class="n">WipeFit</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;PreDef&#39;</span> <span class="ow">in</span> <span class="p">[</span><span class="n">state</span><span class="p">,</span><span class="n">fit_ranges</span><span class="p">]:</span>
            <span class="n">RunPredefFits</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">iGuess</span> <span class="o">!=</span> <span class="s1">&#39;PreDef&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span> <span class="o">=</span> <span class="n">iGuess</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;state&#39;</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">state</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">C2pars</span> <span class="o">!=</span> <span class="s1">&#39;PreDef&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImportTwoPtFits</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="n">C2pars</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">C2pars</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImportFitRanges</span><span class="p">(</span><span class="n">fit_ranges</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># thisfitfun = C3OneStateFitFunNoExp</span>
            <span class="n">thisfitfun</span> <span class="o">=</span> <span class="n">C3OneStateFitFunNoExp</span>
            <span class="n">npar</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># thisfitfun = C3TwoStateFitFunNoExp</span>
            <span class="n">thisfitfun</span> <span class="o">=</span> <span class="n">C3MomTwoStateFitFunNoExp</span>
            <span class="n">npar</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">elif</span> <span class="n">state</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;fitting state is only implemented up to 2 state so far. Cannot do &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">thistflowlist</span> <span class="o">==</span> <span class="s1">&#39;PreDef&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tflowfit</span> <span class="o">==</span> <span class="s1">&#39;Not Set&#39;</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;tflowfit not set, please set by using .SetTflowFit()&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">thistflowlist</span> <span class="o">==</span> <span class="s1">&#39;All&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tflowfit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">tflowlist</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tflowfit</span> <span class="o">=</span> <span class="n">thistflowlist</span>

        <span class="n">ststr</span> <span class="o">=</span> <span class="s1">&#39;state&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="n">legstate</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;SF&#39;</span>
        <span class="n">lFit</span><span class="p">,</span><span class="n">lFitA</span><span class="p">,</span><span class="n">lFitS</span> <span class="o">=</span> <span class="p">[],[],[]</span>
        <span class="n">ilist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">itflow</span><span class="p">),</span><span class="n">gammadata</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;current_operator&#39;</span><span class="p">,</span><span class="s1">&#39;flow_times&#39;</span><span class="p">)):</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">pdata</span><span class="p">),</span><span class="n">ptwopt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gammadata</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;momentum&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">TwoPtPars</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">ifit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_ranges</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">ststr</span><span class="p">,</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">ifit</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Fit_Stats</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">WipeFit</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Fit_Stats</span><span class="o">.</span><span class="n">drop</span><span class="p">([(</span><span class="n">ststr</span><span class="p">,</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">ifit</span><span class="p">)],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">continue</span>
                    <span class="c1"># print &#39;Fitting state&#39;,str(state) ,igamma,itflow,ifit</span>
                    <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ststr</span><span class="p">,</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">ifit</span><span class="p">))</span>
                    <span class="n">ifitmin</span><span class="p">,</span><span class="n">ifitmax</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="n">unxmlfitr</span><span class="p">(</span><span class="n">ifit</span><span class="p">)))</span>
                    <span class="c1">## is this the right ordering of dictionary dimensions?</span>
                    <span class="n">tdatarange</span> <span class="o">=</span> <span class="p">[[]]</span>
                    <span class="n">ydata</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">it</span><span class="p">,</span><span class="n">tdata</span> <span class="ow">in</span> <span class="n">pdata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">itflow</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">tdata</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="k">continue</span>
                        <span class="n">tint</span> <span class="o">=</span> <span class="n">untstr</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">ifitmin</span> <span class="o">&lt;=</span> <span class="n">tint</span> <span class="o">&lt;=</span> <span class="n">ifitmax</span><span class="p">:</span>
                            <span class="n">tcurrboot</span> <span class="o">=</span> <span class="n">BootStrap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">,</span><span class="n">bootvals</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">tint</span><span class="p">)]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">)</span>
                            <span class="n">tdatarange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tcurrboot</span><span class="p">)</span>
                            <span class="n">ydata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tdata</span><span class="p">[</span><span class="n">itflow</span><span class="p">])</span>
                    <span class="n">thistlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tdatarange</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="c1">## this + 3 is just calabrated from looking at the conserved current two- and three- point correlators. Not sure why exactly.</span>
                    <span class="n">tsinkboot</span> <span class="o">=</span> <span class="n">BootStrap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">,</span><span class="n">bootvals</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tsink</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;tsink&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">)</span>
                    <span class="n">tdatarange</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">tsinkboot</span><span class="p">]</span><span class="o">*</span><span class="n">thistlen</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">iparam</span> <span class="ow">in</span> <span class="n">ptwopt</span><span class="p">:</span>
                        <span class="n">tdatarange</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">iparam</span><span class="p">]</span><span class="o">*</span><span class="n">thistlen</span><span class="p">)</span>

                    <span class="c1"># print &#39;DEBUG&#39;</span>
                    <span class="c1"># for it,iy in zip(np.rollaxis(np.array(tdatarange),1),ydata):</span>
                    <span class="c1">#     print it[0].Avg,it[1].Avg,it[2].Avg,it[3].Avg,it[4].Avg,it[5].Avg,iy.Avg</span>

                    <span class="k">if</span> <span class="n">EstDir</span><span class="p">:</span>
                        <span class="n">thisff</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">Fitting</span><span class="p">(</span><span class="n">Funs</span><span class="o">=</span><span class="p">[</span><span class="n">thisfitfun</span><span class="p">,</span><span class="n">npar</span><span class="p">,</span><span class="s1">&#39;Estimate&#39;</span><span class="p">],</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">tdatarange</span><span class="p">,</span><span class="n">ydata</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">legstate</span><span class="p">,</span><span class="n">ifit</span><span class="p">,</span><span class="n">itflow</span><span class="p">]),</span><span class="n">iGuess</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">thisff</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">Fitting</span><span class="p">(</span><span class="n">Funs</span><span class="o">=</span><span class="p">[</span><span class="n">thisfitfun</span><span class="p">,</span><span class="n">npar</span><span class="p">],</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">tdatarange</span><span class="p">,</span><span class="n">ydata</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">legstate</span><span class="p">,</span><span class="n">ifit</span><span class="p">,</span><span class="n">itflow</span><span class="p">]),</span><span class="n">iGuess</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span><span class="p">)</span>
                    <span class="n">thistest</span> <span class="o">=</span> <span class="n">thisff</span><span class="o">.</span><span class="n">FitBoots</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">thistest</span><span class="p">):</span>
                        <span class="n">lFit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisff</span><span class="p">)</span>
                        <span class="n">lFitA</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisff</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;ParamsAvg&#39;</span><span class="p">])</span>
                        <span class="n">lFitS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisff</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;ParamsStd&#39;</span><span class="p">])</span>
        <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Fit_Col_Names</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Fit_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">this_df</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="n">this_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lFit</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="n">this_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lFitA</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="n">this_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lFitS</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Fit_Stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Fit_Stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_df</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Fit_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lFit</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Fit_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lFitA</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Fit_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lFitS</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span></div>



<div class="viewcode-block" id="NJNQCorr.Write"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.Write">[docs]</a>    <span class="k">def</span> <span class="nf">Write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">FixDictArray</span><span class="p">(</span><span class="n">thislist</span><span class="p">,</span><span class="n">ikey</span><span class="p">):</span>
            <span class="n">outDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">ic</span><span class="p">,</span><span class="n">ilist</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">thislist</span><span class="p">):</span>
                <span class="n">outDict</span><span class="p">[</span><span class="n">ikey</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ic</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ilist</span>
            <span class="k">return</span> <span class="n">outDict</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDScomb</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNsing</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">FlowWrite</span><span class="p">()</span>


        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;show_cfgs&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_cfgs</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">outDict</span> <span class="o">=</span> <span class="n">ODNested</span><span class="p">()</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDScomb</span><span class="p">:</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;doub_ThreePC_File&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">HumanFile</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;sing_ThreePC_File&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNsing</span><span class="o">.</span><span class="n">HumanFile</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ThreePC_File&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">HumanFile</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;FlowOp_File&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">flowHumanFile</span>

        <span class="n">excel_params</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">outDict</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">col_key</span><span class="p">,</span><span class="n">col_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;Avg&#39;</span> <span class="ow">in</span> <span class="n">col_key</span> <span class="ow">or</span> <span class="s1">&#39;Std&#39;</span> <span class="ow">in</span> <span class="n">col_key</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">itflow</span><span class="p">),</span><span class="n">idata</span> <span class="ow">in</span> <span class="n">col_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">outDict</span><span class="p">[</span><span class="n">col_key</span><span class="p">][</span><span class="n">igamma</span><span class="p">][</span><span class="n">ip</span><span class="p">][</span><span class="n">it</span><span class="p">][</span><span class="n">itflow</span><span class="p">]</span> <span class="o">=</span> <span class="n">AvgStdToFormat</span><span class="p">(</span><span class="n">idata</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span><span class="n">idata</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>


        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Fit_Stats</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">istate</span><span class="p">,</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itr</span><span class="p">,</span><span class="n">itflow</span><span class="p">),</span><span class="n">fitdict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fitdict</span><span class="p">,</span><span class="n">ff</span><span class="o">.</span><span class="n">Fitting</span><span class="p">):</span> <span class="k">continue</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;Fits&#39;</span><span class="p">][</span><span class="n">istate</span><span class="p">][</span><span class="n">igamma</span><span class="p">][</span><span class="n">ip</span><span class="p">][</span><span class="n">itr</span><span class="p">][</span><span class="n">itflow</span><span class="p">]</span> <span class="o">=</span> <span class="n">fitdict</span><span class="o">.</span><span class="n">GetOutputDict</span><span class="p">()</span>



        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ncfg_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cfgs</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">((</span><span class="n">istream</span><span class="p">,</span><span class="n">iccfg</span><span class="p">),</span><span class="n">icfg</span><span class="p">),</span><span class="n">ixsrc_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_cfgs</span><span class="p">[</span><span class="s1">&#39;configs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_cfgs</span><span class="p">[</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;cfglist&#39;</span><span class="p">][</span><span class="n">istream</span><span class="p">][</span><span class="n">icfg</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;n_xsrc_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ixsrc_list</span><span class="p">))</span>



        <span class="c1">## Write human readable file with data</span>
        <span class="n">WriteXml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span><span class="p">,{</span><span class="s1">&#39;Results&#39;</span><span class="p">:</span><span class="n">outDict</span><span class="p">})</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ncfg_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">for</span> <span class="p">((</span><span class="n">istream</span><span class="p">,</span><span class="n">iccfg</span><span class="p">),</span><span class="n">icfg</span><span class="p">),</span><span class="n">ixsrc_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_cfgs</span><span class="p">[</span><span class="s1">&#39;configs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_cfgs</span><span class="p">[</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;cfglist&#39;</span><span class="p">][</span><span class="n">istream</span><span class="p">][</span><span class="n">icfg</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;n_xsrc_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ixsrc_list</span><span class="p">))</span>

        <span class="n">WriteExcel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">,{</span><span class="s1">&#39;NJNQ_results&#39;</span><span class="p">:</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Stats</span><span class="p">)},</span><span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_cfgs</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">excel_params</span><span class="p">)</span>

        <span class="c1">## pickles rest of data for reading</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RemoveFuns</span><span class="p">()</span>
        <span class="n">WritePickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GetFuns</span><span class="p">()</span></div>
    <span class="c1">##################################</span>

<div class="viewcode-block" id="NJNQCorr.RemoveFuns"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.RemoveFuns">[docs]</a>    <span class="k">def</span> <span class="nf">RemoveFuns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">RemoveFuns</span><span class="p">()</span></div>

<div class="viewcode-block" id="NJNQCorr.GetFuns"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.GetFuns">[docs]</a>    <span class="k">def</span> <span class="nf">GetFuns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">GetFuns</span><span class="p">()</span></div>

<div class="viewcode-block" id="NJNQCorr.ReadAndWrite"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.ReadAndWrite">[docs]</a>    <span class="k">def</span> <span class="nf">ReadAndWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">WipeData</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Read</span><span class="p">(</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bootstrap</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="c1"># self.Fit()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span></div>

<div class="viewcode-block" id="NJNQCorr.LoadPickle"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.LoadPickle">[docs]</a>    <span class="k">def</span> <span class="nf">LoadPickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">WipeData</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">CheckMom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">DefWipe</span><span class="p">:</span>
            <span class="c1"># print &#39;Loading Pickle for &#39; , self.name</span>
            <span class="n">loadeddict</span> <span class="o">=</span> <span class="n">ReadPickleWrap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span>
            <span class="n">checklist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thischecklist</span>
            <span class="k">if</span> <span class="n">CheckCfgs</span><span class="p">:</span> <span class="n">checklist</span> <span class="o">=</span> <span class="n">checklist</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;cfglist&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">CheckMom</span><span class="p">:</span> <span class="n">checklist</span> <span class="o">=</span> <span class="n">checklist</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;checkmomlist&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">CheckClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span><span class="n">loadeddict</span><span class="p">,</span><span class="n">checklist</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">loadeddict</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">Wipe_All_Fits</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Fit_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                <span class="c1"># self.read_cfgs_from_file = True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;using backupfile for &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">,</span><span class="s1">&#39;.bak.xlsx&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="n">CheckCfgs</span><span class="p">,</span><span class="n">CheckMom</span><span class="o">=</span><span class="n">CheckMom</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning, file &#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span> <span class="p">,</span> <span class="s1">&#39; has different parameters than this instance, reading and writing over file now&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ReadAndWrite</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
            <span class="c1"># self.Write()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ReadAndWrite</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span></div>



    <span class="c1">## Comparisons</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="NJNQCorr.iteritems"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.iteritems">[docs]</a>    <span class="k">def</span> <span class="nf">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span></div>

<div class="viewcode-block" id="NJNQCorr.items"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.items">[docs]</a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span></div>

<div class="viewcode-block" id="NJNQCorr.itemsAvgStd"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.itemsAvgStd">[docs]</a>    <span class="k">def</span> <span class="nf">itemsAvgStd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">outlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ivals</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Stats</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
            <span class="n">outlist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ivals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ivals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">ivals</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">outlist</span></div>

<div class="viewcode-block" id="NJNQCorr.values"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.values">[docs]</a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span></div>

<div class="viewcode-block" id="NJNQCorr.itervalues"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.itervalues">[docs]</a>    <span class="k">def</span> <span class="nf">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span></div>

<div class="viewcode-block" id="NJNQCorr.valuesAvgStd"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.valuesAvgStd">[docs]</a>    <span class="k">def</span> <span class="nf">valuesAvgStd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">outlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ivals</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Stats</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
            <span class="n">outlist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ivals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">ivals</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">outlist</span></div>

<div class="viewcode-block" id="NJNQCorr.keys"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQCorr.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Stats</span><span class="o">.</span><span class="n">index</span></div>


    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__reversed__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQ_Stats</span><span class="o">.</span><span class="n">iiloc</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span>



    <span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thiskey</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">thiskey</span><span class="p">]</span>




    <span class="c1">## unitary arithmetic operations</span>

    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span>


    <span class="k">def</span> <span class="nf">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1">## Casting, just casts the bootstrap values, ignore return value (only needed since return has to be same type).</span>


    <span class="k">def</span> <span class="nf">__complex__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="nb">complex</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">+</span><span class="mi">0</span><span class="n">j</span>

    <span class="k">def</span> <span class="nf">__int__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__float__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="k">return</span> <span class="mf">1.0</span></div>

<span class="c1">####################################################################################################################</span>
<span class="c1">####################################################################################################################</span>
<span class="c1">####################################################################################################################</span>
<span class="c1">####################################################################################################################</span>
<span class="c1">####################################################################################################################</span>


<div class="viewcode-block" id="NJNQFullCorr"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr">[docs]</a><span class="k">class</span> <span class="nc">NJNQFullCorr</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    NJNQ(q,tau,pp,t,tf,ts) uses bootstrap class</span>
<span class="sd">    pp  = sink momentum</span>
<span class="sd">    t   = source sink separation time</span>
<span class="sd">    q   = current insersion momentum</span>
<span class="sd">    tau = current insersion time</span>
<span class="sd">    tflow = flow time</span>
<span class="sd">    ts = operator insersion time (  refered to &quot;sum time&quot;, to keep in</span>
<span class="sd">                                    line with same notation for other quantities)</span>

<span class="sd">    Info is a dictionary containing information for the correlator:</span>
<span class="sd">    see comments below to see what is required.</span>
<span class="sd">    missing elements just sets field to default</span>


<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="NJNQFullCorr.Construct_NJNQFull_File"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.Construct_NJNQFull_File">[docs]</a>    <span class="k">def</span> <span class="nf">Construct_NJNQFull_File</span><span class="p">(</span><span class="n">this_file</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Construct_File_Object</span><span class="p">(</span><span class="n">this_file</span><span class="p">,</span><span class="n">NJNQFullCorr</span><span class="p">)</span></div>

    <span class="c1">## TODO: create variational flag and interface with this function.</span>

    <span class="c1">## array of all classes that inherit this class. Append this when adding new classes please!</span>
    <span class="n">parentlist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RatioCorrelators.RatioCorr&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thisnboot</span><span class="o">=</span><span class="n">nboot</span><span class="p">,</span> <span class="n">cfglist</span><span class="o">=</span><span class="p">{},</span> <span class="n">Info</span><span class="o">=</span><span class="p">{},</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">man_load_cfgs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">## initialising instance of three point correlator as NJN</span>
        <span class="c1">## DoubSing tells whether to read doublet (doub) or singlet (sing) contribution</span>
        <span class="k">if</span> <span class="s1">&#39;DoubSing&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;DoubSing&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">DSfundict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DSList (from DSDefines.py):&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">DSfundict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Doublet,Singlet type (Info[&#39;DoubSing&#39;]) not recognised&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DS</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;DoubSing&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Please set DoubSing in Info for ThreePtCorrelators &#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">isDScomb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DS</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;doub&#39;</span><span class="p">,</span><span class="s1">&#39;sing&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">FO</span> <span class="o">=</span> <span class="n">FlowOpFullSquared</span><span class="p">(</span><span class="n">thisnboot</span><span class="p">,</span><span class="n">cfglist</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span>

        <span class="n">thisinfo</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">Info</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Observ</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">thisinfo</span><span class="p">[</span><span class="s1">&#39;fo_for_cfgs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thisinfo</span><span class="p">[</span><span class="s1">&#39;fo_for_cfgs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Observ</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDScomb</span><span class="p">:</span>
            <span class="n">thisinfo</span><span class="p">[</span><span class="s1">&#39;DoubSing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;doub&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span> <span class="o">=</span> <span class="n">ThreePointCorr</span><span class="p">(</span><span class="n">thisnboot</span><span class="o">=</span><span class="n">thisnboot</span><span class="p">,</span><span class="n">cfglist</span><span class="o">=</span><span class="n">cfglist</span><span class="p">,</span><span class="n">Info</span><span class="o">=</span><span class="n">thisinfo</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

            <span class="n">singinfo</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">Info</span><span class="p">)</span>
            <span class="n">singinfo</span><span class="p">[</span><span class="s1">&#39;DoubSing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;sing&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJNsing</span> <span class="o">=</span> <span class="n">ThreePointCorr</span><span class="p">(</span><span class="n">thisnboot</span><span class="o">=</span><span class="n">thisnboot</span><span class="p">,</span><span class="n">cfglist</span><span class="o">=</span><span class="n">cfglist</span><span class="p">,</span><span class="n">Info</span><span class="o">=</span><span class="n">singinfo</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span> <span class="o">=</span> <span class="n">ThreePointCorr</span><span class="p">(</span><span class="n">thisnboot</span><span class="o">=</span><span class="n">thisnboot</span><span class="p">,</span><span class="n">cfglist</span><span class="o">=</span><span class="n">cfglist</span><span class="p">,</span><span class="n">Info</span><span class="o">=</span><span class="n">Info</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">thischecklist</span> <span class="o">=</span> <span class="p">[</span>  <span class="s1">&#39;nboot&#39;</span><span class="p">,</span><span class="s1">&#39;nt&#39;</span><span class="p">,</span><span class="s1">&#39;ism&#39;</span><span class="p">,</span><span class="s1">&#39;jsm&#39;</span><span class="p">,</span><span class="s1">&#39;tsink&#39;</span><span class="p">,</span><span class="s1">&#39;DS&#39;</span><span class="p">,</span><span class="s1">&#39;ppmom&#39;</span><span class="p">,</span><span class="s1">&#39;Proj&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;tsrc&#39;</span><span class="p">,</span><span class="s1">&#39;kud&#39;</span><span class="p">,</span><span class="s1">&#39;ks&#39;</span><span class="p">,</span><span class="s1">&#39;NJNfile&#39;</span><span class="p">,</span><span class="s1">&#39;FOfile&#39;</span><span class="p">,</span><span class="s1">&#39;tflowlist&#39;</span><span class="p">,</span><span class="s1">&#39;boot_tsum_list&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tflowlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">tflowlist</span>


        <span class="c1">## Grab some stuff (from .NJN and .FO)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJNfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">PickleFile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FOfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">flowPickleFile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nboot</span> <span class="o">=</span> <span class="n">thisnboot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">nt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nxyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">nxyz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span> <span class="o">=</span> <span class="s1">&#39;RC&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nxyz</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;x&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim_ll</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nxyz</span><span class="p">)</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;^</span><span class="si">{3}</span><span class="s1">\times &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ism</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ism</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jsm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">jsm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tsink</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">tsink</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ppmom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ppmom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Proj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">Proj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tsrc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">tsrc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kud</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">kud</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Info</span> <span class="o">=</span> <span class="n">Info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">iGuess</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkmomlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">checkmomlist</span>

        <span class="k">if</span> <span class="s1">&#39;tsum_fit_list&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tsum_fit_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">tsumstr</span><span class="p">,</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;tsum_fit_list&#39;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tsum_fit_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">tsumstr</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">))))</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">boot_tsum_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">))</span>

        <span class="c1"># if &#39;boot_tsum_list&#39; in Info.keys():</span>
        <span class="c1">#     self.boot_tsum_list = map(untstr,Info[&#39;boot_tsum_list&#39;])</span>
        <span class="c1"># else:</span>
        <span class="c1">#     self.boot_tsum_list = range(self.nt)</span>
        <span class="c1">#</span>
        <span class="c1"># new_blist = []</span>
        <span class="c1"># for itboot in self.boot_tsum_list:</span>
        <span class="c1">#     if 0 &lt;= itboot &lt; self.nt:</span>
        <span class="c1">#         new_blist.append(itboot)</span>
        <span class="c1"># self.boot_tsum_list = new_blist</span>


        <span class="k">if</span> <span class="s1">&#39;show_cfgs&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cfgs</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;show_cfgs&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cfgs</span> <span class="o">=</span> <span class="kc">True</span>


        <span class="k">if</span> <span class="s1">&#39;tflowfit&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetTflowFit</span><span class="p">(</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;tflowfit&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetTflowFit</span><span class="p">([])</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        I&#39;m thinking types could be:</span>
<span class="sd">        from_src_sink_sum       is summing from source and sink, outwards</span>
<span class="sd">        from_src_sum            is summing from source</span>
<span class="sd">        from_sink_sum           is summing from sink</span>
<span class="sd">        from_current_sum        is summing from current point</span>

<span class="sd">        from_src_sym_sum                is summing symmetrically from source</span>
<span class="sd">        from_sink_sym_sum               is summing symmetrically from sink</span>
<span class="sd">        from_current_sym_sum            is summing symmetrically from current poin</span>

<span class="sd">        from_src_sink           is values from source and sink, outwards</span>
<span class="sd">        from_src                is values from source</span>
<span class="sd">        from_sink               is values from sink</span>
<span class="sd">        from_current            is values from current point</span>

<span class="sd">        from_src_sym                is values symmetrically from source</span>
<span class="sd">        from_sink_sym               is values symmetrically from sink</span>
<span class="sd">        from_current_sym            is values symmetrically from current point</span>

<span class="sd">        etc...</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;op_trange_sum_type_3pt&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_type</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;op_trange_sum_type_3pt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;)None&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_type</span> <span class="o">=</span> <span class="s1">&#39;from_src_sink&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_type</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">,</span><span class="s1">&#39;sr&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;sink&#39;</span><span class="p">,</span><span class="s1">&#39;si&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span><span class="s1">&#39;su&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;current&#39;</span><span class="p">,</span><span class="s1">&#39;cu&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;sym&#39;</span><span class="p">,</span><span class="s1">&#39;sy&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Col_Names</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;current_operator&#39;</span><span class="p">,</span><span class="s1">&#39;momentum&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;source_sink_separation&#39;</span><span class="p">,</span><span class="s1">&#39;flow_times&#39;</span><span class="p">,</span><span class="s1">&#39;flow_op_trange&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        self.NJNQFull_Stats DataFrame:</span>

<span class="sd">        columns =   boot,   Avg,        Std</span>

<span class="sd">        rows =      current_operator,   momenta,    time separation,</span>
<span class="sd">                    flow_times,         flow op trange</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">NJNQInt_Col_Names</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;current_operator&#39;</span><span class="p">,</span><span class="s1">&#39;momentum&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;source_sink_separation&#39;</span><span class="p">,</span><span class="s1">&#39;flow_times&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJNQInt_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        self.NJNQFull_Stats DataFrame:</span>

<span class="sd">        columns =   boot,   Avg,        Std</span>

<span class="sd">        rows =      current_operator,   momenta,    time separation,    flow_times</span>
<span class="sd">        &#39;&#39;&#39;</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Fit_Col_Names</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;states&#39;</span><span class="p">,</span><span class="s1">&#39;current_operator&#39;</span><span class="p">,</span><span class="s1">&#39;momentum&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;time_fit_range&#39;</span><span class="p">,</span><span class="s1">&#39;flow_times&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Fit_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        self.NJNQFull_Fit_Stats DataFrame:</span>

<span class="sd">        columns =   boot,   Avg,        Std</span>

<span class="sd">        rows =      states fitted to,   current _operator,  momenta,</span>
<span class="sd">                    time fit range ,    flow_times</span>

<span class="sd">        Avg/Std elements are pa.Series instances with:</span>
<span class="sd">            index = fit parameters</span>
<span class="sd">            values = Avg/Std values</span>
<span class="sd">        &#39;&#39;&#39;</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">SetCustomName</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">stringfn</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
        <span class="c1">## is needed?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Info</span> <span class="o">=</span> <span class="n">Info</span>


        <span class="k">if</span> <span class="ow">not</span> <span class="n">man_load_cfgs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LoadCfgs</span><span class="p">(</span><span class="n">cfglist</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">filename</span><span class="p">)</span>

<div class="viewcode-block" id="NJNQFullCorr.LoadCfgs"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.LoadCfgs">[docs]</a>    <span class="k">def</span> <span class="nf">LoadCfgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cfglist</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cfglist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GetCfgList</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">cfglist</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetCustomName</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">stringfn</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span></div>




<div class="viewcode-block" id="NJNQFullCorr.GetCfgList"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.GetCfgList">[docs]</a>    <span class="k">def</span> <span class="nf">GetCfgList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CombineCfgLists</span><span class="p">()</span></div>

<div class="viewcode-block" id="NJNQFullCorr.CombineCfgLists"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.CombineCfgLists">[docs]</a>    <span class="k">def</span> <span class="nf">CombineCfgLists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cfglist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">C3_cfgs</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDScomb</span><span class="p">:</span>
            <span class="n">cfglist</span> <span class="o">=</span> <span class="n">CombineCfgs</span><span class="p">(</span><span class="n">cfglist</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNsing</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">)</span>
        <span class="n">cfglist</span> <span class="o">=</span> <span class="n">CombineCfgs</span><span class="p">(</span><span class="n">cfglist</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Op_cfgs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="n">cfglist</span><span class="p">))</span></div>


<div class="viewcode-block" id="NJNQFullCorr.Stats"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.Stats">[docs]</a>    <span class="k">def</span> <span class="nf">Stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDScomb</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNsing</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">FlowStats</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Stats</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">lAvg</span><span class="p">,</span><span class="n">lStd</span> <span class="o">=</span> <span class="p">[],[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">its</span><span class="p">),</span><span class="n">iNJNQFull</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">iNJNQFull</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
            <span class="n">lAvg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iNJNQFull</span><span class="o">.</span><span class="n">Avg</span><span class="p">)</span>
            <span class="n">lStd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iNJNQFull</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
        <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Stats</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Col_Names</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lAvg</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lStd</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span></div>

<div class="viewcode-block" id="NJNQFullCorr.Create_NJNQ_fun"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.Create_NJNQ_fun">[docs]</a>    <span class="k">def</span> <span class="nf">Create_NJNQ_fun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">it_sum</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">NJNQ_fun</span><span class="p">(</span><span class="n">this_df</span><span class="p">):</span>
            <span class="c1"># print &#39;DEBUG&#39;</span>
            <span class="c1"># print np.array(this_df[&#39;iC3&#39;]).shape</span>
            <span class="c1"># print np.array(this_df[&#39;iFO&#39;])[:,:].shape, it_sum</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">this_df</span><span class="p">[</span><span class="s1">&#39;iC3&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">this_df</span><span class="p">[</span><span class="s1">&#39;iFO&#39;</span><span class="p">])[:,</span><span class="n">it_sum</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;NaN&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">NJNQ_fun</span></div>

<div class="viewcode-block" id="NJNQFullCorr.Create_Tsrc_Fun"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.Create_Tsrc_Fun">[docs]</a>    <span class="k">def</span> <span class="nf">Create_Tsrc_Fun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ictflow</span><span class="p">,</span><span class="n">it_curr</span><span class="p">,</span><span class="n">it_sink</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">it_sink</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">it_sink</span> <span class="o">=</span> <span class="n">untstr</span><span class="p">(</span><span class="n">it_sink</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;tsink&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">it_curr</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">it_curr</span> <span class="o">=</span> <span class="n">untstr</span><span class="p">(</span><span class="n">it_curr</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">Tsrc_Fun</span><span class="p">(</span><span class="n">this_series</span><span class="p">):</span>
            <span class="c1">## tsrc_list = [ ixsrc ]</span>
            <span class="n">out_list</span><span class="p">,</span><span class="n">tflow_rolled</span> <span class="o">=</span> <span class="p">[],[]</span>
            <span class="n">flow_op</span> <span class="o">=</span> <span class="n">this_series</span><span class="p">[</span><span class="s1">&#39;Op&#39;</span><span class="p">][</span><span class="n">ictflow</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">itsrc</span> <span class="ow">in</span> <span class="n">this_series</span><span class="p">[</span><span class="s1">&#39;tsrc_list&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="s1">&#39;from_current&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_type</span><span class="p">:</span>
                        <span class="n">n_roll</span> <span class="o">=</span> <span class="p">(</span><span class="n">itsrc</span><span class="o">+</span><span class="n">it_curr</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span>
                    <span class="k">elif</span> <span class="s1">&#39;src&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_type</span><span class="p">:</span>
                        <span class="n">n_roll</span> <span class="o">=</span> <span class="n">itsrc</span>
                    <span class="k">elif</span> <span class="s1">&#39;from_sink&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_type</span><span class="p">:</span>
                        <span class="n">n_roll</span> <span class="o">=</span> <span class="p">(</span><span class="n">itsrc</span><span class="o">+</span><span class="n">it_sink</span><span class="p">)</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_type</span> <span class="o">+</span> <span class="s1">&#39; sum time not supported.&#39;</span><span class="p">)</span>
                    <span class="c1">## op_series = [ tflow, t_src ]</span>
                    <span class="n">tflow_rolled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">flow_op</span><span class="p">,</span><span class="o">-</span><span class="n">n_roll</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">&#39;_src_sink&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_type</span><span class="p">:</span>
                        <span class="n">tflow_rolled_tsink</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">tflow_rolled</span><span class="p">,</span><span class="o">-</span><span class="n">it_sink</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="s1">&#39;_sym&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_type</span><span class="p">:</span>
                            <span class="n">tflow_rolled</span> <span class="o">=</span> <span class="n">tflow_rolled</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">tflow_rolled</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
                            <span class="n">tflow_rolled_tsink</span> <span class="o">=</span> <span class="n">tflow_rolled_tsink</span><span class="o">+</span><span class="n">tflow_rolled_tsink</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">elif</span> <span class="s1">&#39;_rev&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_type</span><span class="p">:</span>
                            <span class="n">tflow_rolled</span> <span class="o">=</span> <span class="n">tflow_rolled</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">tflow_rolled_tsink</span> <span class="o">=</span> <span class="n">tflow_rolled_tsink</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">tflow_rolled</span> <span class="o">=</span> <span class="p">(</span><span class="n">tflow_rolled</span> <span class="o">+</span> <span class="n">tflow_rolled_tsink</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
                    <span class="k">elif</span> <span class="s1">&#39;_rev&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_type</span><span class="p">:</span>
                        <span class="n">tflow_rolled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">tflow_rolled</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="s1">&#39;_sym&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_type</span><span class="p">:</span>
                        <span class="n">tflow_rolled</span> <span class="o">=</span> <span class="n">tflow_rolled</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">tflow_rolled</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">&#39;_sum&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_type</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s1">&#39;_sym&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_type</span> <span class="ow">and</span> <span class="s1">&#39;_src_sink&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_type</span><span class="p">:</span>
                            <span class="n">tflow_rolled</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">tflow_rolled</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">2.</span>
                            <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="o">/</span><span class="mf">2.</span><span class="p">:</span>
                                <span class="n">tflow_rolled</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tflow_rolled</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span><span class="o">/</span><span class="mi">2</span>
                        <span class="n">out_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">tflow_rolled</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">out_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tflow_rolled</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;File Error:&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">CfgFile</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">flowCfgFile</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;error contructing function for &#39;</span><span class="p">,</span><span class="n">ictflow</span><span class="p">,</span><span class="n">it_curr</span><span class="p">,</span><span class="n">it_sink</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;this locations list is:&#39;</span> <span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">this_series</span><span class="o">.</span><span class="n">name</span><span class="p">)))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;tsrc_list for this location is&#39;</span><span class="p">,</span> <span class="n">this_series</span><span class="p">[</span><span class="s1">&#39;tsrc_list&#39;</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Full series data:&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">this_series</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="s1">&#39;Failed&#39;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;iFO&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">out_list</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;iFO&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">Tsrc_Fun</span></div>


<div class="viewcode-block" id="NJNQFullCorr.Bootstrap"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.Bootstrap">[docs]</a>    <span class="k">def</span> <span class="nf">Bootstrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">WipeData</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1">## Do not wipe the data, we need it for combining on the configuration level!</span>
        <span class="c1"># self.NJN.Bootstrap(WipeData=False,DefWipe=DefWipe)</span>
        <span class="c1"># if self.isDScomb: self.NJNsing.Bootstrap(WipeData=False,DefWipe=DefWipe)</span>
        <span class="c1"># self.FO.FlowBootstrap(WipeData=False,show_timer=False)</span>
        <span class="k">if</span> <span class="s1">&#39;C3&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">C3_cfgs</span> <span class="ow">or</span> <span class="s1">&#39;FO&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Op_cfgs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Read</span><span class="p">(</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
        <span class="n">lNJNQFull</span><span class="p">,</span><span class="n">lNJNQFullAvg</span><span class="p">,</span><span class="n">lNJNQFullStd</span> <span class="o">=</span> <span class="p">[],[],[]</span>
        <span class="n">lNJNQInt</span><span class="p">,</span><span class="n">lNJNQIntAvg</span><span class="p">,</span><span class="n">lNJNQIntStd</span> <span class="o">=</span> <span class="p">[],[],[]</span>
        <span class="n">ilist</span><span class="p">,</span><span class="n">iIntlist</span> <span class="o">=</span> <span class="p">[],[]</span>
        <span class="n">rlist</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Op_cfgs</span><span class="p">[</span><span class="s1">&#39;tsrc_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;tsrc_list&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span>   <span class="n">linklist</span><span class="o">=</span><span class="p">[</span>  <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">gammalist</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">qform</span><span class="p">,</span>
                                                        <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">)),</span><span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">tflowlist</span><span class="p">,</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">boot_tsum_list</span><span class="p">],</span>
                                            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;BS NJNQFull &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDScomb</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">icg</span><span class="p">,</span><span class="n">igamma</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">gammalist</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">icp</span><span class="p">,</span><span class="n">ip</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">qform</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">):</span>
                        <span class="n">strit</span> <span class="o">=</span> <span class="n">tstr</span><span class="p">(</span><span class="n">it</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                        <span class="k">def</span> <span class="nf">C3_pick_fun</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">icg</span><span class="p">][</span><span class="n">icp</span><span class="p">][</span><span class="n">it</span><span class="p">])</span>
                        <span class="n">doub_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;C3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">C3_pick_fun</span><span class="p">)</span>
                        <span class="n">sing_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNsing</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;C3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">C3_pick_fun</span><span class="p">)</span>
                        <span class="n">thisdata</span> <span class="o">=</span> <span class="n">DSfundict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="p">](</span><span class="n">doub_data</span><span class="p">,</span><span class="n">sing_data</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;iC3&#39;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">ictflow</span><span class="p">,</span><span class="n">itflow</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">tflowlist</span><span class="p">):</span>
                            <span class="n">FO_lambda</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ictflow</span><span class="p">])</span>
                            <span class="n">FO_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Op_cfgs</span><span class="p">[</span><span class="s1">&#39;Op&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">FO_lambda</span><span class="p">)</span>
                            <span class="n">passdata</span> <span class="o">=</span> <span class="n">thisdata</span><span class="p">[</span><span class="s1">&#39;iC3&#39;</span><span class="p">]</span><span class="o">*</span> <span class="n">FO_data</span>
                            <span class="n">passdata</span> <span class="o">=</span> <span class="n">passdata</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                            <span class="n">thisboot</span> <span class="o">=</span> <span class="n">BootStrap</span><span class="p">(</span>   <span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;G_</span><span class="si">{3}</span><span class="s1">(&#39;</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">strit</span><span class="p">,</span><span class="n">itflow</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">,</span>
                                                                        <span class="n">cfgvals</span><span class="o">=</span><span class="n">passdata</span><span class="p">,</span><span class="n">rand_list</span><span class="o">=</span><span class="n">rlist</span><span class="p">)</span>
                            <span class="n">rlist</span> <span class="o">=</span> <span class="n">thisboot</span><span class="o">.</span><span class="n">Get_Rand_List</span><span class="p">()</span>
                            <span class="n">iIntlist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">strit</span><span class="p">,</span><span class="n">itflow</span><span class="p">))</span>
                            <span class="n">lNJNQInt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisboot</span><span class="p">)</span>
                            <span class="n">lNJNQIntAvg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisboot</span><span class="o">.</span><span class="n">Avg</span><span class="p">)</span>
                            <span class="n">lNJNQIntStd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisboot</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
                            <span class="n">thisdata</span><span class="p">[</span><span class="s1">&#39;iFO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Op_cfgs</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Create_Tsrc_Fun</span><span class="p">(</span><span class="n">ictflow</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tsink</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="s1">&#39;iFO&#39;</span><span class="p">]</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thisdata</span><span class="p">[</span><span class="s1">&#39;iFO&#39;</span><span class="p">],</span><span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">thisdata</span><span class="p">[</span><span class="s1">&#39;iFO&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Failed&#39;</span><span class="p">:</span> <span class="k">continue</span>
                            <span class="k">for</span> <span class="n">it_sum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">boot_tsum_list</span><span class="p">:</span>
                                <span class="n">tsum_str</span> <span class="o">=</span> <span class="n">tstr</span><span class="p">(</span><span class="n">it_sum</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;ts&#39;</span><span class="p">)</span>
                                <span class="n">combdata</span> <span class="o">=</span> <span class="n">thisdata</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Create_NJNQ_fun</span><span class="p">(</span><span class="n">it_sum</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">combdata</span><span class="p">,(</span><span class="nb">float</span><span class="p">))</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">combdata</span><span class="p">):</span> <span class="k">continue</span>
                                <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">strit</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">tsum_str</span><span class="p">))</span>
                                <span class="n">thisboot</span> <span class="o">=</span> <span class="n">BootStrap</span><span class="p">(</span>   <span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;G_</span><span class="si">{3}</span><span class="s1">(&#39;</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">strit</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">tsum_str</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">,</span>
                                                                                        <span class="n">cfgvals</span><span class="o">=</span><span class="n">combdata</span><span class="p">,</span><span class="n">rand_list</span><span class="o">=</span><span class="n">rlist</span><span class="p">)</span>
                                <span class="n">lNJNQFull</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisboot</span><span class="p">)</span>
                                <span class="n">lNJNQFullAvg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisboot</span><span class="o">.</span><span class="n">Avg</span><span class="p">)</span>
                                <span class="n">lNJNQFullStd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisboot</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span><span class="o">.</span><span class="n">Lap</span><span class="p">((</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">strit</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">tsum_str</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">icg</span><span class="p">,</span><span class="n">igamma</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">gammalist</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">icp</span><span class="p">,</span><span class="n">ip</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">qform</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">):</span>
                        <span class="n">strit</span> <span class="o">=</span> <span class="n">tstr</span><span class="p">(</span><span class="n">it</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                        <span class="k">def</span> <span class="nf">C3_pick_fun</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">icg</span><span class="p">][</span><span class="n">icp</span><span class="p">][</span><span class="n">it</span><span class="p">])</span>
                        <span class="n">thisdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;C3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">C3_pick_fun</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;iC3&#39;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">ictflow</span><span class="p">,</span><span class="n">itflow</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">tflowlist</span><span class="p">):</span>
                            <span class="n">FO_lambda</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ictflow</span><span class="p">])</span>
                            <span class="n">FO_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Op_cfgs</span><span class="p">[</span><span class="s1">&#39;Op&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">FO_lambda</span><span class="p">)</span>
                            <span class="n">passdata</span> <span class="o">=</span> <span class="n">thisdata</span><span class="p">[</span><span class="s1">&#39;iC3&#39;</span><span class="p">]</span><span class="o">*</span> <span class="n">FO_data</span>
                            <span class="n">passdata</span> <span class="o">=</span> <span class="n">passdata</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                            <span class="n">thisboot</span> <span class="o">=</span> <span class="n">BootStrap</span><span class="p">(</span>   <span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;G_</span><span class="si">{3}</span><span class="s1">(&#39;</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">strit</span><span class="p">,</span><span class="n">itflow</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">,</span>
                                                    <span class="n">cfgvals</span><span class="o">=</span><span class="n">passdata</span><span class="p">,</span><span class="n">rand_list</span><span class="o">=</span><span class="n">rlist</span><span class="p">)</span>
                            <span class="n">rlist</span> <span class="o">=</span> <span class="n">thisboot</span><span class="o">.</span><span class="n">Get_Rand_List</span><span class="p">()</span>
                            <span class="n">iIntlist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">strit</span><span class="p">,</span><span class="n">itflow</span><span class="p">))</span>
                            <span class="n">lNJNQInt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisboot</span><span class="p">)</span>
                            <span class="n">lNJNQIntAvg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisboot</span><span class="o">.</span><span class="n">Avg</span><span class="p">)</span>
                            <span class="n">lNJNQIntStd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisboot</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
                            <span class="n">thisdata</span><span class="p">[</span><span class="s1">&#39;iFO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Op_cfgs</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Create_Tsrc_Fun</span><span class="p">(</span><span class="n">ictflow</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tsink</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="s1">&#39;iFO&#39;</span><span class="p">]</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thisdata</span><span class="p">[</span><span class="s1">&#39;iFO&#39;</span><span class="p">],</span><span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">thisdata</span><span class="p">[</span><span class="s1">&#39;iFO&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Failed&#39;</span><span class="p">:</span> <span class="k">continue</span>
                            <span class="k">for</span> <span class="n">it_sum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">boot_tsum_list</span><span class="p">:</span>
                                <span class="n">tsum_str</span> <span class="o">=</span> <span class="n">tstr</span><span class="p">(</span><span class="n">it_sum</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;ts&#39;</span><span class="p">)</span>
                                <span class="n">combdata</span> <span class="o">=</span> <span class="n">thisdata</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Create_NJNQ_fun</span><span class="p">(</span><span class="n">it_sum</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">combdata</span><span class="p">,(</span><span class="nb">float</span><span class="p">))</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">combdata</span><span class="p">):</span> <span class="k">continue</span>
                                <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">strit</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">tsum_str</span><span class="p">))</span>
                                <span class="n">thisboot</span> <span class="o">=</span> <span class="n">BootStrap</span><span class="p">(</span>   <span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;G_</span><span class="si">{3}</span><span class="s1">(&#39;</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">strit</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">tsum_str</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">,</span>
                                                                                        <span class="n">cfgvals</span><span class="o">=</span><span class="n">combdata</span><span class="p">,</span><span class="n">rand_list</span><span class="o">=</span><span class="n">rlist</span><span class="p">)</span>
                                <span class="n">lNJNQFull</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisboot</span><span class="p">)</span>
                                <span class="n">lNJNQFullAvg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisboot</span><span class="o">.</span><span class="n">Avg</span><span class="p">)</span>
                                <span class="n">lNJNQFullStd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisboot</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">show_timer</span><span class="p">:</span> <span class="n">thistimer</span><span class="o">.</span><span class="n">Lap</span><span class="p">((</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">strit</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">tsum_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Col_Names</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lNJNQFull</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lNJNQFullAvg</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lNJNQFullStd</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">iIntlist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">iIntlist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQInt_Col_Names</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJNQInt_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lNJNQInt</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJNQInt_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lNJNQIntAvg</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJNQInt_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lNJNQIntStd</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RemoveVals</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span> <span class="n">WipeData</span><span class="p">)</span></div>

<div class="viewcode-block" id="NJNQFullCorr.ObsToName"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.ObsToName">[docs]</a>    <span class="k">def</span> <span class="nf">ObsToName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thisop</span><span class="p">):</span>
        <span class="n">thisobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">FlowObsToName</span><span class="p">(</span><span class="n">thisop</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">thisobs</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;\alpha_{&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;}&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NJNQFullCorr.SetCustomName"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.SetCustomName">[docs]</a>    <span class="k">def</span> <span class="nf">SetCustomName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">stringfn</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">stringLL</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">string</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>  <span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">kappafolder</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">stream_name</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">Proj</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">gammalist</span><span class="p">),</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">qform</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ppform</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">tsrc</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">tsink</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ism</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">jsm</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Observ</span><span class="p">])</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">string</span>
        <span class="k">if</span> <span class="n">stringfn</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">kappafolder</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">stream_name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">Proj</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">gammalist</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ppform</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">qform</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">tsrc</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">tsink</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ism</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">jsm</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Observ</span><span class="p">])</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">stringfn</span>
        <span class="k">if</span> <span class="n">stringLL</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span> <span class="o">=</span> <span class="s1">&#39;$&#39;</span><span class="o">+</span><span class="s1">&#39;\ &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>   <span class="bp">self</span><span class="o">.</span><span class="n">dim_ll</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">GetPionMassLab</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">stream_name</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ism</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">jsm</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ObsToName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Observ</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">qform</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> \
                                            <span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">tr_sum_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39;\ &#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;$&#39;</span> <span class="c1">## customise this how you like</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span> <span class="o">=</span> <span class="n">stringLL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SubDir</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">Proj</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ppform</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFulldir</span> <span class="o">=</span> <span class="n">outputdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">kappafolder</span><span class="o">+</span><span class="s1">&#39;/G3/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Observ</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">SubDir</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
        <span class="n">mkdir_p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQFulldir</span><span class="o">+</span><span class="s1">&#39;/Pickle/&#39;</span><span class="p">)</span>
        <span class="n">mkdir_p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQFulldir</span><span class="o">+</span><span class="s1">&#39;/Excel/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFulldir</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.xml&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFulldir</span><span class="o">+</span><span class="s1">&#39;/Excel/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.xlsx&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFulldir</span><span class="o">+</span><span class="s1">&#39;/Pickle/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.py3p&#39;</span></div>


    <span class="c1"># def MakeOutputFile(self):</span>
    <span class="c1">#     self.name = &#39;_&#39;.join([self.tsrc,self.ism,self.jsm])</span>
    <span class="c1">#     self.HumanFile = &#39;/&#39;+self.kappafolder+&#39;/G2/&#39;+self.name+&#39;.xml&#39;</span>
    <span class="c1">#     self.PickleFile = &#39;/&#39;+self.kappafolder+&#39;/G2/Pickle/&#39;+self.name+&#39;.py3p&#39;</span>


<div class="viewcode-block" id="NJNQFullCorr.ImportCfgList"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.ImportCfgList">[docs]</a>    <span class="k">def</span> <span class="nf">ImportCfgList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cfgsrclist</span><span class="p">,</span><span class="n">stream_list</span> <span class="o">=</span> <span class="s1">&#39;PreDefine&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfgsrclist</span><span class="p">,</span><span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stream_list</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span> <span class="o">=</span> <span class="n">stream_list</span>
            <span class="c1">## cfgsrclist is [cfglist , xsrclist]</span>
            <span class="c1">## cfglist must be 2-d array, first dimension is stream, second dimension is configuraiton number</span>
            <span class="c1">## xsrclist is 3-d array, first dimension is stream, second dimension is cfg number, third is xsrc number</span>
            <span class="c1">## xsrclist must have values &#39;xsrc##&#39; with no zero pre buffering</span>
            <span class="n">ilist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">xsrc_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">istream</span><span class="p">,(</span><span class="n">is_cfg</span><span class="p">,</span><span class="n">is_xsrc</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">cfgsrclist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cfgsrclist</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                <span class="k">for</span> <span class="n">icf</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">is_cfg</span><span class="p">):</span>
                    <span class="n">xsrc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">is_xsrc</span><span class="p">)</span>
                    <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">istream</span><span class="p">,</span><span class="n">is_cfg</span><span class="p">))</span>
            <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;stream&#39;</span><span class="p">,</span><span class="s1">&#39;config_number&#39;</span><span class="p">])</span>
            <span class="n">cfg_df</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cfgsrclist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;configs&#39;</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="n">cfg_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">xsrc_list</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_cfgs</span> <span class="o">=</span> <span class="n">cfg_df</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_cfgs</span> <span class="o">=</span> <span class="n">cfgsrclist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Update_Stream_List</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ncfg_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">icfg</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">istream</span><span class="p">,</span><span class="n">icfg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_cfgs</span><span class="p">[</span><span class="s1">&#39;configs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;stream&#39;</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xsrcAvg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_cfgs</span><span class="p">[</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nMeas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xsrcAvg</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ncfg_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_cfgs</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDScomb</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJNsing</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">FlowImportCfgList</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span><span class="p">))</span></div>


<div class="viewcode-block" id="NJNQFullCorr.Update_Stream_List"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.Update_Stream_List">[docs]</a>    <span class="k">def</span> <span class="nf">Update_Stream_List</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_cfgs</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nstream</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;stream_name&#39;</span><span class="p">):</span>
            <span class="n">old_sn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">istr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">istr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;-&#39;</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;filename&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old_sn</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old_sn</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;LegLab&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old_sn</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">istr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">istr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;-&#39;</span></div>


<div class="viewcode-block" id="NJNQFullCorr.RemoveVals"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.RemoveVals">[docs]</a>    <span class="k">def</span> <span class="nf">RemoveVals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">WipeData</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;C3&#39;</span> <span class="o">==</span> <span class="n">WipeData</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">RemoveVals</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDScomb</span><span class="p">:</span>  <span class="bp">self</span><span class="o">.</span><span class="n">NJNsing</span><span class="o">.</span><span class="n">RemoveVals</span><span class="p">()</span>
        <span class="k">elif</span> <span class="s1">&#39;Flow&#39;</span> <span class="o">==</span>  <span class="n">WipeData</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">FlowRemoveVals</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">WipeData</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">RemoveVals</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDScomb</span><span class="p">:</span>  <span class="bp">self</span><span class="o">.</span><span class="n">NJNsing</span><span class="o">.</span><span class="n">RemoveVals</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">FlowRemoveVals</span><span class="p">()</span></div>


<div class="viewcode-block" id="NJNQFullCorr.Read"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.Read">[docs]</a>    <span class="k">def</span> <span class="nf">Read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;C3&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">Read</span><span class="p">(</span><span class="n">Full</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDScomb</span> <span class="ow">and</span> <span class="s1">&#39;C3&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNsing</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJNsing</span><span class="o">.</span><span class="n">Read</span><span class="p">(</span><span class="n">Full</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;Op&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Op_cfgs</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">FlowRead</span><span class="p">(</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span></div>
        <span class="c1"># print str(self.FO.Op_cfgs[&#39;Op&#39;])</span>

    <span class="c1"># def ReadAndBoot(self):</span>
    <span class="c1">#     self.Read()</span>
    <span class="c1">#     self.Bootstrap()</span>

<div class="viewcode-block" id="NJNQFullCorr.ImportFitRanges"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.ImportFitRanges">[docs]</a>    <span class="k">def</span> <span class="nf">ImportFitRanges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fit_ranges</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_ranges</span> <span class="o">=</span> <span class="n">fit_ranges</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_ranges</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_ranges</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_ranges</span><span class="p">]</span></div>


<div class="viewcode-block" id="NJNQFullCorr.SetTflowFit"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.SetTflowFit">[docs]</a>    <span class="k">def</span> <span class="nf">SetTflowFit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tflow</span><span class="p">):</span>
        <span class="c1"># if tflow not in self.FO.tflowlist and tflow != &#39;Not Set&#39;:</span>
        <span class="c1">#     print &#39;Warning: &#39;, tflow, &#39; not in flow list, tflowfit not added&#39;</span>
        <span class="c1"># else:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tflowfit</span> <span class="o">=</span> <span class="n">tflow</span></div>

<div class="viewcode-block" id="NJNQFullCorr.SetTFit"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.SetTFit">[docs]</a>    <span class="k">def</span> <span class="nf">SetTFit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tsink</span><span class="p">):</span>
        <span class="c1"># if tsink not in [&#39;t&#39;+str(it) for it in xrange(1,self.nt+1)] and tsink != &#39;Not Set&#39;:</span>
        <span class="c1">#     print &#39;Warning: &#39;, tsink, &#39; not in  list, tsinkfit not added&#39;</span>
        <span class="c1"># else:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tsinkfit</span> <span class="o">=</span> <span class="n">tsink</span></div>


<div class="viewcode-block" id="NJNQFullCorr.ImportTwoPtFits"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.ImportTwoPtFits">[docs]</a>    <span class="k">def</span> <span class="nf">ImportTwoPtFits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">sourcepars</span><span class="p">,</span><span class="n">sinkpars</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ImportTwoPtFits</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="n">sourcepars</span><span class="p">,</span><span class="n">sinkpars</span><span class="p">)</span></div>

<div class="viewcode-block" id="NJNQFullCorr.GetTwoPtPars"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.GetTwoPtPars">[docs]</a>    <span class="k">def</span> <span class="nf">GetTwoPtPars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">pars</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">GetTwoPtPars</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">pars</span><span class="p">)</span></div>


    <span class="c1">## fit_ranges is list of fit ranges to fit the correlator to</span>
    <span class="c1">## formatted as fitr#-# where # are the min and max fit values.</span>
    <span class="c1">## states correspond to how many states to fit to (currenlty only working for states = 1 or 2)</span>
    <span class="c1">## C2pars is list of size 2, containing source and sink fit parameters used in the three point correlator fits</span>
    <span class="c1">## C2pars can be class instances of TwoPointCorr, Fitting, or just a list of values.</span>
    <span class="c1">## Word of caution, theb ootstraps need to have been constructed with the same configurations.</span>
    <span class="c1">## Best to have this run from RatioFunction class only.</span>

    <span class="c1"># def Fit(self,C2pars=&#39;PreDef&#39;,state=&#39;PreDef&#39;,fit_ranges=&#39;PreDef&#39;,iGuess=&#39;PreDef&#39;,EstDir=False,thistflowlist= &#39;PreDef&#39;):</span>
    <span class="c1">#     def RunPredefFits():</span>
    <span class="c1">#         if state == &#39;PreDef&#39; and fit_ranges == &#39;PreDef&#39;:</span>
    <span class="c1">#             for izip in self.PredefFits:</span>
    <span class="c1">#                 if len(izip) == 2:</span>
    <span class="c1">#                     self.Fit(C2pars=C2pars,state=izip[0],fit_ranges=[izip[1]],EstDir=EstDir)</span>
    <span class="c1">#                 else:</span>
    <span class="c1">#                     self.Fit(C2pars=C2pars,state=izip[0],fit_ranges=[izip[1]],iGuess=izip[2],EstDir=EstDir)</span>
    <span class="c1">#         elif state == &#39;PreDef&#39;:</span>
    <span class="c1">#             for izip in self.PredefFits:</span>
    <span class="c1">#                 if izip[1] == fit_ranges:</span>
    <span class="c1">#                     if len(izip) == 2:</span>
    <span class="c1">#                         self.Fit(C2pars=C2pars,state=izip[0],fit_ranges=[izip[1]],EstDir=EstDir)</span>
    <span class="c1">#                     else:</span>
    <span class="c1">#                         self.Fit(C2pars=C2pars,state=izip[0],fit_ranges=[izip[1]],iGuess=izip[2],EstDir=EstDir)</span>
    <span class="c1">#         elif fit_ranges == &#39;PreDef&#39;:</span>
    <span class="c1">#             for izip in self.PredefFits:</span>
    <span class="c1">#                 if izip[0] == state:</span>
    <span class="c1">#                     if len(izip) == 2:</span>
    <span class="c1">#                         self.Fit(C2pars=C2pars,state=izip[0],fit_ranges=[izip[1]],EstDir=EstDir)</span>
    <span class="c1">#                     else:</span>
    <span class="c1">#                         self.Fit(C2pars=C2pars,state=izip[0],fit_ranges=[izip[1]],iGuess=izip[2],EstDir=EstDir)</span>
    <span class="c1">#     if &#39;PreDef&#39; in [state,fit_ranges]:</span>
    <span class="c1">#         RunPredefFits()</span>
    <span class="c1">#         return</span>
    <span class="c1">#     if iGuess != &#39;PreDef&#39;: self.iGuess = iGuess</span>
    <span class="c1">#     if isinstance(state,basestring):</span>
    <span class="c1">#         if &#39;state&#39; in state:</span>
    <span class="c1">#             state = state.replace(&#39;state&#39;,&#39;&#39;)</span>
    <span class="c1">#         state = int(state)</span>
    <span class="c1">#</span>
    <span class="c1">#     if C2pars != &#39;PreDef&#39;: self.ImportTwoPtFits(state,C2pars[0],C2pars[1])</span>
    <span class="c1">#     self.ImportFitRanges(fit_ranges)</span>
    <span class="c1">#     if state == 1:</span>
    <span class="c1">#         # thisfitfun = C3OneStateFitFunNoExp</span>
    <span class="c1">#         thisfitfun = C3OneStateFitFunNoExp</span>
    <span class="c1">#         npar = 1</span>
    <span class="c1">#     elif state == 2:</span>
    <span class="c1">#         # thisfitfun = C3TwoStateFitFunNoExp</span>
    <span class="c1">#         thisfitfun = C3MomTwoStateFitFunNoExp</span>
    <span class="c1">#         npar = 4</span>
    <span class="c1">#     elif state &gt; 2:</span>
    <span class="c1">#         raise IOError(&#39;fitting state is only implemented up to 2 state so far. Cannot do &#39;+str(state))</span>
    <span class="c1">#</span>
    <span class="c1">#     if thistflowlist == &#39;PreDef&#39;:</span>
    <span class="c1">#         if self.tflowfit == &#39;Not Set&#39;: raise IOError(&#39;tflowfit not set, please set by using .SetTflowFit()&#39;)</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         if thistflowlist == &#39;All&#39;:</span>
    <span class="c1">#             self.tflowfit = self.FO.tflowlist</span>
    <span class="c1">#         else:</span>
    <span class="c1">#             self.tflowfit = thistflowlist</span>
    <span class="c1">#</span>
    <span class="c1">#     ststr = &#39;state&#39;+str(state)</span>
    <span class="c1">#     legstate = str(state)+&#39;SF&#39;</span>
    <span class="c1">#     lFit,lFitA,lFitS = [],[],[]</span>
    <span class="c1">#     ilist = []</span>
    <span class="c1">#     for (igamma,itflow),gammadata in self.NJNQFull_Stats[&#39;boot&#39;].groupby(level=(&#39;current_operator&#39;,&#39;flow_times&#39;)):</span>
    <span class="c1">#         for (ip,pdata),ptwopt in zip(gammadata.groupby(level=&#39;momentum&#39;),self.NJN.TwoPtPars):</span>
    <span class="c1">#             for ifit in self.fit_ranges:</span>
    <span class="c1">#                 # print &#39;Fitting state&#39;,str(state) ,igamma,itflow,ifit</span>
    <span class="c1">#                 ifitmin,ifitmax = map(int,unxmlfitr(ifit))</span>
    <span class="c1">#                 ## is this the right ordering of dictionary dimensions?</span>
    <span class="c1">#                 tdatarange = [[]]</span>
    <span class="c1">#                 ydata = []</span>
    <span class="c1">#                 for it,tdata in pdata.iteritems():</span>
    <span class="c1">#                     if itflow not in tdata.keys(): continue</span>
    <span class="c1">#                     tint = untstr(it)</span>
    <span class="c1">#                     if ifitmin &lt;= tint &lt;= ifitmax:</span>
    <span class="c1">#                         tcurrboot = BootStrap(self.nboot,bootvals=[np.float64(tint)]*self.nboot)</span>
    <span class="c1">#                         tdatarange[0].append(tcurrboot)</span>
    <span class="c1">#                         ydata.append(tdata[itflow])</span>
    <span class="c1">#                 thistlen = len(tdatarange[0])</span>
    <span class="c1">#                 ## this + 3 is just calabrated from looking at the conserved current two- and three- point correlators. Not sure why exactly.</span>
    <span class="c1">#                 tsinkboot = BootStrap(self.nboot,bootvals=[np.float64(self.tsink.replace(&#39;tsink&#39;,&#39;&#39;))+3]*self.nboot)</span>
    <span class="c1">#                 tdatarange.append([tsinkboot]*thistlen)</span>
    <span class="c1">#                 for iparam in ptwopt:</span>
    <span class="c1">#                     tdatarange.append([iparam]*thistlen)</span>
    <span class="c1">#</span>
    <span class="c1">#                 # print &#39;DEBUG&#39;</span>
    <span class="c1">#                 # for it,iy in zip(np.rollaxis(np.array(tdatarange),1),ydata):</span>
    <span class="c1">#                 #     print it[0].Avg,it[1].Avg,it[2].Avg,it[3].Avg,it[4].Avg,it[5].Avg,iy.Avg</span>
    <span class="c1">#</span>
    <span class="c1">#                 if EstDir:</span>
    <span class="c1">#                     thisff = ff.Fitting(Funs=[thisfitfun,npar,&#39;Estimate&#39;],data=[tdatarange,ydata],name=&#39; &#39;.join([legstate,ifit,itflow]),iGuess=self.iGuess)</span>
    <span class="c1">#                 else:</span>
    <span class="c1">#                     thisff = ff.Fitting(Funs=[thisfitfun,npar],data=[tdatarange,ydata],name=&#39; &#39;.join([legstate,ifit,itflow]),iGuess=self.iGuess)</span>
    <span class="c1">#                 thisff.FitBoots()</span>
    <span class="c1">#</span>
    <span class="c1">#                 ilist.append((ststr,igamma,ip,ifit))</span>
    <span class="c1">#                 lFit.append(thisff)</span>
    <span class="c1">#                 lFitA.append(thisff.fit_data[&#39;ParamsAvg&#39;])</span>
    <span class="c1">#                 lFitS.append(thisff.fit_data[&#39;ParamsStd&#39;])</span>
    <span class="c1">#     indicies = pa.MultiIndex.from_tuples(ilist,names=self.NJNQFull_Fit_Col_Names)</span>
    <span class="c1">#     if &#39;boot&#39; in self.NJNQFull_Fit_Stats.columns:</span>
    <span class="c1">#         this_df = pa.DataFrame()</span>
    <span class="c1">#         this_df.loc[:,&#39;boot&#39;] = pa.Series(lFit,index=indicies)</span>
    <span class="c1">#         this_df.loc[:,&#39;Avg&#39;] = pa.Series(lFitA,index=indicies)</span>
    <span class="c1">#         this_df.loc[:,&#39;Std&#39;] = pa.Series(lFitS,index=indicies)</span>
    <span class="c1">#         self.NJNQFull_Fit_Stats = self.NJNQFull_Fit_Stats.append(this_df)</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         self.NJNQFull_Fit_Stats.loc[:,&#39;boot&#39;] = pa.Series(lFit,index=indicies)</span>
    <span class="c1">#         self.NJNQFull_Fit_Stats.loc[:,&#39;Avg&#39;] = pa.Series(lFitA,index=indicies)</span>
    <span class="c1">#         self.NJNQFull_Fit_Stats.loc[:,&#39;Std&#39;] = pa.Series(lFitS,index=indicies)</span>
    <span class="c1">#     self.Write()</span>



<div class="viewcode-block" id="NJNQFullCorr.Write"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.Write">[docs]</a>    <span class="k">def</span> <span class="nf">Write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">FixDictArray</span><span class="p">(</span><span class="n">thislist</span><span class="p">,</span><span class="n">ikey</span><span class="p">):</span>
            <span class="n">outDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">ic</span><span class="p">,</span><span class="n">ilist</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">thislist</span><span class="p">):</span>
                <span class="n">outDict</span><span class="p">[</span><span class="n">ikey</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ic</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ilist</span>
            <span class="k">return</span> <span class="n">outDict</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDScomb</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNsing</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">FlowWrite</span><span class="p">()</span>


        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;show_cfgs&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_cfgs</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">outDict</span> <span class="o">=</span> <span class="n">ODNested</span><span class="p">()</span>

        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ThreePtCorr_File&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">HumanFile</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;FlowOp_File&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">flowHumanFile</span>

        <span class="n">excel_params</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">outDict</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">col_key</span><span class="p">,</span><span class="n">col_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQInt_Stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;Avg&#39;</span> <span class="ow">in</span> <span class="n">col_key</span> <span class="ow">or</span> <span class="s1">&#39;Std&#39;</span> <span class="ow">in</span> <span class="n">col_key</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">itflow</span><span class="p">),</span><span class="n">idata</span> <span class="ow">in</span> <span class="n">col_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;NJNQInt_&#39;</span><span class="o">+</span><span class="n">col_key</span><span class="p">][</span><span class="n">igamma</span><span class="p">][</span><span class="n">ip</span><span class="p">][</span><span class="n">it</span><span class="p">][</span><span class="n">itflow</span><span class="p">]</span> <span class="o">=</span> <span class="n">AvgStdToFormat</span><span class="p">(</span><span class="n">idata</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span><span class="n">idata</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>


        <span class="k">for</span> <span class="n">col_key</span><span class="p">,</span><span class="n">col_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;Avg&#39;</span> <span class="ow">in</span> <span class="n">col_key</span> <span class="ow">or</span> <span class="s1">&#39;Std&#39;</span> <span class="ow">in</span> <span class="n">col_key</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">its</span><span class="p">),</span><span class="n">idata</span> <span class="ow">in</span> <span class="n">col_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;NJNQFull_&#39;</span><span class="o">+</span><span class="n">col_key</span><span class="p">][</span><span class="n">igamma</span><span class="p">][</span><span class="n">ip</span><span class="p">][</span><span class="n">it</span><span class="p">][</span><span class="n">itflow</span><span class="p">][</span><span class="n">its</span><span class="p">]</span> <span class="o">=</span> <span class="n">AvgStdToFormat</span><span class="p">(</span><span class="n">idata</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span><span class="n">idata</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>


        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Fit_Stats</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">istate</span><span class="p">,</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itr</span><span class="p">,</span><span class="n">itflow</span><span class="p">),</span><span class="n">fitdict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fitdict</span><span class="p">,</span><span class="n">ff</span><span class="o">.</span><span class="n">Fitting</span><span class="p">):</span> <span class="k">continue</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;Fits&#39;</span><span class="p">][</span><span class="n">istate</span><span class="p">][</span><span class="n">igamma</span><span class="p">][</span><span class="n">ip</span><span class="p">][</span><span class="n">itr</span><span class="p">][</span><span class="n">itflow</span><span class="p">]</span> <span class="o">=</span> <span class="n">fitdict</span><span class="o">.</span><span class="n">GetOutputDict</span><span class="p">()</span>



        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ncfg_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cfgs</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">((</span><span class="n">istream</span><span class="p">,</span><span class="n">iccfg</span><span class="p">),</span><span class="n">icfg</span><span class="p">),</span><span class="n">ixsrc_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_cfgs</span><span class="p">[</span><span class="s1">&#39;configs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_cfgs</span><span class="p">[</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;cfglist&#39;</span><span class="p">][</span><span class="n">istream</span><span class="p">][</span><span class="n">icfg</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;n_xsrc_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ixsrc_list</span><span class="p">))</span>



        <span class="c1">## Write human readable file with data</span>
        <span class="n">WriteXml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span><span class="p">,{</span><span class="s1">&#39;Results&#39;</span><span class="p">:</span><span class="n">outDict</span><span class="p">})</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ncfg_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">for</span> <span class="p">((</span><span class="n">istream</span><span class="p">,</span><span class="n">iccfg</span><span class="p">),</span><span class="n">icfg</span><span class="p">),</span><span class="n">ixsrc_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_cfgs</span><span class="p">[</span><span class="s1">&#39;configs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_cfgs</span><span class="p">[</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;cfglist&#39;</span><span class="p">][</span><span class="n">istream</span><span class="p">][</span><span class="n">icfg</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;n_xsrc_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ixsrc_list</span><span class="p">))</span>

        <span class="n">WriteExcel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">,{</span> <span class="s1">&#39;NJNQFull_results&#39;</span><span class="p">:</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Stats</span><span class="p">),</span>
                                    <span class="s1">&#39;NJNQInt_results&#39;</span><span class="p">:</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQInt_Stats</span><span class="p">)},</span>
                                    <span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_cfgs</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">excel_params</span><span class="p">)</span>

        <span class="c1">## pickles rest of data for reading</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RemoveFuns</span><span class="p">()</span>
        <span class="n">WritePickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GetFuns</span><span class="p">()</span></div>
    <span class="c1">##################################</span>

<div class="viewcode-block" id="NJNQFullCorr.GetFuns"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.GetFuns">[docs]</a>    <span class="k">def</span> <span class="nf">GetFuns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">GetFuns</span><span class="p">()</span></div>

<div class="viewcode-block" id="NJNQFullCorr.RemoveFuns"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.RemoveFuns">[docs]</a>    <span class="k">def</span> <span class="nf">RemoveFuns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">RemoveFuns</span><span class="p">()</span></div>

<div class="viewcode-block" id="NJNQFullCorr.ReadAndWrite"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.ReadAndWrite">[docs]</a>    <span class="k">def</span> <span class="nf">ReadAndWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">WipeData</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Read</span><span class="p">(</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bootstrap</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="c1"># self.Fit()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span></div>

<div class="viewcode-block" id="NJNQFullCorr.LoadPickle"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.LoadPickle">[docs]</a>    <span class="k">def</span> <span class="nf">LoadPickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">WipeData</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">CheckMom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">DefWipe</span><span class="p">:</span>
            <span class="c1"># print &#39;Loading Pickle for &#39; , self.name</span>
            <span class="n">loadeddict</span> <span class="o">=</span> <span class="n">ReadPickleWrap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span>
            <span class="n">checklist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thischecklist</span>
            <span class="k">if</span> <span class="n">CheckCfgs</span><span class="p">:</span> <span class="n">checklist</span> <span class="o">=</span> <span class="n">checklist</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;cfglist&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">CheckMom</span><span class="p">:</span> <span class="n">checklist</span> <span class="o">=</span> <span class="n">checklist</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;checkmomlist&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">CheckClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span><span class="n">loadeddict</span><span class="p">,</span><span class="n">checklist</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">loadeddict</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">Wipe_All_Fits</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Fit_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;using backupfile for &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">,</span><span class="s1">&#39;.bak.xlsx&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="n">CheckCfgs</span><span class="p">,</span><span class="n">CheckMom</span><span class="o">=</span><span class="n">CheckMom</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning, file &#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span> <span class="p">,</span> <span class="s1">&#39; has different parameters than this instance, reading and writing over file now&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ReadAndWrite</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
            <span class="c1"># self.Write()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ReadAndWrite</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span></div>



    <span class="c1">## Comparisons</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="NJNQFullCorr.iteritems"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.iteritems">[docs]</a>    <span class="k">def</span> <span class="nf">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span></div>

<div class="viewcode-block" id="NJNQFullCorr.items"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.items">[docs]</a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span></div>

<div class="viewcode-block" id="NJNQFullCorr.itemsAvgStd"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.itemsAvgStd">[docs]</a>    <span class="k">def</span> <span class="nf">itemsAvgStd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">outlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ivals</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Stats</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
            <span class="n">outlist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ivals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ivals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">ivals</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">outlist</span></div>

<div class="viewcode-block" id="NJNQFullCorr.values"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.values">[docs]</a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span></div>

<div class="viewcode-block" id="NJNQFullCorr.itervalues"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.itervalues">[docs]</a>    <span class="k">def</span> <span class="nf">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span></div>

<div class="viewcode-block" id="NJNQFullCorr.valuesAvgStd"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.valuesAvgStd">[docs]</a>    <span class="k">def</span> <span class="nf">valuesAvgStd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">outlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ivals</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Stats</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
            <span class="n">outlist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ivals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">ivals</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">outlist</span></div>

<div class="viewcode-block" id="NJNQFullCorr.keys"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.NJNQFullCorr.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Stats</span><span class="o">.</span><span class="n">index</span></div>


    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__reversed__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQFull_Stats</span><span class="o">.</span><span class="n">iiloc</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJNQInt_Stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJNQInt_Stats</span><span class="o">.</span><span class="n">iiloc</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span>



    <span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thiskey</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">thiskey</span><span class="p">]</span>




    <span class="c1">## unitary arithmetic operations</span>

    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span>


    <span class="k">def</span> <span class="nf">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1">## Casting, just casts the bootstrap values, ignore return value (only needed since return has to be same type).</span>


    <span class="k">def</span> <span class="nf">__complex__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="nb">complex</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">+</span><span class="mi">0</span><span class="n">j</span>

    <span class="k">def</span> <span class="nf">__int__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__float__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="k">return</span> <span class="mf">1.0</span></div>




<div class="viewcode-block" id="Test3pt"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.Test3pt">[docs]</a><span class="k">def</span> <span class="nf">Test3pt</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">Params</span> <span class="k">import</span> <span class="n">defInfoFlow</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;gammas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;g4&#39;</span><span class="p">]</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;qmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0 0 0&#39;</span><span class="p">]</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;Projector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;P4&#39;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ThreePointCorr</span><span class="p">(</span><span class="n">Info</span><span class="o">=</span><span class="n">defInfoFlow</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="TestNJNQ"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.TestNJNQ">[docs]</a><span class="k">def</span> <span class="nf">TestNJNQ</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">Params</span> <span class="k">import</span> <span class="n">defInfoFlow</span>
    <span class="n">tflow</span> <span class="o">=</span> <span class="mf">6.01</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;tflowlist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">tflow</span><span class="p">])</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;tflowfit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">tflow</span><span class="p">])</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;gammas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;g4&#39;</span><span class="p">]</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;qmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0 0 1&#39;</span><span class="p">]</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;Projector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;P3&#39;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">NJNQCorr</span><span class="p">(</span><span class="n">Info</span><span class="o">=</span><span class="n">defInfoFlow</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="TestNJNQFull"><a class="viewcode-back" href="../ThreePtCorrelators.html#ThreePtCorrelators.TestNJNQFull">[docs]</a><span class="k">def</span> <span class="nf">TestNJNQFull</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">Params</span> <span class="k">import</span> <span class="n">defInfoFlow</span>
    <span class="n">tsum</span> <span class="o">=</span> <span class="mi">32</span>
    <span class="n">tflow</span> <span class="o">=</span> <span class="mf">6.01</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;tsum_fit_list&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">tsumstr</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">tsum</span><span class="p">))))</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;boot_tsum_list&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">tsumstr</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">tsum</span><span class="p">))))</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;tflowlist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">tflow</span><span class="p">])</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;tflowfit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">tflow</span><span class="p">])</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;op_trange_sum_type_3pt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;from_src_sym&#39;</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;gammas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;g4&#39;</span><span class="p">]</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;qmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0 0 1&#39;</span><span class="p">]</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;Projector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;P3&#39;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">NJNQFullCorr</span><span class="p">(</span><span class="n">Info</span><span class="o">=</span><span class="n">defInfoFlow</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">data3</span> <span class="o">=</span> <span class="n">Test3pt</span><span class="p">()</span>
    <span class="n">dataNJNQ</span> <span class="o">=</span> <span class="n">TestNJNQ</span><span class="p">()</span>
    <span class="c1"># dataFull = TestNJNQFull()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Testing 3ptcorr complete, see data3 and dataNJNQ variables&#39;</span><span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Jack Dragos

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>