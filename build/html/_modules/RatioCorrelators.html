

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>RatioCorrelators &mdash; LQCD Analysis Codebase TF Fits documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/my_theme.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> LQCD Analysis Codebase
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Python_Analysis</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">LQCD Analysis Codebase</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>RatioCorrelators</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for RatioCorrelators</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>


<span class="c1">#IMPORT THIS FIRST, put in base import file</span>
<span class="c1"># import matplotlib</span>
<span class="c1"># matplotlib.use(&#39;Agg&#39;) # Must be before importing matplotlib.pyplot or pylab!</span>
<span class="c1"># import matplotlib.pyplot as pl</span>
<span class="c1">##</span>
<span class="kn">from</span> <span class="nn">Params</span> <span class="k">import</span> <span class="n">nboot</span><span class="p">,</span><span class="n">outputdir</span><span class="p">,</span><span class="n">Debug_Mode</span><span class="p">,</span><span class="n">Wipe_All_Fits</span><span class="p">,</span><span class="n">this_dir</span>
<span class="kn">from</span> <span class="nn">FileIO</span> <span class="k">import</span> <span class="n">ReadFuns</span><span class="p">,</span><span class="n">WriteFuns</span>
<span class="c1"># from PredefFitFuns import ConstantFitFun,RF_Prop_Fit</span>
<span class="kn">from</span> <span class="nn">PredefFitFuns</span> <span class="k">import</span> <span class="n">ConstantFitFun</span>
<span class="kn">import</span> <span class="nn">SetsOfFits</span> <span class="k">as</span> <span class="nn">sff</span>
<span class="kn">from</span> <span class="nn">NullPlotData</span> <span class="k">import</span> <span class="n">null_series</span>
<span class="kn">from</span> <span class="nn">TwoPtCorrelators</span> <span class="k">import</span> <span class="n">NNQCorr</span>
<span class="c1"># from TwoPtCorrelators import TwoPointCorr,NNQCorr,NNQFullCorr</span>
<span class="c1"># from FlowOpps import FlowOp</span>

<span class="kn">from</span> <span class="nn">MiscFuns</span> <span class="k">import</span> <span class="n">ODNested</span><span class="p">,</span><span class="n">mkdir_p</span><span class="p">,</span><span class="n">CheckClass</span><span class="p">,</span><span class="n">CombineCfgs</span><span class="p">,</span><span class="n">op_str_list</span><span class="p">,</span><span class="n">MultiSplit</span><span class="p">,</span><span class="n">op_dict</span>
<span class="kn">from</span> <span class="nn">MiscFuns</span> <span class="k">import</span> <span class="n">flip_fun_2arg</span><span class="p">,</span><span class="n">GenSinkFun</span><span class="p">,</span><span class="n">CreateNameAndLL</span><span class="p">,</span><span class="n">GetInfoList</span><span class="p">,</span><span class="n">Series_fix_key</span>
<span class="kn">from</span> <span class="nn">XmlFormatting</span> <span class="k">import</span> <span class="n">untstr</span><span class="p">,</span><span class="n">tstr</span><span class="p">,</span><span class="n">unxmlfitr</span><span class="p">,</span><span class="n">AvgStdToFormat</span><span class="p">,</span><span class="n">AvgFormat</span>
<span class="kn">from</span> <span class="nn">XmlFormatting</span> <span class="k">import</span> <span class="n">rm_tsumfitr</span><span class="p">,</span><span class="n">unxmlfitr_int</span><span class="p">,</span><span class="n">KeyForamtting</span>
<span class="c1"># from XmlFormatting import rm_tsumfitr,tflowTOLeg,tsumTOLeg,tsinkTOLeg</span>
<span class="kn">from</span> <span class="nn">FileIO</span> <span class="k">import</span> <span class="n">WriteXml</span><span class="p">,</span><span class="n">WritePickle</span><span class="p">,</span><span class="n">ReadPickleWrap</span>
<span class="kn">from</span> <span class="nn">FileIO</span> <span class="k">import</span> <span class="n">WriteExcel</span><span class="p">,</span><span class="n">Construct_File_Object</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span>
<span class="c1"># import cPickle as pickle</span>
<span class="c1"># import dill as pickle</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pa</span>
<span class="c1"># import warnings</span>
<span class="c1"># import itertools</span>

<span class="kn">import</span> <span class="nn">operator</span> <span class="k">as</span> <span class="nn">op</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">SetsOfTwoPtCorrs</span> <span class="k">import</span> <span class="n">SetOfTwoPt</span><span class="p">,</span><span class="n">SetOfNNQ</span>
<span class="kn">from</span> <span class="nn">ThreePtCorrelators</span> <span class="k">import</span> <span class="n">ThreePointCorr</span><span class="p">,</span><span class="n">NJNQCorr</span><span class="p">,</span><span class="n">NJNQFullCorr</span>
<span class="c1"># import FitFunctions as ff</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>

<span class="c1"># from FlowOpps import FlowOp</span>




<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">How to use:</span>

<span class="sd">Ratio(cfglist=[], Info={})</span>
<span class="sd">creates class using:</span>
<span class="sd"> configuration list cfglist</span>
<span class="sd"> Information Dictionary Info (See below for what can be in Info)</span>


<span class="sd">.LoadPickle()</span>
<span class="sd">Does everything basically.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">## function to center the x-axis around zero</span>
<div class="viewcode-block" id="CenterT"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.CenterT">[docs]</a><span class="k">def</span> <span class="nf">CenterT</span><span class="p">(</span><span class="n">tlist</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tlist</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">tlist</span><span class="p">),</span><span class="o">-</span><span class="n">tlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">tlist</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span></div>

<span class="c1">## for some reason, CROMA ouptut of the three-point correlator is shifted by 3 in time compared to the two-point correlator</span>
<span class="n">twopttshift</span> <span class="o">=</span> <span class="mi">1</span>


<div class="viewcode-block" id="RatioCorr"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr">[docs]</a><span class="k">class</span> <span class="nc">RatioCorr</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Rat(q,tau,pp,t) uses bootstrap class</span>
<span class="sd">    pp  = sink momentum</span>
<span class="sd">    t   = source sink separation time</span>
<span class="sd">    q   = current insersion momentum</span>
<span class="sd">    tau = current insersion time</span>

<span class="sd">    Info is a dictionary containing information for the correlator:</span>
<span class="sd">    see comments below to see what is required.</span>
<span class="sd">    missing elements just sets field to default</span>


<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="RatioCorr.Construct_Rat_File"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.Construct_Rat_File">[docs]</a>    <span class="k">def</span> <span class="nf">Construct_Rat_File</span><span class="p">(</span><span class="n">this_file</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Construct_File_Object</span><span class="p">(</span><span class="n">this_file</span><span class="p">,</span><span class="n">RatioCorr</span><span class="p">)</span></div>


    <span class="c1">## TODO: create variational flag and interface with this function.</span>

    <span class="c1">## array of all classes that inherit this class. Append this when adding new classes please!</span>
    <span class="n">parentlist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SetOfCorrs.SetsOfRatios&#39;</span><span class="p">,</span><span class="s1">&#39;RatioCorrelators.RatioFOCorr&#39;</span><span class="p">,</span><span class="s1">&#39;RatioCorrelators.RatioFOFullCorr&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thisnboot</span><span class="o">=</span><span class="n">nboot</span><span class="p">,</span> <span class="n">cfglist</span><span class="o">=</span><span class="p">{},</span> <span class="n">Info</span><span class="o">=</span><span class="p">{},</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">thissym</span><span class="o">=</span><span class="s1">&#39;Not Set&#39;</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="s1">&#39;Not Set&#39;</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">man_load_cfgs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">## Initialising plotting parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span> <span class="o">=</span> <span class="n">thisshift</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span> <span class="o">=</span> <span class="n">thiscol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thissym</span> <span class="o">=</span> <span class="n">thissym</span>
        <span class="c1">## the actual shift ammount needs to be scaled by the x axis size</span>
        <span class="c1">## see GetShift</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thisshiftscale</span> <span class="o">=</span> <span class="s1">&#39;Not Set&#39;</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">thischecklist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;C3file&#39;</span><span class="p">,</span><span class="s1">&#39;Sym&#39;</span><span class="p">]</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span> <span class="o">=</span> <span class="n">ThreePointCorr</span><span class="p">(</span><span class="n">thisnboot</span><span class="o">=</span><span class="n">thisnboot</span><span class="p">,</span> <span class="n">cfglist</span><span class="o">=</span><span class="n">cfglist</span><span class="p">,</span> <span class="n">Info</span><span class="o">=</span><span class="n">Info</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">PickleFile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkmomlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">checkmomlist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">latparams</span>


        <span class="k">if</span> <span class="s1">&#39;pmom&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">GetAvgmomstr</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">qmom</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">],</span><span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;All&#39;</span><span class="p">:</span>
                    <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">GetMomList</span><span class="p">(</span><span class="n">list_type</span><span class="o">=</span><span class="s1">&#39;str_Avg&#39;</span><span class="p">,</span><span class="n">list_order</span><span class="o">=</span><span class="s1">&#39;squared&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">]]</span>
            <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">qmom</span><span class="p">:</span>
                <span class="n">fmt_p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">GetAvgmomstr</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">fmt_p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">]:</span>
                    <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fmt_p</span><span class="p">)</span>
            <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">MomSqrdSort</span><span class="p">(</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="s1">&#39;0 0 0&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">]:</span>
            <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0 0 0&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;AllC2p&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;AllC2p&#39;</span><span class="p">]:</span>
            <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">GetMomList</span><span class="p">(</span><span class="n">list_type</span><span class="o">=</span><span class="s1">&#39;str_Avg&#39;</span><span class="p">,</span><span class="n">list_order</span><span class="o">=</span><span class="s1">&#39;squared&#39;</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">nt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">nt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nxyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">nxyz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span> <span class="o">=</span> <span class="s1">&#39;RC&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nxyz</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;x&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim_ll</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nxyz</span><span class="p">)</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;^</span><span class="si">{3}</span><span class="s1">\times &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">)</span>

        <span class="c1"># Info[&#39;pmom&#39;] = self.latparams.momstrlistAvg</span>

        <span class="c1">## both current and sink momentum are requred for the two point correlator construction when constructing the ratio function</span>
        <span class="c1">## but the two point correlator has been averaged over, so we need to get the averaged momentum anaolgy</span>
        <span class="c1">## bah, this was too hard to keep unique files for the two-point correlator.</span>
        <span class="c1">## easier just to read and write the whole 2 point mom file.</span>
        <span class="c1">## e.g. q = [-1,1,-1] corresponds to p = [1 1 1] in the two-point correlator</span>
        <span class="c1"># ppforp = self.latparams.GetAvgmomstr(Info[&#39;ppmom&#39;])</span>
        <span class="c1"># if ppforp not in Info[&#39;pmom&#39;]: Info[&#39;pmom&#39;].append(ppforp)</span>

        <span class="k">if</span> <span class="s1">&#39;show_cfgs&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cfgs</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;show_cfgs&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cfgs</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1">## used to pick out different configuraiton/source lists.</span>
        <span class="c1">## for example, if there are less flowed operators than 2 point correlators, passing &#39;TopCharge&#39; will read that result</span>
        <span class="k">if</span> <span class="s1">&#39;fo_for_cfgs&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">fo_for_cfgs</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;fo_for_cfgs&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fo_for_cfgs</span> <span class="o">=</span> <span class="kc">False</span>


        <span class="c1">## Does symmetrising over smearings</span>
        <span class="k">if</span> <span class="s1">&#39;Symmetric&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">Sym</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;Symmetric&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Sym</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">## default to no symmetrizing, (usually full matrix isn&#39;t computed nowerdays.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sinklab</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">jsmcoeffs</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sm2ptList</span><span class="p">,</span><span class="n">InfoList</span> <span class="o">=</span> <span class="n">GetInfoList</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">Info</span><span class="p">))</span>

        <span class="c1"># self.C2filelist = [ikey.PickleFile for ikey in self.C2classlist.itervalues()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span> <span class="o">=</span> <span class="n">SetOfTwoPt</span><span class="p">(</span><span class="n">cfglist</span><span class="o">=</span><span class="n">cfglist</span><span class="p">,</span><span class="n">InfoDict</span> <span class="o">=</span> <span class="n">InfoList</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span> <span class="o">=</span> <span class="s1">&#39;Not Set&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">defgammamomlist</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">igamma</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">gammalist</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defgammamomlist</span><span class="p">[</span><span class="n">igamma</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">qform</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Col_Names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;current_operator&#39;</span><span class="p">,</span><span class="s1">&#39;momentum&#39;</span><span class="p">,</span><span class="s1">&#39;source_sink_separation&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        self.Rat_Stats DataFrame:</span>

<span class="sd">        columns =   boot,   Avg,        Std</span>

<span class="sd">        rows =      current_operator,   momenta,    time separation</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Col_Names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;current_operator&#39;</span><span class="p">,</span><span class="s1">&#39;momentum&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        self.Rat_Fit_Stats DataFrame:</span>

<span class="sd">        columns =   boot</span>

<span class="sd">        rows =      current_operator, momenta</span>

<span class="sd">        Avg/Std elements are pa.Series instances with:</span>
<span class="sd">            index = fit parameters</span>
<span class="sd">            values = Avg/Std values</span>
<span class="sd">        boot elements are SetOfFitFuns objects</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># # Ratboot [ igamma , ip , it ] bs</span>
        <span class="c1"># self.Ratboot = ODNested()</span>
        <span class="c1"># self.RatAvg  = ODNested()</span>
        <span class="c1"># self.RatStd  = ODNested()</span>
        <span class="c1">#</span>
        <span class="c1"># ## self.FitDict = { igamma , ip , ifit } = thisff</span>
        <span class="c1"># self.FitDict    = ODNested()</span>
        <span class="c1"># self.FitDictAvg = ODNested()</span>
        <span class="c1"># self.FitDictStd = ODNested()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nboot</span> <span class="o">=</span> <span class="n">thisnboot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centert</span> <span class="o">=</span> <span class="s1">&#39;Not Set&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span> <span class="o">=</span> <span class="n">cfglist</span>


        <span class="c1">## Info can contain fit ranges to be calculated</span>
        <span class="c1">## must bein form Info[&#39;FitsRF&#39;] = [ &#39;fit#-#&#39; , ...]</span>
        <span class="k">if</span> <span class="s1">&#39;FitsRF&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">PredefFits</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;FitsRF&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">PredefFits</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="s1">&#39;RFFitFun&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fun</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">npar</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;RFFitFun&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fun</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">npar</span> <span class="o">=</span> <span class="p">(</span><span class="n">ConstantFitFun</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">## Info can contain initial guess for fits, make sure it array of correct length</span>
        <span class="k">if</span> <span class="s1">&#39;iGuessRF&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;iGuessRF&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span> <span class="c1">## Defaults to value set for function in FitFunctions.py</span>

        <span class="c1">## is needed?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Info</span> <span class="o">=</span> <span class="n">Info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SqrtFact</span> <span class="o">=</span> <span class="s1">&#39;Not Set&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SetCustomName</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">stringfn</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">man_load_cfgs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LoadCfgs</span><span class="p">(</span><span class="n">cfglist</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">filename</span><span class="p">)</span>

<div class="viewcode-block" id="RatioCorr.LoadCfgs"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.LoadCfgs">[docs]</a>    <span class="k">def</span> <span class="nf">LoadCfgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cfglist</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cfglist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CombineCfgLists</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">cfglist</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetCustomName</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">stringfn</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span></div>


    <span class="c1">## just for consistancy with other classes</span>
<div class="viewcode-block" id="RatioCorr.GetCfgList"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.GetCfgList">[docs]</a>    <span class="k">def</span> <span class="nf">GetCfgList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CombineCfgLists</span><span class="p">()</span></div>

<div class="viewcode-block" id="RatioCorr.CombineCfgLists"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.CombineCfgLists">[docs]</a>    <span class="k">def</span> <span class="nf">CombineCfgLists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">thiscfglist</span> <span class="o">=</span> <span class="n">CombineCfgs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="o">.</span><span class="n">cfglist</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thiscfglist</span> <span class="o">=</span> <span class="n">CombineCfgs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">C2_cfgs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">thiscfglist</span><span class="p">)</span></div>





<div class="viewcode-block" id="RatioCorr.SetCustomName"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.SetCustomName">[docs]</a>    <span class="k">def</span> <span class="nf">SetCustomName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">stringfn</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">stringLL</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">string</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Rat_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">string</span>
        <span class="k">if</span> <span class="n">stringfn</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;Rat_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">filename</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">stringfn</span>
        <span class="k">if</span> <span class="n">stringLL</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="c1"># self.LegLab = &#39;$&#39;+&#39;\ &#39;.join([self.C3class.DS,self.C3class.ism,self.C3class.jsm])+&#39;$&#39; ## customise this how you like</span>
            <span class="c1"># self.LegLab = &#39;$&#39;+&#39;\ &#39;.join([self.latparams.GetPionMassLab(),self.C3class.DS,self.C3class.ism,self.C3class.jsm,self.C3class.Proj,self.C3class.gammalist[0]])+&#39;$&#39; ## customise this how you like</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span> <span class="o">=</span> <span class="s1">&#39;$&#39;</span><span class="o">+</span><span class="s1">&#39;\ &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>   <span class="bp">self</span><span class="o">.</span><span class="n">dim_ll</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">GetPionMassLab</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">stream_name</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">Proj</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;$&#39;</span> <span class="c1">## customise this how you like</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span> <span class="o">=</span> <span class="n">stringLL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SubDir</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">Proj</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">ppform</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fo_for_cfgs</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ratdir</span> <span class="o">=</span> <span class="n">outputdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">kappafolder</span><span class="o">+</span><span class="s1">&#39;/Rat/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">fo_for_cfgs</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">SubDir</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ratdir</span> <span class="o">=</span> <span class="n">outputdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">kappafolder</span><span class="o">+</span><span class="s1">&#39;/Rat/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">SubDir</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
        <span class="n">mkdir_p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ratdir</span><span class="o">+</span><span class="s1">&#39;/Pickle/&#39;</span><span class="p">)</span>
        <span class="n">mkdir_p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ratdir</span><span class="o">+</span><span class="s1">&#39;/Excel/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ratdir</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.xml&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ratdir</span><span class="o">+</span><span class="s1">&#39;/Excel/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.xlsx&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ratdir</span><span class="o">+</span><span class="s1">&#39;/Pickle/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.py3p&#39;</span></div>


<div class="viewcode-block" id="RatioCorr.ImportCfgList"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.ImportCfgList">[docs]</a>    <span class="k">def</span> <span class="nf">ImportCfgList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cfglist</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span> <span class="o">=</span> <span class="n">cfglist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">cfglist</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span> <span class="o">!=</span> <span class="s1">&#39;Not Set&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">cfglist</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">cfglist</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">stream_name</span></div>


<div class="viewcode-block" id="RatioCorr.Stats"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.Stats">[docs]</a>    <span class="k">def</span> <span class="nf">Stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="p">,</span><span class="s1">&#39;Stats&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="p">,</span><span class="s1">&#39;Stats&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">lAvg</span><span class="p">,</span><span class="n">lStd</span> <span class="o">=</span> <span class="p">[],[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">),</span><span class="n">iRat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">iRat</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
            <span class="n">lAvg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iRat</span><span class="o">.</span><span class="n">Avg</span><span class="p">)</span>
            <span class="n">lStd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iRat</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
        <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Col_Names</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lAvg</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lStd</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span></div>

<div class="viewcode-block" id="RatioCorr.CombineWithAlpha"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.CombineWithAlpha">[docs]</a>    <span class="k">def</span> <span class="nf">CombineWithAlpha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">alpha_in</span><span class="p">,</span><span class="n">flow_time</span><span class="p">,</span><span class="n">this_fun</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="n">truediv</span><span class="p">):</span>
        <span class="n">tsink_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">tsink</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;tsink&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">this_fun</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">this_fun</span> <span class="o">=</span> <span class="n">op_dict</span><span class="p">[</span><span class="n">this_fun</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;alpha_rat_&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_corr&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alpha_in</span><span class="p">,</span><span class="n">NNQCorr</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">alpha_in</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">alpha_in</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Please pass in NNQCorr class instance&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;please compute Rat_Stats before combining with alpha&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;Alphaboot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">alpha_in</span><span class="o">.</span><span class="n">NNQ_Stats</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;please compute NNQ_Stats in alpha before combining with alpha&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;p000&#39;</span><span class="p">,</span><span class="n">tsink_str</span><span class="p">,</span><span class="n">flow_time</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">alpha_in</span><span class="o">.</span><span class="n">NNQ_Stats</span><span class="p">[</span><span class="s1">&#39;Alphaboot&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">alpha_in</span><span class="o">.</span><span class="n">NNQ_Stats</span><span class="p">[</span><span class="s1">&#39;Alphaboot&#39;</span><span class="p">])</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;alpha ratio needs p000,&#39;</span><span class="o">+</span><span class="n">tsink_str</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">+</span><span class="n">flow_time</span><span class="o">+</span><span class="s1">&#39; result&#39;</span><span class="p">)</span>
        <span class="n">alpha_p0</span> <span class="o">=</span> <span class="n">alpha_in</span><span class="o">.</span><span class="n">NNQ_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s1">&#39;p000&#39;</span><span class="p">,</span><span class="n">tsink_str</span><span class="p">,</span><span class="n">flow_time</span><span class="p">),</span><span class="s1">&#39;Alphaboot&#39;</span><span class="p">]</span>
        <span class="n">vall</span><span class="p">,</span><span class="n">ilist</span><span class="p">,</span><span class="n">corrl</span> <span class="o">=</span> <span class="p">[],[],[]</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">),</span><span class="n">irat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">flow_time</span><span class="p">,</span><span class="n">it</span><span class="p">))</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">this_fun</span><span class="p">(</span><span class="n">irat</span><span class="p">,</span><span class="n">alpha_p0</span><span class="p">[(</span><span class="s1">&#39;p000&#39;</span><span class="p">,</span><span class="n">tsink_str</span><span class="p">,</span><span class="n">flow_time</span><span class="p">)])</span>
            <span class="n">output</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
            <span class="n">vall</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
            <span class="n">corrl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">irat</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">alpha_p0</span><span class="p">[(</span><span class="s1">&#39;p000&#39;</span><span class="p">,</span><span class="n">tsink_str</span><span class="p">,</span><span class="n">flow_time</span><span class="p">)]))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Col_Names</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;alpha_rat_&#39;</span><span class="o">+</span><span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">vall</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;alpha_rat_&#39;</span><span class="o">+</span><span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;_corr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">corrl</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span></div>


<div class="viewcode-block" id="RatioCorr.RemoveVals"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.RemoveVals">[docs]</a>    <span class="k">def</span> <span class="nf">RemoveVals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># for iC2 in self.C2classlist.itervalues():</span>
        <span class="c1">#     iC2.RemoveVals()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">RemoveVals</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">RemoveVals</span><span class="p">()</span></div>

    <span class="c1">## self.Rat = [ igamma , ip, it , iconf ]</span>
    <span class="c1">## Configs must be the same, so we must check for them.</span>
<div class="viewcode-block" id="RatioCorr.Read"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.Read">[docs]</a>    <span class="k">def</span> <span class="nf">Read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">WipeData</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">CheckMom</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">CheckMom</span><span class="o">=</span><span class="n">CheckMom</span><span class="p">,</span><span class="n">NoFit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">CheckMom</span><span class="o">=</span><span class="n">CheckMom</span><span class="p">)</span></div>

<div class="viewcode-block" id="RatioCorr.CreateC2Sink"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.CreateC2Sink">[docs]</a>    <span class="k">def</span> <span class="nf">CreateC2Sink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">thisname</span><span class="p">,</span><span class="n">thisleglab</span><span class="p">,</span><span class="n">jsmlab</span> <span class="o">=</span> <span class="n">CreateNameAndLL</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="o">.</span><span class="n">SetC2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sinklab</span><span class="p">)</span>
            <span class="n">thisfun</span> <span class="o">=</span> <span class="n">GenSinkFun</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jsmcoeffs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="o">.</span><span class="n">CombineCorrs</span><span class="p">(</span><span class="n">thisfun</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">thisname</span><span class="p">,</span><span class="n">LegLab</span><span class="o">=</span><span class="n">thisleglab</span><span class="p">,</span><span class="n">jsmlab</span><span class="o">=</span><span class="n">jsmlab</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span> <span class="o">=</span> <span class="s1">&#39;Complete&#39;</span></div>

<div class="viewcode-block" id="RatioCorr.Bootstrap"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.Bootstrap">[docs]</a>    <span class="k">def</span> <span class="nf">Bootstrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">WipeData</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Read</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CreateC2Sink</span><span class="p">()</span>
        <span class="c1"># self.C2class.Bootstrap(WipeData=WipeData)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">Bootstrap</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span></div>


<div class="viewcode-block" id="RatioCorr.CalcRatio"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.CalcRatio">[docs]</a>    <span class="k">def</span> <span class="nf">CalcRatio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CalcSqrtFac</span><span class="p">()</span>
        <span class="c1">## if DS has a divide in it, we ignore the sqrt factor as they cancel</span>
        <span class="n">div_bool</span> <span class="o">=</span> <span class="s1">&#39;divide&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">DS</span>
        <span class="c1">## double the square root factor if we multiply two ds types</span>
        <span class="n">mult_bool</span> <span class="o">=</span> <span class="s1">&#39;multiply&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">DS</span>
        <span class="n">lRat</span><span class="p">,</span><span class="n">lRatAvg</span><span class="p">,</span><span class="n">lRatStd</span> <span class="o">=</span> <span class="p">[],[],[]</span>
        <span class="n">ilist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tsinkint</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">tsink</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;tsink&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">),</span><span class="n">tC3</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">C3_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ip2pt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">GetAvgmomform</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">pref</span><span class="o">=</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
            <span class="n">ict</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">untstr</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ict</span> <span class="o">&gt;</span> <span class="n">tsinkint</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ip2pt</span><span class="p">,</span><span class="n">it</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SqrtFact</span><span class="o">.</span><span class="n">index</span><span class="p">:</span> <span class="k">continue</span>
            <span class="c1"># warnings.warn(&#39;DEBUG, please check if tsink for 2-pt corr is correct via g4.&#39;)</span>
            <span class="c1"># print igamma, ip, it, self.C3class.tsink</span>
            <span class="c1"># print &#39;SqrtFact&#39;</span>
            <span class="c1"># print self.SqrtFact</span>
            <span class="c1"># print list(self.SqrtFact.index), ip2pt,it</span>
            <span class="c1"># print type(self.SqrtFact[ip2pt,it])</span>
            <span class="c1"># print self.SqrtFact[ip2pt,it]</span>
            <span class="c1"># print self.SqrtFact[ip2pt,it].Avg</span>

            <span class="k">if</span> <span class="n">div_bool</span><span class="p">:</span>
                <span class="n">this_boot</span> <span class="o">=</span> <span class="n">tC3</span>
            <span class="k">elif</span> <span class="n">mult_bool</span><span class="p">:</span>
                <span class="n">this_boot</span> <span class="o">=</span> <span class="n">tC3</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SqrtFact</span><span class="p">[</span><span class="n">ip2pt</span><span class="p">,</span><span class="n">it</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">this_boot</span> <span class="o">=</span> <span class="n">tC3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">SqrtFact</span><span class="p">[</span><span class="n">ip2pt</span><span class="p">,</span><span class="n">it</span><span class="p">]</span>
            <span class="n">this_boot</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
            <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">))</span>
            <span class="n">lRat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_boot</span><span class="p">)</span>
            <span class="n">lRatAvg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_boot</span><span class="o">.</span><span class="n">Avg</span><span class="p">)</span>
            <span class="n">lRatStd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_boot</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
            <span class="c1"># self.Ratboot[igamma][ip][it] = tC3/self.C2class[ip.replace(&#39;q&#39;,&#39;p&#39;),&#39;t&#39;+str(int(self.C3class.tsink.replace(&#39;tsink&#39;,&#39;&#39;))+1)]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Col_Names</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lRat</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lRatAvg</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lRatStd</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span></div>



<div class="viewcode-block" id="RatioCorr.CalcSqrtFac"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.CalcSqrtFac">[docs]</a>    <span class="k">def</span> <span class="nf">CalcSqrtFac</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">SqrtFact_hold</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ilist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ipp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">GetAvgmomform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">ppform</span><span class="p">,</span><span class="n">pref</span><span class="o">=</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Debug_Mode</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Outputting sqrt factor debug info:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">iq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">qform</span><span class="p">:</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">GetAvgmomform</span><span class="p">(</span><span class="n">iq</span><span class="p">,</span><span class="n">pref</span><span class="o">=</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
            <span class="n">sqrt_fac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CalcSqrtFacMom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">C2_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">][</span><span class="n">ipp</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">C2_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">][</span><span class="n">ip</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">tsink</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">it</span><span class="p">,</span><span class="n">tdata</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sqrt_fac</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">tstr</span><span class="p">(</span><span class="n">it</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ilist</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">Debug_Mode</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">ierr</span> <span class="ow">in</span> <span class="n">tdata</span><span class="o">.</span><span class="n">GetNaNIndex</span><span class="p">():</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">iq</span><span class="p">,</span> <span class="n">tstr</span><span class="p">(</span><span class="n">it</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39; iboot&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
                    <span class="n">SqrtFact_hold</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tdata</span><span class="p">)</span>
                    <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span><span class="n">tstr</span><span class="p">(</span><span class="n">it</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
            <span class="c1"># if neg_sqrt: warnings.warn(&#39;negative square root in square root factor for &#39;+ipp+iq)</span>
        <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;momentum&#39;</span><span class="p">,</span><span class="s1">&#39;source_sink_separation&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SqrtFact</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">SqrtFact_hold</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span></div>

<div class="viewcode-block" id="RatioCorr.CheckNegForSqrt"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.CheckNegForSqrt">[docs]</a>    <span class="k">def</span> <span class="nf">CheckNegForSqrt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thisboot</span><span class="p">,</span><span class="n">negsqrt</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ict</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">thisboot</span><span class="o">.</span><span class="n">bootvals</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">thisboot</span><span class="o">.</span><span class="n">bootvals</span><span class="p">[</span><span class="n">ict</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">negsqrt</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># if G2_abs:</span>
                <span class="c1">#     thisboot.bootvals[ict] = abs(thisboot.bootvals[ict])</span>
                <span class="c1"># else:</span>
                <span class="n">thisboot</span><span class="o">.</span><span class="n">bootvals</span><span class="p">[</span><span class="n">ict</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;NaN&#39;</span><span class="p">)</span>
                <span class="c1"># thisboot.bootvals[ict] = 0.0</span>
        <span class="k">return</span> <span class="n">thisboot</span><span class="p">,</span><span class="n">negsqrt</span></div>


    <span class="c1">## taking squareroot of each element before combinding makes the numbers not too small</span>
<div class="viewcode-block" id="RatioCorr.CalcSqrtFacMom"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.CalcSqrtFacMom">[docs]</a>    <span class="k">def</span> <span class="nf">CalcSqrtFacMom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data2ptpp</span><span class="p">,</span><span class="n">data2ptp</span><span class="p">,</span><span class="n">thistsink</span><span class="p">):</span>
        <span class="n">dictout</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">thistsink</span> <span class="o">=</span> <span class="n">thistsink</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;tsink&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
        <span class="n">thistsinkp1</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">thistsink</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">+</span><span class="n">twopttshift</span><span class="p">)</span>
        <span class="n">inttsink</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">thistsink</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="c1"># NegSQRTRatFac = False</span>
        <span class="c1"># data2ptpp[thistsinkp1],NegSQRTRatFac = self.CheckNegForSqrt(data2ptpp[thistsinkp1],NegSQRTRatFac)</span>
        <span class="c1"># data2ptp[thistsinkp1],NegSQRTRatFac = self.CheckNegForSqrt(data2ptp[thistsinkp1],NegSQRTRatFac)</span>

        <span class="n">data2ptpp</span> <span class="o">=</span> <span class="n">data2ptpp</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">Sqrt</span><span class="p">())</span>
        <span class="n">data2ptp</span> <span class="o">=</span> <span class="n">data2ptp</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">Sqrt</span><span class="p">())</span>
        <span class="c1"># NegSQRTRatFac = any(data2ptpp.isnull().values) or any(data2ptp.isnull().values)</span>
        <span class="n">two</span> <span class="o">=</span> <span class="n">data2ptpp</span><span class="p">[</span><span class="n">thistsinkp1</span><span class="p">]</span><span class="o">*</span><span class="n">data2ptp</span><span class="p">[</span><span class="n">thistsinkp1</span><span class="p">]</span>
        <span class="c1"># two = two**(0.5)</span>
        <span class="n">thisshift</span> <span class="o">=</span> <span class="n">twopttshift</span>
        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">thisshift</span><span class="p">,</span><span class="n">inttsink</span><span class="o">+</span><span class="n">thisshift</span><span class="p">):</span>
            <span class="n">thiststr</span> <span class="o">=</span> <span class="n">tstr</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
            <span class="n">tflip</span> <span class="o">=</span> <span class="n">tstr</span><span class="p">(</span><span class="n">inttsink</span><span class="o">-</span><span class="n">it</span><span class="o">+</span><span class="n">twopttshift</span><span class="o">+</span><span class="n">thisshift</span><span class="p">)</span>
            <span class="c1"># data2ptpp[thiststr],NegSQRTRatFac = self.CheckNegForSqrt(data2ptpp[thiststr],NegSQRTRatFac)</span>
            <span class="c1"># data2ptp[thiststr],NegSQRTRatFac = self.CheckNegForSqrt(data2ptp[thiststr],NegSQRTRatFac)</span>
            <span class="c1"># data2ptpp[tflip],NegSQRTRatFac = self.CheckNegForSqrt(data2ptpp[tflip],NegSQRTRatFac)</span>
            <span class="c1"># data2ptp[tflip],NegSQRTRatFac = self.CheckNegForSqrt(data2ptp[tflip],NegSQRTRatFac)</span>
            <span class="n">one</span> <span class="o">=</span> <span class="n">data2ptpp</span><span class="p">[</span><span class="n">thiststr</span><span class="p">]</span><span class="o">/</span><span class="n">data2ptp</span><span class="p">[</span><span class="n">thiststr</span><span class="p">]</span>
            <span class="n">three</span> <span class="o">=</span> <span class="n">data2ptp</span><span class="p">[</span><span class="n">tflip</span><span class="p">]</span><span class="o">/</span><span class="n">data2ptpp</span><span class="p">[</span><span class="n">tflip</span><span class="p">]</span>
            <span class="n">inter</span> <span class="o">=</span> <span class="n">one</span><span class="o">*</span><span class="n">three</span>
            <span class="n">ott</span> <span class="o">=</span> <span class="n">inter</span><span class="o">/</span><span class="n">two</span>
            <span class="c1"># ott.Sqrt()</span>
            <span class="n">ott</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
            <span class="n">dictout</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ott</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dictout</span></div>


<div class="viewcode-block" id="RatioCorr.ImportFitRanges"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.ImportFitRanges">[docs]</a>    <span class="k">def</span> <span class="nf">ImportFitRanges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fit_range</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;PreDef&#39;</span> <span class="o">==</span> <span class="n">fit_range</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PredefFits</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span> <span class="o">=</span> <span class="n">fit_range</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SetsOfFits implementation now accepts 1 fit range to scan between. Selecting first one&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span> <span class="o">=</span> <span class="n">rm_tsumfitr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span><span class="p">)</span></div>


    <span class="c1">## NB, iGuess here is not implemented yet, needs to be passed into the function</span>
<div class="viewcode-block" id="RatioCorr.Fit"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.Fit">[docs]</a>    <span class="k">def</span> <span class="nf">Fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fit_range</span><span class="o">=</span><span class="s1">&#39;PreDef&#39;</span><span class="p">,</span><span class="n">iGuess</span><span class="o">=</span><span class="s1">&#39;PreDef&#39;</span><span class="p">,</span><span class="n">EstDir</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">WipeFit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">min_fitr</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImportFitRanges</span><span class="p">(</span><span class="n">fit_range</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">iGuess</span> <span class="o">!=</span> <span class="s1">&#39;PreDef&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span> <span class="o">=</span> <span class="n">iGuess</span>
        <span class="n">lFit</span><span class="p">,</span><span class="n">ilist</span> <span class="o">=</span> <span class="p">[],[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">),</span><span class="n">pdata</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;current_operator&#39;</span><span class="p">,</span><span class="s1">&#39;momentum&#39;</span><span class="p">)):</span>
            <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">this_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">WipeFit</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">drop</span><span class="p">([(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">)],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="n">ifitmin</span><span class="p">,</span><span class="n">ifitmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">unxmlfitr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span><span class="p">,(</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                <span class="n">ifitmin</span><span class="p">,</span><span class="n">ifitmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;incorrect format for fitr#-# &#39;</span> <span class="p">)</span>
            <span class="c1"># ifitmin,ifitmax = np.array(unxmlfitr(ifit),dtype=np.float64)</span>

            <span class="c1"># ##debugging</span>
            <span class="c1"># print</span>
            <span class="c1"># print &#39;FitData:&#39;</span>
            <span class="c1"># for it,iy in zip(tdatarange[0],ydata):</span>
            <span class="c1">#     print it, iy</span>
            <span class="c1"># print</span>
            <span class="n">fit_info</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">EstDir</span><span class="p">:</span>
                <span class="n">fit_info</span><span class="p">[</span><span class="s1">&#39;Funs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Fun</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">npar</span><span class="p">,</span><span class="s1">&#39;Estimate&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fit_info</span><span class="p">[</span><span class="s1">&#39;Funs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Fun</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">npar</span><span class="p">)</span>
            <span class="n">fit_info</span><span class="p">[</span><span class="s1">&#39;iGuess&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span>
            <span class="n">fit_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">this_key</span><span class="p">)</span>
            <span class="n">thisff</span> <span class="o">=</span> <span class="n">sff</span><span class="o">.</span><span class="n">SetOfFitFuns</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="n">this_key</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="n">fit_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="n">thisff</span><span class="o">.</span><span class="n">ScanRange_fitr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span><span class="p">,</span><span class="n">fit_info</span><span class="o">=</span><span class="n">fit_info</span><span class="p">,</span><span class="n">min_fit_len</span><span class="o">=</span><span class="n">min_fitr</span><span class="p">)</span>
            <span class="n">lFit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisff</span><span class="p">)</span>
            <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_key</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Col_Names</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">this_df</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                <span class="n">this_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lFit</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_df</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lFit</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">DoFits</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                <span class="n">val</span><span class="o">.</span><span class="n">DoFits</span><span class="p">(</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">val</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">DoFits</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span></div>


<div class="viewcode-block" id="RatioCorr.GetFuns"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.GetFuns">[docs]</a>    <span class="k">def</span> <span class="nf">GetFuns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
                <span class="n">ival</span><span class="o">.</span><span class="n">GetFuns</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="p">,</span><span class="s1">&#39;GetFuns&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">GetFuns</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="p">,</span><span class="s1">&#39;GetFuns&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="o">.</span><span class="n">GetFuns</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Fun&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fun</span> <span class="o">=</span> <span class="n">ReadFuns</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Fun_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="RatioCorr.RemoveFuns"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.RemoveFuns">[docs]</a>    <span class="k">def</span> <span class="nf">RemoveFuns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
                <span class="n">ival</span><span class="o">.</span><span class="n">RemoveFuns</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="p">,</span><span class="s1">&#39;GetFuns&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">RemoveFuns</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="p">,</span><span class="s1">&#39;GetFuns&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="o">.</span><span class="n">RemoveFuns</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Fun&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fun_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fun</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="n">WriteFuns</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Fun</span><span class="p">)</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fun</span></div>

<div class="viewcode-block" id="RatioCorr.Write"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.Write">[docs]</a>    <span class="k">def</span> <span class="nf">Write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">FixDictArray</span><span class="p">(</span><span class="n">thislist</span><span class="p">,</span><span class="n">ikey</span><span class="p">):</span>
            <span class="n">outDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">ic</span><span class="p">,</span><span class="n">ilist</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">thislist</span><span class="p">):</span>
                <span class="n">outDict</span><span class="p">[</span><span class="n">ikey</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ic</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ilist</span>
            <span class="k">return</span> <span class="n">outDict</span>

        <span class="c1"># C2name = self.C2class.name.replace(self.C2class.jsm,self.C3class.jsm)</span>
        <span class="c1"># C2LL = self.C2class.LegLab.replace(self.C2class.jsm,self.C3class.jsm)</span>
        <span class="c1"># self.C2class.SetCustomName(C2name,C2LL)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="p">,</span><span class="s1">&#39;Write&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;show_cfgs&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_cfgs</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">outDict</span> <span class="o">=</span> <span class="n">ODNested</span><span class="p">()</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="p">,</span><span class="s1">&#39;Write&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;C2file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">HumanFile</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;C3file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">HumanFile</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;kud&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">kud</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">ks</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;nt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nt</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;nxyz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nxyz</span>

        <span class="k">for</span> <span class="n">istream</span><span class="p">,</span><span class="n">incfg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">stream_list</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">ncfg_list</span><span class="p">):</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ncfg_&#39;</span><span class="o">+</span><span class="n">istream</span><span class="p">]</span> <span class="o">=</span> <span class="n">incfg</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;nxsrc_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">xsrcAvg</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;nMeas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">nMeas</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;nboot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nboot</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;tsrc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">tsrc</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;tsink&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">tsink</span>
        <span class="c1"># outDict[&#39;xsrc&#39;] = FixDictArray(self.xsrc,&#39;xsrc&#39;)</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ism&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">ism</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;sink_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">jsm</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;Projector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">Proj</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;Doub_Sing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">DS</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ppmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">ppmom</span>

        <span class="k">for</span> <span class="n">icg</span><span class="p">,</span><span class="n">igamma</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">gammalist</span><span class="p">):</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icg</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">igamma</span>
        <span class="k">for</span> <span class="n">icq</span><span class="p">,</span><span class="n">iqmom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">qmom</span><span class="p">):</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;qmom&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icq</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">iqmom</span>

        <span class="n">excel_params</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">outDict</span><span class="p">))</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;gamma_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FixDictArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">gammalist</span><span class="p">,</span><span class="s1">&#39;gamma&#39;</span><span class="p">)</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;qmom_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FixDictArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">qmom</span><span class="p">,</span><span class="s1">&#39;qmom&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">icg</span><span class="p">,</span><span class="n">igamma</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">gammalist</span><span class="p">):</span>
            <span class="k">del</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icg</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">icq</span><span class="p">,</span><span class="n">iqmom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">qmom</span><span class="p">):</span>
            <span class="k">del</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;qmom&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icq</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>



        <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">),</span><span class="n">fitdata</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;Fits&#39;</span><span class="p">][</span><span class="n">igamma</span><span class="p">][</span><span class="n">ip</span><span class="p">]</span> <span class="o">=</span> <span class="n">fitdata</span><span class="o">.</span><span class="n">GetOutputDict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">col_key</span><span class="p">,</span><span class="n">col_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;Avg&#39;</span> <span class="ow">in</span> <span class="n">col_key</span> <span class="ow">or</span> <span class="s1">&#39;Std&#39;</span> <span class="ow">in</span> <span class="n">col_key</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">),</span><span class="n">idata</span> <span class="ow">in</span> <span class="n">col_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">outDict</span><span class="p">[</span><span class="n">col_key</span><span class="p">][</span><span class="n">igamma</span><span class="p">][</span><span class="n">ip</span><span class="p">][</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">AvgStdToFormat</span><span class="p">(</span><span class="n">idata</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span><span class="n">idata</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>

        <span class="n">y</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;SqrtFact&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SqrtFact</span><span class="p">,</span><span class="s1">&#39;iteritems&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">),</span><span class="n">idata</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SqrtFact</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">idata</span><span class="o">.</span><span class="n">Avg</span><span class="p">):</span> <span class="n">idata</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;SqrtFact&#39;</span><span class="p">][</span><span class="n">ip</span><span class="p">][</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">AvgStdToFormat</span><span class="p">(</span><span class="n">idata</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span><span class="n">idata</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">),</span><span class="n">idata</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">C2_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">idata</span><span class="o">.</span><span class="n">Avg</span><span class="p">):</span> <span class="n">idata</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;G2&#39;</span><span class="p">][</span><span class="n">ip</span><span class="p">][</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">AvgStdToFormat</span><span class="p">(</span><span class="n">idata</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span><span class="n">idata</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>


        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">ncfg_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cfgs</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">((</span><span class="n">istream</span><span class="p">,</span><span class="n">iccfg</span><span class="p">),</span><span class="n">icfg</span><span class="p">),</span><span class="n">ixsrc_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;configs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;cfglist&#39;</span><span class="p">][</span><span class="n">istream</span><span class="p">][</span><span class="n">icfg</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;n_xsrc_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ixsrc_list</span><span class="p">))</span>

        <span class="c1">## Write human readable file with data</span>
        <span class="n">WriteXml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span><span class="p">,{</span><span class="s1">&#39;Results&#39;</span><span class="p">:</span><span class="n">outDict</span><span class="p">})</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">ncfg_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">for</span> <span class="p">((</span><span class="n">istream</span><span class="p">,</span><span class="n">iccfg</span><span class="p">),</span><span class="n">icfg</span><span class="p">),</span><span class="n">ixsrc_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;configs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;cfglist&#39;</span><span class="p">][</span><span class="n">istream</span><span class="p">][</span><span class="n">icfg</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;n_xsrc_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ixsrc_list</span><span class="p">))</span>

        <span class="c1">## TODO, include fitting in the excell file</span>
        <span class="n">WriteExcel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">,{</span><span class="s1">&#39;Rat_results&#39;</span><span class="p">:</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">)},</span><span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">excel_params</span><span class="p">)</span>

        <span class="c1">## pickles rest of data for reading</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RemoveFuns</span><span class="p">()</span>
        <span class="n">WritePickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GetFuns</span><span class="p">()</span></div>

    <span class="c1">##################################</span>


<div class="viewcode-block" id="RatioCorr.ReadAndWrite"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.ReadAndWrite">[docs]</a>    <span class="k">def</span> <span class="nf">ReadAndWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">WipeData</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Read</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CreateC2Sink</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bootstrap</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CalcRatio</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span></div>

    <span class="c1">## add things you want to update to the depreciated pickled files here.</span>
<div class="viewcode-block" id="RatioCorr.FixDict"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.FixDict">[docs]</a>    <span class="k">def</span> <span class="nf">FixDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thisdict</span><span class="p">):</span>
        <span class="n">thisdict</span><span class="p">[</span><span class="s1">&#39;LegLab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span>
        <span class="k">return</span> <span class="n">thisdict</span></div>

<div class="viewcode-block" id="RatioCorr.GetTflowList"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.GetTflowList">[docs]</a>    <span class="k">def</span> <span class="nf">GetTflowList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">load_dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">load_dict</span><span class="p">[</span><span class="s1">&#39;Rat_Stats&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span></div>

<div class="viewcode-block" id="RatioCorr.FixRead"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.FixRead">[docs]</a>    <span class="k">def</span> <span class="nf">FixRead</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">readdict</span><span class="p">):</span>
        <span class="n">rewrite</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;C2class&#39;</span><span class="p">],</span><span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;C2Set&#39;</span><span class="p">],</span><span class="nb">str</span><span class="p">):</span>
                <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;C2Set&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Complete&#39;</span>
                <span class="n">rewrite</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">readdict</span><span class="p">,</span><span class="n">rewrite</span></div>

<div class="viewcode-block" id="RatioCorr.LoadPickle"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.LoadPickle">[docs]</a>    <span class="k">def</span> <span class="nf">LoadPickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">WipeData</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">CheckMom</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># print</span>
        <span class="c1"># print &#39;NJN&#39;</span>
        <span class="c1"># print self.HumanFile</span>
        <span class="c1"># print self.PickleFile</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">DefWipe</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading Pickle file &#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span>
            <span class="n">loadeddict</span> <span class="o">=</span> <span class="n">ReadPickleWrap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span>
            <span class="n">loadeddict</span><span class="p">,</span><span class="n">rewrite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FixRead</span><span class="p">(</span><span class="n">loadeddict</span><span class="p">)</span>
            <span class="n">checklist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thischecklist</span>
            <span class="k">if</span> <span class="n">CheckCfgs</span><span class="p">:</span> <span class="n">checklist</span> <span class="o">=</span> <span class="n">checklist</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;cfglist&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">CheckMom</span><span class="p">:</span> <span class="n">checklist</span> <span class="o">=</span> <span class="n">checklist</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;checkmomlist&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">CheckClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span><span class="n">loadeddict</span><span class="p">,</span><span class="n">checklist</span><span class="p">):</span>
                <span class="n">loadeddict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FixDict</span><span class="p">(</span><span class="n">loadeddict</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">loadeddict</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rewrite</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">Wipe_All_Fits</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">sff</span><span class="o">.</span><span class="n">SetOfFitFuns</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Legacy file, fits need to be recomputed&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">,</span><span class="s1">&#39;.bak.xlsx&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;using backupfile for &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="n">CheckCfgs</span><span class="p">,</span><span class="n">CheckMom</span><span class="o">=</span><span class="n">CheckMom</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning, file &#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span> <span class="p">,</span> <span class="s1">&#39; has different parameters than this instance, reading and writing over file now&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ReadAndWrite</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span>
            <span class="c1"># self.Write()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;pickle file not found: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ReadAndWrite</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span></div>
    <span class="c1">## Routines for Plotting ###############################################</span>

<div class="viewcode-block" id="RatioCorr.ImportPlotParams"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.ImportPlotParams">[docs]</a>    <span class="k">def</span> <span class="nf">ImportPlotParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thiscol</span><span class="p">,</span><span class="n">thissym</span><span class="p">,</span><span class="n">thisshift</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckCol</span><span class="p">(</span><span class="n">thiscol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckSym</span><span class="p">(</span><span class="n">thissym</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span> <span class="o">=</span> <span class="n">thisshift</span></div>

<div class="viewcode-block" id="RatioCorr.CheckCol"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.CheckCol">[docs]</a>    <span class="k">def</span> <span class="nf">CheckCol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thiscol</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;PreDefine&#39;</span> <span class="o">==</span> <span class="n">thiscol</span> <span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;Not Set&#39;</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Pass in color to initialize it&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span> <span class="o">=</span> <span class="n">thiscol</span></div>

<div class="viewcode-block" id="RatioCorr.CheckSym"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.CheckSym">[docs]</a>    <span class="k">def</span> <span class="nf">CheckSym</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thissym</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;PreDefine&#39;</span> <span class="o">==</span> <span class="n">thissym</span> <span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;Not Set&#39;</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">thissym</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Pass in symbol to initialize it&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thissym</span> <span class="o">=</span> <span class="n">thissym</span></div>


<div class="viewcode-block" id="RatioCorr.GetShift"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.GetShift">[docs]</a>    <span class="k">def</span> <span class="nf">GetShift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">xlims</span><span class="p">,</span><span class="n">thisshift</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">thisshift</span> <span class="o">!=</span> <span class="s1">&#39;PreDefine&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span> <span class="o">=</span> <span class="n">thisshift</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisshiftscale</span> <span class="o">==</span> <span class="s1">&#39;Not Set&#39;</span><span class="p">:</span>
            <span class="n">xlen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xlims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xlims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thisshiftscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span><span class="o">*</span><span class="n">xlen</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisshiftscale</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisshiftscale</span></div>




    <span class="c1">## make sure all xlims are the same, because this sets the window of xlim (needed for calculating shifts)</span>
    <span class="c1">## gammamomlist is a dictionary where the keys are the gamma matricies, and the values are lists of momenta</span>
    <span class="c1">## TODO: SHIFTS NEED TO BE FIXED!! LIKE NOW. A better way needs to be implemented.</span>
<div class="viewcode-block" id="RatioCorr.Plot"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.Plot">[docs]</a>    <span class="k">def</span> <span class="nf">Plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">plot_class</span><span class="p">,</span><span class="n">xlims</span><span class="o">=</span><span class="s1">&#39;tsink&#39;</span><span class="p">,</span><span class="n">gammamomlist</span><span class="o">=</span><span class="p">{},</span><span class="n">thiscol</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">,</span><span class="n">thissym</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">xlims</span> <span class="o">==</span> <span class="s1">&#39;tsink&#39;</span><span class="p">:</span> <span class="n">xlims</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">tsink</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;tsink&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckCol</span><span class="p">(</span><span class="n">thiscol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckSym</span><span class="p">(</span><span class="n">thissym</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thisshiftscale</span> <span class="o">=</span> <span class="s1">&#39;Not Set&#39;</span>
        <span class="n">thisshift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetShift</span><span class="p">(</span><span class="n">xlims</span><span class="p">,</span><span class="n">thisshift</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s1">&#39;no data to plot, maybe try to read in and bootstrap before plotting&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">gammamomlist</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gammamomlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defgammamomlist</span>


        <span class="c1"># for (igamma,ip),Rat_data in self.Rat_Stats[&#39;boot&#39;].groupby(level=(&#39;current_operator&#39;,&#39;momentum&#39;)):</span>
            <span class="c1"># if igamma not in gammamomlist.keys(): continue</span>
            <span class="c1"># if ip not in gammamomlist[igamma]: continue</span>
        <span class="n">igamma</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gammamomlist</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">TOpform</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">gammamomlist</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">pref</span><span class="o">=</span><span class="s1">&#39;q&#39;</span><span class="p">)</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;qq&#39;</span><span class="p">,</span><span class="s1">&#39;q&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">])</span> <span class="p">,</span><span class="s1">&#39; not computed&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">plot_class</span>
        <span class="c1"># tlist,databoot = zip(*list(self.Rat_Stats[&#39;boot&#39;][igamma,ip].iteritems()))</span>
        <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
        <span class="n">databoot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span>
        <span class="n">dataavg</span> <span class="o">=</span> <span class="n">databoot</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">Avg</span><span class="p">)</span>
        <span class="n">dataerr</span> <span class="o">=</span> <span class="n">databoot</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
        <span class="n">tlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">databoot</span><span class="p">[</span><span class="n">this_key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="c1"># dataavg,dataerr = [],[]</span>
        <span class="c1"># for idata in databoot[xlims[0]:xlims[1]]:</span>
        <span class="c1">#     dataavg.append(idata.Avg)</span>
        <span class="c1">#     dataerr.append(idata.Std)</span>
        <span class="n">tlist</span> <span class="o">=</span> <span class="n">tlist</span><span class="p">[</span><span class="n">xlims</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">xlims</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="c1"># print &#39;plotting &#39; , igamma,ip</span>
        <span class="c1"># pleg,gammaleg = &#39;&#39;,&#39;&#39;</span>
        <span class="c1"># if len(gammamomlist[igamma]) &gt; 1:</span>
        <span class="c1"># pleg = &#39; $&#39;+ip+&#39;$&#39;</span>
        <span class="c1"># if &#39;_cmplx&#39; in igamma:</span>
        <span class="c1">#     gammaleg = &#39; $i&#39;+igamma.replace(&#39;_cmplx&#39;,&#39;&#39;)+&#39;$&#39;</span>
        <span class="c1"># else:</span>
        <span class="c1">#     gammaleg = &#39; $&#39;+igamma+&#39;$&#39;</span>
        <span class="c1"># if len(gammamomlist.keys()) &gt; 1:</span>
        <span class="n">tlistplot</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">centert</span> <span class="o">=</span> <span class="n">CenterT</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">untstr</span><span class="p">,</span><span class="n">tlist</span><span class="p">)))</span><span class="o">-</span><span class="n">twopttshift</span><span class="o">+</span><span class="n">thisshift</span><span class="p">)</span>
        <span class="n">hold_series</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
        <span class="c1"># hold_series[&#39;x_data&#39;] = tlistplot</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;x_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;from_keys&#39;</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;y_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataavg</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;yerr_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataerr</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;xerr_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;key_select&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_key</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;error_bar_vary&#39;</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;fit_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span><span class="c1">#+pleg+gammaleg</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thissym</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;shift&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisshift</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;xdatarange&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;Phys&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;ShowPar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;fmt_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">KeyForamtting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="p">)</span>
        <span class="n">plot_class</span><span class="o">.</span><span class="n">AppendData</span><span class="p">(</span><span class="n">hold_series</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plot_class</span></div>

    <span class="c1">## state is 1 or 2 state fit</span>
    <span class="c1">## fitr is fit range e.g. fitr5-10</span>
    <span class="c1">## fit range of &#39;Data&#39; is just the original fit range</span>
    <span class="c1">## tflowlist is just for consistancy with other function in NJNQ, does nothing</span>
<div class="viewcode-block" id="RatioCorr.GetBestFitr"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.GetBestFitr">[docs]</a>    <span class="k">def</span> <span class="nf">GetBestFitr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">)</span><span class="o">+</span> <span class="s1">&#39; not foun in ratio fit list, cannot find best&#39;</span>
            <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>
        <span class="n">chi_str</span><span class="p">,</span><span class="n">cut_fit_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">at</span><span class="p">[(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">),</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">GetBestChi</span><span class="p">()</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;$\chi^</span><span class="si">{2}</span><span class="s1">_</span><span class="si">{pdf}</span><span class="s1">=</span><span class="si">{:.3f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chi_str</span><span class="p">),</span><span class="n">cut_fit_result</span></div>

<div class="viewcode-block" id="RatioCorr.Get_Extrapolation"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.Get_Extrapolation">[docs]</a>    <span class="k">def</span> <span class="nf">Get_Extrapolation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">keep_keys</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">fmted</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sff</span><span class="o">.</span><span class="n">PullSOFSeries_Wpar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">],</span><span class="n">keep_keys</span><span class="o">=</span><span class="n">keep_keys</span><span class="p">,</span><span class="n">fmted</span><span class="o">=</span><span class="n">fmted</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span></div>

<div class="viewcode-block" id="RatioCorr.FitPlot"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.FitPlot">[docs]</a>    <span class="k">def</span> <span class="nf">FitPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">plot_class</span><span class="p">,</span><span class="n">fitr</span><span class="p">,</span><span class="n">xlims</span> <span class="o">=</span> <span class="s1">&#39;Data&#39;</span><span class="p">,</span><span class="n">gammamomlist</span><span class="o">=</span><span class="p">{},</span>
                <span class="n">thiscol</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">,</span><span class="n">tflowlist</span><span class="o">=</span><span class="p">[]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckCol</span><span class="p">(</span><span class="n">thiscol</span><span class="p">)</span>
        <span class="n">thisshift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetShift</span><span class="p">(</span><span class="n">xlims</span><span class="p">,</span><span class="n">thisshift</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">centert</span> <span class="o">==</span> <span class="s1">&#39;Not Set&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;print centert not set, defaulting to 0&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">centert</span> <span class="o">=</span> <span class="mf">0.9</span>

        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s1">&#39;No fitting has been done, maybe try to Fit before plotting fit&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">gammamomlist</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gammamomlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defgammamomlist</span>
        <span class="c1"># for igamma,momlist in gammamomlist.iteritems():</span>
        <span class="c1">#     for ip in momlist:</span>
        <span class="n">igamma</span><span class="p">,</span><span class="n">momlist</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">gammamomlist</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">TOpform</span><span class="p">(</span><span class="n">momlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pref</span><span class="o">=</span><span class="s1">&#39;q&#39;</span><span class="p">)</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;qq&#39;</span><span class="p">,</span><span class="s1">&#39;q&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fitr</span> <span class="o">==</span> <span class="s1">&#39;Best&#39;</span><span class="p">:</span>
            <span class="n">chi_legend</span><span class="p">,</span><span class="n">fitr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetBestFitr</span><span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no fits done, attempting fit now&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">fit_range</span><span class="o">=</span><span class="n">fitr</span><span class="p">)</span>
        <span class="n">fit_data</span> <span class="o">=</span> <span class="n">sff</span><span class="o">.</span><span class="n">PullSOFSeries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
        <span class="n">this_fun</span> <span class="o">=</span> <span class="n">fit_data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">this_fun</span><span class="p">,</span><span class="n">fitr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">this_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fit_data</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">this_key</span> <span class="p">,</span> <span class="s1">&#39;not present in Rat Fit Stats, fitting now&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">fit_range</span><span class="o">=</span><span class="n">fitr</span><span class="p">)</span>
            <span class="n">fit_data</span> <span class="o">=</span> <span class="n">sff</span><span class="o">.</span><span class="n">PullSOFSeries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
            <span class="n">this_fun</span> <span class="o">=</span> <span class="n">fit_data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">this_fun</span><span class="p">,</span><span class="n">fitr</span><span class="p">)</span>

        <span class="n">hold_series</span> <span class="o">=</span> <span class="n">null_series</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;key_select&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_key</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;fit_vary&#39;</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;fit_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit_data</span>
        <span class="c1"># hold_series[&#39;label&#39;] = fit_data[this_key].name +&#39; &#39; + chi_legend</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ACTUAL_VALUE_fit&#39;</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thissym</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;shift&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisshift</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;xdatarange&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xlims</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;ShowPar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Par1&#39;</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;fmt_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">KeyForamtting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="p">)</span>
        <span class="n">plot_class</span><span class="o">.</span><span class="n">AppendData</span><span class="p">(</span><span class="n">hold_series</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plot_class</span></div>


    <span class="c1">## ##################### ###############################################</span>

    <span class="c1">## Comparisons</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">SubDir</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="RatioCorr.iteritems"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.iteritems">[docs]</a>    <span class="k">def</span> <span class="nf">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span></div>

<div class="viewcode-block" id="RatioCorr.items"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.items">[docs]</a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span></div>

<div class="viewcode-block" id="RatioCorr.itemsAvgStd"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.itemsAvgStd">[docs]</a>    <span class="k">def</span> <span class="nf">itemsAvgStd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">outlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ivals</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
            <span class="n">outlist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ivals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ivals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">ivals</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">outlist</span></div>

<div class="viewcode-block" id="RatioCorr.values"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.values">[docs]</a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span></div>
<div class="viewcode-block" id="RatioCorr.itervalues"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.itervalues">[docs]</a>    <span class="k">def</span> <span class="nf">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span></div>

<div class="viewcode-block" id="RatioCorr.valuesAvgStd"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.valuesAvgStd">[docs]</a>    <span class="k">def</span> <span class="nf">valuesAvgStd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">outlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ivals</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
            <span class="n">outlist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ivals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">ivals</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">outlist</span></div>

<div class="viewcode-block" id="RatioCorr.keys"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">index</span></div>


    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__reversed__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">iiloc</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span>


    <span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thiskey</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">thiskey</span><span class="p">]</span>


    <span class="c1">## unitary arithmetic operations</span>

    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span>


    <span class="k">def</span> <span class="nf">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1">## Casting, just casts the bootstrap values, ignore return value (only needed since return has to be same type).</span>


    <span class="k">def</span> <span class="nf">__complex__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="nb">complex</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">+</span><span class="mi">0</span><span class="n">j</span>

    <span class="k">def</span> <span class="nf">__int__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__float__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="k">return</span> <span class="mf">1.0</span>


<span class="c1">## BLOCK FOR OVERLOADING ARITHMETIC OPERATIONS ####</span>
<div class="viewcode-block" id="RatioCorr.ReduceIndicies"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.ReduceIndicies">[docs]</a>    <span class="k">def</span> <span class="nf">ReduceIndicies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">indexl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">first_gamma</span> <span class="o">=</span> <span class="n">MultiSplit</span><span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">op_str_list</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;FO&#39;</span><span class="p">,</span><span class="s1">&#39;FOFull&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">this_gamma</span> <span class="o">=</span> <span class="n">first_gamma</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;FO&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">this_gamma</span> <span class="o">=</span> <span class="n">this_gamma</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;FOFull&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">this_gamma</span> <span class="o">=</span> <span class="n">this_gamma</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">this_gamma</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span>
                <span class="n">this_gamma</span> <span class="o">=</span> <span class="n">this_gamma</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">this_p</span> <span class="o">=</span> <span class="n">MultiSplit</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">op_str_list</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;FO&#39;</span><span class="p">,</span><span class="s1">&#39;FOFull&#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">indexl</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">this_gamma</span><span class="p">,</span><span class="n">this_p</span><span class="p">,</span><span class="n">it</span><span class="p">))</span>
        <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">indexl</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Col_Names</span><span class="p">)</span>
        <span class="n">this_series</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_series</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span></div>


<div class="viewcode-block" id="RatioCorr.sin"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.sin">[docs]</a>    <span class="k">def</span> <span class="nf">sin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">RatioCorr</span><span class="p">(</span><span class="n">thisnboot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">,</span> <span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[[</span><span class="s1">&#39;configs&#39;</span><span class="p">,</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]],</span>
                         <span class="n">Info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">,</span><span class="n">thissym</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thissym</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span><span class="p">,</span>
                         <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;sin(&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;sin_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="RatioCorr.cos"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.cos">[docs]</a>    <span class="k">def</span> <span class="nf">cos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">RatioCorr</span><span class="p">(</span><span class="n">thisnboot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">,</span> <span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[[</span><span class="s1">&#39;configs&#39;</span><span class="p">,</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]],</span>
                         <span class="n">Info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">,</span><span class="n">thissym</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thissym</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span><span class="p">,</span>
                         <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;cos(&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;cos_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">Rat_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="RatioCorr.Overload_wrap"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioCorr.Overload_wrap">[docs]</a>    <span class="k">def</span> <span class="nf">Overload_wrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">,</span><span class="n">this_fun</span><span class="p">):</span>
        <span class="c1">## TODO, include some name and filename formatting</span>
        <span class="n">thisname</span><span class="p">,</span><span class="n">thisfilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">):</span>
            <span class="n">thisname</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">Rat2</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="s1">&#39;filename&#39;</span><span class="p">):</span>
            <span class="n">thisfilename</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">Rat2</span><span class="o">.</span><span class="n">filename</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">RatioCorr</span><span class="p">(</span><span class="n">thisnboot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">,</span> <span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C3class</span><span class="o">.</span><span class="n">C3_cfgs</span><span class="p">[[</span><span class="s1">&#39;configs&#39;</span><span class="p">,</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]],</span>
                         <span class="n">Info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">,</span><span class="n">thissym</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thissym</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">Rat_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
        <span class="c1"># result.UpdateName(&#39;+&#39;,self,Rat2)</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">RatioCorr</span><span class="p">):</span>
                <span class="c1"># result.Rat_Stats.loc[:,&#39;boot&#39;] = this_fun(self.Rat_Stats.loc[:,&#39;boot&#39;],Rat2.Rat_Stats.loc[:,&#39;boot&#39;])</span>
                <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="n">Rat2</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">:</span>
                    <span class="n">vall</span><span class="p">,</span><span class="n">ilist</span> <span class="o">=</span> <span class="p">[],[]</span>
                    <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">),</span><span class="n">irat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">it</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Rat2</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
                            <span class="n">out_str</span> <span class="o">=</span> <span class="s1">&#39;missmatch in euclidian times when combining ratio functions </span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="n">out_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="n">out_str</span> <span class="o">+=</span> <span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="n">out_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Rat2</span><span class="p">)</span>
                            <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="n">out_str</span><span class="p">)</span>
                        <span class="k">for</span> <span class="p">(</span><span class="n">igamma2</span><span class="p">,</span><span class="n">ip2</span><span class="p">,</span><span class="n">itdump</span><span class="p">),</span><span class="n">irat2</span> <span class="ow">in</span> <span class="n">Rat2</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">it</span><span class="p">),</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">igammacomb</span><span class="p">,</span><span class="n">ipcomb</span> <span class="o">=</span> <span class="n">igamma</span><span class="p">,</span><span class="n">ip</span>
                            <span class="k">if</span> <span class="n">igamma2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">igamma</span><span class="p">:</span>
                                <span class="n">igammacomb</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">igamma2</span>
                            <span class="k">if</span> <span class="n">ip2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ip2</span><span class="p">:</span>
                                <span class="n">ipcomb</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">ip2</span>
                            <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">igammacomb</span><span class="p">,</span><span class="n">ipcomb</span><span class="p">,</span><span class="n">it</span><span class="p">))</span>
                            <span class="n">vall</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_fun</span><span class="p">(</span><span class="n">irat</span><span class="p">,</span><span class="n">irat2</span><span class="p">))</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Col_Names</span><span class="p">)</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">vall</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s1">&#39;Run Bootstrap on second class before combining ratio functions&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_fun</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">],</span> <span class="n">Rat2</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">),</span> <span class="n">Rat2</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">Rat2</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">this_fun</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Rat2</span><span class="p">))</span>
                    <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Invalid value to combine with RatioCorr class&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s1">&#39;Run Bootstrap on first class before combining ratio functions&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">op</span><span class="o">.</span><span class="n">add</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">op</span><span class="o">.</span><span class="n">sub</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">op</span><span class="o">.</span><span class="n">mul</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="n">__rdiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">op</span><span class="o">.</span><span class="n">truediv</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="fm">__rpow__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">op</span><span class="o">.</span><span class="n">pow</span><span class="p">)</span>


    <span class="c1">## Right multiplication functions</span>


    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">flip_fun_2arg</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">add</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">flip_fun_2arg</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">sub</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">flip_fun_2arg</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">mul</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rdiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="n">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">flip_fun_2arg</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">truediv</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">__rpow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="fm">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">flip_fun_2arg</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">pow</span><span class="p">))</span></div>




<span class="c1">####################################################################################################################</span>
<span class="c1">####################################################################################################################</span>
<span class="c1">####################################################################################################################</span>
<span class="c1">####################################################################################################################</span>
<span class="c1">####################################################################################################################</span>

<span class="c1">##UP TO HERE TODO:</span>

<div class="viewcode-block" id="RatioFOCorr"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr">[docs]</a><span class="k">class</span> <span class="nc">RatioFOCorr</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Rat(q,tau,pp,t,tflow) uses bootstrap class</span>
<span class="sd">    pp  = sink momentum</span>
<span class="sd">    t   = source sink separation time</span>
<span class="sd">    q   = current insersion momentum</span>
<span class="sd">    tau = current insersion time</span>
<span class="sd">    tflow = flow time</span>

<span class="sd">    Info is a dictionary containing information for the correlator:</span>
<span class="sd">    see comments below to see what is required.</span>
<span class="sd">    missing elements just sets field to default</span>


<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="RatioFOCorr.Construct_RatFO_File"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.Construct_RatFO_File">[docs]</a>    <span class="k">def</span> <span class="nf">Construct_RatFO_File</span><span class="p">(</span><span class="n">this_file</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Construct_File_Object</span><span class="p">(</span><span class="n">this_file</span><span class="p">,</span><span class="n">RatioFOCorr</span><span class="p">)</span></div>

    <span class="c1">## TODO: create variational flag and interface with this function.</span>

    <span class="c1">## array of all classes that inherit this class. Append this when adding new classes please!</span>
    <span class="n">parentlist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SetOfCorrs.SetsOfRatios&#39;</span><span class="p">,</span><span class="s1">&#39;RatioCorrelators.RatioFOFullCorr&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thisnboot</span><span class="o">=</span><span class="n">nboot</span><span class="p">,</span> <span class="n">cfglist</span><span class="o">=</span><span class="p">{},</span> <span class="n">Info</span><span class="o">=</span><span class="p">{},</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">thissym</span><span class="o">=</span><span class="s1">&#39;Not Set&#39;</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="s1">&#39;Not Set&#39;</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="mf">0.0</span>
                 <span class="p">,</span><span class="n">man_load_cfgs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">## Initialising plotting parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span> <span class="o">=</span> <span class="n">thisshift</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span> <span class="o">=</span> <span class="n">thiscol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thissym</span> <span class="o">=</span> <span class="n">thissym</span>
        <span class="c1">## the actual shift ammount needs to be scaled by the x axis size</span>
        <span class="c1">## see GetShift</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thisshiftscale</span> <span class="o">=</span> <span class="s1">&#39;Not Set&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span> <span class="o">=</span> <span class="n">NJNQCorr</span><span class="p">(</span><span class="n">thisnboot</span><span class="o">=</span><span class="n">thisnboot</span><span class="p">,</span> <span class="n">cfglist</span><span class="o">=</span><span class="n">cfglist</span><span class="p">,</span> <span class="n">Info</span><span class="o">=</span><span class="n">Info</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">PickleFile</span>
        <span class="k">if</span> <span class="s1">&#39;fo_for_cfgs&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">fo_for_cfgs</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;fo_for_cfgs&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fo_for_cfgs</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tflow_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">tflowlist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thischecklist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;C3file&#39;</span><span class="p">,</span><span class="s1">&#39;Sym&#39;</span><span class="p">,</span><span class="s1">&#39;fo_for_cfgs&#39;</span><span class="p">,</span><span class="s1">&#39;tflow_list&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkmomlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">checkmomlist</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">latparams</span>
        <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">GetAvgmomstr</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">qmom</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;0 0 0&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">]:</span>
            <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0 0 0&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">nt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nxyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">nxyz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span> <span class="o">=</span> <span class="s1">&#39;RC&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nxyz</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;x&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim_ll</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nxyz</span><span class="p">)</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;^</span><span class="si">{3}</span><span class="s1">\times &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">)</span>

        <span class="c1">## both current and sink momentum are requred for the two point correlator construction when constructing the ratio function</span>
        <span class="c1">## but the two point correlator has been averaged over, so we need to get the averaged momentum anaolgy</span>
        <span class="c1">## bah, this was too hard to keep unique files for the two-point correlator.</span>
        <span class="c1">## easier just to read and write the whole 2 point mom file.</span>
        <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">GetMomList</span><span class="p">(</span><span class="n">list_type</span><span class="o">=</span><span class="s1">&#39;str_Avg&#39;</span><span class="p">,</span><span class="n">list_order</span><span class="o">=</span><span class="s1">&#39;squared_rev&#39;</span><span class="p">)</span>
        <span class="c1">## e.g. q = [-1,1,-1] corresponds to p = [1 1 1] in the two-point correlator</span>
        <span class="c1"># ppforp = self.latparams.GetAvgmomstr(Info[&#39;ppmom&#39;])</span>
        <span class="c1"># if ppforp not in Info[&#39;pmom&#39;]: Info[&#39;pmom&#39;].append(ppforp)</span>


        <span class="k">if</span> <span class="s1">&#39;show_cfgs&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cfgs</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;show_cfgs&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cfgs</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="s1">&#39;Rat_comb_alpha_fun&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;Rat_comb_alpha_fun&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Rat_comb_alpha_fun has been set to false, turn back on if you want to use it again!.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha_rat</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_rat</span> <span class="o">=</span> <span class="kc">False</span>



        <span class="c1">## Does symmetrising over smearings</span>
        <span class="k">if</span> <span class="s1">&#39;Symmetric&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">Sym</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;Symmetric&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Sym</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">## default to no symmetrizing, (usually full matrix isn&#39;t computed nowerdays.</span>

        <span class="c1"># self.C2filelist = [ikey.PickleFile for ikey in self.C2classlist.itervalues()]</span>

        <span class="k">if</span> <span class="s1">&#39;Rat_alpha&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span>  <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;Rat_alpha&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING, Rat_alpha hard coded to be off, turn this on if you decide you want to use it again!&#39;</span><span class="p">)</span>
            <span class="c1"># self.Rat_alpha = Info[&#39;Rat_alpha&#39;]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Rat_alpha</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_alpha</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_alpha</span><span class="p">:</span>
            <span class="n">Info2pt</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">Info</span><span class="p">)</span>
            <span class="n">Info2pt</span><span class="p">[</span><span class="s1">&#39;Interp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;CPOdd&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sinklab</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">jsmcoeffs</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sm2ptList</span><span class="p">,</span><span class="n">InfoList</span> <span class="o">=</span> <span class="n">GetInfoList</span><span class="p">(</span><span class="n">Info2pt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span> <span class="o">=</span> <span class="n">SetOfNNQ</span><span class="p">(</span><span class="n">cfglist</span><span class="o">=</span><span class="n">cfglist</span><span class="p">,</span><span class="n">InfoDict</span> <span class="o">=</span> <span class="n">InfoList</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Info2pt</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">Info</span><span class="p">)</span>
            <span class="n">Info2pt</span><span class="p">[</span><span class="s1">&#39;Interp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;CPEven&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sinklab</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">jsmcoeffs</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sm2ptList</span><span class="p">,</span><span class="n">InfoList</span> <span class="o">=</span> <span class="n">GetInfoList</span><span class="p">(</span><span class="n">Info2pt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span> <span class="o">=</span> <span class="n">SetOfTwoPt</span><span class="p">(</span><span class="n">cfglist</span><span class="o">=</span><span class="n">cfglist</span><span class="p">,</span><span class="n">InfoDict</span> <span class="o">=</span> <span class="n">InfoList</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span> <span class="o">=</span> <span class="s1">&#39;Not Set&#39;</span>

        <span class="k">if</span> <span class="n">Debug_Mode</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;testing getinfolist&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sinklab</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jsmcoeffs</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sm2ptList</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Observ</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">iinfo</span> <span class="ow">in</span> <span class="n">InfoList</span><span class="p">:</span> <span class="n">iinfo</span><span class="p">[</span><span class="s1">&#39;fo_for_cfgs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">iinfo</span> <span class="ow">in</span> <span class="n">InfoList</span><span class="p">:</span> <span class="n">iinfo</span><span class="p">[</span><span class="s1">&#39;fo_for_cfgs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Observ</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">defgammamomlist</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">igamma</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">gammalist</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defgammamomlist</span><span class="p">[</span><span class="n">igamma</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">qform</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Col_Names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;current_operator&#39;</span><span class="p">,</span><span class="s1">&#39;momentum&#39;</span><span class="p">,</span><span class="s1">&#39;flow_times&#39;</span><span class="p">,</span><span class="s1">&#39;source_sink_separation&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        self.Rat_Stats DataFrame:</span>

<span class="sd">        columns =   boot,   Avg,        Std</span>

<span class="sd">        rows =      current_operator,   momenta,    flow_times,    time separation</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Col_Names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;current_operator&#39;</span><span class="p">,</span><span class="s1">&#39;momentum&#39;</span><span class="p">,</span><span class="s1">&#39;flow_times&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        self.Rat_Fit_Stats DataFrame:</span>

<span class="sd">        columns =   boot,   Avg,        Std</span>

<span class="sd">        rows =      current_operator, momenta,  flow_times, time fit range</span>

<span class="sd">        Avg/Std elements are pa.Series instances with:</span>
<span class="sd">            index = fit parameters</span>
<span class="sd">            values = Avg/Std values</span>
<span class="sd">        &#39;&#39;&#39;</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">nboot</span> <span class="o">=</span> <span class="n">thisnboot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centert</span> <span class="o">=</span> <span class="s1">&#39;Not Set&#39;</span>


        <span class="c1">## Info can contain fit ranges to be calculated</span>
        <span class="c1">## must bein form Info[&#39;FitsRF&#39;] = [ &#39;fit#-#&#39; , ...]</span>
        <span class="k">if</span> <span class="s1">&#39;FitsRF&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">PredefFits</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;FitsRF&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">PredefFits</span> <span class="o">=</span> <span class="p">[]</span>


        <span class="k">if</span> <span class="s1">&#39;RFFitFun&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fun</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">npar</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;RFFitFun&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fun</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">npar</span> <span class="o">=</span> <span class="p">(</span><span class="n">ConstantFitFun</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">## Info can contain initial guess for fits, make sure it array of correct length</span>
        <span class="k">if</span> <span class="s1">&#39;iGuessRF&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;iGuessRF&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span> <span class="c1">## Defaults to value set for function in FitFunctions.py</span>

        <span class="c1">## is needed?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Info</span> <span class="o">=</span> <span class="n">Info</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SetCustomName</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">stringfn</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">man_load_cfgs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LoadCfgs</span><span class="p">(</span><span class="n">cfglist</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">filename</span><span class="p">)</span>

<div class="viewcode-block" id="RatioFOCorr.LoadCfgs"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.LoadCfgs">[docs]</a>    <span class="k">def</span> <span class="nf">LoadCfgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cfglist</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cfglist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CombineCfgLists</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">cfglist</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetCustomName</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">stringfn</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span></div>

    <span class="c1">## just for consistancy with other classes</span>
<div class="viewcode-block" id="RatioFOCorr.GetCfgList"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.GetCfgList">[docs]</a>    <span class="k">def</span> <span class="nf">GetCfgList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CombineCfgLists</span><span class="p">()</span></div>

<div class="viewcode-block" id="RatioFOCorr.CombineCfgLists"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.CombineCfgLists">[docs]</a>    <span class="k">def</span> <span class="nf">CombineCfgLists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">thiscfglist</span> <span class="o">=</span> <span class="n">CombineCfgs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJNQ_cfgs</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="o">.</span><span class="n">cfglist</span><span class="p">)</span>
            <span class="c1"># print</span>
            <span class="c1"># print len(thiscfglist.keys()), len(self.C3FOclass.cfglist.keys()), len(self.C2Set.cfglist.keys())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thiscfglist</span> <span class="o">=</span> <span class="n">CombineCfgs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJNQ_cfgs</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">C2_cfgs</span><span class="p">)</span>
            <span class="c1"># print</span>
            <span class="c1"># print len(thiscfglist.keys()), len(self.C3FOclass.cfglist.keys()), len(self.C2class.cfglist.keys())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">thiscfglist</span><span class="p">)</span></div>




<div class="viewcode-block" id="RatioFOCorr.SetCustomName"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.SetCustomName">[docs]</a>    <span class="k">def</span> <span class="nf">SetCustomName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">stringfn</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">stringLL</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">string</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Rat_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">string</span>
        <span class="k">if</span> <span class="n">stringfn</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;Rat_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">filename</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">stringfn</span>
        <span class="k">if</span> <span class="n">stringLL</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">thisops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Observ</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span> <span class="o">=</span> <span class="s1">&#39;$&#39;</span><span class="o">+</span><span class="s1">&#39;\ &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>   <span class="bp">self</span><span class="o">.</span><span class="n">dim_ll</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">GetPionMassLab</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">stream_name</span><span class="p">,</span><span class="n">thisops</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">Proj</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;$&#39;</span> <span class="c1">## customise this how you like</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span> <span class="o">=</span> <span class="n">stringLL</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_alpha</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+=</span> <span class="s1">&#39;_Rata&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39;_Rata&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39;\ $G^</span><span class="si">{Q}</span><span class="s1">_</span><span class="si">{2}</span><span class="s1">$&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SubDir</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">Proj</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ppform</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ratdir</span> <span class="o">=</span> <span class="n">outputdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">kappafolder</span><span class="o">+</span><span class="s1">&#39;/Rat/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Observ</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">SubDir</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
        <span class="n">mkdir_p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ratdir</span><span class="o">+</span><span class="s1">&#39;/Pickle/&#39;</span><span class="p">)</span>
        <span class="n">mkdir_p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ratdir</span><span class="o">+</span><span class="s1">&#39;/Excel/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ratdir</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.xml&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ratdir</span><span class="o">+</span><span class="s1">&#39;/Excel/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.xlsx&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ratdir</span><span class="o">+</span><span class="s1">&#39;/Pickle/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.py3p&#39;</span></div>



<div class="viewcode-block" id="RatioFOCorr.ImportCfgList"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.ImportCfgList">[docs]</a>    <span class="k">def</span> <span class="nf">ImportCfgList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cfglist</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span> <span class="o">=</span> <span class="n">cfglist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">cfglist</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span> <span class="o">!=</span> <span class="s1">&#39;Not Set&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">cfglist</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">cfglist</span><span class="p">)</span></div>

    <span class="c1"># def ImportCfgList(self,cfglist):</span>
    <span class="c1">#     for iC2 in self.C2classlist.itervalues():</span>
    <span class="c1">#         iC2.ImportCfgList(cfglist)</span>
    <span class="c1">#     if self.C2class != &#39;Not Set&#39;: self.C2class.ImportCfgList(cfglist)</span>
    <span class="c1">#     self.C3FOclass.ImportCfgList(cfglist)</span>


<div class="viewcode-block" id="RatioFOCorr.Stats"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.Stats">[docs]</a>    <span class="k">def</span> <span class="nf">Stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="p">,</span><span class="s1">&#39;Stats&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="p">,</span><span class="s1">&#39;Stats&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">lAvg</span><span class="p">,</span><span class="n">lStd</span> <span class="o">=</span> <span class="p">[],[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">itflow</span><span class="p">),</span><span class="n">iRat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">iRat</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
            <span class="n">lAvg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iRat</span><span class="o">.</span><span class="n">Avg</span><span class="p">)</span>
            <span class="n">lStd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iRat</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
        <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Col_Names</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lAvg</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lStd</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span></div>


<div class="viewcode-block" id="RatioFOCorr.RemoveVals"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.RemoveVals">[docs]</a>    <span class="k">def</span> <span class="nf">RemoveVals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># for iC2 in self.C2classlist.itervalues():</span>
        <span class="c1">#     iC2.RemoveVals()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">RemoveVals</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">RemoveVals</span><span class="p">()</span></div>

    <span class="c1">## self.Rat = [ igamma , ip, it , iconf ]</span>
    <span class="c1">## configs must be the same, so we check for them</span>
<div class="viewcode-block" id="RatioFOCorr.Read"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.Read">[docs]</a>    <span class="k">def</span> <span class="nf">Read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">WipeData</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">NoFit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">CheckMom</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="RatioFOCorr.CreateC2Sink"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.CreateC2Sink">[docs]</a>    <span class="k">def</span> <span class="nf">CreateC2Sink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">thisname</span><span class="p">,</span><span class="n">thisleglab</span><span class="p">,</span><span class="n">jsmlab</span> <span class="o">=</span> <span class="n">CreateNameAndLL</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="o">.</span><span class="n">SetC2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sinklab</span><span class="p">)</span>
            <span class="n">thisfun</span> <span class="o">=</span> <span class="n">GenSinkFun</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jsmcoeffs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Debug_Mode</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check file&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">thisname</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">thisleglab</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">jsmlab</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">thisfun</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="o">.</span><span class="n">CombineCorrs</span><span class="p">(</span><span class="n">thisfun</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">thisname</span><span class="p">,</span><span class="n">LegLab</span><span class="o">=</span><span class="n">thisleglab</span><span class="p">,</span><span class="n">jsmlab</span><span class="o">=</span><span class="n">jsmlab</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span> <span class="o">=</span> <span class="s1">&#39;Complete&#39;</span></div>

<div class="viewcode-block" id="RatioFOCorr.Bootstrap"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.Bootstrap">[docs]</a>    <span class="k">def</span> <span class="nf">Bootstrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">WipeData</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Read</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CreateC2Sink</span><span class="p">()</span>
        <span class="c1"># self.C2class.Bootstrap()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">Bootstrap</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span></div>


<div class="viewcode-block" id="RatioFOCorr.CalcRatio"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.CalcRatio">[docs]</a>    <span class="k">def</span> <span class="nf">CalcRatio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CalcSqrtFac</span><span class="p">()</span>
        <span class="c1">## if DS has a divide in it, we ignore the sqrt factor as they cancel</span>
        <span class="n">div_bool</span> <span class="o">=</span> <span class="s1">&#39;divide&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">DS</span>
        <span class="c1">## double the square root factor if we multiply two ds types</span>
        <span class="n">mult_bool</span> <span class="o">=</span> <span class="s1">&#39;multiply&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">DS</span>
        <span class="n">lRat</span><span class="p">,</span><span class="n">lRatAvg</span><span class="p">,</span><span class="n">lRatStd</span> <span class="o">=</span> <span class="p">[],[],[]</span>
        <span class="n">ilist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tsinkint</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">tsink</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;tsink&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">itflow</span><span class="p">),</span><span class="n">tC3FO</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJNQ_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ip2pt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">GetAvgmomform</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">pref</span><span class="o">=</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
            <span class="n">ict</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">untstr</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ict</span> <span class="o">&gt;</span> <span class="n">tsinkint</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_alpha</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ip2pt</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">itflow</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SqrtFact</span><span class="o">.</span><span class="n">index</span><span class="p">:</span> <span class="k">continue</span>
                <span class="k">if</span> <span class="n">div_bool</span><span class="p">:</span>
                    <span class="n">this_boot</span> <span class="o">=</span> <span class="n">tC3FO</span>
                <span class="k">elif</span> <span class="n">mult_bool</span><span class="p">:</span>
                    <span class="n">this_boot</span> <span class="o">=</span> <span class="n">tC3FO</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SqrtFact</span><span class="p">[</span><span class="n">ip2pt</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">itflow</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">this_boot</span> <span class="o">=</span> <span class="n">tC3FO</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">SqrtFact</span><span class="p">[</span><span class="n">ip2pt</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">itflow</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ip2pt</span><span class="p">,</span><span class="n">it</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SqrtFact</span><span class="o">.</span><span class="n">index</span><span class="p">:</span> <span class="k">continue</span>
                <span class="k">if</span> <span class="n">div_bool</span><span class="p">:</span>
                    <span class="n">this_boot</span> <span class="o">=</span> <span class="n">tC3FO</span>
                <span class="k">elif</span> <span class="n">mult_bool</span><span class="p">:</span>
                    <span class="n">this_boot</span> <span class="o">=</span> <span class="n">tC3FO</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SqrtFact</span><span class="p">[</span><span class="n">ip2pt</span><span class="p">,</span><span class="n">it</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">this_boot</span> <span class="o">=</span> <span class="n">tC3FO</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">SqrtFact</span><span class="p">[</span><span class="n">ip2pt</span><span class="p">,</span><span class="n">it</span><span class="p">]</span>
            <span class="c1"># warnings.warn(&#39;DEBUG, please check if tsink for 2-pt corr is correct via g4.&#39;)</span>
            <span class="c1"># print igamma, ip, it, self.C3class.tsink, tC3.Avg,self.SqrtFact[ip2pt,it].Avg</span>

            <span class="n">this_boot</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
            <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">it</span><span class="p">))</span>
            <span class="n">lRat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_boot</span><span class="p">)</span>
            <span class="n">lRatAvg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_boot</span><span class="o">.</span><span class="n">Avg</span><span class="p">)</span>
            <span class="n">lRatStd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_boot</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
            <span class="c1"># self.Ratboot[igamma][ip][it] = tC3/self.C2class[ip.replace(&#39;q&#39;,&#39;p&#39;),&#39;t&#39;+str(int(self.C3class.tsink.replace(&#39;tsink&#39;,&#39;&#39;))+1)]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Col_Names</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lRat</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lRatAvg</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lRatStd</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span></div>



<div class="viewcode-block" id="RatioFOCorr.CalcSqrtFac"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.CalcSqrtFac">[docs]</a>    <span class="k">def</span> <span class="nf">CalcSqrtFac</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">SqrtFact_hold</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ilist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ipp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">GetAvgmomform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ppform</span><span class="p">,</span><span class="n">pref</span><span class="o">=</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Debug_Mode</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Outputting sqrt factor debug info:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">iq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">qform</span><span class="p">:</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">GetAvgmomform</span><span class="p">(</span><span class="n">iq</span><span class="p">,</span><span class="n">pref</span><span class="o">=</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_alpha</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">itflow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tflow_list</span><span class="p">:</span>
                    <span class="n">sqrt_fac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CalcSqrtFacMom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">NNQ_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">][</span><span class="n">ipp</span><span class="p">,:,</span><span class="n">itflow</span><span class="p">],</span>
                                                            <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">NNQ_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">][</span><span class="n">ip</span><span class="p">,:,</span><span class="n">itflow</span><span class="p">],</span>
                                                            <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">tsink</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">it</span><span class="p">,</span><span class="n">tdata</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sqrt_fac</span><span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">tstr</span><span class="p">(</span><span class="n">it</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">itflow</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ilist</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">Debug_Mode</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">ierr</span> <span class="ow">in</span> <span class="n">tdata</span><span class="o">.</span><span class="n">GetNaNIndex</span><span class="p">():</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="n">iq</span><span class="p">,</span> <span class="n">itflow</span><span class="p">,</span> <span class="n">tstr</span><span class="p">(</span><span class="n">it</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39; iboot&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
                            <span class="n">tdata</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
                            <span class="n">SqrtFact_hold</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tdata</span><span class="p">)</span>
                            <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span><span class="n">tstr</span><span class="p">(</span><span class="n">it</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">itflow</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sqrt_fac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CalcSqrtFacMom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">C2_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">][</span><span class="n">ipp</span><span class="p">],</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">C2_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">][</span><span class="n">ip</span><span class="p">],</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">tsink</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">it</span><span class="p">,</span><span class="n">tdata</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sqrt_fac</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">tstr</span><span class="p">(</span><span class="n">it</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ilist</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">Debug_Mode</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">ierr</span> <span class="ow">in</span> <span class="n">tdata</span><span class="o">.</span><span class="n">GetNaNIndex</span><span class="p">():</span>
                                <span class="nb">print</span><span class="p">(</span><span class="n">iq</span><span class="p">,</span> <span class="n">tstr</span><span class="p">(</span><span class="n">it</span><span class="p">),</span> <span class="s1">&#39; iboot&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
                        <span class="n">tdata</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
                        <span class="n">SqrtFact_hold</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tdata</span><span class="p">)</span>
                        <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span><span class="n">tstr</span><span class="p">(</span><span class="n">it</span><span class="p">)))</span>
            <span class="c1"># if neg_sqrt: warnings.warn(&#39;negative square root in square root factor for &#39;+ipp+iq)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_alpha</span><span class="p">:</span>
            <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;momentum&#39;</span><span class="p">,</span><span class="s1">&#39;source_sink_separation&#39;</span><span class="p">,</span><span class="s1">&#39;flow_time&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;momentum&#39;</span><span class="p">,</span><span class="s1">&#39;source_sink_separation&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SqrtFact</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">SqrtFact_hold</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span></div>

<div class="viewcode-block" id="RatioFOCorr.CheckNegForSqrt"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.CheckNegForSqrt">[docs]</a>    <span class="k">def</span> <span class="nf">CheckNegForSqrt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thisboot</span><span class="p">,</span><span class="n">negsqrt</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ict</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">thisboot</span><span class="o">.</span><span class="n">bootvals</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">thisboot</span><span class="o">.</span><span class="n">bootvals</span><span class="p">[</span><span class="n">ict</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">negsqrt</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># if G2_abs:</span>
                <span class="c1">#     thisboot.bootvals[ict] = abs(thisboot.bootvals[ict])</span>
                <span class="c1"># else:</span>
                <span class="n">thisboot</span><span class="o">.</span><span class="n">bootvals</span><span class="p">[</span><span class="n">ict</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;NaN&#39;</span><span class="p">)</span>
                <span class="c1"># thisboot.bootvals[ict] = 0.0</span>
        <span class="k">return</span> <span class="n">thisboot</span><span class="p">,</span><span class="n">negsqrt</span></div>


    <span class="c1">## taking squareroot of each element before combinding makes the numbers not too small</span>
<div class="viewcode-block" id="RatioFOCorr.CalcSqrtFacMom"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.CalcSqrtFacMom">[docs]</a>    <span class="k">def</span> <span class="nf">CalcSqrtFacMom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data2ptpp</span><span class="p">,</span><span class="n">data2ptp</span><span class="p">,</span><span class="n">thistsink</span><span class="p">):</span>
        <span class="n">dictout</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">thistsink</span> <span class="o">=</span> <span class="n">thistsink</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;tsink&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
        <span class="n">thistsinkp1</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">thistsink</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">+</span><span class="n">twopttshift</span><span class="p">)</span>
        <span class="n">inttsink</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">thistsink</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="c1"># data2ptpp[thistsinkp1],NegSQRTRatFac = self.CheckNegForSqrt(data2ptpp[thistsinkp1],NegSQRTRatFac)</span>
        <span class="c1"># data2ptp[thistsinkp1],NegSQRTRatFac = self.CheckNegForSqrt(data2ptp[thistsinkp1],NegSQRTRatFac)</span>
        <span class="n">data2ptpp</span> <span class="o">=</span> <span class="n">data2ptpp</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">Sqrt</span><span class="p">())</span>
        <span class="n">data2ptp</span> <span class="o">=</span> <span class="n">data2ptp</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">Sqrt</span><span class="p">())</span>
        <span class="c1"># NegSQRTRatFac = any(data2ptpp.isnull().values) or any(data2ptp.isnull().values)</span>
        <span class="c1"># if Debug_Mode:</span>
        <span class="c1">#     print</span>
        <span class="c1">#     print &#39;p&#39;</span>
        <span class="c1">#     for ip in data2ptp:</span>
        <span class="c1">#         print &#39;     &#39;,ip.Avg,ip.Std</span>
        <span class="c1">#     print &#39;pp&#39;</span>
        <span class="c1">#     for ipp in data2ptpp:</span>
        <span class="c1">#         print &#39;     &#39;,ip.Avg,ip.Std</span>
        <span class="c1">#     print</span>

        <span class="n">two</span> <span class="o">=</span> <span class="n">data2ptpp</span><span class="p">[</span><span class="n">thistsinkp1</span><span class="p">]</span><span class="o">*</span><span class="n">data2ptp</span><span class="p">[</span><span class="n">thistsinkp1</span><span class="p">]</span>
        <span class="c1"># two = two.Sqrt()</span>
        <span class="c1"># two = (data2ptpp[thistsinkp1]**0.5)*(data2ptp[thistsinkp1]**0.5)</span>
        <span class="c1"># two = two**(0.5)</span>
        <span class="n">thisshift</span> <span class="o">=</span> <span class="n">twopttshift</span>
        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">thisshift</span><span class="p">,</span><span class="n">inttsink</span><span class="o">+</span><span class="n">thisshift</span><span class="p">):</span>
            <span class="n">thiststr</span> <span class="o">=</span> <span class="n">tstr</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
            <span class="n">tflip</span> <span class="o">=</span> <span class="n">tstr</span><span class="p">(</span><span class="n">inttsink</span><span class="o">-</span><span class="n">it</span><span class="o">+</span><span class="n">twopttshift</span><span class="o">+</span><span class="n">thisshift</span><span class="p">)</span>
            <span class="c1"># data2ptpp[thiststr],NegSQRTRatFac = self.CheckNegForSqrt(data2ptpp[thiststr],NegSQRTRatFac)</span>
            <span class="c1"># data2ptp[thiststr],NegSQRTRatFac = self.CheckNegForSqrt(data2ptp[thiststr],NegSQRTRatFac)</span>
            <span class="c1"># data2ptpp[tflip],NegSQRTRatFac = self.CheckNegForSqrt(data2ptpp[tflip],NegSQRTRatFac)</span>
            <span class="c1"># data2ptp[tflip],NegSQRTRatFac = self.CheckNegForSqrt(data2ptp[tflip],NegSQRTRatFac)</span>
            <span class="c1"># one = (data2ptpp[thiststr]**0.5)/(data2ptp[thiststr]**0.5)</span>
            <span class="c1"># three = (data2ptp[tflip]**0.5)/(data2ptpp[tflip]**0.5)</span>
            <span class="n">one</span> <span class="o">=</span> <span class="n">data2ptpp</span><span class="p">[</span><span class="n">thiststr</span><span class="p">]</span><span class="o">/</span><span class="n">data2ptp</span><span class="p">[</span><span class="n">thiststr</span><span class="p">]</span>
            <span class="n">three</span> <span class="o">=</span> <span class="n">data2ptp</span><span class="p">[</span><span class="n">tflip</span><span class="p">]</span><span class="o">/</span><span class="n">data2ptpp</span><span class="p">[</span><span class="n">tflip</span><span class="p">]</span>
            <span class="n">inter</span> <span class="o">=</span> <span class="n">one</span><span class="o">*</span><span class="n">three</span>
            <span class="n">ott</span> <span class="o">=</span> <span class="n">inter</span><span class="o">/</span><span class="n">two</span>
            <span class="c1"># ott.Sqrt()</span>
            <span class="n">ott</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
            <span class="c1"># ott,NegSQRTRatFac = self.CheckNegForSqrt(ott,NegSQRTRatFac)</span>
            <span class="c1"># ott.Stats()</span>
            <span class="n">dictout</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ott</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dictout</span></div>

    <span class="c1"># def DoAlphaCombine(self,this_fun=op.truediv):</span>
    <span class="c1">#     if not hasattr(self,&#39;alpha_class&#39;):</span>
    <span class="c1">#         from SetsOfTwoPtCorrs import SetOfNNQ</span>
    <span class="c1">#         Info2pt = deepcopy(self.Info)</span>
    <span class="c1">#         Info2pt[&#39;pmom&#39;] = [&#39;0 0 0&#39;]</span>
    <span class="c1">#         Info2pt[&#39;Interp&#39;] = &#39;CPOdd&#39;</span>
    <span class="c1">#         sinklab,jsmcoeffs,sm2ptList,InfoList = GetInfoList(Info2pt)</span>
    <span class="c1">#         FOSet = SetOfNNQ(cfglist=self.cfglist,InfoDict=InfoList)</span>
    <span class="c1">#</span>
    <span class="c1">#         FOSet.LoadPickle(CheckCfgs=True)</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1">#         thisname,thisleglab,jsmlab = CreateNameAndLL(FOSet.SetC2,sinklab)</span>
    <span class="c1">#         thisfun = GenSinkFun(jsmcoeffs)</span>
    <span class="c1">#         # print thisname,thisleglab</span>
    <span class="c1">#         # print jsmcoeffs</span>
    <span class="c1">#         # print sinklab</span>
    <span class="c1">#         # print thisfun.__name__</span>
    <span class="c1">#         # print FOSet.SetC2.keys()</span>
    <span class="c1">#         # print FOSet.SetC2[FOSet.SetC2.keys()[0]].NNQ_Stats[&#39;boot&#39;]</span>
    <span class="c1">#         # for ikey,ival in FOSet.SetC2.iteritems():</span>
    <span class="c1">#         #     print ikey</span>
    <span class="c1">#         #     print ival.NNQ_Stats</span>
    <span class="c1">#         #     print</span>
    <span class="c1">#         self.alpha_class = FOSet.CombineCorrs(thisfun,filename=thisname,</span>
    <span class="c1">#                                         LegLab=thisleglab,jsmlab =jsmlab)</span>
    <span class="c1">#         del FOSet</span>
    <span class="c1">#     self.CombineWithAlpha(self.alpha_class,this_fun=this_fun)</span>
    <span class="c1">#</span>
    <span class="c1"># def CombineWithAlpha(self,alpha_in,this_fun):</span>
    <span class="c1">#     tsink_str = self.C3FOclass.NJN.tsink.replace(&#39;tsink&#39;,&#39;t&#39;)</span>
    <span class="c1">#     if isinstance(this_fun,basestring):</span>
    <span class="c1">#         this_fun = op_dict[this_fun.replace(&#39;alpha_rat_&#39;,&#39;&#39;).replace(&#39;_corr&#39;,&#39;&#39;)]</span>
    <span class="c1">#     if not isinstance(alpha_in,NNQCorr):</span>
    <span class="c1">#         print type(alpha_in)</span>
    <span class="c1">#         print alpha_in</span>
    <span class="c1">#         raise AttributeError(&#39;Please pass in NNQCorr class instance&#39;)</span>
    <span class="c1">#     if &#39;boot&#39; not in self.Rat_Stats:</span>
    <span class="c1">#         raise AttributeError(&#39;please compute Rat_Stats before combining with alpha&#39;)</span>
    <span class="c1">#     if &#39;Alphaboot&#39; not in alpha_in.NNQ_Stats :</span>
    <span class="c1">#         raise AttributeError(&#39;please compute NNQ_Stats in alpha before combining with alpha&#39;)</span>
    <span class="c1">#     if (&#39;p000&#39;,tsink_str) not in alpha_in.NNQ_Stats[&#39;Alphaboot&#39;]:</span>
    <span class="c1">#         print alpha_in.NNQ_Stats[&#39;Alphaboot&#39;]</span>
    <span class="c1">#         raise AttributeError(&#39;alpha ratio needs p000,&#39;+tsink_str+&#39; result&#39;)</span>
    <span class="c1">#     alpha_p0 = alpha_in.NNQ_Stats.loc[(&#39;p000&#39;,tsink_str,slice(None)),&#39;Alphaboot&#39;]</span>
    <span class="c1">#     vall,ilist,corrl = [],[],[]</span>
    <span class="c1">#     for (igamma,ip,itflow,it),irat in self.Rat_Stats[&#39;boot&#39;].iteritems():</span>
    <span class="c1">#         if itflow not in alpha_p0.index.swaplevel(0,2):</span>
    <span class="c1">#             out_str = &#39;missmatch in flow times when CombineWithAlpha called \n&#39;</span>
    <span class="c1">#             out_str += itflow</span>
    <span class="c1">#             raise EnvironmentError(out_str)</span>
    <span class="c1">#         ilist.append((igamma,ip,itflow,it))</span>
    <span class="c1">#         output = this_fun(irat,alpha_p0[(&#39;p000&#39;,tsink_str,itflow)])</span>
    <span class="c1">#         output.Stats()</span>
    <span class="c1">#         vall.append(output)</span>
    <span class="c1">#         corrl.append(irat.corr(alpha_p0[(&#39;p000&#39;,tsink_str,itflow)]))</span>
    <span class="c1">#     if len(ilist) &gt; 0:</span>
    <span class="c1">#         indicies = pa.MultiIndex.from_tuples(ilist,names=self.Rat_Col_Names)</span>
    <span class="c1">#         self.Rat_Stats.loc[:,&#39;alpha_rat_&#39;+this_fun.__name__] = pa.Series(vall,index=indicies)</span>
    <span class="c1">#         self.Rat_Stats.loc[:,&#39;alpha_rat_&#39;+this_fun.__name__+&#39;_corr&#39;] = pa.Series(corrl,index=indicies)</span>
    <span class="c1">#         self.Write()</span>

<div class="viewcode-block" id="RatioFOCorr.ImportFitRanges"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.ImportFitRanges">[docs]</a>    <span class="k">def</span> <span class="nf">ImportFitRanges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fit_range</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;PreDef&#39;</span> <span class="o">==</span> <span class="n">fit_range</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PredefFits</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span> <span class="o">=</span> <span class="n">fit_range</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="c1"># print &#39;fit_range in setoffits implementation is a single value varied inwards, selecting first&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span> <span class="o">=</span> <span class="n">rm_tsumfitr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span><span class="p">)</span></div>

<div class="viewcode-block" id="RatioFOCorr.DoAlphaCombine"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.DoAlphaCombine">[docs]</a>    <span class="k">def</span> <span class="nf">DoAlphaCombine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">this_fun</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="n">truediv</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;alpha_class&#39;</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">SetsOfTwoPtCorrs</span> <span class="k">import</span> <span class="n">SetOfNNQ</span>
            <span class="n">Info2pt</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">)</span>
            <span class="n">Info2pt</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0 0 0&#39;</span><span class="p">]</span>
            <span class="n">Info2pt</span><span class="p">[</span><span class="s1">&#39;Interp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;CPOdd&#39;</span>
            <span class="n">sinklab</span><span class="p">,</span><span class="n">jsmcoeffs</span><span class="p">,</span><span class="n">sm2ptList</span><span class="p">,</span><span class="n">InfoList</span> <span class="o">=</span> <span class="n">GetInfoList</span><span class="p">(</span><span class="n">Info2pt</span><span class="p">)</span>
            <span class="n">FOSet</span> <span class="o">=</span> <span class="n">SetOfNNQ</span><span class="p">(</span><span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span><span class="p">,</span><span class="n">InfoDict</span><span class="o">=</span><span class="n">InfoList</span><span class="p">)</span>

            <span class="n">FOSet</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


            <span class="n">thisname</span><span class="p">,</span><span class="n">thisleglab</span><span class="p">,</span><span class="n">jsmlab</span> <span class="o">=</span> <span class="n">CreateNameAndLL</span><span class="p">(</span><span class="n">FOSet</span><span class="o">.</span><span class="n">SetC2</span><span class="p">,</span><span class="n">sinklab</span><span class="p">)</span>
            <span class="n">thisfun</span> <span class="o">=</span> <span class="n">GenSinkFun</span><span class="p">(</span><span class="n">jsmcoeffs</span><span class="p">)</span>
            <span class="c1"># print thisname,thisleglab</span>
            <span class="c1"># print jsmcoeffs</span>
            <span class="c1"># print sinklab</span>
            <span class="c1"># print thisfun.__name__</span>
            <span class="c1"># print FOSet.SetC2.keys()</span>
            <span class="c1"># print FOSet.SetC2[FOSet.SetC2.keys()[0]].NNQ_Stats[&#39;boot&#39;]</span>
            <span class="c1"># for ikey,ival in FOSet.SetC2.iteritems():</span>
            <span class="c1">#     print ikey</span>
            <span class="c1">#     print ival.NNQ_Stats</span>
            <span class="c1">#     print</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha_class</span> <span class="o">=</span> <span class="n">FOSet</span><span class="o">.</span><span class="n">CombineCorrs</span><span class="p">(</span><span class="n">thisfun</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">thisname</span><span class="p">,</span>
                                            <span class="n">LegLab</span><span class="o">=</span><span class="n">thisleglab</span><span class="p">,</span><span class="n">jsmlab</span> <span class="o">=</span><span class="n">jsmlab</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">FOSet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CombineWithAlpha</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha_class</span><span class="p">,</span><span class="n">this_fun</span><span class="o">=</span><span class="n">this_fun</span><span class="p">)</span></div>

<div class="viewcode-block" id="RatioFOCorr.CombineWithAlpha"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.CombineWithAlpha">[docs]</a>    <span class="k">def</span> <span class="nf">CombineWithAlpha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">alpha_in</span><span class="p">,</span><span class="n">this_fun</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="n">truediv</span><span class="p">):</span>
        <span class="n">tsink_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">tsink</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;tsink&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">this_fun</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">this_fun</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span> <span class="k">return</span>
            <span class="n">this_fun</span> <span class="o">=</span> <span class="n">op_dict</span><span class="p">[</span><span class="n">this_fun</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;alpha_rat_&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_corr&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alpha_in</span><span class="p">,</span><span class="n">NNQCorr</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">alpha_in</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">alpha_in</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Please pass in NNQCorr class instance&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;please compute Rat_Stats before combining with alpha&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;Alphaboot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">alpha_in</span><span class="o">.</span><span class="n">NNQ_Stats</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;please compute NNQ_Stats in alpha before combining with alpha&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;p000&#39;</span><span class="p">,</span><span class="n">tsink_str</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">alpha_in</span><span class="o">.</span><span class="n">NNQ_Stats</span><span class="p">[</span><span class="s1">&#39;Alphaboot&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">alpha_in</span><span class="o">.</span><span class="n">NNQ_Stats</span><span class="p">[</span><span class="s1">&#39;Alphaboot&#39;</span><span class="p">])</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;alpha ratio needs p000,&#39;</span><span class="o">+</span><span class="n">tsink_str</span><span class="o">+</span><span class="s1">&#39; result&#39;</span><span class="p">)</span>
        <span class="n">alpha_p0</span> <span class="o">=</span> <span class="n">alpha_in</span><span class="o">.</span><span class="n">NNQ_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s1">&#39;p000&#39;</span><span class="p">,</span><span class="n">tsink_str</span><span class="p">,</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)),</span><span class="s1">&#39;Alphaboot&#39;</span><span class="p">]</span>
        <span class="n">vall</span><span class="p">,</span><span class="n">ilist</span><span class="p">,</span><span class="n">corrl</span> <span class="o">=</span> <span class="p">[],[],[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">it</span><span class="p">),</span><span class="n">irat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">itflow</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">alpha_p0</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">out_str</span> <span class="o">=</span> <span class="s1">&#39;missmatch in flow times when CombineWithAlpha called </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">out_str</span> <span class="o">+=</span> <span class="n">itflow</span>
                <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="n">out_str</span><span class="p">)</span>
            <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">it</span><span class="p">))</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">this_fun</span><span class="p">(</span><span class="n">irat</span><span class="p">,</span><span class="n">alpha_p0</span><span class="p">[(</span><span class="s1">&#39;p000&#39;</span><span class="p">,</span><span class="n">tsink_str</span><span class="p">,</span><span class="n">itflow</span><span class="p">)])</span>
            <span class="n">output</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
            <span class="n">vall</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
            <span class="n">corrl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">irat</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">alpha_p0</span><span class="p">[(</span><span class="s1">&#39;p000&#39;</span><span class="p">,</span><span class="n">tsink_str</span><span class="p">,</span><span class="n">itflow</span><span class="p">)]))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Col_Names</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;alpha_rat_&#39;</span><span class="o">+</span><span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">vall</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;alpha_rat_&#39;</span><span class="o">+</span><span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;_corr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">corrl</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span></div>

<div class="viewcode-block" id="RatioFOCorr.Fit"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.Fit">[docs]</a>    <span class="k">def</span> <span class="nf">Fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fit_range</span><span class="o">=</span><span class="s1">&#39;PreDef&#39;</span><span class="p">,</span><span class="n">iGuess</span><span class="o">=</span><span class="s1">&#39;PreDef&#39;</span><span class="p">,</span><span class="n">EstDir</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tflowfit</span><span class="o">=</span><span class="p">[],</span><span class="n">WipeFit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">show_timer</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">min_fitr</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImportFitRanges</span><span class="p">(</span><span class="n">fit_range</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">iGuess</span> <span class="o">!=</span> <span class="s1">&#39;PreDef&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span> <span class="o">=</span> <span class="n">iGuess</span>
        <span class="n">lFit</span><span class="p">,</span><span class="n">ilist</span> <span class="o">=</span> <span class="p">[],[]</span>
        <span class="c1"># print &#39;DEBUG&#39;</span>
        <span class="c1"># print self.Rat_Stats[&#39;boot&#39;]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">),</span><span class="n">pdata</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;current_operator&#39;</span><span class="p">,</span><span class="s1">&#39;momentum&#39;</span><span class="p">,</span><span class="s1">&#39;flow_times&#39;</span><span class="p">)):</span>
            <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">WipeFit</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">drop</span><span class="p">([(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">)],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>

            <span class="c1"># ##debugging</span>
            <span class="c1"># print</span>
            <span class="c1"># print &#39;FitData:&#39;</span>
            <span class="c1"># for it,iy in zip(tdatarange[0],ydata):</span>
            <span class="c1">#     print it, iy</span>
            <span class="c1"># print</span>
            <span class="c1"># print &#39;DEBUG2&#39;</span>
            <span class="c1"># print ydata</span>
            <span class="c1"># print np.array(ydata)</span>
            <span class="c1"># print [np.array(tdatarange),np.array(ydata)]</span>
            <span class="n">fit_info</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">EstDir</span><span class="p">:</span>
                <span class="n">fit_info</span><span class="p">[</span><span class="s1">&#39;Funs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Fun</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">npar</span><span class="p">,</span><span class="s1">&#39;Estimate&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fit_info</span><span class="p">[</span><span class="s1">&#39;Funs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Fun</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">npar</span><span class="p">)</span>
            <span class="n">fit_info</span><span class="p">[</span><span class="s1">&#39;iGuess&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span>
            <span class="n">fit_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">this_key</span><span class="p">)</span>
            <span class="n">thisff</span> <span class="o">=</span> <span class="n">sff</span><span class="o">.</span><span class="n">SetOfFitFuns</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="n">this_key</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="n">fit_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="n">thisff</span><span class="o">.</span><span class="n">ScanRange_fitr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span><span class="p">,</span><span class="n">fit_info</span><span class="o">=</span><span class="n">fit_info</span><span class="p">,</span><span class="n">min_fit_len</span><span class="o">=</span><span class="n">min_fitr</span><span class="p">)</span>
            <span class="n">lFit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisff</span><span class="p">)</span>
            <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_key</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Col_Names</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">this_df</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                <span class="n">this_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lFit</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_df</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lFit</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">DoFits</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                <span class="n">val</span><span class="o">.</span><span class="n">DoFits</span><span class="p">(</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">val</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">DoFits</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span></div>


<div class="viewcode-block" id="RatioFOCorr.Write"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.Write">[docs]</a>    <span class="k">def</span> <span class="nf">Write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">FixDictArray</span><span class="p">(</span><span class="n">thislist</span><span class="p">,</span><span class="n">ikey</span><span class="p">):</span>
            <span class="n">outDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">ic</span><span class="p">,</span><span class="n">ilist</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">thislist</span><span class="p">):</span>
                <span class="n">outDict</span><span class="p">[</span><span class="n">ikey</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ic</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ilist</span>
            <span class="k">return</span> <span class="n">outDict</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;show_cfgs&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_cfgs</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># C2name = self.C2class.name.replace(self.C2class.jsm,self.C3FOclass.NJN.jsm)</span>
        <span class="c1"># C2LL = self.C2class.LegLab.replace(self.C2class.jsm,self.C3FOclass.NJN.jsm)</span>
        <span class="c1"># self.C2class.SetCustomName(C2name,C2LL)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="p">,</span><span class="s1">&#39;Write&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>

        <span class="n">outDict</span> <span class="o">=</span> <span class="n">ODNested</span><span class="p">()</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="p">,</span><span class="s1">&#39;Write&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;C2file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">HumanFile</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;C3FOfile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">HumanFile</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;kud&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">kud</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ks</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;nt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nt</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;nxyz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nxyz</span>
        <span class="k">for</span> <span class="n">istream</span><span class="p">,</span><span class="n">incfg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">stream_list</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ncfg_list</span><span class="p">):</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ncfg_&#39;</span><span class="o">+</span><span class="n">istream</span><span class="p">]</span> <span class="o">=</span> <span class="n">incfg</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;nxsrc_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">xsrcAvg</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;nMeas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">nMeas</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;nboot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nboot</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;tsrc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">tsrc</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;tsink&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">tsink</span>
        <span class="c1"># outDict[&#39;xsrc&#39;] = FixDictArray(self.xsrc,&#39;xsrc&#39;)</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ism&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ism</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;sink_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">jsm</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;Projector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">Proj</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;Doub_Sing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">DS</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ppmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ppmom</span>

        <span class="k">for</span> <span class="n">ict</span><span class="p">,</span><span class="n">itflow</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">tflowlist</span><span class="p">):</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;t_flow&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ict</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">itflow</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">icg</span><span class="p">,</span><span class="n">igamma</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">gammalist</span><span class="p">):</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icg</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">igamma</span>
        <span class="k">for</span> <span class="n">icq</span><span class="p">,</span><span class="n">iqmom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">qmom</span><span class="p">):</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;qmom&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icq</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">iqmom</span>

        <span class="n">excel_params</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">outDict</span><span class="p">))</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;tflow_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FixDictArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tflow_list</span><span class="p">,</span><span class="s1">&#39;tflow&#39;</span><span class="p">)</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;gamma_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FixDictArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">gammalist</span><span class="p">,</span><span class="s1">&#39;gamma&#39;</span><span class="p">)</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;qmom_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FixDictArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">qmom</span><span class="p">,</span><span class="s1">&#39;qmom&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ict</span><span class="p">,</span><span class="n">itflow</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">tflowlist</span><span class="p">):</span>
            <span class="k">del</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;t_flow&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ict</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">icg</span><span class="p">,</span><span class="n">igamma</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">gammalist</span><span class="p">):</span>
            <span class="k">del</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icg</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">icq</span><span class="p">,</span><span class="n">iqmom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">qmom</span><span class="p">):</span>
            <span class="k">del</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;qmom&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icq</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>


        <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">),</span><span class="n">fitdata</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;Fits&#39;</span><span class="p">][</span><span class="n">igamma</span><span class="p">][</span><span class="n">ip</span><span class="p">][</span><span class="n">itflow</span><span class="p">]</span> <span class="o">=</span> <span class="n">fitdata</span><span class="o">.</span><span class="n">GetOutputDict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">col_key</span><span class="p">,</span><span class="n">col_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;Avg&#39;</span> <span class="ow">in</span> <span class="n">col_key</span> <span class="ow">or</span> <span class="s1">&#39;Std&#39;</span> <span class="ow">in</span> <span class="n">col_key</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">itflow</span><span class="p">),</span><span class="n">idata</span> <span class="ow">in</span> <span class="n">col_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">idata</span><span class="p">,</span><span class="s1">&#39;Avg&#39;</span><span class="p">):</span>
                    <span class="n">outDict</span><span class="p">[</span><span class="n">col_key</span><span class="p">][</span><span class="n">igamma</span><span class="p">][</span><span class="n">ip</span><span class="p">][</span><span class="n">it</span><span class="p">][</span><span class="n">itflow</span><span class="p">]</span> <span class="o">=</span> <span class="n">AvgStdToFormat</span><span class="p">(</span><span class="n">idata</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span><span class="n">idata</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">outDict</span><span class="p">[</span><span class="n">col_key</span><span class="p">][</span><span class="n">igamma</span><span class="p">][</span><span class="n">ip</span><span class="p">][</span><span class="n">it</span><span class="p">][</span><span class="n">itflow</span><span class="p">]</span> <span class="o">=</span> <span class="n">AvgFormat</span><span class="p">(</span><span class="n">idata</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_alpha</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">itflow</span><span class="p">),</span><span class="n">idata</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SqrtFact</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">idata</span><span class="o">.</span><span class="n">Avg</span><span class="p">):</span> <span class="n">idata</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;SqrtFact_G2Q&#39;</span><span class="p">][</span><span class="n">itflow</span><span class="p">][</span><span class="n">ip</span><span class="p">][</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">AvgStdToFormat</span><span class="p">(</span><span class="n">idata</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span><span class="n">idata</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">itflow</span><span class="p">),</span><span class="n">idata</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">NNQ_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">idata</span><span class="o">.</span><span class="n">Avg</span><span class="p">):</span> <span class="n">idata</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;G2Q&#39;</span><span class="p">][</span><span class="n">itflow</span><span class="p">][</span><span class="n">ip</span><span class="p">][</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">AvgStdToFormat</span><span class="p">(</span><span class="n">idata</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span><span class="n">idata</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;SqrtFact&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SqrtFact</span><span class="p">,</span><span class="s1">&#39;iteritems&#39;</span><span class="p">):</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">),</span><span class="n">idata</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SqrtFact</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">idata</span><span class="o">.</span><span class="n">Avg</span><span class="p">):</span> <span class="n">idata</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
                    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;SqrtFact&#39;</span><span class="p">][</span><span class="n">ip</span><span class="p">][</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">AvgStdToFormat</span><span class="p">(</span><span class="n">idata</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span><span class="n">idata</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">),</span><span class="n">idata</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">C2_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">idata</span><span class="o">.</span><span class="n">Avg</span><span class="p">):</span> <span class="n">idata</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
                    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;G2&#39;</span><span class="p">][</span><span class="n">ip</span><span class="p">][</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">AvgStdToFormat</span><span class="p">(</span><span class="n">idata</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span><span class="n">idata</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>


        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ncfg_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cfgs</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">((</span><span class="n">istream</span><span class="p">,</span><span class="n">iccfg</span><span class="p">),</span><span class="n">icfg</span><span class="p">),</span><span class="n">ixsrc_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJNQ_cfgs</span><span class="p">[</span><span class="s1">&#39;configs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJNQ_cfgs</span><span class="p">[</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;cfglist&#39;</span><span class="p">][</span><span class="n">istream</span><span class="p">][</span><span class="n">icfg</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;n_xsrc_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ixsrc_list</span><span class="p">))</span>


        <span class="c1">## Write human readable file with data</span>
        <span class="n">WriteXml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span><span class="p">,{</span><span class="s1">&#39;Results&#39;</span><span class="p">:</span><span class="n">outDict</span><span class="p">})</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ncfg_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">for</span> <span class="p">((</span><span class="n">istream</span><span class="p">,</span><span class="n">iccfg</span><span class="p">),</span><span class="n">icfg</span><span class="p">),</span><span class="n">ixsrc_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJNQ_cfgs</span><span class="p">[</span><span class="s1">&#39;configs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJNQ_cfgs</span><span class="p">[</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;cfglist&#39;</span><span class="p">][</span><span class="n">istream</span><span class="p">][</span><span class="n">icfg</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;n_xsrc_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ixsrc_list</span><span class="p">))</span>
        <span class="c1">## TODO, include fitting in the excell file</span>
        <span class="n">WriteExcel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">,{</span><span class="s1">&#39;Rat_results&#39;</span><span class="p">:</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">)},</span><span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJNQ_cfgs</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">excel_params</span><span class="p">)</span>

        <span class="c1">## pickles rest of data for reading</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RemoveFuns</span><span class="p">()</span>
        <span class="n">WritePickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GetFuns</span><span class="p">()</span></div>

<div class="viewcode-block" id="RatioFOCorr.GetFuns"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.GetFuns">[docs]</a>    <span class="k">def</span> <span class="nf">GetFuns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
                <span class="n">ival</span><span class="o">.</span><span class="n">GetFuns</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="p">,</span><span class="s1">&#39;GetFuns&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">GetFuns</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="p">,</span><span class="s1">&#39;GetFuns&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="o">.</span><span class="n">GetFuns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">GetFuns</span><span class="p">()</span></div>

<div class="viewcode-block" id="RatioFOCorr.RemoveFuns"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.RemoveFuns">[docs]</a>    <span class="k">def</span> <span class="nf">RemoveFuns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
                <span class="n">ival</span><span class="o">.</span><span class="n">RemoveFuns</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="p">,</span><span class="s1">&#39;GetFuns&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">RemoveFuns</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="p">,</span><span class="s1">&#39;GetFuns&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="o">.</span><span class="n">RemoveFuns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">RemoveFuns</span><span class="p">()</span></div>

    <span class="c1">##################################</span>


<div class="viewcode-block" id="RatioFOCorr.ReadAndWrite"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.ReadAndWrite">[docs]</a>    <span class="k">def</span> <span class="nf">ReadAndWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">WipeData</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Read</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CreateC2Sink</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bootstrap</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="n">CheckCfgs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CalcRatio</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;alpha_rat&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_rat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This has been hard coded to be false, remove these statements to bring it back&#39;</span><span class="p">)</span>
            <span class="c1"># self.DoAlphaCombine(self.alpha_rat)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span></div>

<div class="viewcode-block" id="RatioFOCorr.FixRead"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.FixRead">[docs]</a>    <span class="k">def</span> <span class="nf">FixRead</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">readdict</span><span class="p">):</span>
        <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;alpha_rat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_rat</span>
        <span class="n">rewrite</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;C2class&#39;</span><span class="p">],</span><span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;C2Set&#39;</span><span class="p">],</span><span class="nb">str</span><span class="p">):</span>
                <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;C2Set&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Complete&#39;</span>
                <span class="n">rewrite</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">readdict</span><span class="p">,</span><span class="n">rewrite</span></div>

<div class="viewcode-block" id="RatioFOCorr.LoadPickle"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.LoadPickle">[docs]</a>    <span class="k">def</span> <span class="nf">LoadPickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">WipeData</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">CheckMom</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># print</span>
        <span class="c1"># print &#39;NJNQ&#39;</span>
        <span class="c1"># print self.HumanFile</span>
        <span class="c1"># print self.PickleFile</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">DefWipe</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading Pickle file &#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span>
            <span class="n">loadeddict</span> <span class="o">=</span> <span class="n">ReadPickleWrap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span>
            <span class="n">loadeddict</span><span class="p">,</span><span class="n">rewrite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FixRead</span><span class="p">(</span><span class="n">loadeddict</span><span class="p">)</span>
            <span class="n">checklist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thischecklist</span>
            <span class="k">if</span> <span class="n">CheckCfgs</span><span class="p">:</span> <span class="n">checklist</span> <span class="o">=</span> <span class="n">checklist</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;cfglist&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">CheckMom</span><span class="p">:</span> <span class="n">checklist</span> <span class="o">=</span> <span class="n">checklist</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;checkmomlist&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">CheckClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span><span class="n">loadeddict</span><span class="p">,</span><span class="n">checklist</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">loadeddict</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rewrite</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">Wipe_All_Fits</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">sff</span><span class="o">.</span><span class="n">SetOfFitFuns</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Legacy file, fits need to be recomputed&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;using backupfile for &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">,</span><span class="s1">&#39;.bak.xlsx&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="n">CheckCfgs</span><span class="p">,</span><span class="n">CheckMom</span><span class="o">=</span><span class="n">CheckMom</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning, file &#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span> <span class="p">,</span> <span class="s1">&#39; has different parameters than this instance, reading and writing over file now&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ReadAndWrite</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span>
            <span class="c1"># self.Write()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;pickle file not found: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ReadAndWrite</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span></div>

    <span class="c1">## Routines for Plotting ###############################################</span>

<div class="viewcode-block" id="RatioFOCorr.ImportPlotParams"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.ImportPlotParams">[docs]</a>    <span class="k">def</span> <span class="nf">ImportPlotParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thiscol</span><span class="p">,</span><span class="n">thissym</span><span class="p">,</span><span class="n">thisshift</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckCol</span><span class="p">(</span><span class="n">thiscol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckSym</span><span class="p">(</span><span class="n">thissym</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span> <span class="o">=</span> <span class="n">thisshift</span></div>

<div class="viewcode-block" id="RatioFOCorr.CheckCol"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.CheckCol">[docs]</a>    <span class="k">def</span> <span class="nf">CheckCol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thiscol</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;PreDefine&#39;</span> <span class="o">==</span> <span class="n">thiscol</span> <span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;Not Set&#39;</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Pass in color to initialize it&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span> <span class="o">=</span> <span class="n">thiscol</span></div>

<div class="viewcode-block" id="RatioFOCorr.CheckSym"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.CheckSym">[docs]</a>    <span class="k">def</span> <span class="nf">CheckSym</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thissym</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;PreDefine&#39;</span> <span class="o">==</span> <span class="n">thissym</span> <span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;Not Set&#39;</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">thissym</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Pass in symbol to initialize it&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thissym</span> <span class="o">=</span> <span class="n">thissym</span></div>


<div class="viewcode-block" id="RatioFOCorr.GetShift"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.GetShift">[docs]</a>    <span class="k">def</span> <span class="nf">GetShift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">xlims</span><span class="p">,</span><span class="n">thisshift</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">thisshift</span> <span class="o">!=</span> <span class="s1">&#39;PreDefine&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span> <span class="o">=</span> <span class="n">thisshift</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisshiftscale</span> <span class="o">==</span> <span class="s1">&#39;Not Set&#39;</span><span class="p">:</span>
            <span class="n">xlen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xlims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xlims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thisshiftscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span><span class="o">*</span><span class="n">xlen</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisshiftscale</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisshiftscale</span></div>


<div class="viewcode-block" id="RatioFOCorr.Importtflow"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.Importtflow">[docs]</a>    <span class="k">def</span> <span class="nf">Importtflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tflowlist</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tflowlist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tflowfit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">tflowfit</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tflowfit</span> <span class="o">=</span> <span class="n">tflowlist</span></div>



    <span class="c1">## make sure all xlims are the same, because this sets the window of xlim (needed for calculating shifts)</span>
    <span class="c1">## gammamomlist is a dictionary where the keys are the gamma matricies, and the values are lists of momenta</span>
<div class="viewcode-block" id="RatioFOCorr.Plot"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.Plot">[docs]</a>    <span class="k">def</span> <span class="nf">Plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">plot_class</span><span class="p">,</span><span class="n">xlims</span><span class="o">=</span><span class="s1">&#39;tsink&#39;</span><span class="p">,</span><span class="n">gammamomlist</span><span class="o">=</span><span class="p">{},</span><span class="n">tflowlist</span> <span class="o">=</span> <span class="p">[],</span><span class="n">thiscol</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">,</span><span class="n">thissym</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">,</span><span class="n">alpha_fun</span><span class="o">=</span><span class="s1">&#39;Pre_Def&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">xlims</span> <span class="o">==</span> <span class="s1">&#39;tsink&#39;</span><span class="p">:</span> <span class="n">xlims</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">tsink</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;tsink&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckCol</span><span class="p">(</span><span class="n">thiscol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckSym</span><span class="p">(</span><span class="n">thissym</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thisshiftscale</span> <span class="o">=</span> <span class="s1">&#39;Not Set&#39;</span>
        <span class="n">thisshift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetShift</span><span class="p">(</span><span class="n">xlims</span><span class="p">,</span><span class="n">thisshift</span><span class="p">)</span>
        <span class="n">rs_col_name</span> <span class="o">=</span> <span class="s1">&#39;boot&#39;</span>
        <span class="n">this_leg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span>
        <span class="k">if</span> <span class="n">alpha_fun</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">alpha_fun</span><span class="p">,</span><span class="s1">&#39;__name__&#39;</span><span class="p">):</span>
                <span class="n">rs_col_name</span> <span class="o">=</span> <span class="n">alpha_fun</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="k">elif</span> <span class="n">alpha_fun</span> <span class="o">==</span> <span class="s1">&#39;Pre_Def&#39;</span><span class="p">:</span>
                <span class="n">rs_col_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_rat</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rs_col_name</span> <span class="o">=</span> <span class="n">alpha_fun</span>
            <span class="k">if</span> <span class="n">rs_col_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;_corr&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rs_col_name</span><span class="p">:</span>
                    <span class="n">plot_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Plot</span><span class="p">(</span><span class="n">plot_class</span><span class="p">,</span><span class="n">xlims</span><span class="o">=</span><span class="n">xlims</span><span class="p">,</span><span class="n">gammamomlist</span><span class="o">=</span><span class="n">gammamomlist</span><span class="p">,</span><span class="n">tflowlist</span> <span class="o">=</span><span class="n">tflowlist</span><span class="p">,</span>
                                           <span class="n">thiscol</span><span class="o">=</span><span class="n">thiscol</span><span class="p">,</span><span class="n">thissym</span><span class="o">=</span><span class="n">thissym</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="n">thisshift</span><span class="p">,</span><span class="n">alpha_fun</span><span class="o">=</span><span class="n">rs_col_name</span><span class="o">+</span><span class="s1">&#39;_corr&#39;</span><span class="p">)</span>
                <span class="n">this_leg</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">rs_col_name</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39; \alpha&#39;</span>
                <span class="n">rs_col_name</span> <span class="o">=</span> <span class="s1">&#39;alpha_rat_&#39;</span><span class="o">+</span><span class="n">rs_col_name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rs_col_name</span> <span class="o">=</span> <span class="s1">&#39;boot&#39;</span>

        <span class="k">if</span> <span class="n">rs_col_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rs_col_name</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no data to plot for column &#39;</span><span class="o">+</span><span class="n">rs_col_name</span><span class="o">+</span> <span class="s1">&#39;, attemping to run alpha computation (THIS MAY TAKE ALONG TIME!)&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">DoAlphaCombine</span><span class="p">(</span><span class="n">rs_col_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no data to plot for ratio function, skipping&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rs_col_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;error trying to compute ratio alpha combintation &#39;</span><span class="o">+</span><span class="n">rs_col_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">gammamomlist</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gammamomlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defgammamomlist</span>
        <span class="c1"># for (igamma,ip,itflow),Rat_data in self.Rat_Stats[rs_col_name].groupby(level=(&#39;current_operator&#39;,&#39;momentum&#39;,&#39;flow_times&#39;)):</span>
        <span class="c1">#     if itflow not in tflowlist: continue</span>
        <span class="c1">#     if igamma not in gammamomlist.keys(): continue</span>
        <span class="c1">#     if ip not in gammamomlist[igamma]: continue</span>

        <span class="n">igamma</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gammamomlist</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">TOpform</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">gammamomlist</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">pref</span><span class="o">=</span><span class="s1">&#39;q&#39;</span><span class="p">)</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;qq&#39;</span><span class="p">,</span><span class="s1">&#39;q&#39;</span><span class="p">)</span>
        <span class="n">itflow</span> <span class="o">=</span> <span class="n">tflowlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="n">rs_col_name</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
        <span class="n">databoot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="n">rs_col_name</span><span class="p">]</span>

        <span class="n">tlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">databoot</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">this_key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="c1"># tlist,databoot = zip(*list(self.Rat_Stats[rs_col_name][igamma,ip,itflow].iteritems()))</span>
        <span class="c1"># dataavg,dataerr = [],[]</span>
        <span class="c1"># for idata in databoot[xlims[0]:xlims[1]]:</span>
        <span class="c1">#     dataavg.append(idata.Avg)</span>
        <span class="c1">#     dataerr.append(idata.Std)</span>
        <span class="n">tlist</span> <span class="o">=</span> <span class="n">tlist</span><span class="p">[</span><span class="n">xlims</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">xlims</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="c1"># print &#39;plotting &#39; , igamma,ip</span>
        <span class="c1"># pleg,gammaleg = &#39;&#39;,&#39;&#39;</span>
        <span class="c1"># if len(gammamomlist[igamma]) &gt; 1:</span>
        <span class="c1">#     pleg = &#39; $&#39;+ip+&#39;$&#39;</span>
        <span class="c1"># if len(gammamomlist.keys()) &gt; 1:</span>
        <span class="c1">#     gammaleg = &#39; $&#39;+igamma+&#39;$&#39;</span>
        <span class="c1"># pleg = &#39; $&#39;+ip+&#39;$&#39;</span>
        <span class="c1"># if &#39;_cmplx&#39; in igamma:</span>
        <span class="c1">#     gammaleg = &#39; $i&#39;+igamma.replace(&#39;_cmplx&#39;,&#39;&#39;)+&#39;$&#39;</span>
        <span class="c1"># else:</span>
        <span class="c1">#     gammaleg = &#39; $&#39;+igamma+&#39;$&#39;</span>
        <span class="c1"># tflowleg = &#39; $&#39;+tflowTOLeg(itflow)+&#39;$&#39;</span>
        <span class="n">tlistplot</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">centert</span> <span class="o">=</span> <span class="n">CenterT</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">untstr</span><span class="p">,</span><span class="n">tlist</span><span class="p">)))</span><span class="o">-</span><span class="n">twopttshift</span><span class="o">+</span><span class="n">thisshift</span><span class="p">)</span>
        <span class="n">hold_series</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;x_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tlistplot</span>
        <span class="k">if</span> <span class="s1">&#39;_corr&#39;</span> <span class="ow">in</span> <span class="n">rs_col_name</span><span class="p">:</span>
            <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;y_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">databoot</span>
            <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;yerr_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;scatter_vary&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;y_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">databoot</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">Avg</span><span class="p">)</span>
            <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;yerr_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">databoot</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
            <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;error_bar_vary&#39;</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;xerr_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;key_select&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_key</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;fit_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># hold_series[&#39;label&#39;] = self.LegLab+pleg+gammaleg+tflowleg</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">this_leg</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thissym</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;shift&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisshift</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;xdatarange&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;Phys&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;ShowPar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;fmt_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">KeyForamtting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="p">)</span>
        <span class="n">plot_class</span><span class="o">.</span><span class="n">AppendData</span><span class="p">(</span><span class="n">hold_series</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plot_class</span></div>

<div class="viewcode-block" id="RatioFOCorr.GetBestFitr"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.GetBestFitr">[docs]</a>    <span class="k">def</span> <span class="nf">GetBestFitr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">itflow</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39; not foun in ratio fit list, cannot find best&#39;</span>
            <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>
        <span class="n">chi_str</span><span class="p">,</span><span class="n">cut_fit_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">at</span><span class="p">[(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">),</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">GetBestChi</span><span class="p">()</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;$\chi^</span><span class="si">{2}</span><span class="s1">_</span><span class="si">{pdf}</span><span class="s1">=</span><span class="si">{:.3f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chi_str</span><span class="p">),</span><span class="n">cut_fit_result</span></div>

    <span class="c1">## state is 1 or 2 state fit</span>
    <span class="c1">## fitr is fit range e.g. fitr5-10</span>
    <span class="c1">## fit range of &#39;Data&#39; is just the original fit range</span>
<div class="viewcode-block" id="RatioFOCorr.FitPlot"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.FitPlot">[docs]</a>    <span class="k">def</span> <span class="nf">FitPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">plot_class</span><span class="p">,</span><span class="n">fitr</span><span class="p">,</span><span class="n">xlims</span> <span class="o">=</span> <span class="s1">&#39;Data&#39;</span><span class="p">,</span><span class="n">gammamomlist</span><span class="o">=</span><span class="p">{},</span>
                <span class="n">tflowlist</span> <span class="o">=</span> <span class="p">[],</span><span class="n">thiscol</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">):</span>
        <span class="c1"># if self.alpha_rat is not False:</span>
        <span class="c1">#     print &#39;alpha_rat is not false, skipping fit plot&#39;</span>
        <span class="c1">#     return plot_class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckCol</span><span class="p">(</span><span class="n">thiscol</span><span class="p">)</span>
        <span class="n">thisshift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetShift</span><span class="p">(</span><span class="n">xlims</span><span class="p">,</span><span class="n">thisshift</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Importtflow</span><span class="p">(</span><span class="n">tflowlist</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">centert</span> <span class="o">==</span> <span class="s1">&#39;Not Set&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;print centert not set, defaulting to 0&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">centert</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s1">&#39;No fitting has been done, maybe try to Fit before plotting fit&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">gammamomlist</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gammamomlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defgammamomlist</span>
        <span class="c1"># if (igamma,ip,fitr) not in self.Rat_Fit_Stats.index:</span>
        <span class="c1"># for igamma,momlist in gammamomlist.iteritems():</span>
        <span class="c1">#     for ip in momlist:</span>
        <span class="c1">#         for itflow in tflowlist:</span>
        <span class="n">igamma</span><span class="p">,</span><span class="n">momlist</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">gammamomlist</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">TOpform</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">gammamomlist</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">pref</span><span class="o">=</span><span class="s1">&#39;q&#39;</span><span class="p">)</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;qq&#39;</span><span class="p">,</span><span class="s1">&#39;q&#39;</span><span class="p">)</span>
        <span class="n">itflow</span> <span class="o">=</span> <span class="n">tflowlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">fitr</span> <span class="o">==</span> <span class="s1">&#39;Best&#39;</span><span class="p">:</span>
            <span class="n">chi_legend</span><span class="p">,</span><span class="n">fitr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetBestFitr</span><span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no fits done, attempting fit now&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">fit_range</span><span class="o">=</span><span class="n">fitr</span><span class="p">)</span>
        <span class="n">fit_data</span> <span class="o">=</span> <span class="n">sff</span><span class="o">.</span><span class="n">PullSOFSeries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
        <span class="n">this_fun</span> <span class="o">=</span> <span class="n">fit_data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">this_fun</span><span class="p">,</span><span class="n">fitr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">this_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fit_data</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">this_key</span> <span class="p">,</span> <span class="s1">&#39;not present in Rat Fit Stats, fitting now&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">fit_range</span><span class="o">=</span><span class="n">fitr</span><span class="p">)</span>
            <span class="n">fit_data</span> <span class="o">=</span> <span class="n">sff</span><span class="o">.</span><span class="n">PullSOFSeries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
            <span class="n">this_fun</span> <span class="o">=</span> <span class="n">fit_data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">this_fun</span><span class="p">,</span><span class="n">fitr</span><span class="p">)</span>

        <span class="n">hold_series</span> <span class="o">=</span> <span class="n">null_series</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;key_select&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_key</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;fit_vary&#39;</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;fit_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit_data</span>
        <span class="c1"># hold_series[&#39;label&#39;] = fit_data[this_key].name +&#39; &#39; + chi_legend</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ACTUAL_VALUE_fit&#39;</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thissym</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;shift&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisshift</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;xdatarange&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xlims</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;ShowPar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Par1&#39;</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;fmt_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">KeyForamtting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="p">)</span>
        <span class="n">plot_class</span><span class="o">.</span><span class="n">AppendData</span><span class="p">(</span><span class="n">hold_series</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plot_class</span></div>






    <span class="c1">## ##################### ###############################################</span>


    <span class="c1">## Comparisons</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">SubDir</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="RatioFOCorr.iteritems"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.iteritems">[docs]</a>    <span class="k">def</span> <span class="nf">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span></div>

<div class="viewcode-block" id="RatioFOCorr.items"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.items">[docs]</a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span></div>

<div class="viewcode-block" id="RatioFOCorr.itemsAvgStd"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.itemsAvgStd">[docs]</a>    <span class="k">def</span> <span class="nf">itemsAvgStd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">outlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ivals</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
            <span class="n">outlist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ivals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ivals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">ivals</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">outlist</span></div>

<div class="viewcode-block" id="RatioFOCorr.values"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.values">[docs]</a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span></div>

<div class="viewcode-block" id="RatioFOCorr.itervalues"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.itervalues">[docs]</a>    <span class="k">def</span> <span class="nf">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span></div>

<div class="viewcode-block" id="RatioFOCorr.valuesAvgStd"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.valuesAvgStd">[docs]</a>    <span class="k">def</span> <span class="nf">valuesAvgStd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">outlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ivals</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
            <span class="n">outlist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ivals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">ivals</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">outlist</span></div>

<div class="viewcode-block" id="RatioFOCorr.keys"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">index</span></div>


    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__reversed__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">iiloc</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span>




    <span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thiskey</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">thiskey</span><span class="p">]</span>

    <span class="c1">## unitary arithmetic operations</span>

    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span>


    <span class="k">def</span> <span class="nf">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1">## Casting, just casts the bootstrap values, ignore return value (only needed since return has to be same type).</span>


    <span class="k">def</span> <span class="nf">__complex__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="nb">complex</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">+</span><span class="mi">0</span><span class="n">j</span>

    <span class="k">def</span> <span class="nf">__int__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__float__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="k">return</span> <span class="mf">1.0</span>

<div class="viewcode-block" id="RatioFOCorr.ReduceIndicies"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.ReduceIndicies">[docs]</a>    <span class="k">def</span> <span class="nf">ReduceIndicies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">indexl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">itflow</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">first_gamma</span> <span class="o">=</span> <span class="n">MultiSplit</span><span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">op_str_list</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;FO&#39;</span><span class="p">,</span><span class="s1">&#39;FOFull&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">this_gamma</span> <span class="o">=</span> <span class="n">first_gamma</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;FO&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">this_gamma</span> <span class="o">=</span> <span class="n">this_gamma</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;FOFull&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">this_gamma</span> <span class="o">=</span> <span class="n">this_gamma</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">this_gamma</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span>
                <span class="n">this_gamma</span> <span class="o">=</span> <span class="n">this_gamma</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">this_p</span> <span class="o">=</span> <span class="n">MultiSplit</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">op_str_list</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;FO&#39;</span><span class="p">,</span><span class="s1">&#39;FOFull&#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">indexl</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">this_gamma</span><span class="p">,</span><span class="n">this_p</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">itflow</span><span class="p">))</span>
        <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">indexl</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Col_Names</span><span class="p">)</span>
        <span class="n">this_series</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_series</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span></div>


<div class="viewcode-block" id="RatioFOCorr.sin"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.sin">[docs]</a>    <span class="k">def</span> <span class="nf">sin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">RatioFOCorr</span><span class="p">(</span><span class="n">thisnboot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">,</span> <span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span><span class="p">[[</span><span class="s1">&#39;configs&#39;</span><span class="p">,</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]],</span>
                         <span class="n">Info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">,</span><span class="n">thissym</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thissym</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span><span class="p">,</span>
                         <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;sin(&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;sin_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="RatioFOCorr.cos"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.cos">[docs]</a>    <span class="k">def</span> <span class="nf">cos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">RatioFOCorr</span><span class="p">(</span><span class="n">thisnboot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">,</span> <span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span><span class="p">[[</span><span class="s1">&#39;configs&#39;</span><span class="p">,</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]],</span>
                         <span class="n">Info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">,</span><span class="n">thissym</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thissym</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span><span class="p">,</span>
                         <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;cos(&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;cos_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">Rat_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="RatioFOCorr.Overload_wrap"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOCorr.Overload_wrap">[docs]</a>    <span class="k">def</span> <span class="nf">Overload_wrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">,</span><span class="n">this_fun</span><span class="p">):</span>
        <span class="c1">## TODO, include some name and filename formatting</span>
        <span class="n">thisname</span><span class="p">,</span><span class="n">thisfilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">):</span>
            <span class="n">thisname</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">Rat2</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="s1">&#39;filename&#39;</span><span class="p">):</span>
            <span class="n">thisfilename</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">Rat2</span><span class="o">.</span><span class="n">filename</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">RatioFOCorr</span><span class="p">(</span><span class="n">thisnboot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">,</span> <span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span><span class="p">[[</span><span class="s1">&#39;configs&#39;</span><span class="p">,</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]],</span>
                         <span class="n">Info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">,</span><span class="n">thissym</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thissym</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">Rat_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
        <span class="c1"># result.UpdateName(&#39;+&#39;,self,Rat2)</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">RatioFOCorr</span><span class="p">):</span>
                <span class="c1"># result.Rat_Stats.loc[:,&#39;boot&#39;] = this_fun(self.Rat_Stats.loc[:,&#39;boot&#39;],Rat2.Rat_Stats.loc[:,&#39;boot&#39;])</span>
                <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="n">Rat2</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">:</span>
                    <span class="n">vall</span><span class="p">,</span><span class="n">ilist</span> <span class="o">=</span> <span class="p">[],[]</span>
                    <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">it</span><span class="p">),</span><span class="n">irat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">it</span><span class="p">,</span><span class="n">itflow</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Rat2</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
                            <span class="n">out_str</span> <span class="o">=</span> <span class="s1">&#39;missmatch in euclidian times / flow times when combining ratio functions </span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="n">out_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="n">out_str</span> <span class="o">+=</span> <span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="n">out_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Rat2</span><span class="p">)</span>
                            <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="n">out_str</span><span class="p">)</span>
                        <span class="k">for</span> <span class="p">(</span><span class="n">igamma2</span><span class="p">,</span><span class="n">ip2</span><span class="p">,</span><span class="n">itflowdump</span><span class="p">,</span><span class="n">itdump</span><span class="p">),</span><span class="n">irat2</span> <span class="ow">in</span> <span class="n">Rat2</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">itflow</span><span class="p">,</span><span class="n">it</span><span class="p">),</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">igammacomb</span><span class="p">,</span><span class="n">ipcomb</span> <span class="o">=</span> <span class="n">igamma</span><span class="p">,</span><span class="n">ip</span>
                            <span class="k">if</span> <span class="n">igamma2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">igamma</span><span class="p">:</span>
                                <span class="n">igammacomb</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">igamma2</span>
                            <span class="k">if</span> <span class="n">ip2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ip</span><span class="p">:</span>
                                <span class="n">ipcomb</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">ip2</span>
                            <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">igammacomb</span><span class="p">,</span><span class="n">ipcomb</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">it</span><span class="p">))</span>
                            <span class="n">vall</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_fun</span><span class="p">(</span><span class="n">irat</span><span class="p">,</span><span class="n">irat2</span><span class="p">))</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Col_Names</span><span class="p">)</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">vall</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s1">&#39;Run Bootstrap on second class before combining ratio functions&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">RatioCorr</span><span class="p">):</span>
                <span class="c1"># result.Rat_Stats.loc[:,&#39;boot&#39;] = this_fun(self.Rat_Stats.loc[:,&#39;boot&#39;],Rat2.Rat_Stats.loc[:,&#39;boot&#39;])</span>
                <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="n">Rat2</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">:</span>
                    <span class="n">vall</span><span class="p">,</span><span class="n">ilist</span> <span class="o">=</span> <span class="p">[],[]</span>
                    <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">it</span><span class="p">),</span><span class="n">irat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">it</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Rat2</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
                            <span class="n">out_str</span> <span class="o">=</span> <span class="s1">&#39;missmatch in euclidian times when combining ratio functions </span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="n">out_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="n">out_str</span> <span class="o">+=</span> <span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="n">out_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Rat2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="n">out_str</span> <span class="o">+=</span> <span class="n">it</span>
                            <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="n">out_str</span><span class="p">)</span>
                        <span class="k">for</span> <span class="p">(</span><span class="n">igamma2</span><span class="p">,</span><span class="n">ip2</span><span class="p">,</span><span class="n">itdump</span><span class="p">),</span><span class="n">irat2</span> <span class="ow">in</span> <span class="n">Rat2</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">it</span><span class="p">),</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">igammacomb</span><span class="p">,</span><span class="n">ipcomb</span> <span class="o">=</span> <span class="n">igamma</span><span class="o">+</span><span class="s1">&#39;_FO_&#39;</span><span class="p">,</span><span class="n">ip</span>
                            <span class="c1"># if igamma != igamma2:</span>
                            <span class="n">igammacomb</span> <span class="o">+=</span> <span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">igamma2</span>
                            <span class="k">if</span> <span class="n">ip2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ip</span><span class="p">:</span>
                                <span class="n">ipcomb</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">ip2</span>
                            <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">igammacomb</span><span class="p">,</span><span class="n">ipcomb</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">it</span><span class="p">))</span>
                            <span class="n">vall</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_fun</span><span class="p">(</span><span class="n">irat</span><span class="p">,</span><span class="n">irat2</span><span class="p">))</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Col_Names</span><span class="p">)</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">vall</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s1">&#39;Run Bootstrap on second class before combining ratio functions&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_fun</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">],</span> <span class="n">Rat2</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">),</span> <span class="n">Rat2</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Invalid value to combine with RatioFOCorr class&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s1">&#39;Run Bootstrap on first class before combining ratio functions&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioFOCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">op</span><span class="o">.</span><span class="n">add</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioFOCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">op</span><span class="o">.</span><span class="n">sub</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioFOCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">op</span><span class="o">.</span><span class="n">mul</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioFOCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="n">__rdiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">op</span><span class="o">.</span><span class="n">truediv</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioFOCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="fm">__rpow__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">op</span><span class="o">.</span><span class="n">pow</span><span class="p">)</span>


    <span class="c1">## Right multiplication functions</span>


    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioFOCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">flip_fun_2arg</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">add</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioFOCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">flip_fun_2arg</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">sub</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioFOCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">flip_fun_2arg</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">mul</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rdiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioFOCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="n">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">flip_fun_2arg</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">truediv</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">__rpow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioFOCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="fm">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">flip_fun_2arg</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">pow</span><span class="p">))</span></div>



<span class="c1">####################################################################################################################</span>
<span class="c1">####################################################################################################################</span>
<span class="c1">####################################################################################################################</span>
<span class="c1">####################################################################################################################</span>
<span class="c1">####################################################################################################################</span>

<span class="c1">##UP TO HERE TODO:</span>

<div class="viewcode-block" id="RatioFOFullCorr"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr">[docs]</a><span class="k">class</span> <span class="nc">RatioFOFullCorr</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Rat(q,tau,pp,t,tflow) uses bootstrap class</span>
<span class="sd">    pp  = sink momentum</span>
<span class="sd">    t   = source sink separation time</span>
<span class="sd">    q   = current insersion momentum</span>
<span class="sd">    tau = current insersion time</span>
<span class="sd">    tflow = flow time</span>
<span class="sd">    tsum = summed current flow time.</span>

<span class="sd">    Info is a dictionary containing information for the correlator:</span>
<span class="sd">    see comments below to see what is required.</span>
<span class="sd">    missing elements just sets field to default</span>


<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="RatioFOFullCorr.Construct_RatFOFull_File"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.Construct_RatFOFull_File">[docs]</a>    <span class="k">def</span> <span class="nf">Construct_RatFOFull_File</span><span class="p">(</span><span class="n">this_file</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Construct_File_Object</span><span class="p">(</span><span class="n">this_file</span><span class="p">,</span><span class="n">RatioFOFullCorr</span><span class="p">)</span></div>


    <span class="c1">## TODO: create variational flag and interface with this function.</span>

    <span class="c1">## array of all classes that inherit this class. Append this when adding new classes please!</span>
    <span class="n">parentlist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SetOfCorrs.SetsOfRatios&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thisnboot</span><span class="o">=</span><span class="n">nboot</span><span class="p">,</span> <span class="n">cfglist</span><span class="o">=</span><span class="p">{},</span> <span class="n">Info</span><span class="o">=</span><span class="p">{},</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">thissym</span><span class="o">=</span><span class="s1">&#39;Not Set&#39;</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="s1">&#39;Not Set&#39;</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="mf">0.0</span>
                 <span class="p">,</span><span class="n">man_load_cfgs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">## Initialising plotting parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span> <span class="o">=</span> <span class="n">thisshift</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span> <span class="o">=</span> <span class="n">thiscol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thissym</span> <span class="o">=</span> <span class="n">thissym</span>
        <span class="c1">## the actual shift ammount needs to be scaled by the x axis size</span>
        <span class="c1">## see GetShift</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thisshiftscale</span> <span class="o">=</span> <span class="s1">&#39;Not Set&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span> <span class="o">=</span> <span class="n">NJNQFullCorr</span><span class="p">(</span><span class="n">thisnboot</span><span class="o">=</span><span class="n">thisnboot</span><span class="p">,</span> <span class="n">cfglist</span><span class="o">=</span><span class="n">cfglist</span><span class="p">,</span> <span class="n">Info</span><span class="o">=</span><span class="n">Info</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">PickleFile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tflow_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">tflowlist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thischecklist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;C3file&#39;</span><span class="p">,</span><span class="s1">&#39;Sym&#39;</span><span class="p">,</span><span class="s1">&#39;boot_tsum_list&#39;</span><span class="p">,</span><span class="s1">&#39;tflow_list&#39;</span><span class="p">,</span><span class="s1">&#39;Fun&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkmomlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">checkmomlist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boot_tsum_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">boot_tsum_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">latparams</span>
        <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">GetAvgmomstr</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">qmom</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;0 0 0&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">]:</span>
            <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0 0 0&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">nt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nxyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">nxyz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span> <span class="o">=</span> <span class="s1">&#39;RC&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nxyz</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;x&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim_ll</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nxyz</span><span class="p">)</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;^</span><span class="si">{3}</span><span class="s1">\times &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">)</span>

        <span class="c1">## both current and sink momentum are requred for the two point correlator construction when constructing the ratio function</span>
        <span class="c1">## but the two point correlator has been averaged over, so we need to get the averaged momentum anaolgy</span>
        <span class="c1">## bah, this was too hard to keep unique files for the two-point correlator.</span>
        <span class="c1">## easier just to read and write the whole 2 point mom file.</span>
        <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;pmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">GetMomList</span><span class="p">(</span><span class="n">list_type</span><span class="o">=</span><span class="s1">&#39;str_Avg&#39;</span><span class="p">)</span>
        <span class="c1">## e.g. q = [-1,1,-1] corresponds to p = [1 1 1] in the two-point correlator</span>
        <span class="c1"># ppforp = self.latparams.GetAvgmomstr(Info[&#39;ppmom&#39;])</span>
        <span class="c1"># if ppforp not in Info[&#39;pmom&#39;]: Info[&#39;pmom&#39;].append(ppforp)</span>


        <span class="k">if</span> <span class="s1">&#39;show_cfgs&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cfgs</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;show_cfgs&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cfgs</span> <span class="o">=</span> <span class="kc">True</span>


        <span class="c1">## Does symmetrising over smearings</span>
        <span class="k">if</span> <span class="s1">&#39;Symmetric&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">Sym</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;Symmetric&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Sym</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">## default to no symmetrizing, (usually full matrix isn&#39;t computed nowerdays.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sinklab</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">jsmcoeffs</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sm2ptList</span><span class="p">,</span><span class="n">InfoList</span> <span class="o">=</span> <span class="n">GetInfoList</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">Info</span><span class="p">))</span>




        <span class="c1"># self.C2filelist = [ikey.PickleFile for ikey in self.C2classlist.itervalues()]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Observ</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">iinfo</span> <span class="ow">in</span> <span class="n">InfoList</span><span class="p">:</span> <span class="n">iinfo</span><span class="p">[</span><span class="s1">&#39;fo_for_cfgs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">iinfo</span> <span class="ow">in</span> <span class="n">InfoList</span><span class="p">:</span> <span class="n">iinfo</span><span class="p">[</span><span class="s1">&#39;fo_for_cfgs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Observ</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span> <span class="o">=</span> <span class="n">SetOfTwoPt</span><span class="p">(</span><span class="n">cfglist</span><span class="o">=</span><span class="n">cfglist</span><span class="p">,</span><span class="n">InfoDict</span> <span class="o">=</span> <span class="n">InfoList</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span> <span class="o">=</span> <span class="s1">&#39;Not Set&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">defgammamomlist</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">igamma</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">gammalist</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defgammamomlist</span><span class="p">[</span><span class="n">igamma</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">qform</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Col_Names</span> <span class="o">=</span> <span class="p">[</span>  <span class="s1">&#39;current_operator&#39;</span><span class="p">,</span><span class="s1">&#39;momentum&#39;</span><span class="p">,</span><span class="s1">&#39;flow_times&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;source_sink_separation&#39;</span><span class="p">,</span><span class="s1">&#39;flow_op_trange&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        self.Rat_Stats DataFrame:</span>

<span class="sd">        columns =   boot,   Avg,        Std</span>

<span class="sd">        rows =      current_operator,   momenta,    flow_times,</span>
<span class="sd">                    time separation,    flow op trange</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">RatInt_Col_Names</span> <span class="o">=</span> <span class="p">[</span>  <span class="s1">&#39;current_operator&#39;</span><span class="p">,</span><span class="s1">&#39;momentum&#39;</span><span class="p">,</span><span class="s1">&#39;flow_times&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;source_sink_separation&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RatInt_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        self.RatInt_Stats DataFrame:</span>

<span class="sd">        columns =   boot,   Avg,        Std</span>

<span class="sd">        rows =      current_operator,   momenta,    flow_times,</span>
<span class="sd">                    time separation</span>
<span class="sd">        &#39;&#39;&#39;</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Col_Names</span> <span class="o">=</span> <span class="p">[</span>  <span class="s1">&#39;current_operator&#39;</span><span class="p">,</span><span class="s1">&#39;momentum&#39;</span><span class="p">,</span><span class="s1">&#39;flow_times&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        self.Rat_Fit_Stats DataFrame:</span>

<span class="sd">        columns =   boot,   Avg,        Std</span>

<span class="sd">        rows =      current_operator, momenta,  flow_times, time fit range, flow op trange</span>

<span class="sd">        Avg/Std elements are pa.Series instances with:</span>
<span class="sd">            index = fit parameters</span>
<span class="sd">            values = Avg/Std values</span>
<span class="sd">        &#39;&#39;&#39;</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">RatInt_Fit_Col_Names</span> <span class="o">=</span> <span class="p">[</span>  <span class="s1">&#39;current_operator&#39;</span><span class="p">,</span><span class="s1">&#39;momentum&#39;</span><span class="p">,</span><span class="s1">&#39;flow_times&#39;</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RatInt_Fit_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        self.RatInt_Fit_Stats DataFrame:</span>

<span class="sd">        columns =   boot,   Avg,        Std</span>

<span class="sd">        rows =      current_operator, momenta,  flow_times, time fit range</span>

<span class="sd">        Avg/Std elements are pa.Series instances with:</span>
<span class="sd">            index = fit parameters</span>
<span class="sd">            values = Avg/Std values</span>
<span class="sd">        &#39;&#39;&#39;</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">nboot</span> <span class="o">=</span> <span class="n">thisnboot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centert</span> <span class="o">=</span> <span class="s1">&#39;Not Set&#39;</span>


        <span class="c1">## Info can contain fit ranges to be calculated</span>
        <span class="c1">## must bein form Info[&#39;FitsRF&#39;] = [ (&#39;taufit#-#&#39;,&#39;fit#-#&#39;) , ...]</span>
        <span class="k">if</span> <span class="s1">&#39;FitsRFFull&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">PredefFits</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;FitsRFFull&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">PredefFits</span> <span class="o">=</span> <span class="p">[]</span>


        <span class="k">if</span> <span class="s1">&#39;RFFitFun&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fun</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">npar</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;RFFitFun&#39;</span><span class="p">]</span>
        <span class="c1"># else: self.Fun,self.npar = (RF_Prop_Fit,3)</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fun</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">npar</span> <span class="o">=</span> <span class="p">(</span><span class="n">ConstantFitFun</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">## Info can contain initial guess for fits, make sure it array of correct length</span>
        <span class="k">if</span> <span class="s1">&#39;iGuessRF&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Info</span><span class="p">[</span><span class="s1">&#39;iGuessRF&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span> <span class="c1">## Defaults to value set for function in FitFunctions.py</span>

        <span class="k">if</span> <span class="s1">&#39;min_fit_len_tsum&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_fit_len_tsum</span> <span class="o">=</span> <span class="n">Info</span><span class="p">[</span><span class="s1">&#39;min_fit_len_tsum&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_fit_len_tsum</span> <span class="o">=</span> <span class="s1">&#39;Default&#39;</span>


        <span class="c1">## is needed?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Info</span> <span class="o">=</span> <span class="n">Info</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SetCustomName</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">stringfn</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">man_load_cfgs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LoadCfgs</span><span class="p">(</span><span class="n">cfglist</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">filename</span><span class="p">)</span>

<div class="viewcode-block" id="RatioFOFullCorr.LoadCfgs"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.LoadCfgs">[docs]</a>    <span class="k">def</span> <span class="nf">LoadCfgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cfglist</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cfglist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CombineCfgLists</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">cfglist</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetCustomName</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">stringfn</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></div>

    <span class="c1">## just for consistancy with other classes</span>
<div class="viewcode-block" id="RatioFOFullCorr.GetCfgList"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.GetCfgList">[docs]</a>    <span class="k">def</span> <span class="nf">GetCfgList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CombineCfgLists</span><span class="p">()</span></div>

<div class="viewcode-block" id="RatioFOFullCorr.CombineCfgLists"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.CombineCfgLists">[docs]</a>    <span class="k">def</span> <span class="nf">CombineCfgLists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">thiscfglist</span> <span class="o">=</span> <span class="n">CombineCfgs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJNQFull_cfgs</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="o">.</span><span class="n">cfglist</span><span class="p">)</span>
            <span class="c1"># print</span>
            <span class="c1"># print len(thiscfglist.keys()), len(self.C3FOclass.cfglist.keys()), len(self.C2Set.cfglist.keys())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thiscfglist</span> <span class="o">=</span> <span class="n">CombineCfgs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJNQFull_cfgs</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">C2_cfgs</span><span class="p">)</span>
            <span class="c1"># print</span>
            <span class="c1"># print len(thiscfglist.keys()), len(self.C3FOclass.cfglist.keys()), len(self.C2class.cfglist.keys())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">thiscfglist</span><span class="p">)</span></div>




<div class="viewcode-block" id="RatioFOFullCorr.SetCustomName"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.SetCustomName">[docs]</a>    <span class="k">def</span> <span class="nf">SetCustomName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">stringfn</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">stringLL</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">string</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Rat_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">string</span>
        <span class="k">if</span> <span class="n">stringfn</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;Rat_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">filename</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">stringfn</span>
        <span class="k">if</span> <span class="n">stringLL</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">thisops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Observ</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span> <span class="o">=</span> <span class="s1">&#39;$&#39;</span><span class="o">+</span><span class="s1">&#39;\ &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>   <span class="bp">self</span><span class="o">.</span><span class="n">dim_ll</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">GetPionMassLab</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">stream_name</span><span class="p">,</span><span class="n">thisops</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">Proj</span><span class="p">])</span> \
                                            <span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">tr_sum_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39;\ &#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;$&#39;</span> <span class="c1">## customise this how you like</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span> <span class="o">=</span> <span class="n">stringLL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SubDir</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">Proj</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">DS</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ppform</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ratdir</span> <span class="o">=</span>   <span class="n">outputdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">kappafolder</span><span class="o">+</span><span class="s1">&#39;/Rat/&#39;</span><span class="o">+</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">Observ</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">SubDir</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
        <span class="n">mkdir_p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ratdir</span><span class="o">+</span><span class="s1">&#39;/Pickle/&#39;</span><span class="p">)</span>
        <span class="n">mkdir_p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ratdir</span><span class="o">+</span><span class="s1">&#39;/Excel/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ratdir</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.xml&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ratdir</span><span class="o">+</span><span class="s1">&#39;/Excel/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.xlsx&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ratdir</span><span class="o">+</span><span class="s1">&#39;/Pickle/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.py3p&#39;</span></div>



<div class="viewcode-block" id="RatioFOFullCorr.ImportCfgList"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.ImportCfgList">[docs]</a>    <span class="k">def</span> <span class="nf">ImportCfgList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cfglist</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span> <span class="o">=</span> <span class="n">cfglist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">cfglist</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span> <span class="o">!=</span> <span class="s1">&#39;Not Set&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">cfglist</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">ImportCfgList</span><span class="p">(</span><span class="n">cfglist</span><span class="p">)</span></div>

    <span class="c1"># def ImportCfgList(self,cfglist):</span>
    <span class="c1">#     for iC2 in self.C2classlist.itervalues():</span>
    <span class="c1">#         iC2.ImportCfgList(cfglist)</span>
    <span class="c1">#     if self.C2class != &#39;Not Set&#39;: self.C2class.ImportCfgList(cfglist)</span>
    <span class="c1">#     self.C3FOclass.ImportCfgList(cfglist)</span>


<div class="viewcode-block" id="RatioFOFullCorr.Stats"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.Stats">[docs]</a>    <span class="k">def</span> <span class="nf">Stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="p">,</span><span class="s1">&#39;Stats&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="p">,</span><span class="s1">&#39;Stats&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">lAvg</span><span class="p">,</span><span class="n">lStd</span> <span class="o">=</span> <span class="p">[],[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">its</span><span class="p">),</span><span class="n">iRat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">iRat</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
            <span class="n">lAvg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iRat</span><span class="o">.</span><span class="n">Avg</span><span class="p">)</span>
            <span class="n">lStd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iRat</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
        <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Col_Names</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lAvg</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lStd</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span></div>


<div class="viewcode-block" id="RatioFOFullCorr.RemoveVals"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.RemoveVals">[docs]</a>    <span class="k">def</span> <span class="nf">RemoveVals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># for iC2 in self.C2classlist.itervalues():</span>
        <span class="c1">#     iC2.RemoveVals()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">RemoveVals</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">RemoveVals</span><span class="p">()</span></div>

    <span class="c1">## self.Rat = [ igamma , ip, it , iconf ]</span>
    <span class="c1">## configs must be the same, so we check for them</span>
<div class="viewcode-block" id="RatioFOFullCorr.Read"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.Read">[docs]</a>    <span class="k">def</span> <span class="nf">Read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">WipeData</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">NoFit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># else:</span>
        <span class="c1">#     print(&#39;WARNING: C2class (combined from C2Set) is already present, yet we are trying to read&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">CheckMom</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="RatioFOFullCorr.CreateC2Sink"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.CreateC2Sink">[docs]</a>    <span class="k">def</span> <span class="nf">CreateC2Sink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">thisname</span><span class="p">,</span><span class="n">thisleglab</span><span class="p">,</span><span class="n">jsmlab</span> <span class="o">=</span> <span class="n">CreateNameAndLL</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="o">.</span><span class="n">SetC2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sinklab</span><span class="p">)</span>
            <span class="n">thisfun</span> <span class="o">=</span> <span class="n">GenSinkFun</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jsmcoeffs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="o">.</span><span class="n">CombineCorrs</span><span class="p">(</span><span class="n">thisfun</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">thisname</span><span class="p">,</span><span class="n">LegLab</span><span class="o">=</span><span class="n">thisleglab</span><span class="p">,</span><span class="n">jsmlab</span><span class="o">=</span><span class="n">jsmlab</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span> <span class="o">=</span> <span class="s1">&#39;Complete&#39;</span></div>

<div class="viewcode-block" id="RatioFOFullCorr.Bootstrap"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.Bootstrap">[docs]</a>    <span class="k">def</span> <span class="nf">Bootstrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">WipeData</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Read</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CreateC2Sink</span><span class="p">()</span>
        <span class="c1"># self.C2class.Bootstrap()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">Bootstrap</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span></div>


<div class="viewcode-block" id="RatioFOFullCorr.CalcRatio"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.CalcRatio">[docs]</a>    <span class="k">def</span> <span class="nf">CalcRatio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CalcSqrtFac</span><span class="p">()</span>
        <span class="c1">## if DS has a divide in it, we ignore the sqrt factor as they cancel</span>
        <span class="n">div_bool</span> <span class="o">=</span> <span class="s1">&#39;divide&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">DS</span>
        <span class="c1">## double the square root factor if we multiply two ds types</span>
        <span class="n">mult_bool</span> <span class="o">=</span> <span class="s1">&#39;multiply&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">DS</span>
        <span class="n">tsinkint</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">tsink</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;tsink&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="n">lRat</span><span class="p">,</span><span class="n">lRatAvg</span><span class="p">,</span><span class="n">lRatStd</span> <span class="o">=</span> <span class="p">[],[],[]</span>
        <span class="n">ilist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">its</span><span class="p">),</span><span class="n">tC3FO</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJNQFull_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ip2pt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">GetAvgmomform</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">pref</span><span class="o">=</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
            <span class="n">ict</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">untstr</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ict</span> <span class="o">&gt;</span> <span class="n">tsinkint</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ip2pt</span><span class="p">,</span><span class="n">it</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SqrtFact</span><span class="o">.</span><span class="n">index</span><span class="p">:</span> <span class="k">continue</span>
            <span class="c1"># warnings.warn(&#39;DEBUG, please check if tsink for 2-pt corr is correct via g4.&#39;)</span>
            <span class="c1"># print igamma, ip, it, self.C3class.tsink, tC3.Avg,self.SqrtFact[ip2pt,it].Avg</span>

            <span class="k">if</span> <span class="n">div_bool</span><span class="p">:</span>
                <span class="n">this_boot</span> <span class="o">=</span> <span class="n">tC3FO</span>
            <span class="k">elif</span> <span class="n">mult_bool</span><span class="p">:</span>
                <span class="n">this_boot</span> <span class="o">=</span> <span class="n">tC3FO</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SqrtFact</span><span class="p">[</span><span class="n">ip2pt</span><span class="p">,</span><span class="n">it</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">this_boot</span> <span class="o">=</span> <span class="n">tC3FO</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">SqrtFact</span><span class="p">[</span><span class="n">ip2pt</span><span class="p">,</span><span class="n">it</span><span class="p">]</span>
            <span class="n">this_boot</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
            <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">its</span><span class="p">))</span>
            <span class="n">lRat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_boot</span><span class="p">)</span>
            <span class="n">lRatAvg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_boot</span><span class="o">.</span><span class="n">Avg</span><span class="p">)</span>
            <span class="n">lRatStd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_boot</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
            <span class="c1"># self.Ratboot[igamma][ip][it] = tC3/self.C2class[ip.replace(&#39;q&#39;,&#39;p&#39;),&#39;t&#39;+str(int(self.C3class.tsink.replace(&#39;tsink&#39;,&#39;&#39;))+1)]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Col_Names</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lRat</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lRatAvg</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lRatStd</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>

        <span class="n">lRat</span><span class="p">,</span><span class="n">lRatAvg</span><span class="p">,</span><span class="n">lRatStd</span> <span class="o">=</span> <span class="p">[],[],[]</span>
        <span class="n">ilist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">itflow</span><span class="p">),</span><span class="n">tC3FO</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJNQInt_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ip2pt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">GetAvgmomform</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">pref</span><span class="o">=</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
            <span class="n">ict</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">untstr</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ict</span> <span class="o">&gt;</span> <span class="n">tsinkint</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ip2pt</span><span class="p">,</span><span class="n">it</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SqrtFact</span><span class="o">.</span><span class="n">index</span><span class="p">:</span> <span class="k">continue</span>
            <span class="c1"># warnings.warn(&#39;DEBUG, please check if tsink for 2-pt corr is correct via g4.&#39;)</span>
            <span class="c1"># print igamma, ip, it, self.C3class.tsink, tC3.Avg,self.SqrtFact[ip2pt,it].Avg</span>

            <span class="n">this_boot</span> <span class="o">=</span> <span class="n">tC3FO</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">SqrtFact</span><span class="p">[</span><span class="n">ip2pt</span><span class="p">,</span><span class="n">it</span><span class="p">]</span>
            <span class="n">this_boot</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
            <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">it</span><span class="p">))</span>
            <span class="n">lRat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_boot</span><span class="p">)</span>
            <span class="n">lRatAvg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_boot</span><span class="o">.</span><span class="n">Avg</span><span class="p">)</span>
            <span class="n">lRatStd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_boot</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
            <span class="c1"># self.Ratboot[igamma][ip][it] = tC3/self.C2class[ip.replace(&#39;q&#39;,&#39;p&#39;),&#39;t&#39;+str(int(self.C3class.tsink.replace(&#39;tsink&#39;,&#39;&#39;))+1)]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">RatInt_Col_Names</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RatInt_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lRat</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RatInt_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lRatAvg</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RatInt_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lRatStd</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span></div>



<div class="viewcode-block" id="RatioFOFullCorr.CalcSqrtFac"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.CalcSqrtFac">[docs]</a>    <span class="k">def</span> <span class="nf">CalcSqrtFac</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">SqrtFact_hold</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ilist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ipp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">GetAvgmomform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ppform</span><span class="p">,</span><span class="n">pref</span><span class="o">=</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Debug_Mode</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Outputting sqrt factor debug info:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">iq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">qform</span><span class="p">:</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">GetAvgmomform</span><span class="p">(</span><span class="n">iq</span><span class="p">,</span><span class="n">pref</span><span class="o">=</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
            <span class="n">sqrt_fac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CalcSqrtFacMom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">C2_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">][</span><span class="n">ipp</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">C2_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">][</span><span class="n">ip</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">tsink</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">it</span><span class="p">,</span><span class="n">tdata</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sqrt_fac</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">tstr</span><span class="p">(</span><span class="n">it</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ilist</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">Debug_Mode</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">ierr</span> <span class="ow">in</span> <span class="n">tdata</span><span class="o">.</span><span class="n">GetNaNIndex</span><span class="p">():</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">iq</span><span class="p">,</span> <span class="n">tstr</span><span class="p">(</span><span class="n">it</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39; iboot&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
                    <span class="n">SqrtFact_hold</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tdata</span><span class="p">)</span>
                    <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span><span class="n">tstr</span><span class="p">(</span><span class="n">it</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
            <span class="c1"># if neg_sqrt: warnings.warn(&#39;negative square root in square root factor for &#39;+ipp+iq)</span>
        <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;momentum&#39;</span><span class="p">,</span><span class="s1">&#39;source_sink_separation&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SqrtFact</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">SqrtFact_hold</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span></div>


<div class="viewcode-block" id="RatioFOFullCorr.CheckNegForSqrt"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.CheckNegForSqrt">[docs]</a>    <span class="k">def</span> <span class="nf">CheckNegForSqrt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thisboot</span><span class="p">,</span><span class="n">negsqrt</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ict</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">thisboot</span><span class="o">.</span><span class="n">bootvals</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">thisboot</span><span class="o">.</span><span class="n">bootvals</span><span class="p">[</span><span class="n">ict</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">negsqrt</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># if G2_abs:</span>
                <span class="c1">#     thisboot.bootvals[ict] = abs(thisboot.bootvals[ict])</span>
                <span class="c1"># else:</span>
                <span class="n">thisboot</span><span class="o">.</span><span class="n">bootvals</span><span class="p">[</span><span class="n">ict</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;NaN&#39;</span><span class="p">)</span>
                <span class="c1"># thisboot.bootvals[ict] = 0.0</span>
        <span class="k">return</span> <span class="n">thisboot</span><span class="p">,</span><span class="n">negsqrt</span></div>


    <span class="c1">## taking squareroot of each element before combinding makes the numbers not too small</span>
<div class="viewcode-block" id="RatioFOFullCorr.CalcSqrtFacMom"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.CalcSqrtFacMom">[docs]</a>    <span class="k">def</span> <span class="nf">CalcSqrtFacMom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data2ptpp</span><span class="p">,</span><span class="n">data2ptp</span><span class="p">,</span><span class="n">thistsink</span><span class="p">):</span>
        <span class="n">dictout</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">thistsink</span> <span class="o">=</span> <span class="n">thistsink</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;tsink&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
        <span class="n">thistsinkp1</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">thistsink</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">+</span><span class="n">twopttshift</span><span class="p">)</span>
        <span class="n">inttsink</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">thistsink</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="c1"># NegSQRTRatFac = False</span>
        <span class="c1"># data2ptpp[thistsinkp1],NegSQRTRatFac = self.CheckNegForSqrt(data2ptpp[thistsinkp1],NegSQRTRatFac)</span>
        <span class="c1"># data2ptp[thistsinkp1],NegSQRTRatFac = self.CheckNegForSqrt(data2ptp[thistsinkp1],NegSQRTRatFac)</span>

        <span class="n">data2ptpp</span> <span class="o">=</span> <span class="n">data2ptpp</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">Sqrt</span><span class="p">())</span>
        <span class="n">data2ptp</span> <span class="o">=</span> <span class="n">data2ptp</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">Sqrt</span><span class="p">())</span>
        <span class="c1"># NegSQRTRatFac = any(data2ptpp.isnull().values) or any(data2ptp.isnull().values)</span>
        <span class="n">two</span> <span class="o">=</span> <span class="n">data2ptpp</span><span class="p">[</span><span class="n">thistsinkp1</span><span class="p">]</span><span class="o">*</span><span class="n">data2ptp</span><span class="p">[</span><span class="n">thistsinkp1</span><span class="p">]</span>
        <span class="c1"># two = two.Sqrt()</span>
        <span class="n">thisshift</span> <span class="o">=</span> <span class="n">twopttshift</span>
        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">thisshift</span><span class="p">,</span><span class="n">inttsink</span><span class="o">+</span><span class="n">thisshift</span><span class="p">):</span>
            <span class="n">thiststr</span> <span class="o">=</span> <span class="n">tstr</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
            <span class="n">tflip</span> <span class="o">=</span> <span class="n">tstr</span><span class="p">(</span><span class="n">inttsink</span><span class="o">-</span><span class="n">it</span><span class="o">+</span><span class="n">twopttshift</span><span class="o">+</span><span class="n">thisshift</span><span class="p">)</span>
            <span class="c1"># data2ptpp[thiststr],NegSQRTRatFac = self.CheckNegForSqrt(data2ptpp[thiststr],NegSQRTRatFac)</span>
            <span class="c1"># data2ptp[thiststr],NegSQRTRatFac = self.CheckNegForSqrt(data2ptp[thiststr],NegSQRTRatFac)</span>
            <span class="c1"># data2ptpp[tflip],NegSQRTRatFac = self.CheckNegForSqrt(data2ptpp[tflip],NegSQRTRatFac)</span>
            <span class="c1"># data2ptp[tflip],NegSQRTRatFac = self.CheckNegForSqrt(data2ptp[tflip],NegSQRTRatFac)</span>
            <span class="n">one</span> <span class="o">=</span> <span class="n">data2ptpp</span><span class="p">[</span><span class="n">thiststr</span><span class="p">]</span><span class="o">/</span><span class="n">data2ptp</span><span class="p">[</span><span class="n">thiststr</span><span class="p">]</span>
            <span class="n">three</span> <span class="o">=</span> <span class="n">data2ptp</span><span class="p">[</span><span class="n">tflip</span><span class="p">]</span><span class="o">/</span><span class="n">data2ptpp</span><span class="p">[</span><span class="n">tflip</span><span class="p">]</span>
            <span class="n">inter</span> <span class="o">=</span> <span class="n">one</span><span class="o">*</span><span class="n">three</span>
            <span class="n">ott</span> <span class="o">=</span> <span class="n">inter</span><span class="o">/</span><span class="n">two</span>
            <span class="c1"># ott.Sqrt()</span>
            <span class="n">ott</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
            <span class="n">dictout</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ott</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Debug_Mode</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Printing two poitn correlators to be combine:&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ic</span><span class="p">,(</span><span class="n">ip</span><span class="p">,</span><span class="n">ipp</span><span class="p">,</span><span class="n">icomb</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">data2ptp</span><span class="p">,</span><span class="n">data2ptpp</span><span class="p">,</span><span class="n">dictout</span><span class="p">)):</span>
                <span class="n">icomb</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">ic</span><span class="p">,</span><span class="n">ip</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span><span class="n">ipp</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span><span class="n">icomb</span><span class="o">.</span><span class="n">Avg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dictout</span></div>

<div class="viewcode-block" id="RatioFOFullCorr.ImportFitRanges"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.ImportFitRanges">[docs]</a>    <span class="k">def</span> <span class="nf">ImportFitRanges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tau_fit_range</span><span class="p">,</span><span class="n">tsum_fit_range</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tau_fit_range</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;tau_fit_range for setsoffits takes 1 fit range to vary over, selecting first one&#39;</span><span class="p">)</span>
            <span class="n">tau_fit_range</span> <span class="o">=</span> <span class="n">tau_fit_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tsum_fit_range</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;tsum_fit_range for setsoffits takes 1 fit range to vary over, selecting first one&#39;</span><span class="p">)</span>
            <span class="n">tsum_fit_range</span> <span class="o">=</span> <span class="n">tsum_fit_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;PreDef&#39;</span> <span class="o">==</span> <span class="n">tau_fit_range</span><span class="p">:</span>
            <span class="n">tau_fit_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PredefFits</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;PreDef&#39;</span> <span class="o">==</span> <span class="n">tsum_fit_range</span><span class="p">:</span>
            <span class="n">tsum_fit_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PredefFits</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">tau_fit_range</span><span class="p">,</span><span class="n">tsum_fit_range</span><span class="p">]</span></div>


<div class="viewcode-block" id="RatioFOFullCorr.Fit"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.Fit">[docs]</a>    <span class="k">def</span> <span class="nf">Fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fit_range</span><span class="o">=</span><span class="s1">&#39;PreDef&#39;</span><span class="p">,</span><span class="n">tsum_ranges</span><span class="o">=</span><span class="s1">&#39;PreDef&#39;</span><span class="p">,</span><span class="n">iGuess</span><span class="o">=</span><span class="s1">&#39;PreDef&#39;</span><span class="p">,</span>
            <span class="n">EstDir</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">WipeFit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">show_timer</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">min_fitr</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImportFitRanges</span><span class="p">(</span><span class="n">fit_range</span><span class="p">,</span><span class="n">tsum_ranges</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">iGuess</span> <span class="o">!=</span> <span class="s1">&#39;PreDef&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span> <span class="o">=</span> <span class="n">iGuess</span>
        <span class="n">lFit</span><span class="p">,</span><span class="n">ilist</span> <span class="o">=</span> <span class="p">[],[]</span>
        <span class="n">itaufit</span><span class="p">,</span><span class="n">isumfit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_fit_len_tsum</span> <span class="o">==</span> <span class="s1">&#39;Default&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_fit_len_tsum</span> <span class="o">=</span> <span class="n">unxmlfitr_int</span><span class="p">(</span><span class="n">isumfit</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;tsumfitr&#39;</span><span class="p">,</span><span class="s1">&#39;fitr&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_fit_len_tsum</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">min_fit_len_tsum</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_fit_len_tsum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">),</span><span class="n">pdata</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;current_operator&#39;</span><span class="p">,</span><span class="s1">&#39;momentum&#39;</span><span class="p">,</span><span class="s1">&#39;flow_times&#39;</span><span class="p">)):</span>
            <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">WipeFit</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">drop</span><span class="p">([(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">)],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="n">fit_info</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">EstDir</span><span class="p">:</span>
                <span class="n">fit_info</span><span class="p">[</span><span class="s1">&#39;Funs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Fun</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">npar</span><span class="p">,</span><span class="s1">&#39;Estimate&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fit_info</span><span class="p">[</span><span class="s1">&#39;Funs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Fun</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">npar</span><span class="p">)</span>
            <span class="n">fit_info</span><span class="p">[</span><span class="s1">&#39;iGuess&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iGuess</span>
            <span class="n">fit_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">this_key</span><span class="p">)</span>
            <span class="n">thisff</span> <span class="o">=</span> <span class="n">sff</span><span class="o">.</span><span class="n">SetOfFitFuns</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="n">this_key</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="n">fit_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="n">thisff</span><span class="o">.</span><span class="n">ScanBox_fitr</span><span class="p">(</span><span class="n">itaufit</span><span class="p">,</span><span class="n">isumfit</span><span class="p">,</span><span class="n">fit_info</span><span class="o">=</span><span class="n">fit_info</span><span class="p">,</span>
                                <span class="n">min_fit_len_1</span><span class="o">=</span><span class="n">min_fitr</span><span class="p">,</span><span class="n">min_fit_len_2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">min_fit_len_tsum</span><span class="p">)</span>
            <span class="n">lFit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisff</span><span class="p">)</span>
            <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_key</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Col_Names</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">this_df</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                <span class="n">this_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lFit</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_df</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lFit</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">DoFits</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                <span class="n">val</span><span class="o">.</span><span class="n">DoFits</span><span class="p">(</span><span class="n">show_timer</span><span class="o">=</span><span class="n">show_timer</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">val</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">DoFits</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span></div>

        <span class="c1"># lFit,lFitA,lFitS = [],[],[]</span>
        <span class="c1"># ilist = []</span>
        <span class="c1"># for (igamma,ip,itflow),pdata in self.RatInt_Stats[&#39;boot&#39;].groupby(level=(&#39;current_operator&#39;,&#39;momentum&#39;,&#39;flow_times&#39;)):</span>
        <span class="c1">#     for ifit in self.fit_range:</span>
        <span class="c1">#         ifitmin,ifitmax = np.array(unxmlfitr(ifit),dtype=np.float64)</span>
        <span class="c1">#         tdatarange,ydata = [[]],[]</span>
        <span class="c1">#         for it,tdata in pdata.iteritems():</span>
        <span class="c1">#             tint = untstr(it[3])</span>
        <span class="c1">#             if ifitmin &lt;= tint &lt;= ifitmax:</span>
        <span class="c1">#                 tdatarange[0].append(tint)</span>
        <span class="c1">#                 ydata.append(tdata)</span>
        <span class="c1">#</span>
        <span class="c1">#         # ##debugging</span>
        <span class="c1">#         # print</span>
        <span class="c1">#         # print &#39;FitData:&#39;</span>
        <span class="c1">#         # for it,iy in zip(tdatarange[0],ydata):</span>
        <span class="c1">#         #     print it, iy</span>
        <span class="c1">#         # print</span>
        <span class="c1">#</span>
        <span class="c1">#         if EstDir:</span>
        <span class="c1">#             thisff = ff.Fitting(Funs=[self.Fun,self.npar,&#39;Estimate&#39;],data=[np.array(tdatarange),np.array(ydata)],name=ifit,iGuess=self.iGuess)</span>
        <span class="c1">#         else:</span>
        <span class="c1">#             thisff = ff.Fitting(Funs=[self.Fun,self.npar],data=[np.array(tdatarange),np.array(ydata)],name=ifit,iGuess=self.iGuess)</span>
        <span class="c1">#         thisff.FitBoots()</span>
        <span class="c1">#         ilist.append((igamma,ip,itflow,ifit))</span>
        <span class="c1">#         lFit.append(thisff)</span>
        <span class="c1">#         lFitA.append(thisff.fit_data[&#39;ParamsAvg&#39;])</span>
        <span class="c1">#         lFitS.append(thisff.fit_data[&#39;ParamsStd&#39;])</span>
        <span class="c1"># indicies = pa.MultiIndex.from_tuples(ilist,names=self.RatInt_Fit_Col_Names)</span>
        <span class="c1"># if &#39;boot&#39; in self.RatInt_Fit_Stats.columns:</span>
        <span class="c1">#     this_df = pa.DataFrame()</span>
        <span class="c1">#     this_df.loc[:,&#39;boot&#39;] = pa.Series(lFit,index=indicies)</span>
        <span class="c1">#     this_df.loc[:,&#39;Avg&#39;] = pa.Series(lFitA,index=indicies)</span>
        <span class="c1">#     this_df.loc[:,&#39;Std&#39;] = pa.Series(lFitS,index=indicies)</span>
        <span class="c1">#     self.RatInt_Fit_Stats = self.RatInt_Fit_Stats.append(this_df)</span>
        <span class="c1"># else:</span>
        <span class="c1">#     self.RatInt_Fit_Stats.loc[:,&#39;boot&#39;] = pa.Series(lFit,index=indicies)</span>
        <span class="c1">#     self.RatInt_Fit_Stats.loc[:,&#39;Avg&#39;] = pa.Series(lFitA,index=indicies)</span>
        <span class="c1">#     self.RatInt_Fit_Stats.loc[:,&#39;Std&#39;] = pa.Series(lFitS,index=indicies)</span>


<div class="viewcode-block" id="RatioFOFullCorr.Write"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.Write">[docs]</a>    <span class="k">def</span> <span class="nf">Write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">FixDictArray</span><span class="p">(</span><span class="n">thislist</span><span class="p">,</span><span class="n">ikey</span><span class="p">):</span>
            <span class="n">outDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">ic</span><span class="p">,</span><span class="n">ilist</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">thislist</span><span class="p">):</span>
                <span class="n">outDict</span><span class="p">[</span><span class="n">ikey</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ic</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ilist</span>
            <span class="k">return</span> <span class="n">outDict</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;show_cfgs&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_cfgs</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># C2name = self.C2class.name.replace(self.C2class.jsm,self.C3FOclass.NJN.jsm)</span>
        <span class="c1"># C2LL = self.C2class.LegLab.replace(self.C2class.jsm,self.C3FOclass.NJN.jsm)</span>
        <span class="c1"># self.C2class.SetCustomName(C2name,C2LL)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="p">,</span><span class="s1">&#39;Write&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>

        <span class="n">outDict</span> <span class="o">=</span> <span class="n">ODNested</span><span class="p">()</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="p">,</span><span class="s1">&#39;Write&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;C2file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">HumanFile</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;C3FOfile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">HumanFile</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;kud&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">kud</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ks</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;nt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nt</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;nxyz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nxyz</span>
        <span class="k">for</span> <span class="n">istream</span><span class="p">,</span><span class="n">incfg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">stream_list</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ncfg_list</span><span class="p">):</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ncfg_&#39;</span><span class="o">+</span><span class="n">istream</span><span class="p">]</span> <span class="o">=</span> <span class="n">incfg</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;nxsrc_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">xsrcAvg</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;nMeas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">nMeas</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;nboot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nboot</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;tsrc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">tsrc</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;tsink&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">tsink</span>
        <span class="c1"># outDict[&#39;xsrc&#39;] = FixDictArray(self.xsrc,&#39;xsrc&#39;)</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ism&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ism</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;sink_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">jsm</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;Projector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">Proj</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;Doub_Sing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">DS</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ppmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ppmom</span>

        <span class="k">for</span> <span class="n">ict</span><span class="p">,</span><span class="n">itflow</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">tflowlist</span><span class="p">):</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;t_flow&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ict</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">itflow</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">icg</span><span class="p">,</span><span class="n">igamma</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">gammalist</span><span class="p">):</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icg</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">igamma</span>
        <span class="k">for</span> <span class="n">icq</span><span class="p">,</span><span class="n">iqmom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">qmom</span><span class="p">):</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;qmom&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icq</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">iqmom</span>

        <span class="n">excel_params</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">outDict</span><span class="p">))</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;tflow_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FixDictArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">tflowlist</span><span class="p">,</span><span class="s1">&#39;tflow&#39;</span><span class="p">)</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;gamma_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FixDictArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">gammalist</span><span class="p">,</span><span class="s1">&#39;gamma&#39;</span><span class="p">)</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;qmom_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FixDictArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">qmom</span><span class="p">,</span><span class="s1">&#39;qmom&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ict</span><span class="p">,</span><span class="n">itflow</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">FO</span><span class="o">.</span><span class="n">tflowlist</span><span class="p">):</span>
            <span class="k">del</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;t_flow&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ict</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">icg</span><span class="p">,</span><span class="n">igamma</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">gammalist</span><span class="p">):</span>
            <span class="k">del</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icg</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">icq</span><span class="p">,</span><span class="n">iqmom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">qmom</span><span class="p">):</span>
            <span class="k">del</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;qmom&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">icq</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>

        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">),</span><span class="n">fitdata</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;Fits&#39;</span><span class="p">][</span><span class="n">igamma</span><span class="p">][</span><span class="n">ip</span><span class="p">][</span><span class="n">itflow</span><span class="p">]</span> <span class="o">=</span> <span class="n">fitdata</span><span class="o">.</span><span class="n">GetOutputDict</span><span class="p">()</span>

        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RatInt_Fit_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">ifit</span><span class="p">,</span><span class="n">itflow</span><span class="p">),</span><span class="n">fitdata</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RatInt_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;Fits&#39;</span><span class="p">][</span><span class="n">igamma</span><span class="p">][</span><span class="n">ip</span><span class="p">][</span><span class="n">ifit</span><span class="p">][</span><span class="n">itflow</span><span class="p">]</span> <span class="o">=</span> <span class="n">fitdata</span><span class="o">.</span><span class="n">GetOutputDict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">col_key</span><span class="p">,</span><span class="n">col_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;Avg&#39;</span> <span class="ow">in</span> <span class="n">col_key</span> <span class="ow">or</span> <span class="s1">&#39;Std&#39;</span> <span class="ow">in</span> <span class="n">col_key</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">its</span><span class="p">),</span><span class="n">idata</span> <span class="ow">in</span> <span class="n">col_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">outDict</span><span class="p">[</span><span class="n">col_key</span><span class="p">][</span><span class="n">igamma</span><span class="p">][</span><span class="n">ip</span><span class="p">][</span><span class="n">it</span><span class="p">][</span><span class="n">itflow</span><span class="p">][</span><span class="n">its</span><span class="p">]</span> <span class="o">=</span> <span class="n">AvgStdToFormat</span><span class="p">(</span><span class="n">idata</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span><span class="n">idata</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>


        <span class="k">for</span> <span class="n">col_key</span><span class="p">,</span><span class="n">col_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RatInt_Stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;Avg&#39;</span> <span class="ow">in</span> <span class="n">col_key</span> <span class="ow">or</span> <span class="s1">&#39;Std&#39;</span> <span class="ow">in</span> <span class="n">col_key</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">itflow</span><span class="p">),</span><span class="n">idata</span> <span class="ow">in</span> <span class="n">col_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">outDict</span><span class="p">[</span><span class="n">col_key</span><span class="o">+</span><span class="s1">&#39;_Int&#39;</span><span class="p">][</span><span class="n">igamma</span><span class="p">][</span><span class="n">ip</span><span class="p">][</span><span class="n">it</span><span class="p">][</span><span class="n">itflow</span><span class="p">]</span> <span class="o">=</span> <span class="n">AvgStdToFormat</span><span class="p">(</span><span class="n">idata</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span><span class="n">idata</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>

        <span class="n">y</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;SqrtFact&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SqrtFact</span><span class="p">,</span><span class="s1">&#39;iteritems&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">),</span><span class="n">idata</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SqrtFact</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;SqrtFact&#39;</span><span class="p">][</span><span class="n">ip</span><span class="p">][</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">AvgStdToFormat</span><span class="p">(</span><span class="n">idata</span><span class="o">.</span><span class="n">Avg</span><span class="p">,</span><span class="n">idata</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>


        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ncfg_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cfgs</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">((</span><span class="n">istream</span><span class="p">,</span><span class="n">iccfg</span><span class="p">),</span><span class="n">icfg</span><span class="p">),</span><span class="n">ixsrc_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>   <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJNQFull_cfgs</span><span class="p">[</span><span class="s1">&#39;configs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span>
                                                            <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJNQFull_cfgs</span><span class="p">[</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;cfglist&#39;</span><span class="p">][</span><span class="n">istream</span><span class="p">][</span><span class="n">icfg</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;n_xsrc_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ixsrc_list</span><span class="p">))</span>


        <span class="c1">## Write human readable file with data</span>
        <span class="n">WriteXml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span><span class="p">,{</span><span class="s1">&#39;Results&#39;</span><span class="p">:</span><span class="n">outDict</span><span class="p">})</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">ncfg_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">for</span> <span class="p">((</span><span class="n">istream</span><span class="p">,</span><span class="n">iccfg</span><span class="p">),</span><span class="n">icfg</span><span class="p">),</span><span class="n">ixsrc_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>   <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJNQFull_cfgs</span><span class="p">[</span><span class="s1">&#39;configs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span>
                                                            <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJNQFull_cfgs</span><span class="p">[</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;cfglist&#39;</span><span class="p">][</span><span class="n">istream</span><span class="p">][</span><span class="n">icfg</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;n_xsrc_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ixsrc_list</span><span class="p">))</span>
        <span class="c1">## TODO, include fitting in the excell file</span>
        <span class="n">WriteExcel</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">,{</span><span class="s1">&#39;Rat_results&#39;</span><span class="p">:</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">),</span><span class="s1">&#39;RatInt_results&#39;</span><span class="p">:</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RatInt_Stats</span><span class="p">)},</span>
                    <span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJNQFull_cfgs</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">excel_params</span><span class="p">)</span>

        <span class="c1">## pickles rest of data for reading</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RemoveFuns</span><span class="p">()</span>
        <span class="n">WritePickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GetFuns</span><span class="p">()</span></div>

<div class="viewcode-block" id="RatioFOFullCorr.GetFuns"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.GetFuns">[docs]</a>    <span class="k">def</span> <span class="nf">GetFuns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
                <span class="n">ival</span><span class="o">.</span><span class="n">GetFuns</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="p">,</span><span class="s1">&#39;GetFuns&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">GetFuns</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="p">,</span><span class="s1">&#39;GetFuns&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="o">.</span><span class="n">GetFuns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">GetFuns</span><span class="p">()</span></div>

<div class="viewcode-block" id="RatioFOFullCorr.RemoveFuns"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.RemoveFuns">[docs]</a>    <span class="k">def</span> <span class="nf">RemoveFuns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
                <span class="n">ival</span><span class="o">.</span><span class="n">RemoveFuns</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="p">,</span><span class="s1">&#39;GetFuns&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2class</span><span class="o">.</span><span class="n">RemoveFuns</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="p">,</span><span class="s1">&#39;GetFuns&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2Set</span><span class="o">.</span><span class="n">RemoveFuns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">RemoveFuns</span><span class="p">()</span></div>


    <span class="c1">##################################</span>


<div class="viewcode-block" id="RatioFOFullCorr.ReadAndWrite"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.ReadAndWrite">[docs]</a>    <span class="k">def</span> <span class="nf">ReadAndWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">WipeData</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Read</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CreateC2Sink</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bootstrap</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="n">CheckCfgs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CalcRatio</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span></div>

<div class="viewcode-block" id="RatioFOFullCorr.GetTflowList"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.GetTflowList">[docs]</a>    <span class="k">def</span> <span class="nf">GetTflowList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">load_dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">load_dict</span><span class="p">[</span><span class="s1">&#39;Rat_Stats&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span></div>

<div class="viewcode-block" id="RatioFOFullCorr.FixRead"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.FixRead">[docs]</a>    <span class="k">def</span> <span class="nf">FixRead</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">readdict</span><span class="p">):</span>
        <span class="n">rewrite</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;C2class&#39;</span><span class="p">],</span><span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;C2Set&#39;</span><span class="p">],</span><span class="nb">str</span><span class="p">):</span>
                <span class="n">readdict</span><span class="p">[</span><span class="s1">&#39;C2Set&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Complete&#39;</span>
                <span class="n">rewrite</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">readdict</span><span class="p">,</span><span class="n">rewrite</span></div>

<div class="viewcode-block" id="RatioFOFullCorr.LoadPickle"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.LoadPickle">[docs]</a>    <span class="k">def</span> <span class="nf">LoadPickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">WipeData</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">CheckMom</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># print</span>
        <span class="c1"># print &#39;NJNQ&#39;</span>
        <span class="c1"># print self.HumanFile</span>
        <span class="c1"># print self.PickleFile</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">DefWipe</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading Pickle file &#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span>
            <span class="n">loadeddict</span> <span class="o">=</span> <span class="n">ReadPickleWrap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span>
            <span class="n">checklist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thischecklist</span>
            <span class="n">loadeddict</span><span class="p">,</span><span class="n">rewrite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FixRead</span><span class="p">(</span><span class="n">loadeddict</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">CheckCfgs</span><span class="p">:</span> <span class="n">checklist</span> <span class="o">=</span> <span class="n">checklist</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;cfglist&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">CheckMom</span><span class="p">:</span> <span class="n">checklist</span> <span class="o">=</span> <span class="n">checklist</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;checkmomlist&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;tflow_list&#39;</span> <span class="ow">not</span> <span class="ow">in</span>  <span class="nb">list</span><span class="p">(</span><span class="n">loadeddict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">loadeddict</span><span class="p">[</span><span class="s1">&#39;tflow_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTflowList</span><span class="p">(</span><span class="n">loadeddict</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">CheckClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span><span class="n">loadeddict</span><span class="p">,</span><span class="n">checklist</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">loadeddict</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rewrite</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">Wipe_All_Fits</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">sff</span><span class="o">.</span><span class="n">SetOfFitFuns</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Legacy file, fits need to be recomputed&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;using backupfile for &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExcelFile</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">,</span><span class="s1">&#39;.bak.xlsx&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">,</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">CheckCfgs</span><span class="o">=</span><span class="n">CheckCfgs</span><span class="p">,</span><span class="n">CheckMom</span><span class="o">=</span><span class="n">CheckMom</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning, file &#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HumanFile</span> <span class="p">,</span> <span class="s1">&#39; has different parameters than this instance, reading and writing over file now&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ReadAndWrite</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span>
            <span class="c1"># self.Write()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;pickle file not found: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickleFile</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ReadAndWrite</span><span class="p">(</span><span class="n">WipeData</span><span class="o">=</span><span class="n">WipeData</span><span class="p">,</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span></div>

    <span class="c1">## Routines for Plotting ###############################################</span>

<div class="viewcode-block" id="RatioFOFullCorr.ImportPlotParams"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.ImportPlotParams">[docs]</a>    <span class="k">def</span> <span class="nf">ImportPlotParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thiscol</span><span class="p">,</span><span class="n">thissym</span><span class="p">,</span><span class="n">thisshift</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckCol</span><span class="p">(</span><span class="n">thiscol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckSym</span><span class="p">(</span><span class="n">thissym</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span> <span class="o">=</span> <span class="n">thisshift</span></div>

<div class="viewcode-block" id="RatioFOFullCorr.CheckCol"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.CheckCol">[docs]</a>    <span class="k">def</span> <span class="nf">CheckCol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thiscol</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;PreDefine&#39;</span> <span class="o">==</span> <span class="n">thiscol</span> <span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;Not Set&#39;</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Pass in color to initialize it&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span> <span class="o">=</span> <span class="n">thiscol</span></div>

<div class="viewcode-block" id="RatioFOFullCorr.CheckSym"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.CheckSym">[docs]</a>    <span class="k">def</span> <span class="nf">CheckSym</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thissym</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;PreDefine&#39;</span> <span class="o">==</span> <span class="n">thissym</span> <span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;Not Set&#39;</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">thissym</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Pass in symbol to initialize it&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thissym</span> <span class="o">=</span> <span class="n">thissym</span></div>


<div class="viewcode-block" id="RatioFOFullCorr.GetShift"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.GetShift">[docs]</a>    <span class="k">def</span> <span class="nf">GetShift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">xlims</span><span class="p">,</span><span class="n">thisshift</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">thisshift</span> <span class="o">!=</span> <span class="s1">&#39;PreDefine&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span> <span class="o">=</span> <span class="n">thisshift</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisshiftscale</span> <span class="o">==</span> <span class="s1">&#39;Not Set&#39;</span><span class="p">:</span>
            <span class="n">xlen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xlims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xlims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thisshiftscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span><span class="o">*</span><span class="n">xlen</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisshiftscale</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisshiftscale</span></div>


<div class="viewcode-block" id="RatioFOFullCorr.Importtflow"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.Importtflow">[docs]</a>    <span class="k">def</span> <span class="nf">Importtflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tflowlist</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tflowlist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tflowfit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">tflowfit</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tflowfit</span> <span class="o">=</span> <span class="n">tflowlist</span></div>


    <span class="c1">## make sure all xlims are the same, because this sets the window of xlim (needed for calculating shifts)</span>
    <span class="c1">## gammamomlist is a dictionary where the keys are the gamma matricies, and the values are lists of momenta</span>
<div class="viewcode-block" id="RatioFOFullCorr.Plot"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.Plot">[docs]</a>    <span class="k">def</span> <span class="nf">Plot</span><span class="p">(</span>   <span class="bp">self</span><span class="p">,</span><span class="n">plot_class</span><span class="p">,</span><span class="n">xlims</span><span class="o">=</span><span class="s1">&#39;tsink&#39;</span><span class="p">,</span><span class="n">gammamomlist</span><span class="o">=</span><span class="p">{},</span><span class="n">tflowlist</span> <span class="o">=</span> <span class="p">[],</span><span class="n">tsum_list</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">thiscol</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">,</span><span class="n">thissym</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">xlims</span> <span class="o">==</span> <span class="s1">&#39;tsink&#39;</span><span class="p">:</span> <span class="n">xlims</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">tsink</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;tsink&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckCol</span><span class="p">(</span><span class="n">thiscol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckSym</span><span class="p">(</span><span class="n">thissym</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thisshiftscale</span> <span class="o">=</span> <span class="s1">&#39;Not Set&#39;</span>
        <span class="n">thisshift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetShift</span><span class="p">(</span><span class="n">xlims</span><span class="p">,</span><span class="n">thisshift</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s1">&#39;no data to plot, maybe try to read in and bootstrap before plotting&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">gammamomlist</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gammamomlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defgammamomlist</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tflowlist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">itflow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">tflowlist</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tsum_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tsum_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">its</span><span class="p">)</span> <span class="k">for</span> <span class="n">its</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">boot_tsum_list</span><span class="p">]</span>
        <span class="c1"># for (igamma,ip,itflow),Rat_data in self.Rat_Stats[&#39;boot&#39;].groupby(level=(&#39;current_operator&#39;,&#39;momentum&#39;,&#39;flow_times&#39;)):</span>
        <span class="c1">#     if itflow not in tflowlist: continue</span>
        <span class="c1">#     if igamma not in gammamomlist.keys(): continue</span>
        <span class="c1">#     if ip not in gammamomlist[igamma]: continue</span>
        <span class="n">its</span> <span class="o">=</span> <span class="n">tsum_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">igamma</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gammamomlist</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">TOpform</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">gammamomlist</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">pref</span><span class="o">=</span><span class="s1">&#39;q&#39;</span><span class="p">)</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;qq&#39;</span><span class="p">,</span><span class="s1">&#39;q&#39;</span><span class="p">)</span>

        <span class="n">itflow</span> <span class="o">=</span> <span class="n">tflowlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">its</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reorder_levels</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: data not found to plot&#39;</span><span class="p">,</span> <span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">its</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">plot_class</span>
        <span class="n">databoot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span>
        <span class="n">dataavg</span> <span class="o">=</span> <span class="n">databoot</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">Avg</span><span class="p">)</span>
        <span class="n">dataerr</span> <span class="o">=</span> <span class="n">databoot</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
        <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">its</span><span class="p">)</span>
        <span class="n">tlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">this_key</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tlist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">tlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">it</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">tlist</span><span class="p">]</span>

        <span class="c1"># dataavg,dataerr = [],[]</span>
        <span class="c1"># for idata in databoot[xlims[0]:xlims[1]]:</span>
        <span class="c1">#     dataavg.append(idata.Avg)</span>
        <span class="c1">#     dataerr.append(idata.Std)</span>
        <span class="n">tlist</span> <span class="o">=</span> <span class="n">tlist</span><span class="p">[</span><span class="n">xlims</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">xlims</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="c1"># print &#39;plotting &#39; , igamma,ip</span>
        <span class="c1"># pleg,gammaleg = &#39;&#39;,&#39;&#39;</span>
        <span class="c1"># if len(gammamomlist[igamma]) &gt; 1:</span>
        <span class="c1">#     pleg = &#39; $&#39;+ip+&#39;$&#39;</span>
        <span class="c1"># if len(gammamomlist.keys()) &gt; 1:</span>
        <span class="c1">#     gammaleg = &#39; $&#39;+igamma+&#39;$&#39;</span>
        <span class="c1"># pleg = &#39; $&#39;+ip+&#39;$&#39;</span>
        <span class="c1"># if &#39;_cmplx&#39; in igamma:</span>
        <span class="c1">#     gammaleg = &#39; $i&#39;+igamma.replace(&#39;_cmplx&#39;,&#39;&#39;)+&#39;$&#39;</span>
        <span class="c1"># else:</span>
        <span class="c1">#     gammaleg = &#39; $&#39;+igamma+&#39;$&#39;</span>
        <span class="c1"># tflowleg = &#39; $&#39;+tflowTOLeg(itflow)+&#39;$&#39;</span>
        <span class="c1"># tsumleg = &#39; $&#39;+tsumTOLeg(its)+&#39;$&#39;</span>
        <span class="n">tlistplot</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">centert</span> <span class="o">=</span> <span class="n">CenterT</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">untstr</span><span class="p">,</span><span class="n">tlist</span><span class="p">)))</span><span class="o">-</span><span class="n">twopttshift</span><span class="o">+</span><span class="n">thisshift</span><span class="p">)</span>
        <span class="n">hold_series</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
        <span class="c1"># hold_series[&#39;x_data&#39;] = tlistplot</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;x_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;from_keys&#39;</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;y_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataavg</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;yerr_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataerr</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;xerr_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;key_select&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_key</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;error_bar_vary&#39;</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;fit_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span><span class="c1">#+pleg+gammaleg+tflowleg+tsumleg</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thissym</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;shift&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisshift</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;xaxis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;otherXvals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;xdatarange&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;Phys&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;ShowPar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;fmt_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">KeyForamtting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="p">)</span>
        <span class="n">plot_class</span><span class="o">.</span><span class="n">AppendData</span><span class="p">(</span><span class="n">hold_series</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plot_class</span></div>


    <span class="c1">## make sure all xlims are the same, because this sets the window of xlim (needed for calculating shifts)</span>
    <span class="c1">## gammamomlist is a dictionary where the keys are the gamma matricies, and the values are lists of momenta</span>
<div class="viewcode-block" id="RatioFOFullCorr.PlotTsum"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.PlotTsum">[docs]</a>    <span class="k">def</span> <span class="nf">PlotTsum</span><span class="p">(</span>   <span class="bp">self</span><span class="p">,</span><span class="n">plot_class</span><span class="p">,</span><span class="n">xlims</span><span class="o">=</span><span class="s1">&#39;All&#39;</span><span class="p">,</span><span class="n">gammamomlist</span><span class="o">=</span><span class="p">{},</span><span class="n">tflowlist</span> <span class="o">=</span> <span class="p">[],</span><span class="n">tcurr</span><span class="o">=</span><span class="p">[],</span>
                    <span class="n">thiscol</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">,</span><span class="n">thissym</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">xlims</span> <span class="o">==</span> <span class="s1">&#39;All&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;sym&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">tr_sum_type</span><span class="p">:</span>
                <span class="n">xlims</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xlims</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nt</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckCol</span><span class="p">(</span><span class="n">thiscol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckSym</span><span class="p">(</span><span class="n">thissym</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thisshiftscale</span> <span class="o">=</span> <span class="s1">&#39;Not Set&#39;</span>
        <span class="n">thisshift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetShift</span><span class="p">(</span><span class="n">xlims</span><span class="p">,</span><span class="n">thisshift</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s1">&#39;no data to plot, maybe try to read in and bootstrap before plotting&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">gammamomlist</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gammamomlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defgammamomlist</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tflowlist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tflowlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">tflowlist</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tcurr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tcurr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">tsink</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;tsink&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">//</span><span class="mi">2</span><span class="p">)]</span>
        <span class="c1"># for (igamma,ip,itflow),Rat_data in self.Rat_Stats[&#39;boot&#39;].groupby(level=(&#39;current_operator&#39;,&#39;momentum&#39;,&#39;flow_times&#39;)):</span>
        <span class="c1">#     if itflow not in tflowlist: continue</span>
        <span class="c1">#     if igamma not in gammamomlist.keys(): continue</span>
        <span class="c1">#     if ip not in gammamomlist[igamma]: continue</span>
        <span class="n">it</span> <span class="o">=</span> <span class="n">tcurr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">igamma</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gammamomlist</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">TOpform</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">gammamomlist</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">pref</span><span class="o">=</span><span class="s1">&#39;q&#39;</span><span class="p">)</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;qq&#39;</span><span class="p">,</span><span class="s1">&#39;q&#39;</span><span class="p">)</span>
        <span class="n">itflow</span> <span class="o">=</span> <span class="n">tflowlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">it</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: data not found to plot&#39;</span><span class="p">,</span> <span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">it</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">plot_class</span>
        <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
        <span class="n">databoot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span>
        <span class="n">dataavg</span> <span class="o">=</span> <span class="n">databoot</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">Avg</span><span class="p">)</span>
        <span class="n">dataerr</span> <span class="o">=</span> <span class="n">databoot</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">Std</span><span class="p">)</span>
        <span class="c1"># tslist,databoot = zip(*list(self.Rat_Stats[&#39;boot&#39;][igamma,ip,itflow,it].iteritems()))</span>
        <span class="n">tslist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">this_key</span><span class="p">,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="c1"># dataavg,dataerr = [],[]</span>
        <span class="c1"># for idata in databoot[xlims[0]:xlims[1]]:</span>
        <span class="c1">#     dataavg.append(idata.Avg)</span>
        <span class="c1">#     dataerr.append(idata.Std)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tslist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tslist</span><span class="p">[</span><span class="mi">0</span><span class="p">],(</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">tslist</span> <span class="o">=</span> <span class="p">[</span><span class="n">this_t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">this_t</span> <span class="ow">in</span> <span class="n">tslist</span><span class="p">]</span>
        <span class="n">tslist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">untstr</span><span class="p">,</span><span class="n">tslist</span><span class="p">[</span><span class="n">xlims</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">xlims</span><span class="p">[</span><span class="mi">1</span><span class="p">]])))</span>
        <span class="c1"># print &#39;plotting &#39; , igamma,ip</span>
        <span class="c1"># pleg,gammaleg = &#39;&#39;,&#39;&#39;</span>
        <span class="c1"># if len(gammamomlist[igamma]) &gt; 1:</span>
        <span class="c1">#     pleg = &#39; $&#39;+ip+&#39;$&#39;</span>
        <span class="c1"># if len(gammamomlist.keys()) &gt; 1:</span>
        <span class="c1">#     gammaleg = &#39; $&#39;+igamma+&#39;$&#39;</span>
        <span class="c1"># pleg = &#39; $&#39;+ip+&#39;$&#39;</span>
        <span class="c1"># if &#39;_cmplx&#39; in igamma:</span>
        <span class="c1">#     gammaleg = &#39; $i&#39;+igamma.replace(&#39;_cmplx&#39;,&#39;&#39;)+&#39;$&#39;</span>
        <span class="c1"># else:</span>
        <span class="c1">#     gammaleg = &#39; $&#39;+igamma+&#39;$&#39;</span>
        <span class="c1"># tflowleg = &#39; $&#39;+tflowTOLeg(itflow)+&#39;$&#39;</span>
        <span class="c1"># tleg = &#39; $&#39;+tsinkTOLeg(it)+&#39;$&#39;</span>
        <span class="n">hold_series</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;x_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;from_keys&#39;</span>
        <span class="c1"># hold_series[&#39;x_data&#39;] = tslist</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;y_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataavg</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;yerr_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataerr</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;xerr_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;key_select&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_key</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;error_bar_vary&#39;</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;fit_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LegLab</span><span class="c1">#+pleg+gammaleg+tflowleg+tleg</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thissym</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;shift&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisshift</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;xdatarange&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;xaxis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;otherXvals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;Phys&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;ShowPar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;fmt_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">KeyForamtting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="p">)</span>
        <span class="n">plot_class</span><span class="o">.</span><span class="n">AppendData</span><span class="p">(</span><span class="n">hold_series</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plot_class</span></div>


<div class="viewcode-block" id="RatioFOFullCorr.GetBestFitr"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.GetBestFitr">[docs]</a>    <span class="k">def</span> <span class="nf">GetBestFitr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">itflow</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39; not foun in ratio fit list, cannot find best&#39;</span>
            <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>
        <span class="n">chi_str</span><span class="p">,</span><span class="n">cut_fit_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">at</span><span class="p">[(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">),</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">GetBestChi</span><span class="p">()</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;$\chi^</span><span class="si">{2}</span><span class="s1">_</span><span class="si">{pdf}</span><span class="s1">=</span><span class="si">{:.3f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chi_str</span><span class="p">),</span><span class="n">cut_fit_result</span></div>

    <span class="c1">## state is 1 or 2 state fit</span>
    <span class="c1">## fitr is fit range e.g. fitr5-10</span>
    <span class="c1">## fit range of &#39;Data&#39; is just the original fit range</span>
<div class="viewcode-block" id="RatioFOFullCorr.FitPlot"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.FitPlot">[docs]</a>    <span class="k">def</span> <span class="nf">FitPlot</span><span class="p">(</span>    <span class="bp">self</span><span class="p">,</span><span class="n">plot_class</span><span class="p">,</span><span class="n">fitr</span><span class="p">,</span><span class="n">xlims</span> <span class="o">=</span> <span class="s1">&#39;Data&#39;</span><span class="p">,</span><span class="n">tsum_list</span><span class="o">=</span><span class="p">[],</span><span class="n">gammamomlist</span><span class="o">=</span><span class="p">{},</span>
                    <span class="n">tflowlist</span> <span class="o">=</span> <span class="p">[],</span><span class="n">thiscol</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckCol</span><span class="p">(</span><span class="n">thiscol</span><span class="p">)</span>
        <span class="n">thisshift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetShift</span><span class="p">(</span><span class="n">xlims</span><span class="p">,</span><span class="n">thisshift</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Importtflow</span><span class="p">(</span><span class="n">tflowlist</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">centert</span> <span class="o">==</span> <span class="s1">&#39;Not Set&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;print centert not set, defaulting to 0&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">centert</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="c1"># raise IOError(&#39;Run Plot() before running FitPlot() to find the center value&#39;)</span>
        <span class="c1"># if &#39;boot&#39; not in self.Rat_Fit_Stats.columns:</span>
        <span class="c1">#     raise EnvironmentError(&#39;No fitting has been done, maybe try to Fit before plotting fit&#39;)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">gammamomlist</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gammamomlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defgammamomlist</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tflowlist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tflowlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">tflowlist</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tsum_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tsum_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">its</span> <span class="k">for</span> <span class="n">its</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">boot_tsum_list</span><span class="p">]</span>
        <span class="c1"># if (igamma,ip,fitr) not in self.Rat_Fit_Stats.index:</span>
        <span class="c1"># for igamma,momlist in gammamomlist.iteritems():</span>
        <span class="c1">#     for ip in momlist:</span>
        <span class="c1">#         for itflow in tflowlist:</span>
        <span class="n">igamma</span><span class="p">,</span><span class="n">momlist</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">gammamomlist</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">TOpform</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">gammamomlist</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">pref</span><span class="o">=</span><span class="s1">&#39;q&#39;</span><span class="p">)</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;qq&#39;</span><span class="p">,</span><span class="s1">&#39;q&#39;</span><span class="p">)</span>
        <span class="n">itflow</span> <span class="o">=</span> <span class="n">tflowlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">itsum</span> <span class="o">=</span> <span class="n">tsum_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fitr</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">fitr</span> <span class="o">=</span> <span class="n">fitr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">itsum</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">itsum</span> <span class="o">=</span> <span class="n">untstr</span><span class="p">(</span><span class="n">itsum</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fitr</span> <span class="o">==</span> <span class="s1">&#39;Best&#39;</span><span class="p">:</span>
            <span class="n">chi_legend</span><span class="p">,</span><span class="n">fitr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetBestFitr</span><span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no fits done, attempting fit now&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">fit_range</span><span class="o">=</span><span class="n">fitr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">tsum_ranges</span><span class="o">=</span><span class="n">fitr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">fit_data</span> <span class="o">=</span> <span class="n">sff</span><span class="o">.</span><span class="n">PullSOFSeries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
        <span class="n">fit_data</span> <span class="o">=</span> <span class="n">Series_fix_key</span><span class="p">(</span><span class="n">fit_data</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;fittwor&#39;</span><span class="p">,</span><span class="s1">&#39;tsumfitr&#39;</span><span class="p">)</span>
        <span class="n">this_fun</span> <span class="o">=</span> <span class="n">fit_data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">this_fun</span><span class="p">,</span><span class="n">fitr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fitr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">this_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fit_data</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">this_key</span> <span class="p">,</span> <span class="s1">&#39;not present in Rat Fit Stats, fitting now&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">fit_range</span><span class="o">=</span><span class="n">fitr</span><span class="p">)</span>
            <span class="n">fit_data</span> <span class="o">=</span> <span class="n">sff</span><span class="o">.</span><span class="n">PullSOFSeries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
            <span class="n">fit_data</span> <span class="o">=</span> <span class="n">Series_fix_key</span><span class="p">(</span><span class="n">fit_data</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;fittwor&#39;</span><span class="p">,</span><span class="s1">&#39;tsumfitr&#39;</span><span class="p">)</span>
            <span class="n">this_fun</span> <span class="o">=</span> <span class="n">fit_data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">this_fun</span><span class="p">,</span><span class="n">fitr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fitr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">hold_series</span> <span class="o">=</span> <span class="n">null_series</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;key_select&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_key</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;fit_vary&#39;</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;fit_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit_data</span>
        <span class="c1"># hold_series[&#39;label&#39;] = fit_data[this_key].name +&#39; &#39; + chi_legend</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ACTUAL_VALUE_fit&#39;</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thissym</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;shift&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisshift</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;xaxis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;xdatarange&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xlims</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;otherXvals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">itsum</span><span class="p">]</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;ShowPar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Par1&#39;</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;fmt_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">KeyForamtting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="p">)</span>
        <span class="n">plot_class</span><span class="o">.</span><span class="n">AppendData</span><span class="p">(</span><span class="n">hold_series</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plot_class</span></div>

                                    <span class="c1">## state is 1 or 2 state fit</span>
    <span class="c1">## fitr is fit range e.g. fitr5-10</span>
    <span class="c1">## fit range of &#39;Data&#39; is just the original fit range</span>
<div class="viewcode-block" id="RatioFOFullCorr.FitSumPlot"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.FitSumPlot">[docs]</a>    <span class="k">def</span> <span class="nf">FitSumPlot</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span><span class="n">plot_class</span><span class="p">,</span><span class="n">fitr</span><span class="p">,</span><span class="n">xlims</span> <span class="o">=</span> <span class="s1">&#39;Data&#39;</span><span class="p">,</span><span class="n">tcurr</span><span class="o">=</span><span class="p">[],</span><span class="n">gammamomlist</span><span class="o">=</span><span class="p">{},</span>
                    <span class="n">tflowlist</span> <span class="o">=</span> <span class="p">[],</span><span class="n">thiscol</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="s1">&#39;PreDefine&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckCol</span><span class="p">(</span><span class="n">thiscol</span><span class="p">)</span>
        <span class="n">thisshift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetShift</span><span class="p">(</span><span class="n">xlims</span><span class="p">,</span><span class="n">thisshift</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Importtflow</span><span class="p">(</span><span class="n">tflowlist</span><span class="p">)</span>
        <span class="c1"># if &#39;boot&#39; not in self.Rat_Fit_Stats.columns:</span>
        <span class="c1">#     raise EnvironmentError(&#39;No fitting has been done, maybe try to Fit before plotting fit&#39;)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">gammamomlist</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gammamomlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defgammamomlist</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tflowlist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tflowlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">tflowlist</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tcurr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tcurr</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3FOclass</span><span class="o">.</span><span class="n">NJN</span><span class="o">.</span><span class="n">tsink</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;tsink&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span>
        <span class="c1"># if (igamma,ip,fitr) not in self.Rat_Fit_Stats.index:</span>
        <span class="c1"># for igamma,momlist in gammamomlist.iteritems():</span>
        <span class="c1">#     for ip in momlist:</span>
        <span class="c1">#         for itflow in tflowlist:</span>
        <span class="n">igamma</span><span class="p">,</span><span class="n">momlist</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">gammamomlist</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="o">.</span><span class="n">TOpform</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">gammamomlist</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">pref</span><span class="o">=</span><span class="s1">&#39;q&#39;</span><span class="p">)</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;qq&#39;</span><span class="p">,</span><span class="s1">&#39;q&#39;</span><span class="p">)</span>
        <span class="n">itflow</span> <span class="o">=</span> <span class="n">tflowlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tcurr</span> <span class="o">=</span> <span class="n">tcurr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fitr</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">fitr</span> <span class="o">=</span> <span class="n">fitr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tcurr</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">tcurr</span> <span class="o">=</span> <span class="n">untstr</span><span class="p">(</span><span class="n">tcurr</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no fits done, attempting fit now&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">fit_range</span><span class="o">=</span><span class="n">fitr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">tsum_ranges</span><span class="o">=</span><span class="n">fitr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">fit_data</span> <span class="o">=</span> <span class="n">sff</span><span class="o">.</span><span class="n">PullSOFSeries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
        <span class="n">fit_data</span> <span class="o">=</span> <span class="n">Series_fix_key</span><span class="p">(</span><span class="n">fit_data</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;fittwor&#39;</span><span class="p">,</span><span class="s1">&#39;tsumfitr&#39;</span><span class="p">)</span>
        <span class="n">this_fun</span> <span class="o">=</span> <span class="n">fit_data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">this_fun</span><span class="p">,</span><span class="n">fitr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fitr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">this_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fit_data</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">this_key</span> <span class="p">,</span> <span class="s1">&#39;not present in Rat Fit Stats, fitting now&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">fit_range</span><span class="o">=</span><span class="n">fitr</span><span class="p">)</span>
            <span class="n">fit_data</span> <span class="o">=</span> <span class="n">sff</span><span class="o">.</span><span class="n">PullSOFSeries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Fit_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
            <span class="n">fit_data</span> <span class="o">=</span> <span class="n">Series_fix_key</span><span class="p">(</span><span class="n">fit_data</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;fittwor&#39;</span><span class="p">,</span><span class="s1">&#39;tsumfitr&#39;</span><span class="p">)</span>
            <span class="n">this_fun</span> <span class="o">=</span> <span class="n">fit_data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">this_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">this_fun</span><span class="p">,</span><span class="n">fitr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fitr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">hold_series</span> <span class="o">=</span> <span class="n">null_series</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;fit_vary&#39;</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;fit_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit_data</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;key_select&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_key</span>
        <span class="c1"># hold_series[&#39;label&#39;] = fit_class[this_key].name</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ACTUAL_VALUE_fit&#39;</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thissym</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;shift&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisshift</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;xdatarange&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xlims</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;xaxis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;otherXvals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">tcurr</span><span class="p">]</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;ShowPar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Par1&#39;</span>
        <span class="n">hold_series</span><span class="p">[</span><span class="s1">&#39;fmt_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">KeyForamtting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latparams</span><span class="p">)</span>
        <span class="n">plot_class</span><span class="o">.</span><span class="n">AppendData</span><span class="p">(</span><span class="n">hold_series</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plot_class</span></div>




    <span class="c1">## ##################### ###############################################</span>


    <span class="c1">## Comparisons</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">SubDir</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="RatioFOFullCorr.iteritems"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.iteritems">[docs]</a>    <span class="k">def</span> <span class="nf">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span></div>

<div class="viewcode-block" id="RatioFOFullCorr.items"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.items">[docs]</a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span></div>

<div class="viewcode-block" id="RatioFOFullCorr.itemsAvgStd"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.itemsAvgStd">[docs]</a>    <span class="k">def</span> <span class="nf">itemsAvgStd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">outlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ivals</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
            <span class="n">outlist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ivals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ivals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">ivals</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">outlist</span></div>

<div class="viewcode-block" id="RatioFOFullCorr.values"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.values">[docs]</a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span></div>

<div class="viewcode-block" id="RatioFOFullCorr.itervalues"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.itervalues">[docs]</a>    <span class="k">def</span> <span class="nf">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span></div>

<div class="viewcode-block" id="RatioFOFullCorr.valuesAvgStd"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.valuesAvgStd">[docs]</a>    <span class="k">def</span> <span class="nf">valuesAvgStd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">outlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ivals</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
            <span class="n">outlist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ivals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">ivals</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">outlist</span></div>

<div class="viewcode-block" id="RatioFOFullCorr.keys"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">index</span></div>


    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__reversed__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">iiloc</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span>




    <span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thiskey</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">thiskey</span><span class="p">]</span>

    <span class="c1">## unitary arithmetic operations</span>

    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span>


    <span class="k">def</span> <span class="nf">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1">## Casting, just casts the bootstrap values, ignore return value (only needed since return has to be same type).</span>


    <span class="k">def</span> <span class="nf">__complex__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="nb">complex</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">+</span><span class="mi">0</span><span class="n">j</span>

    <span class="k">def</span> <span class="nf">__int__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__float__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">ival</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span>
        <span class="k">return</span> <span class="mf">1.0</span>


<div class="viewcode-block" id="RatioFOFullCorr.ReduceIndicies"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.ReduceIndicies">[docs]</a>    <span class="k">def</span> <span class="nf">ReduceIndicies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">indexl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">its</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">first_gamma</span> <span class="o">=</span> <span class="n">MultiSplit</span><span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">op_str_list</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;FO&#39;</span><span class="p">,</span><span class="s1">&#39;FOFull&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">this_gamma</span> <span class="o">=</span> <span class="n">first_gamma</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;FO&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">this_gamma</span> <span class="o">=</span> <span class="n">this_gamma</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;FOFull&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">this_gamma</span> <span class="o">=</span> <span class="n">this_gamma</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">this_gamma</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span>
                <span class="n">this_gamma</span> <span class="o">=</span> <span class="n">this_gamma</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">this_p</span> <span class="o">=</span> <span class="n">MultiSplit</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">op_str_list</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;FO&#39;</span><span class="p">,</span><span class="s1">&#39;FOFull&#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">indexl</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">this_gamma</span><span class="p">,</span><span class="n">this_p</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">its</span><span class="p">))</span>
        <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">indexl</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Col_Names</span><span class="p">)</span>
        <span class="n">this_series</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_series</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Stats</span><span class="p">()</span></div>


<div class="viewcode-block" id="RatioFOFullCorr.sin"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.sin">[docs]</a>    <span class="k">def</span> <span class="nf">sin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">RatioFOFullCorr</span><span class="p">(</span><span class="n">thisnboot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">,</span> <span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span><span class="p">[[</span><span class="s1">&#39;configs&#39;</span><span class="p">,</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]],</span>
                         <span class="n">Info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">,</span><span class="n">thissym</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thissym</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span><span class="p">,</span>
                         <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;sin(&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;sin_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">Rat_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="RatioFOFullCorr.cos"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.cos">[docs]</a>    <span class="k">def</span> <span class="nf">cos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">RatioFOFullCorr</span><span class="p">(</span><span class="n">thisnboot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">,</span> <span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span><span class="p">[[</span><span class="s1">&#39;configs&#39;</span><span class="p">,</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]],</span>
                         <span class="n">Info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">,</span><span class="n">thissym</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thissym</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span><span class="p">,</span>
                         <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;cos(&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;cos_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">Rat_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="RatioFOFullCorr.Overload_wrap"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.RatioFOFullCorr.Overload_wrap">[docs]</a>    <span class="k">def</span> <span class="nf">Overload_wrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">,</span><span class="n">this_fun</span><span class="p">):</span>
        <span class="c1">## TODO, include some name and filename formatting</span>
        <span class="n">thisname</span><span class="p">,</span><span class="n">thisfilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">):</span>
            <span class="n">thisname</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">Rat2</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="s1">&#39;filename&#39;</span><span class="p">):</span>
            <span class="n">thisfilename</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">Rat2</span><span class="o">.</span><span class="n">filename</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">RatioFOFullCorr</span><span class="p">(</span>   <span class="n">thisnboot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nboot</span><span class="p">,</span> <span class="n">cfglist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfglist</span><span class="p">[[</span><span class="s1">&#39;configs&#39;</span><span class="p">,</span><span class="s1">&#39;xsrc_list&#39;</span><span class="p">]],</span>
                                    <span class="n">Info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="p">,</span><span class="n">thissym</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thissym</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thiscol</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thisshift</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">Rat_Stats</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">])</span>
        <span class="c1"># result.UpdateName(&#39;+&#39;,self,Rat2)</span>
        <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">RatioFOFullCorr</span><span class="p">):</span>
                <span class="c1"># result.Rat_Stats.loc[:,&#39;boot&#39;] = this_fun(self.Rat_Stats.loc[:,&#39;boot&#39;],Rat2.Rat_Stats.loc[:,&#39;boot&#39;])</span>
                <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="n">Rat2</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">:</span>
                    <span class="n">vall</span><span class="p">,</span><span class="n">ilist</span> <span class="o">=</span> <span class="p">[],[]</span>
                    <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">its</span><span class="p">),</span><span class="n">irat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">its</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">itflow</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Rat2</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
                            <span class="n">out_str</span> <span class="o">=</span> <span class="s1">&#39; missmatch in euclidian times / flow time / op times </span><span class="se">\</span>
<span class="s1">                                        when combining ratio functions </span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="n">out_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="n">out_str</span> <span class="o">+=</span> <span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="n">out_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Rat2</span><span class="p">)</span>
                            <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="n">out_str</span><span class="p">)</span>
                        <span class="k">for</span> <span class="p">(</span><span class="n">igamma2</span><span class="p">,</span><span class="n">ip2</span><span class="p">,</span><span class="n">itflowdump</span><span class="p">,</span><span class="n">itdump</span><span class="p">,</span><span class="n">itsdump</span><span class="p">),</span><span class="n">irat2</span> <span class="ow">in</span> <span class="n">Rat2</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">itflow</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">its</span><span class="p">),</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">igammacomb</span><span class="p">,</span><span class="n">ipcomb</span> <span class="o">=</span> <span class="n">igamma</span><span class="p">,</span><span class="n">ip</span>
                            <span class="k">if</span> <span class="n">igamma2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">igamma</span><span class="p">:</span>
                                <span class="n">igammacomb</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">igamma2</span>
                            <span class="k">if</span> <span class="n">ip2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ip</span><span class="p">:</span>
                                <span class="n">ipcomb</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">ip2</span>
                            <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">igammacomb</span><span class="p">,</span><span class="n">ipcomb</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">its</span><span class="p">))</span>
                            <span class="n">vall</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_fun</span><span class="p">(</span><span class="n">irat</span><span class="p">,</span><span class="n">irat2</span><span class="p">))</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Col_Names</span><span class="p">)</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">vall</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s1">&#39;Run Bootstrap on second class before combining ratio functions&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">RatioFOCorr</span><span class="p">):</span>
                <span class="c1"># result.Rat_Stats.loc[:,&#39;boot&#39;] = this_fun(self.Rat_Stats.loc[:,&#39;boot&#39;],Rat2.Rat_Stats.loc[:,&#39;boot&#39;])</span>
                <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="n">Rat2</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">:</span>
                    <span class="n">vall</span><span class="p">,</span><span class="n">ilist</span> <span class="o">=</span> <span class="p">[],[]</span>
                    <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">its</span><span class="p">),</span><span class="n">irat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">it</span><span class="p">,</span><span class="n">itflow</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Rat2</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
                            <span class="n">out_str</span> <span class="o">=</span> <span class="s1">&#39;missmatch in euclidian times / flow times when combining ratio functions </span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="n">out_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="n">out_str</span> <span class="o">+=</span> <span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="n">out_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Rat2</span><span class="p">)</span>
                            <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="n">out_str</span><span class="p">)</span>
                        <span class="k">for</span> <span class="p">(</span><span class="n">igamma2</span><span class="p">,</span><span class="n">ip2</span><span class="p">,</span><span class="n">itflowdump</span><span class="p">,</span><span class="n">itdump</span><span class="p">),</span><span class="n">irat2</span> <span class="ow">in</span> <span class="n">Rat2</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">itflow</span><span class="p">,</span><span class="n">it</span><span class="p">),</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">igammacomb</span><span class="p">,</span><span class="n">ipcomb</span> <span class="o">=</span> <span class="n">igamma</span><span class="o">+</span><span class="s1">&#39;_FOFull_&#39;</span><span class="p">,</span><span class="n">ip</span>
                            <span class="n">igammacomb</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">igamma2</span><span class="o">+</span><span class="s1">&#39;_FO&#39;</span>
                            <span class="k">if</span> <span class="n">ip2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ip</span><span class="p">:</span>
                                <span class="n">ipcomb</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">ip2</span>
                            <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">igammacomb</span><span class="p">,</span><span class="n">ipcomb</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">its</span><span class="p">))</span>
                            <span class="n">vall</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_fun</span><span class="p">(</span><span class="n">irat</span><span class="p">,</span><span class="n">irat2</span><span class="p">))</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Col_Names</span><span class="p">)</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">vall</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s1">&#39;Run Bootstrap on second class before combining ratio functions&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">RatioCorr</span><span class="p">):</span>
                <span class="c1"># result.Rat_Stats.loc[:,&#39;boot&#39;] = this_fun(self.Rat_Stats.loc[:,&#39;boot&#39;],Rat2.Rat_Stats.loc[:,&#39;boot&#39;])</span>
                <span class="k">if</span> <span class="s1">&#39;boot&#39;</span> <span class="ow">in</span> <span class="n">Rat2</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">:</span>
                    <span class="n">vall</span><span class="p">,</span><span class="n">ilist</span> <span class="o">=</span> <span class="p">[],[]</span>
                    <span class="k">for</span> <span class="p">(</span><span class="n">igamma</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">its</span><span class="p">),</span><span class="n">irat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">it</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Rat2</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">[</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
                            <span class="n">out_str</span> <span class="o">=</span> <span class="s1">&#39;missmatch in euclidian times when combining ratio functions </span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="n">out_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="n">out_str</span> <span class="o">+=</span> <span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="n">out_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Rat2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="n">out_str</span> <span class="o">+=</span> <span class="n">it</span>
                            <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="n">out_str</span><span class="p">)</span>
                        <span class="k">for</span> <span class="p">(</span><span class="n">igamma2</span><span class="p">,</span><span class="n">ip2</span><span class="p">,</span><span class="n">itdump</span><span class="p">),</span><span class="n">irat2</span> <span class="ow">in</span> <span class="n">Rat2</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">it</span><span class="p">),</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">igammacomb</span><span class="p">,</span><span class="n">ipcomb</span> <span class="o">=</span> <span class="n">igamma</span><span class="o">+</span><span class="s1">&#39;_FOFull_&#39;</span><span class="p">,</span><span class="n">ip</span>
                            <span class="c1"># if igamma != igamma2:</span>
                            <span class="n">igammacomb</span> <span class="o">+=</span> <span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">igamma2</span>
                            <span class="k">if</span> <span class="n">ip2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ip</span><span class="p">:</span>
                                <span class="n">ipcomb</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">this_fun</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">ip2</span>
                            <span class="n">ilist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">igammacomb</span><span class="p">,</span><span class="n">ipcomb</span><span class="p">,</span><span class="n">itflow</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">its</span><span class="p">))</span>
                            <span class="n">vall</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_fun</span><span class="p">(</span><span class="n">irat</span><span class="p">,</span><span class="n">irat2</span><span class="p">))</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">indicies</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Col_Names</span><span class="p">)</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">vall</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">indicies</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s1">&#39;Run Bootstrap on second class before combining ratio functions&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_fun</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;boot&#39;</span><span class="p">],</span> <span class="n">Rat2</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">),</span> <span class="n">Rat2</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rat_Stats</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Invalid value to combine with RatioFOCorr class&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s1">&#39;Run Bootstrap on first class before combining ratio functions&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioFOFullCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">op</span><span class="o">.</span><span class="n">add</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioFOFullCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">op</span><span class="o">.</span><span class="n">sub</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioFOFullCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">op</span><span class="o">.</span><span class="n">mul</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioFOFullCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="n">__rdiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">op</span><span class="o">.</span><span class="n">truediv</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioFOFullCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="fm">__rpow__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">op</span><span class="o">.</span><span class="n">pow</span><span class="p">)</span>


    <span class="c1">## Right multiplication functions</span>


    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioFOFullCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">flip_fun_2arg</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">add</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioFOFullCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">flip_fun_2arg</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">sub</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioFOFullCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">flip_fun_2arg</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">mul</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rdiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioFOFullCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="n">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">flip_fun_2arg</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">truediv</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">__rpow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rat2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">ipar</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Rat2</span><span class="p">))</span> <span class="k">for</span> <span class="n">ipar</span> <span class="ow">in</span> <span class="n">RatioFOFullCorr</span><span class="o">.</span><span class="n">parentlist</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">Rat2</span><span class="o">.</span><span class="fm">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Overload_wrap</span><span class="p">(</span><span class="n">Rat2</span><span class="p">,</span><span class="n">flip_fun_2arg</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">pow</span><span class="p">))</span></div>




    <span class="c1">## Operator overloading Starting to get tedious, leave to last or think of better way of implementing (maybe use predefined funtion passed in?)</span>

<div class="viewcode-block" id="TestRat"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.TestRat">[docs]</a><span class="k">def</span> <span class="nf">TestRat</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">Params</span> <span class="k">import</span> <span class="n">defInfo</span>
    <span class="n">defInfo</span><span class="p">[</span><span class="s1">&#39;gammas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;g4&#39;</span><span class="p">]</span>
    <span class="n">defInfo</span><span class="p">[</span><span class="s1">&#39;qmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0 0 0&#39;</span><span class="p">]</span>
    <span class="n">defInfo</span><span class="p">[</span><span class="s1">&#39;Projector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;P4&#39;</span>
    <span class="n">this_info</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
    <span class="n">this_info</span><span class="p">[</span><span class="s1">&#39;save_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_dir</span><span class="o">+</span><span class="s1">&#39;/TestGraphs/testRat.pdf&#39;</span>
    <span class="n">this_info</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Test Ratio&#39;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">RatioCorr</span><span class="p">(</span><span class="n">Info</span><span class="o">=</span><span class="n">defInfo</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">PlotData</span> <span class="k">as</span> <span class="nn">jpl</span>
    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">jpl</span><span class="o">.</span><span class="n">Plotting</span><span class="p">(</span><span class="n">plot_info</span><span class="o">=</span><span class="n">this_info</span><span class="p">)</span>
    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Plot</span><span class="p">(</span><span class="n">data_plot</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="s1">&#39;Blue&#39;</span><span class="p">,</span><span class="n">thissym</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">FitPlot</span><span class="p">(</span><span class="n">data_plot</span><span class="p">,</span><span class="n">defInfo</span><span class="p">[</span><span class="s1">&#39;FitsRF&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">data_plot</span><span class="o">.</span><span class="n">PrintData</span><span class="p">()</span>
    <span class="n">data_plot</span><span class="o">.</span><span class="n">PlotAll</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="TestRat2"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.TestRat2">[docs]</a><span class="k">def</span> <span class="nf">TestRat2</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">Params</span> <span class="k">import</span> <span class="n">defInfo</span>
    <span class="n">defInfo</span><span class="p">[</span><span class="s1">&#39;gammas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;g3g5_cmplx&#39;</span><span class="p">]</span>
    <span class="n">defInfo</span><span class="p">[</span><span class="s1">&#39;qmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0 0 0&#39;</span><span class="p">]</span>
    <span class="n">defInfo</span><span class="p">[</span><span class="s1">&#39;Projector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;P3&#39;</span>
    <span class="n">this_info</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
    <span class="n">this_info</span><span class="p">[</span><span class="s1">&#39;save_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_dir</span><span class="o">+</span><span class="s1">&#39;/TestGraphs/testRat2.pdf&#39;</span>
    <span class="n">this_info</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Test Ratio2&#39;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">RatioCorr</span><span class="p">(</span><span class="n">Info</span><span class="o">=</span><span class="n">defInfo</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">PlotData</span> <span class="k">as</span> <span class="nn">jpl</span>
    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">jpl</span><span class="o">.</span><span class="n">Plotting</span><span class="p">(</span><span class="n">plot_info</span><span class="o">=</span><span class="n">this_info</span><span class="p">)</span>
    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Plot</span><span class="p">(</span><span class="n">data_plot</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="s1">&#39;Blue&#39;</span><span class="p">,</span><span class="n">thissym</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">FitPlot</span><span class="p">(</span><span class="n">data_plot</span><span class="p">,</span><span class="n">defInfo</span><span class="p">[</span><span class="s1">&#39;FitsRF&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">data_plot</span><span class="o">.</span><span class="n">PrintData</span><span class="p">()</span>
    <span class="n">data_plot</span><span class="o">.</span><span class="n">PlotAll</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="TestRatFO"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.TestRatFO">[docs]</a><span class="k">def</span> <span class="nf">TestRatFO</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">Params</span> <span class="k">import</span> <span class="n">defInfoFlow</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;gammas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;g4&#39;</span><span class="p">]</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;qmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0 0 1&#39;</span><span class="p">]</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;Projector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;P3&#39;</span>
    <span class="n">this_info</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
    <span class="n">this_info</span><span class="p">[</span><span class="s1">&#39;save_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_dir</span><span class="o">+</span><span class="s1">&#39;/TestGraphs/testRatFO.pdf&#39;</span>
    <span class="n">this_info</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Test Ratio FO&#39;</span>
    <span class="n">dataflow</span> <span class="o">=</span> <span class="n">RatioFOCorr</span><span class="p">(</span><span class="n">Info</span><span class="o">=</span><span class="n">defInfoFlow</span><span class="p">)</span>
    <span class="n">dataflow</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">PlotData</span> <span class="k">as</span> <span class="nn">jpl</span>
    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">jpl</span><span class="o">.</span><span class="n">Plotting</span><span class="p">(</span><span class="n">plot_info</span><span class="o">=</span><span class="n">this_info</span><span class="p">)</span>
    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">dataflow</span><span class="o">.</span><span class="n">Plot</span><span class="p">(</span><span class="n">data_plot</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="s1">&#39;Blue&#39;</span><span class="p">,</span><span class="n">thissym</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">tflowlist</span><span class="o">=</span><span class="p">[</span><span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;tflowfit&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">dataflow</span><span class="o">.</span><span class="n">FitPlot</span><span class="p">(</span><span class="n">data_plot</span><span class="p">,</span><span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;FitsRF&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">tflowlist</span><span class="o">=</span><span class="p">[</span><span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;tflowfit&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">data_plot</span><span class="o">.</span><span class="n">PrintData</span><span class="p">()</span>
    <span class="n">data_plot</span><span class="o">.</span><span class="n">PlotAll</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">dataflow</span></div>


<div class="viewcode-block" id="TestRatFO2"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.TestRatFO2">[docs]</a><span class="k">def</span> <span class="nf">TestRatFO2</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">Params</span> <span class="k">import</span> <span class="n">defInfoFlow</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;gammas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;g4&#39;</span><span class="p">]</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;qmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0 1 -1&#39;</span><span class="p">]</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;Projector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;P3&#39;</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;tflowlist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;t_f4.01&#39;</span><span class="p">,</span><span class="s1">&#39;t_f5.01&#39;</span><span class="p">,</span><span class="s1">&#39;t_f6.01&#39;</span><span class="p">])</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;tflowfit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;tflowlist&#39;</span><span class="p">]</span>
    <span class="n">this_info</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
    <span class="n">this_info</span><span class="p">[</span><span class="s1">&#39;save_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_dir</span><span class="o">+</span><span class="s1">&#39;/TestGraphs/testRatFO2.pdf&#39;</span>
    <span class="n">this_info</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Test Ratio FO2&#39;</span>
    <span class="n">dataflow</span> <span class="o">=</span> <span class="n">RatioFOCorr</span><span class="p">(</span><span class="n">Info</span><span class="o">=</span><span class="n">defInfoFlow</span><span class="p">)</span>
    <span class="n">dataflow</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">PlotData</span> <span class="k">as</span> <span class="nn">jpl</span>
    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">jpl</span><span class="o">.</span><span class="n">Plotting</span><span class="p">(</span><span class="n">plot_info</span><span class="o">=</span><span class="n">this_info</span><span class="p">)</span>
    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">dataflow</span><span class="o">.</span><span class="n">Plot</span><span class="p">(</span><span class="n">data_plot</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="s1">&#39;Blue&#39;</span><span class="p">,</span><span class="n">thissym</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">tflowlist</span><span class="o">=</span><span class="p">[</span><span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;tflowfit&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">dataflow</span><span class="o">.</span><span class="n">FitPlot</span><span class="p">(</span><span class="n">data_plot</span><span class="p">,</span><span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;FitsRF&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">tflowlist</span><span class="o">=</span><span class="p">[</span><span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;tflowfit&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">data_plot</span><span class="o">.</span><span class="n">PrintData</span><span class="p">()</span>
    <span class="n">data_plot</span><span class="o">.</span><span class="n">PlotAll</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">dataflow</span></div>

<div class="viewcode-block" id="TestRatFOFull"><a class="viewcode-back" href="../RatioCorrelators.html#RatioCorrelators.TestRatFOFull">[docs]</a><span class="k">def</span> <span class="nf">TestRatFOFull</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">Params</span> <span class="k">import</span> <span class="n">defInfoFlow</span>
    <span class="n">this_info</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
    <span class="n">this_info</span><span class="p">[</span><span class="s1">&#39;save_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_dir</span><span class="o">+</span><span class="s1">&#39;/TestGraphs/testRatFOFull.pdf&#39;</span>
    <span class="n">this_info</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Test Ratio FOFull&#39;</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;DoubSing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Neutron&#39;</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;gammas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;g4&#39;</span><span class="p">]</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;qmom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0 0 1&#39;</span><span class="p">]</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;Projector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;P3&#39;</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;tflowlist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;t_f4.01&#39;</span><span class="p">,</span><span class="s1">&#39;t_f5.01&#39;</span><span class="p">,</span><span class="s1">&#39;t_f6.01&#39;</span><span class="p">])</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;tflowfit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;tflowlist&#39;</span><span class="p">]</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;tsum_fit_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ts28&#39;</span><span class="p">,</span><span class="s1">&#39;ts29&#39;</span><span class="p">,</span><span class="s1">&#39;ts30&#39;</span><span class="p">,</span><span class="s1">&#39;ts31&#39;</span><span class="p">,</span><span class="s1">&#39;ts32&#39;</span><span class="p">]</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;tsum_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ts28&#39;</span><span class="p">,</span><span class="s1">&#39;ts30&#39;</span><span class="p">,</span><span class="s1">&#39;ts32&#39;</span><span class="p">]</span>
    <span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;FitsRFFull&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;taufitr4-8&#39;</span><span class="p">,</span><span class="s1">&#39;tsumfitr28-32&#39;</span><span class="p">)]</span>
    <span class="n">dataflow</span> <span class="o">=</span> <span class="n">RatioFOFullCorr</span><span class="p">(</span><span class="n">Info</span><span class="o">=</span><span class="n">defInfoFlow</span><span class="p">)</span>
    <span class="n">dataflow</span><span class="o">.</span><span class="n">LoadPickle</span><span class="p">(</span><span class="n">DefWipe</span><span class="o">=</span><span class="n">DefWipe</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">PlotData</span> <span class="k">as</span> <span class="nn">jpl</span>
    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">jpl</span><span class="o">.</span><span class="n">Plotting</span><span class="p">(</span><span class="n">plot_info</span><span class="o">=</span><span class="n">this_info</span><span class="p">)</span>
    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">dataflow</span><span class="o">.</span><span class="n">Plot</span><span class="p">(</span><span class="n">data_plot</span><span class="p">,</span><span class="n">thiscol</span><span class="o">=</span><span class="s1">&#39;Blue&#39;</span><span class="p">,</span><span class="n">thissym</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">thisshift</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">tflowlist</span><span class="o">=</span><span class="p">[</span><span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;tflowfit&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span><span class="n">tsum_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ts32&#39;</span><span class="p">])</span>
    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">dataflow</span><span class="o">.</span><span class="n">FitPlot</span><span class="p">(</span><span class="n">data_plot</span><span class="p">,</span><span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;FitsRFFull&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">tflowlist</span><span class="o">=</span><span class="p">[</span><span class="n">defInfoFlow</span><span class="p">[</span><span class="s1">&#39;tflowfit&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span><span class="n">tsum_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ts32&#39;</span><span class="p">])</span>
    <span class="n">data_plot</span><span class="o">.</span><span class="n">PrintData</span><span class="p">()</span>
    <span class="n">data_plot</span><span class="o">.</span><span class="n">PlotAll</span><span class="p">()</span>

    <span class="c1"># this_info = pa.Series()</span>
    <span class="c1"># this_info[&#39;save_file&#39;] = this_dir+&#39;/TestGraphs/testRatFOTsum.pdf&#39;</span>
    <span class="c1"># this_info[&#39;title&#39;] = &#39;Test Ratio FOFull Tsum&#39;</span>
    <span class="c1"># defInfoFlow[&#39;DoubSing&#39;] = &#39;Proton&#39;</span>
    <span class="c1"># defInfoFlow[&#39;gammas&#39;] = [&#39;g4&#39;]</span>
    <span class="c1"># defInfoFlow[&#39;qmom&#39;] = [&#39;0 0 1&#39;]</span>
    <span class="c1"># defInfoFlow[&#39;Projector&#39;] = &#39;P3&#39;</span>
    <span class="c1"># # defInfoFlow[&#39;FitsRFFull&#39;] = [(&#39;taufitr3-7&#39;,&#39;fitr1-10&#39;)]</span>
    <span class="c1"># dataflow = RatioFOFullCorr(Info=defInfoFlow)</span>
    <span class="c1"># dataflow.LoadPickle(DefWipe=False)</span>
    <span class="c1"># import PlotData as jpl</span>
    <span class="c1"># data_plot = jpl.Plotting(plot_info=this_info)</span>
    <span class="c1"># data_plot = dataflow.PlotTsum(data_plot,thiscol=&#39;Blue&#39;,thissym=&#39;o&#39;,thisshift=0.0)</span>
    <span class="c1"># dataflow.Rat_Fit_Stats = pa.DataFrame()</span>
    <span class="c1"># data_plot = dataflow.FitSumPlot(data_plot,defInfoFlow[&#39;FitsRFFull&#39;][0],tcurr=[&#39;t6&#39;],thiscol=&#39;Blue&#39;,thisshift=0.0)</span>
    <span class="c1"># defInfoFlow[&#39;DoubSing&#39;] = &#39;Neutron&#39;</span>
    <span class="c1"># dataflow = RatioFOFullCorr(Info=defInfoFlow)</span>
    <span class="c1"># dataflow.LoadPickle(DefWipe=False)</span>
    <span class="c1"># data_plot = dataflow.PlotTsum(data_plot,thiscol=&#39;Red&#39;,thissym=&#39;*&#39;,thisshift=0.01)</span>
    <span class="c1"># dataflow.Rat_Fit_Stats = pa.DataFrame()</span>
    <span class="c1"># data_plot = dataflow.FitSumPlot(data_plot,defInfoFlow[&#39;FitsRFFull&#39;][0],tcurr=[&#39;t6&#39;],thiscol=&#39;Red&#39;,thisshift=0.01)</span>
    <span class="c1"># data_plot.PrintData()</span>
    <span class="c1"># data_plot.PlotAll()</span>
    <span class="k">return</span> <span class="n">dataflow</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># dataRatFOFull = TestRatFOFull()</span>
    <span class="n">dataRatFO</span> <span class="o">=</span> <span class="n">TestRatFO</span><span class="p">()</span>
    <span class="n">dataRat</span> <span class="o">=</span> <span class="n">TestRat</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ratio function test complete, see variables dataRat and dataRatFO&#39;</span><span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Jack Dragos

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>